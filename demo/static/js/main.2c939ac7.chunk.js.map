{"version":3,"sources":["config.js","version.js","utils/getUserManagerForOpenIdConnectClient.js","store/layout/reducers.js","store/index.js","appExtensions/GenericViewerCommands/commandsModule.js","appExtensions/GenericViewerCommands/index.js","appExtensions/MeasurementsPanel/jumpToRowItem.js","lib/updateTableWithNewMeasurementData.js","lib/getMeasurementLocationCallback.js","appExtensions/MeasurementsPanel/ConnectedMeasurementTable.js","appExtensions/MeasurementsPanel/index.js","components/OHIFLogo/OHIFLogo.js","WhiteLabellingContext.js","components/Header/Header.js","connectedComponents/ConnectedHeader.js","connectedComponents/ConnectedCineDialog.js","connectedComponents/ConnectedLayoutButton.js","connectedComponents/PluginSwitch.js","connectedComponents/ConnectedPluginSwitch.js","connectedComponents/ToolbarRow.js","store/layout/selectors.js","connectedComponents/ConnectedToolbarRow.js","components/SimpleDialog/SimpleDialog.js","lib/utils/bounding.js","components/Labelling/labellingPositionUtils.js","components/EditDescriptionDialog/EditDescriptionDialog.js","components/Labelling/LabellingTransition.js","components/Labelling/OHIFLabellingData.js","components/Labelling/LabellingFlow.js","components/Labelling/LabellingManager.js","connectedComponents/LabellingOverlay.js","connectedComponents/ConnectedLabellingOverlay.js","connectedComponents/ConnectedStudyBrowser.js","connectedComponents/ConnectedLayoutManager.js","connectedComponents/ToolContextMenu.js","connectedComponents/ConnectedToolContextMenu.js","connectedComponents/ViewerMain.js","connectedComponents/ConnectedViewerMain.js","components/SidePanel.js","UserManagerContext.js","connectedComponents/Viewer.js","connectedComponents/ConnectedViewer.js","connectedComponents/ViewerRetrieveStudyData.js","connectedComponents/ConnectedViewerRetrieveStudyData.js","routes/IHEInvokeImageDisplay.js","routes/ViewerRouting.js","lib/filesToStudies.js","connectedComponents/ViewerLocalFileData.js","googleCloud/utils/helpers.js","googleCloud/utils/CancellationToken.js","googleCloud/api/DicomUploadService.js","googleCloud/DicomUploader.js","googleCloud/DicomFileUploaderModal.js","googleCloud/ConnectedDicomFilesUploader.js","googleCloud/api/GoogleCloudApi.js","googleCloud/DicomStoreList.js","googleCloud/DicomStorePicker.js","googleCloud/DatasetsList.js","googleCloud/DatasetPicker.js","googleCloud/ProjectsList.js","googleCloud/ProjectPicker.js","googleCloud/LocationsList.js","googleCloud/LocationPicker.js","googleCloud/DatasetSelector.js","googleCloud/DicomStorePickerModal.js","googleCloud/ConnectedDicomStorePicker.js","studylist/StudyListWithData.js","studylist/ConnectedStudyList.js","studylist/StudyListRouting.js","routes/StandaloneRouting.js","routes/CallbackPage.js","routes/NotFound.js","components/LoadingBar/Bar.js","components/LoadingBar/Container.js","OHIFStandaloneViewer.js","setupTools.js","initCornerstoneTools.js","App.js","utils/initWebWorkers.js","index.js"],"names":["homepage","process","window","env","PUBLIC_URL","info","version","cornerstone","cornerstoneWADOImageLoader","external","dicomParser","OHIF","user","getAccessToken","state","store","getState","oidc","access_token","configure","beforeSend","xhr","headers","DICOMWeb","getAuthorizationHeader","Authorization","setRequestHeader","getUserManagerForOpenIdConnectClient","oidcSettings","userStore","WebStorageStateStore","InMemoryWebStorage","settings","Object","objectSpread","automaticSilentRenew","revokeAccessTokenOnSignout","filterProtocolClaims","loadUserInfo","userManager","createUserManager","loadUser","defaultState","labelling","contextMenu","ui","arguments","length","undefined","action","type","assign","labellingFlowData","viewportIndex","toolContextMenuData","reducers","redux","localStorage","layoutReducers","oidcReducer","rootReducer","combineReducers","createStore","loadState","applyMiddleware","thunkMiddleware","subscribe","saveState","preferences","setViewportActive","actions","updateViewportDisplaySet","_ref","direction","updateActiveViewport","_ref2","viewports","viewportSpecificData","activeViewportIndex","maxIndex","keys","newIndex","dispatch","commandsModule","definitions","incrementActiveViewport","commandFn","storeContexts","options","decrementActiveViewport","defaultContext","GenericViewerCommands","id","getCommandsModule","MeasurementApi","measurements","studyMetadataManager","utils","updateTableWithNewMeasurementData","toolType","measurementNumber","location","description","measurementApi","Instance","tools","filter","m","forEach","measurement","updateMeasurement","syncMeasurementsAndToolData","getEnabledElements","enabledElement","updateImage","element","getMeasurementLocationCallback","eventData","tool","doneCallback","ToolInstance","cornerstoneTools","getToolForElement","configuration","console","warn","setViewportSpecificData","getMeasurementText","measurementData","text","concat","getDataForEachMeasurementNumber","measurementNumberList","timepoints","displayFunction","data","timepoint","eachData","displayText","timepointId","push","convertMeasurementsToTableData","toolCollections","toolGroups","getConfiguration","measurementTools","config","toolGroup","childTools","getAllTools","tableMeasurements","map","groupName","name","groupId","toolId","props","toolMeasurements","find","measurementTable","groupedMeasurements","reduce","a","b","groupedMeasurementsIndex","lesionNamingNumber","measurementId","_id","tableMeasurement","itemNumber","label","hasWarnings","warningTitle","isSplitLesion","warningList","group","tm","sort","m1","m2","convertTimepointsToTableData","key","date","moment","latestDate","format","ConnectedMeasurementTable","connect","_state$timepointManag","timepointManager","measurementCollection","dispatchRelabel","event","viewportsState","enabledElements","log","error","clientX","clientY","skipAddLabelButton","editLocation","dispatchEditDescription","editDescriptionOnDialog","dispatchJumpToRowItem","timepointManagerState","invertViewportTimepointsOrder","childToolKey","numViewports","layout","numTimepoints","numViewportsToUpdate","Math","min","reverse","measurementsForToolGroup","measurementsToJumpTo","_loop","i","dataAtThisTimepoint","entry","getToolConfiguration","Array","isArray","study","get","studyInstanceUid","Error","displaySet","findDisplaySet","sopInstanceUid","images","image","getSOPInstanceUID","displaySetContainsSopInstance","frameIndex","jumpToRowItem","active","measurementToActive","propsFromState","propsFromDispatch","ownProps","selectedMeasurementNumber","onItemClick","onRelabelClick","onEditDescriptionClick","onDeleteClick","MeasurementHandlers","onRemoved","detail","MeasurementTable","MeasurementsPanel","getPanelModule","menuOptions","icon","target","components","component","OHIFLogo","react_default","createElement","rel","className","href","dist_index_es","defaultContextValues","logoComponent","WhiteLabellingContext","React","createContext","Header","_this","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","isUserPreferencesOpen","isOpen","loadOptions","_this2","t","title","onClick","setState","signoutRedirect","hotKeysData","hotkeysManager","hotkeyDefinitions","windowLevelData","_this3","showStudyList","home","studyLink","react_router_dom","to","children","pathname","list","align","onCancel","Component","defaultProps","withTranslation","withRouter","ConnectedHeader","userPreferencesModalOpen","scrollToIndex","toolImport","csTools","import","ConnectedCineDialog","_state$viewports","cine","activeEnabledElement","dom","activeViewportCineData","isPlaying","cineFrameRate","dispatchSetViewportSpecificData","onPlayPauseChanged","cloneDeep","onFrameRateChanged","frameRate","onClickNextButton","stackData","getToolState","_stackData$data$","currentImageIdIndex","imageIds","onClickBackButton","onClickSkipToStart","onClickSkipToEnd","lastIndex","CineDialog","setLayout","ConnectedLayoutButton","currentLayout","onChange","selectedCell","rows","row","columns","col","height","width","LayoutButton","PluginSwitch","buttons","ConnectedPluginSwitch","commandsManager","runCommand","ToolbarRow","toolbarButtonDefinitions","_getVisibleToolbarButtons","assertThisInitialized","toolbarButtons","activeButtons","isCineDialogOpen","_handleBuiltIn","behavior","bind","panelModules","extensionManager","modules","MODULE_TYPES","PANEL","buttonGroups","left","value","bottomLabel","right","panelExtension","panelModule","module","defaultContexts","from","menuOption","contexts","context","activeContexts","some","actx","includes","menuOptionEntry","prevProps","buttonComponents","button","index","activeCommand","childButtons","childButton","_handleToolbarButtonClick","indexOf","isActive","cineDialogContainerStyle","display","position","top","zIndex","onPress","side","handleSidePanelChange","onPressLeft","onPressRight","Fragment","style","padding","selectedLeftSidePanel","onValueChanged","connectedComponents_ConnectedLayoutButton","connectedComponents_ConnectedPluginSwitch","marginLeft","selectedRightSidePanel","connectedComponents_ConnectedCineDialog","evt","commandName","commandOptions","_this4","toolbarModules","TOOLBAR","extension","_extension$module","definition","getActiveContexts","createSelector","layoutViewports","activeLayoutViewport","activeViewportSpecificData","activeViewportPluginName","plugin","activeViewportExtension","toUpperCase","ConnectedToolbarRow","SimpleDialog","rootClass","ref","componentRef","componentStyle","onSubmit","onConfirm","onClose","headerTitle","bounding","elementRef","currentPosition","current","currentElement","offsetParent","offsetTop","offsetHeight","offsetLeft","offsetWidth","maxHeight","buttonSize","EditDescriptionDialog","componentDidMount","mainElement","e","preventDefault","onUpdate","handleChange","createRef","dialogProps","maxLeft","innerWidth","maxTop","innerHeight","getDialogStyle","components_SimpleDialog_SimpleDialog","autoComplete","autoFocus","LabellingTransition","CSSTransition","in","displayComponent","appear","timeout","classNames","onExited","onTransitionExit","OHIFLabellingData","item","LabellingFlow","componentDidUpdate","repositionComponent","editDescription","descriptionInput","focus","labellingStateFragment","_this$state","locationLabel","items","currentItems","onSelected","selectTreeSelectCalback","selectTreeFirstTitle","onComponentChange","fadeOutAndLeaveFast","defaultValue","relabel","setDescriptionUpdateMode","descriptionCancel","descriptionSave","showLabelling","viewportTopPosition","nativeEvent","y","x","_cloneDeep$descriptio","updateLabelling","itemSelected","confirmationState","isTouchScreen","setTimeout","fadeOutAndLeave","fadeOutTimer","clearFadeOutTimer","clearTimeout","calculateTopDistance","_props$measurementDat","_measurementData$hand","handles","start","end","client","currentPoints","clientStart","pixelToCanvas","clientEnd","canvasOffSetLeft","canvasOffSetTop","getAddLabelButtonStyle","initialItems","mainElementClassName","initialTopDistance","LabellingTransition_LabellingTransition","labellingDoneCallback","onMouseLeave","onMouseEnter","LabellingManager","document","addEventListener","onTouchStart","componentWillUnmount","removeEventListener","getRenderComponent","EditDescriptionDialog_EditDescriptionDialog_EditDescriptionDialog","descriptionDialogUpdate","editDescriptionDialog","LabellingFlow_LabellingFlow","treatMeasurementData","_this$props","responseDialogUpdate","response","getComponentPosition","_eventData$event","LabellingOverlay","visible","LabellingManager_LabellingManager","ConnectedLabellingOverlay","ConnectedStudyBrowser","stackLoadingProgressMap","loading","progress","studiesWithLoadingData","studies","thumbnails","displaySetInstanceUid","stackId","stackProgressData","stackPercentComplete","percentComplete","StudyBrowser","ConnectedLayoutManager","defaultPlugin","availableViewportModules","viewportModules","VIEWPORT","moduleDefinition","extensionId","availablePlugins","LayoutManager","toolTypes","defaultDropdownItems","actionType","nearbyToolData","removeToolState","_ref3","getDropdownItems","isTouchEvent","coords","nearbyTool","pointNearTool","toolData","toolInterface","getNearbyToolData","canvas","dropdownItems","params","ToolContextMenu","updateElementPosition","_this$mainElement$cur","offBoundPixels","availableTools","dropdownComponents","ConnectedToolContextMenu","extensions","ViewerMain","getViewportData","viewportData","cachedViewportData","originalDisplaySet","displaySets","ds","v","setViewportData","dSet","getDisplaySets","connectedComponents_ConnectedLayoutManager","connectedComponents_ConnectedToolContextMenu","clearViewportSpecificData","ConnectedViewerMain","SidePanel","fromSideClass","styles","maxWidth","marginRight","Number","parseInt","is-open","UserManagerContext","Viewer","isLeftSidePanelOpen","isRightSidePanelOpen","retrieveMeasurements","patientId","timepointIds","Promise","resolve","storeMeasurements","retrieveTimepoints","earliestDate","Date","toISOString","studyDate","timepointType","studyInstanceUids","isLocked","storeTimepoints","timepointData","updateTimepoint","query","removeTimepoint","disassociateStudy","onTimepointsUpdated","onMeasurementsUpdated","setConfiguration","dataExchange","retrieve","TimepointApi","remove","update","disassociate","_OHIF$measurements","timepointApi","currentTimepointId","_mapStudiesToThumbnails","VisiblePanelLeft","VisiblePanelRight","panelExt","comp","src_WhiteLabellingContext","Consumer","whiteLabelling","src_UserManagerContext","connectedComponents_ConnectedHeader","connectedComponents_ConnectedToolbarRow","selectedPanel","sideClicked","slice","openKey","selectedKey","updatedState","prevSelectedPanel","isSameSelectedPanel","src_components_SidePanel","activeIndex","connectedComponents_ConnectedStudyBrowser","connectedComponents_ConnectedViewerMain","connectedComponents_ConnectedLabellingOverlay","imageId","altImageText","seriesDescription","seriesNumber","instanceNumber","numImageFrames","modality","imageIndex","floor","getImageId","setTimepoints","setMeasurements","ConnectedViewer","OHIFStudyMetadata","metadata","retrieveStudiesMetadata","updateMetaDataManager","ViewerRetrieveStudyData","seriesInstanceUids","server","purge","updatedStudies","studyMetadata","sopClassHandlerModules","createDisplaySets","setDisplaySets","add","_context","t0","JSON","stringify","connectedComponents_ConnectedViewer","ConnectedViewerRetrieveStudyData","servers","studyUids","_getQueryParameters","queryString","parse","search","getQueryParameters","requestType","studyUID","connectedComponents_ConnectedViewerRetrieveStudyData","split","atob","ViewerRouting","studyUIDs","seriesUIDs","match","_match$params","datasetsToStudies","datasets","StudyInstanceUIDs","Set","StudyInstanceUID","studyDatasets","firstDataset","StudyDate","studyTime","StudyTime","accessionNumber","AccessionNumber","referringPhysicianName","ReferringPhysicianName","patientName","PatientName","PatientID","patientBirthdate","PatientBirthDate","patientSex","PatientSex","studyId","StudyID","studyDescription","StudyDescription","seriesList","SeriesInstanceUIDs","SeriesInstanceUID","seriesInstanceUid","seriesDatasets","SOPInstanceUIDs","SOPInstanceUID","SeriesDescription","SeriesNumber","instances","instance","sopClassUid","SOPClassUID","Rows","Columns","numberOfFrames","NumberOfFrames","InstanceNumber","filesToStudies","_x","_filesToStudies","apply","_callee","files","imagePromises","regenerator_default","wrap","prev","next","file","wadouri","fileManager","loadAndCacheImage","catch","all","sent","arrayBuffer","byteArray","buffer","dicomData","dcmjs","DicomMessage","readFile","dataset","DicomMetaDictionary","naturalizeDataset","dict","_meta","namifyDataset","meta","abrupt","stop","ViewerLocalFileData","updateStudies","onDrop","asyncToGenerator","mark","acceptedFiles","dist_es","getRootProps","getInputProps","formatFileSize","size","n","pow","toFixed","httpErrorToStr","jsonResponse","code","message","err","checkDicomFile","arr","Uint8Array","every","char","charCodeAt","CancellationToken","cancelled","api_DicomUploadService","url","uploadCallback","cancellationToken","CHUNK_SIZE","MAX_PARALLEL_JOBS","filesArray","parallelJobsCount","completed","processJob","reject","_ret","_context2","chunk","simpleUpload","fileId","delegateYield","getClient","loadedFile","content","storeInstances","reader","FileReader","onload","result","onerror","readAsArrayBuffer","func","retrieveAuthHeaderFunc","api","DICOMwebClient","DicomUploader","status","isCancelled","errorsCount","uploadedVolume","wholeVolumeStr","isFilesListHidden","timeLeft","uploadedList","totalCount","successfullyUploadedCount","lastFile","uploadContext","uploadFiles","filesDict","fileDesc","path","webkitRelativePath","processed","processedInUI","wholeVolume","f","random","dicomUploader","setRetrieveAuthHeaderFunction","retrieveAuthHeaderFunction","smartUpload","renderTableRow","color","errors","htmlFor","src","alt","multiple","webkitdirectory","mozdirectory","percents","filesLeft","DicomFileUploaderModal","uploaded","Modal_default","show","onHide","aria-labelledby","backdrop","keyboard","closeButton","Title","Body","DicomUploader_DicomUploader","ConnectedDicomFileUploader","activeServer","qidoRoot","api_GoogleCloudApi","accessToken","urlStr","URL","URLSearchParams","fetch","fetchConfig","json","nextPageToken","pageToken","doRequest","subPage","hasOwnProperty","isError","t1","projectId","urlBaseProject","locationId","urlBase","method","DicomStoreList","highlightedItem","onHighlightItem","onSelect","loadingIcon","body","stores","DicomStorePicker","locations","setAccessToken","loadDicomStores","dicomStores","googleCloud_DicomStoreList","DatasetsList","DatasetPicker","loadDatasets","project","googleCloud_DatasetsList","ProjectsList","projects","ProjectPicker","loadProjects","googleCloud_ProjectsList","LocationsList","LocationPicker","loadLocations","googleCloud_LocationsList","DatasetSelector","unloading","onProjectSelect","onLocationSelect","onDatasetSelect","onProjectClick","onLocationClick","onDatasetClick","onDicomStoreSelect","dicomStoreJson","dicomStore","parts","wadoUriRoot","GoogleCloudApi","wadoRoot","setServers","projectBreadcrumbs","ProjectPicker_ProjectPicker","LocationPicker_LocationPicker","DatasetPicker_DatasetPicker","DicomStorePicker_DicomStorePicker","DicomStorePickerModal","handleEvent","imageRendering","thumbnailRendering","qidoSupportsIncludeField","supportsFuzzyMatching","googleCloud_DatasetSelector","ConnectedDicomStorePicker","StudyListWithData","searchData","modalComponentId","searchForStudies","defaultSearchData","modalitiesInStudy","modalities","studyDateFrom","studyDateTo","limit","rowsPerPage","offset","currentPage","fuzzymatching","searchStudies","then","_searchData$sortData","sortData","field","order","sortedStudies","isValid","fieldA","fieldB","onImport","openModal","closeModal","onSelectItem","studyInstanceUID","history","onSearch","closeModals","enableGoogleCloudAdapter","filters","healthCareApiButtons","healthCareApiWindows","googleCloud_ConnectedDicomStorePicker","studyList","studyListFunctionsEnabled","pageSize","defaultSort","studyListDateFilterNumDays","ConnectedDicomFilesUploader","defaultStudyDateFrom","subtract","toDate","defaultStudyDateTo","ConnectedStudyList","_ref4","searchParameters","entries","word","slicedToArray","toLowerCase","getFilters","studylist_ConnectedStudyList","StandaloneRouting","qs","parseQueryAndFetchStudies","src_connectedComponents_Viewer","oReq","XMLHttpRequest","responseText","dicomWeb","open","send","CallbackPage","redux_oidc","successCallback","sessionStorage","getItem","errorCallback","NotFound","Bar","animationDuration","background","transition","boxShadow","opacity","transform","Container","isFinished","pointerEvents","reload","OHIFStandaloneViewer","isLoading","unlisten","listen","setContext","expired","setItem","react_router","exact","onEnter","render","routes_CallbackPage","getUser","signinSilent","signinRedirect","routes","IHEInvokeImageDisplay","StudyListRouting","currentPath","noMatchingRoutes","r","matchPath","react_nprogress","isAnimating","LoadingBar_Container","LoadingBar_Bar","unmountOnExit","onEntered","NotFound_NotFound","ConnectedOHIFStandaloneViewer","ViewerbaseDragDropContext","resetLabellingAndContextMenuAction","setToolContextMenuDataAction","getOnRightClickCallback","getOnCloseCallback","setToolContextMenuData","getOnTouchPressCallback","getResetLabellingAndContextMenu","Hammer","cornerstoneMath","init","textStyle","setFont","toolStyle","setToolWidth","toolColors","setToolColor","setActiveColor","touchProximity","initCornerstoneTools","globalToolSyncEnabled","showSVGCursors","commandsManagerConfig","getAppState","CommandsManager","HotkeysManager","ExtensionManager","makeAbsoluteIfNecessary","base_url","isAbsoluteUrl","toolLabellingFlowCallback","setLabellingFlowData","setLabellingFlowDataAction","editResponse","getToolLabellingFlowCallback","mouseButtonMasks","onRightClick","onTouchPress","onNewImage","onMouseClick","toolAction","setExtensionData","setupTools","registerExtensions","OHIFCornerstoneExtension","OHIFVTKExtension","OHIFDicomPDFExtension","OHIFDicomHtmlExtension","OHIFDicomMicroscopyExtension","hotkeys","setHotkeys","App","firstOpenIdClient","_window$location","protocol","host","routerBasename","baseUri","redirect_uri","silent_redirect_uri","post_logout_redirect_uri","openIdConnectConfiguration","addServers","maxWebWorkers","max","navigator","hardwareConcurrency","startWebWorkersOnDemand","taskConfiguration","decodeTask","initializeCodecsOnStartup","usePDFJS","strict","webWorkerManager","initialize","initWebWorkers","react_redux_es","es","i18n","Provider","basename","src_OHIFStandaloneViewer_0","__webpack_require__","d","__webpack_exports__","src_App","applicationProps","app","ReactDOM","getElementById"],"mappings":"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","file":"static/js/main.2c939ac7.chunk.js","sourcesContent":["import OHIF from 'ohif-core';\nimport cornerstone from 'cornerstone-core';\nimport cornerstoneWADOImageLoader from 'cornerstone-wado-image-loader';\nimport dicomParser from 'dicom-parser';\nimport version from './version.js';\n\nlet homepage;\nconst { process } = window;\nif (process && process.env && process.env.PUBLIC_URL) {\n  homepage = process.env.PUBLIC_URL;\n}\n\nwindow.info = {\n  version,\n  homepage,\n};\n\n// For debugging\n//if (process.env.node_env === 'development') {\nwindow.cornerstone = cornerstone;\nwindow.cornerstoneWADOImageLoader = cornerstoneWADOImageLoader;\n//}\n\ncornerstoneWADOImageLoader.external.cornerstone = cornerstone;\ncornerstoneWADOImageLoader.external.dicomParser = dicomParser;\n\nOHIF.user.getAccessToken = () => {\n  // TODO: Get the Redux store from somewhere else\n  const state = window.store.getState();\n  if (!state.oidc || !state.oidc.user) {\n    return;\n  }\n\n  return state.oidc.user.access_token;\n};\n\ncornerstoneWADOImageLoader.configure({\n  beforeSend: function(xhr) {\n    const headers = OHIF.DICOMWeb.getAuthorizationHeader();\n\n    if (headers.Authorization) {\n      xhr.setRequestHeader('Authorization', headers.Authorization);\n    }\n  },\n});\n","export default '0.0.21';\n","// https://github.com/maxmantz/redux-oidc/blob/master/docs/API.md\nimport { loadUser, createUserManager } from 'redux-oidc';\nimport { WebStorageStateStore, InMemoryWebStorage } from 'oidc-client';\n\n/**\n * Creates a userManager from oidcSettings;\n * loads the user into the provided redux store\n * LINK: https://github.com/IdentityModel/oidc-client-js/wiki#configuration\n *\n * @param {*} store\n * @param {Object} oidcSettings\n * @param {string} oidcSettings.authServerUrl,\n * @param {string} oidcSettings.clientId,\n * @param {string} oidcSettings.authRedirectUri,\n * @param {string} oidcSettings.postLogoutRedirectUri,\n * @param {string} oidcSettings.responseType,\n * @param {string} oidcSettings.extraQueryParams,\n */\nexport default function(store, oidcSettings) {\n  if (!store || !oidcSettings) {\n    return;\n  }\n\n  // Do not store tokens in localStorage or sessionStorage\n  // https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/HTML5_Security_Cheat_Sheet.md#local-storage\n  const userStore = new WebStorageStateStore({ store: new InMemoryWebStorage() });\n\n  const settings = {\n    ...oidcSettings,\n    automaticSilentRenew: true,\n    revokeAccessTokenOnSignout: true,\n    filterProtocolClaims: true,\n    loadUserInfo: true,\n    userStore,\n  };\n\n  const userManager = createUserManager(settings);\n\n  loadUser(store, userManager);\n\n  return userManager;\n}\n","const defaultState = {\n  labelling: {},\n  contextMenu: {},\n};\n\nconst ui = (state = defaultState, action) => {\n  switch (action.type) {\n    case 'SET_LABELLING_FLOW_DATA': {\n      const labelling = Object.assign({}, action.labellingFlowData);\n\n      return Object.assign({}, state, { labelling });\n    }\n    case 'SET_TOOL_CONTEXT_MENU_DATA': {\n      const contextMenu = Object.assign({}, state.contextMenu);\n\n      contextMenu[action.viewportIndex] = Object.assign(\n        {},\n        action.toolContextMenuData\n      );\n\n      return Object.assign({}, state, { contextMenu });\n    }\n    case 'RESET_LABELLING_AND_CONTEXT_MENU':\n      return Object.assign({}, state, {\n        labelling: defaultState.labelling,\n        contextMenu: defaultState.contextMenu,\n      });\n    default:\n      return state;\n  }\n};\n\nexport default ui;\n","import { applyMiddleware, combineReducers, createStore } from 'redux';\n\n// import { createLogger } from 'redux-logger';\nimport layoutReducers from './layout/reducers.js';\nimport { reducer as oidcReducer } from 'redux-oidc';\nimport { redux } from 'ohif-core';\nimport thunkMiddleware from 'redux-thunk';\n\n// Combine our ohif-core, ui, and oidc reducers\n// Set init data, using values found in localStorage\nconst { reducers, localStorage } = redux;\n// const loggerMiddleware = createLogger();\n\nreducers.ui = layoutReducers;\nreducers.oidc = oidcReducer;\n\nconst rootReducer = combineReducers(reducers);\nconst store = createStore(\n  rootReducer,\n  localStorage.loadState(), // preloadedState\n  applyMiddleware(\n    thunkMiddleware // Lets us dispatch() functions\n    // loggerMiddleware // neat middleware that logs actions\n  )\n);\n\n// When the store's preferences change,\n// Update our cached preferences in localStorage\nstore.subscribe(() => {\n  localStorage.saveState({\n    preferences: store.getState().preferences,\n  });\n});\n\nexport default store;\n","import { redux } from 'ohif-core';\nimport store from './../../store';\nconst { setViewportActive } = redux.actions;\n\nconst actions = {\n  updateViewportDisplaySet: ({ direction }) => {\n    // TODO\n    // console.warn('updateDisplaySet: ', direction);\n  },\n  updateActiveViewport: ({ viewports, direction }) => {\n    const { viewportSpecificData, activeViewportIndex } = viewports;\n    const maxIndex = Object.keys(viewportSpecificData).length - 1;\n\n    let newIndex = activeViewportIndex + direction;\n    newIndex = newIndex > maxIndex ? 0 : newIndex;\n    newIndex = newIndex < 0 ? maxIndex : newIndex;\n\n    store.dispatch(setViewportActive(newIndex));\n  },\n};\n\nconst definitions = {\n  // Next/Previous active viewport\n  incrementActiveViewport: {\n    commandFn: actions.updateActiveViewport,\n    storeContexts: ['viewports'],\n    options: { direction: 1 },\n  },\n  decrementActiveViewport: {\n    commandFn: actions.updateActiveViewport,\n    storeContexts: ['viewports'],\n    options: { direction: -1 },\n  },\n};\n\nexport default {\n  definitions,\n  defaultContext: 'VIEWER',\n};\n","import commandsModule from './commandsModule.js';\n\nexport default {\n  id: 'generic-viewer-commands',\n  getCommandsModule() {\n    return commandsModule;\n  },\n};\n","import { measurements, utils } from 'ohif-core';\n\nconst { MeasurementApi } = measurements;\nconst { studyMetadataManager } = utils;\n\n// TODO: Move this function to OHIF itself so we can use it on the OHIF measurment table (when it is finished)\n\n/**\n * Activates a set of measurements\n *\n * @param measurementData\n * @param viewportsState\n * @param timepointManagerState\n * @param options\n */\nexport default function jumpToRowItem(\n  measurementData,\n  viewportsState,\n  timepointManagerState,\n  options = { invertViewportTimepointsOrder: false, childToolKey: null }\n) {\n  const numViewports = viewportsState.layout.viewports.length;\n  const numTimepoints = timepointManagerState.timepoints.length;\n  const { measurements, timepoints } = timepointManagerState;\n  const numViewportsToUpdate = Math.min(numTimepoints, numViewports);\n  const { toolType, measurementNumber } = measurementData;\n\n  if (options.invertViewportTimepointsOrder) {\n    timepoints.reverse();\n  }\n\n  const measurementsForToolGroup = measurements[toolType];\n\n  // Retrieve the measurements data\n  const measurementsToJumpTo = [];\n  for (let i = 0; i < numViewportsToUpdate; i++) {\n    const { timepointId } = timepoints[i];\n\n    const dataAtThisTimepoint = measurementsForToolGroup.find(entry => {\n      return (\n        entry.timepointId === timepointId &&\n        entry.measurementNumber === measurementNumber\n      );\n    });\n\n    if (!dataAtThisTimepoint) {\n      measurementsToJumpTo.push(null);\n      continue;\n    }\n\n    let measurement = dataAtThisTimepoint;\n\n    const { tool } = MeasurementApi.getToolConfiguration(toolType);\n    if (options.childToolKey) {\n      measurement = dataAtThisTimepoint[options.childToolKey];\n    } else if (Array.isArray(tool.childTools)) {\n      const key = tool.childTools.find(key => !!dataAtThisTimepoint[key]);\n      measurement = dataAtThisTimepoint[key];\n    }\n\n    measurementsToJumpTo.push(measurement);\n  }\n\n  // TODO: Add a single viewports state action which allows\n  // - viewportData to be set\n  // - layout to be set\n  // - activeViewport to be set\n\n  // Needs to update viewports.viewportData state to set image set data\n\n  const displaySetContainsSopInstance = (displaySet, sopInstanceUid) =>\n    displaySet.images.find(\n      image => image.getSOPInstanceUID() === sopInstanceUid\n    );\n\n  const viewportSpecificData = [];\n  measurementsToJumpTo.forEach((data, viewportIndex) => {\n    // Skip if there is no measurement to jump\n    if (!data) {\n      return;\n    }\n\n    const study = studyMetadataManager.get(data.studyInstanceUid);\n    if (!study) {\n      throw new Error('Study not found.');\n    }\n\n    const displaySet = study.findDisplaySet(displaySet => {\n      return displaySetContainsSopInstance(displaySet, data.sopInstanceUid);\n    });\n\n    if (!displaySet) {\n      throw new Error('Display set not found.');\n    }\n\n    displaySet.sopInstanceUid = data.sopInstanceUid;\n    if (data.frameIndex) {\n      displaySet.frameIndex = data.frameIndex;\n    }\n\n    viewportSpecificData.push({\n      viewportIndex,\n      displaySet,\n    });\n  });\n\n  return {\n    viewportSpecificData,\n    layout: [], // TODO: if we need to change layout, we should return this here\n  };\n}\n","import OHIF from 'ohif-core';\nimport cornerstone from 'cornerstone-core';\n\nexport default function updateTableWithNewMeasurementData({\n  toolType,\n  measurementNumber,\n  location,\n  description,\n}) {\n  // Update all measurements by measurement number\n  const measurementApi = OHIF.measurements.MeasurementApi.Instance;\n  const measurements = measurementApi.tools[toolType].filter(\n    m => m.measurementNumber === measurementNumber\n  );\n\n  measurements.forEach(measurement => {\n    measurement.location = location;\n    measurement.description = description;\n\n    measurementApi.updateMeasurement(measurement.toolType, measurement);\n  });\n\n  measurementApi.syncMeasurementsAndToolData();\n\n  // Update images in all active viewports\n  cornerstone.getEnabledElements().forEach(enabledElement => {\n    cornerstone.updateImage(enabledElement.element);\n  });\n}\n","import cornerstoneTools from 'cornerstone-tools';\nimport updateTableWithNewMeasurementData from './updateTableWithNewMeasurementData';\n\nexport default function getMeasurementLocationCallback(\n  eventData,\n  tool,\n  options\n) {\n  const { toolType } = tool;\n  const { element } = eventData;\n  const doneCallback = updateTableWithNewMeasurementData;\n\n  const ToolInstance = cornerstoneTools.getToolForElement(element, toolType);\n\n  if (\n    !ToolInstance ||\n    !ToolInstance.configuration ||\n    !ToolInstance.configuration.getMeasurementLocationCallback\n  ) {\n    console.warn(\n      'Tool instance configuration is missing: getMeasurementLocationCallback'\n    );\n\n    return;\n  }\n\n  ToolInstance.configuration.getMeasurementLocationCallback(\n    tool,\n    eventData,\n    doneCallback,\n    options\n  );\n}\n","import { connect } from 'react-redux';\nimport { MeasurementTable } from 'react-viewerbase';\nimport OHIF from 'ohif-core';\nimport moment from 'moment';\nimport cornerstone from 'cornerstone-core';\n\n//\nimport jumpToRowItem from './jumpToRowItem.js';\nimport getMeasurementLocationCallback from './../../lib/getMeasurementLocationCallback';\n\nconst { setViewportSpecificData } = OHIF.redux.actions;\nconst { MeasurementApi } = OHIF.measurements;\n\nfunction groupBy(list, props) {\n  return list.reduce((a, b) => {\n    (a[b[props]] = a[b[props]] || []).push(b);\n    return a;\n  }, {});\n}\n\nfunction getAllTools() {\n  const config = OHIF.measurements.MeasurementApi.getConfiguration();\n  let tools = [];\n  config.measurementTools.forEach(\n    toolGroup => (tools = tools.concat(toolGroup.childTools))\n  );\n\n  return tools;\n}\n\nfunction getMeasurementText(measurementData) {\n  const { location, description } = measurementData;\n  let text = '...';\n  if (location) {\n    text = location;\n    if (description) {\n      text += `(${description})`;\n    }\n  }\n  return text;\n}\n\nfunction getDataForEachMeasurementNumber(\n  measurementNumberList,\n  timepoints,\n  displayFunction\n) {\n  const data = [];\n  // on each measurement number we should get each measurement data by available timepoint\n  measurementNumberList.forEach(measurement => {\n    timepoints.forEach(timepoint => {\n      const eachData = {\n        displayText: '...',\n      };\n      if (measurement.timepointId === timepoint.timepointId) {\n        eachData.displayText = displayFunction(measurement);\n      }\n      data.push(eachData);\n    });\n  });\n\n  return data;\n}\n\nfunction convertMeasurementsToTableData(toolCollections, timepoints) {\n  const config = OHIF.measurements.MeasurementApi.getConfiguration();\n  const toolGroups = config.measurementTools;\n  const tools = getAllTools();\n\n  const tableMeasurements = toolGroups.map(toolGroup => {\n    return {\n      groupName: toolGroup.name,\n      groupId: toolGroup.id,\n      measurements: [],\n    };\n  });\n\n  Object.keys(toolCollections).forEach(toolId => {\n    const toolMeasurements = toolCollections[toolId];\n    const tool = tools.find(tool => tool.id === toolId);\n    const { displayFunction } = tool.options.measurementTable;\n\n    // Group by measurementNumber so we can display then all in the same line\n    const groupedMeasurements = groupBy(toolMeasurements, 'measurementNumber');\n\n    Object.keys(groupedMeasurements).forEach(groupedMeasurementsIndex => {\n      const measurementNumberList =\n        groupedMeasurements[groupedMeasurementsIndex];\n      const measurementData = measurementNumberList[0];\n      const {\n        measurementNumber,\n        lesionNamingNumber,\n        toolType,\n      } = measurementData;\n      const measurementId = measurementData._id;\n\n      //check if all measurements with same measurementNumber will have same LABEL\n      const tableMeasurement = {\n        itemNumber: lesionNamingNumber,\n        label: getMeasurementText(measurementData),\n        measurementId,\n        measurementNumber,\n        lesionNamingNumber,\n        toolType,\n        hasWarnings: false, //TODO\n        warningTitle: '', //TODO\n        isSplitLesion: false, //TODO\n        warningList: [], //TODO\n        data: getDataForEachMeasurementNumber(\n          measurementNumberList,\n          timepoints,\n          displayFunction\n        ),\n      };\n\n      // find the group object for the tool\n      const toolGroupMeasurements = tableMeasurements.find(group => {\n        return group.groupId === tool.toolGroup;\n      });\n      // inject the new measurement for this measurementNumer\n      toolGroupMeasurements.measurements.push(tableMeasurement);\n    });\n  });\n\n  // Sort measurements by lesion naming number\n  tableMeasurements.forEach(tm => {\n    tm.measurements.sort((m1, m2) =>\n      m1.lesionNamingNumber > m2.lesionNamingNumber ? 1 : -1\n    );\n  });\n\n  return tableMeasurements;\n}\n\nfunction convertTimepointsToTableData(timepoints) {\n  if (!timepoints || !timepoints.length) {\n    return [];\n  }\n\n  return [\n    {\n      label: 'Study date:',\n      key: 'StudyDate',\n      date: moment(timepoints[0].latestDate).format('DD-MMM-YY'),\n    },\n  ];\n}\n\nconst mapStateToProps = state => {\n  const { timepoints, measurements } = state.timepointManager;\n  return {\n    timepoints: convertTimepointsToTableData(timepoints),\n    measurementCollection: convertMeasurementsToTableData(\n      measurements,\n      timepoints\n    ),\n    timepointManager: state.timepointManager,\n    viewports: state.viewports,\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    dispatchRelabel: (event, measurementData, viewportsState) => {\n      const activeViewportIndex =\n        (viewportsState && viewportsState.activeViewportIndex) || 0;\n\n      const enabledElements = cornerstone.getEnabledElements();\n      if (!enabledElements || enabledElements.length <= activeViewportIndex) {\n        OHIF.log.error('Failed to find the enabled element');\n        return;\n      }\n\n      const { element } = enabledElements[activeViewportIndex];\n\n      const eventData = {\n        event: {\n          clientX: event.clientX,\n          clientY: event.clientY,\n        },\n        element,\n      };\n\n      const { toolType, measurementId } = measurementData;\n      const tool = MeasurementApi.Instance.tools[toolType].find(measurement => {\n        return measurement._id === measurementId;\n      });\n\n      const options = {\n        skipAddLabelButton: true,\n        editLocation: true,\n      };\n\n      // Clone the tool not to set empty location initially\n      const toolForLocation = Object.assign({}, tool, { location: null });\n      getMeasurementLocationCallback(eventData, toolForLocation, options);\n    },\n    dispatchEditDescription: (event, measurementData, viewportsState) => {\n      const activeViewportIndex =\n        (viewportsState && viewportsState.activeViewportIndex) || 0;\n\n      const enabledElements = cornerstone.getEnabledElements();\n      if (!enabledElements || enabledElements.length <= activeViewportIndex) {\n        OHIF.log.error('Failed to find the enabled element');\n        return;\n      }\n\n      const { element } = enabledElements[activeViewportIndex];\n\n      const eventData = {\n        event: {\n          clientX: event.clientX,\n          clientY: event.clientY,\n        },\n        element,\n      };\n\n      const { toolType, measurementId } = measurementData;\n      const tool = MeasurementApi.Instance.tools[toolType].find(measurement => {\n        return measurement._id === measurementId;\n      });\n\n      const options = {\n        editDescriptionOnDialog: true,\n      };\n\n      getMeasurementLocationCallback(eventData, tool, options);\n    },\n    dispatchJumpToRowItem: (\n      measurementData,\n      viewportsState,\n      timepointManagerState,\n      options\n    ) => {\n      const actionData = jumpToRowItem(\n        measurementData,\n        viewportsState,\n        timepointManagerState,\n        dispatch,\n        options\n      );\n\n      actionData.viewportSpecificData.forEach(viewportSpecificData => {\n        const { viewportIndex, displaySet } = viewportSpecificData;\n\n        dispatch(setViewportSpecificData(viewportIndex, displaySet));\n      });\n\n      const { toolType, measurementNumber } = measurementData;\n      const measurementApi = MeasurementApi.Instance;\n\n      Object.keys(measurementApi.tools).forEach(toolType => {\n        const measurements = measurementApi.tools[toolType];\n\n        measurements.forEach(measurement => {\n          measurement.active = false;\n        });\n      });\n\n      const measurementsToActive = measurementApi.tools[toolType].filter(\n        measurement => {\n          return measurement.measurementNumber === measurementNumber;\n        }\n      );\n\n      measurementsToActive.forEach(measurementToActive => {\n        measurementToActive.active = true;\n      });\n\n      measurementApi.syncMeasurementsAndToolData();\n\n      cornerstone.getEnabledElements().forEach(enabledElement => {\n        cornerstone.updateImage(enabledElement.element);\n      });\n\n      // Needs to update viewports.layout state to set layout\n      //const layout = actionData.layout;\n      //dispatch(setLayout(layout))\n\n      // Needs to update viewports.activeViewportIndex to the first updated viewport\n      //const viewportIndex = actionData.viewportIndex;\n      //dispatch(setViewportActive(viewportIndex));\n\n      // Needs to update timepointsManager.measurements state to set active measurementId\n      // TODO: Not yet implemented\n      //dispatch(setActiveMeasurement(measurementData.measurementId))\n\n      // (later): Needs to set some property on state.extensions.cornerstone to synchronize viewport scrolling\n    },\n  };\n};\n\nconst mergeProps = (propsFromState, propsFromDispatch, ownProps) => {\n  return {\n    timepoints: propsFromState.timepoints,\n    measurementCollection: propsFromState.measurementCollection,\n    selectedMeasurementNumber: ownProps.selectedMeasurementNumber,\n    ...propsFromDispatch,\n    onItemClick: (event, measurementData) => {\n      // TODO: Add timepointId to .data for measurementData?\n      // TODO: Tooltype should be on the level below? This should\n      // provide the entire row item?\n\n      const viewportsState = propsFromState.viewports;\n      const timepointManagerState = propsFromState.timepointManager;\n\n      // TODO: invertViewportTimepointsOrder should be stored in / read from user preferences\n      // TODO: childToolKey should come from the measurement table when it supports child tools\n      const options = {\n        invertViewportTimepointsOrder: false,\n        childToolKey: null,\n      };\n\n      propsFromDispatch.dispatchJumpToRowItem(\n        measurementData,\n        viewportsState,\n        timepointManagerState,\n        options\n      );\n    },\n    onRelabelClick: (event, measurementData) => {\n      const viewportsState = propsFromState.viewports;\n      propsFromDispatch.dispatchRelabel(event, measurementData, viewportsState);\n    },\n    onEditDescriptionClick: (event, measurementData) => {\n      const viewportsState = propsFromState.viewports;\n      propsFromDispatch.dispatchEditDescription(\n        event,\n        measurementData,\n        viewportsState\n      );\n    },\n    onDeleteClick: (event, measurementData) => {\n      const { MeasurementHandlers } = OHIF.measurements;\n\n      MeasurementHandlers.onRemoved({\n        detail: {\n          toolType: measurementData.toolType,\n          measurementData: {\n            _id: measurementData.measurementId,\n            lesionNamingNumber: measurementData.lesionNamingNumber,\n            measurementNumber: measurementData.measurementNumber,\n          },\n        },\n      });\n    },\n  };\n};\n\nconst ConnectedMeasurementTable = connect(\n  mapStateToProps,\n  mapDispatchToProps,\n  mergeProps\n)(MeasurementTable);\n\nexport default ConnectedMeasurementTable;\n","import ConnectedMeasurementTable from './ConnectedMeasurementTable.js';\n\nexport default {\n  id: 'measurements-table',\n  getPanelModule() {\n    return {\n      menuOptions: [\n        {\n          icon: 'list',\n          label: 'Measurements',\n          target: 'measurement-panel',\n        },\n      ],\n      components: [\n        {\n          id: 'measurement-panel',\n          component: ConnectedMeasurementTable,\n        },\n      ],\n      defaultContext: ['VIEWER'],\n    };\n  },\n};\n","import './OHIFLogo.css';\n\nimport { Icon } from 'react-viewerbase';\nimport React from 'react';\n\nfunction OHIFLogo() {\n  return (\n    <a\n      target=\"_blank\"\n      rel=\"noopener noreferrer\"\n      className=\"header-brand\"\n      href=\"http://ohif.org\"\n    >\n      <Icon name=\"ohif-logo\" className=\"header-logo-image\" />\n      <div className=\"header-logo-text\">Open Health Imaging Foundation</div>\n    </a>\n  );\n}\n\nexport default OHIFLogo;\n","import OHIFLogo from './components/OHIFLogo/OHIFLogo.js';\nimport React from 'react';\n\nconst defaultContextValues = {\n  logoComponent: OHIFLogo(),\n};\n\nconst WhiteLabellingContext = React.createContext(defaultContextValues);\n\nexport default WhiteLabellingContext;\n","import './Header.css';\nimport './Header.css';\n\nimport { Link, withRouter } from 'react-router-dom';\nimport React, { Component } from 'react';\n\nimport { Dropdown } from 'react-viewerbase';\nimport OHIFLogo from '../OHIFLogo/OHIFLogo.js';\nimport PropTypes from 'prop-types';\nimport { AboutModal } from 'react-viewerbase';\nimport { hotkeysManager } from './../../App.js';\nimport { withTranslation } from 'react-i18next';\n\nclass Header extends Component {\n  static propTypes = {\n    home: PropTypes.bool.isRequired,\n    location: PropTypes.object.isRequired,\n    children: PropTypes.node,\n    t: PropTypes.func.isRequired,\n    userManager: PropTypes.object\n  };\n\n  static defaultProps = {\n    home: true,\n    children: OHIFLogo(),\n  };\n\n  // onSave: data => {\n  //   const contextName = store.getState().commandContext.context;\n  //   const preferences = cloneDeep(store.getState().preferences);\n  //   preferences[contextName] = data;\n  //   dispatch(setUserPreferences(preferences));\n  //   dispatch(setUserPreferencesModalOpen(false));\n  //   OHIF.hotkeysUtil.setHotkeys(data.hotKeysData);\n  // },\n  // onResetToDefaults: () => {\n  //   dispatch(setUserPreferences());\n  //   dispatch(setUserPreferencesModalOpen(false));\n  //   OHIF.hotkeysUtil.setHotkeys();\n  // },\n\n  constructor(props) {\n    super(props);\n    this.state = { isUserPreferencesOpen: false, isOpen: false };\n\n    this.loadOptions();\n  }\n\n  loadOptions() {\n    const { t } = this.props;\n    this.options = [\n      {\n        title: t('About'),\n        icon: { name: 'info' },\n        onClick: () => {\n          this.setState({\n            isOpen: true,\n          });\n        },\n      },\n    ];\n\n    if (this.props.user && this.props.userManager) {\n      this.options.push({\n        title: t('Logout'),\n          icon: { name: 'power-off' },\n          onClick: () => {\n            this.props.userManager.signoutRedirect();\n          },\n      });\n    }\n\n    this.hotKeysData = hotkeysManager.hotkeyDefinitions;\n  }\n\n  onUserPreferencesSave({ windowLevelData, hotKeysData }) {\n    // console.log(windowLevelData);\n    // console.log(hotKeysData);\n    // TODO: Update hotkeysManager\n    // TODO: reset `this.hotKeysData`\n  }\n\n  render() {\n    const { t } = this.props;\n    const showStudyList =\n      window.config.showStudyList !== undefined\n        ? window.config.showStudyList\n        : true;\n    return (\n      <div className={`entry-header ${this.props.home ? 'header-big' : ''}`}>\n        <div className=\"header-left-box\">\n          {this.props.location && this.props.location.studyLink && (\n            <Link\n              to={this.props.location.studyLink}\n              className=\"header-btn header-viewerLink\"\n            >\n              {t('Back to Viewer')}\n            </Link>\n          )}\n\n          {this.props.children}\n\n          {showStudyList && !this.props.home && (\n            <Link\n              className=\"header-btn header-studyListLinkSection\"\n              to={{\n                pathname: '/',\n                state: { studyLink: this.props.location.pathname },\n              }}\n            >\n              {t('Study list')}\n            </Link>\n          )}\n        </div>\n\n        <div className=\"header-menu\">\n          <span className=\"research-use\">{t('INVESTIGATIONAL USE ONLY')}</span>\n          <Dropdown title={t('Options')} list={this.options} align=\"right\" />\n          <AboutModal\n            {...this.state}\n            onCancel={() =>\n              this.setState({\n                isOpen: false,\n              })\n            }\n          />\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default withTranslation('Header')(withRouter(Header));\n","import Header from '../components/Header/Header.js';\nimport { connect } from 'react-redux';\n\nconst mapStateToProps = state => {\n  return {\n    user: state.oidc && state.oidc.user,\n    isOpen: state.ui.userPreferencesModalOpen,\n  };\n};\n\nconst ConnectedHeader = connect(mapStateToProps)(Header);\n\nexport default ConnectedHeader;\n","import { connect } from 'react-redux';\nimport { CineDialog } from 'react-viewerbase';\nimport OHIF from 'ohif-core';\nimport csTools from 'cornerstone-tools';\n// Our target output kills the `as` and \"import\" throws a keyword error\n// import { import as toolImport, getToolState } from 'cornerstone-tools';\nimport cloneDeep from 'lodash.clonedeep';\n\nconst toolImport = csTools.import;\nconst scrollToIndex = toolImport('util/scrollToIndex');\nconst { setViewportSpecificData } = OHIF.redux.actions;\n\n// Why do I need or care about any of this info?\n// A dispatch action should be able to pull this at the time of an event?\n// `isPlaying` and `cineFrameRate` might matter, but I think we can prop pass for those.\nconst mapStateToProps = state => {\n  // Get activeViewport's `cine` and `stack`\n  const { viewportSpecificData, activeViewportIndex } = state.viewports;\n  const { cine, dom } = viewportSpecificData[activeViewportIndex] || {};\n\n  const cineData = cine || {\n    isPlaying: false,\n    cineFrameRate: 24,\n  };\n\n  // New props we're creating?\n  return {\n    activeEnabledElement: dom,\n    activeViewportCineData: cineData,\n    activeViewportIndex: state.viewports.activeViewportIndex,\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    dispatchSetViewportSpecificData: (viewportIndex, data) => {\n      dispatch(setViewportSpecificData(viewportIndex, data));\n    },\n  };\n};\n\nconst mergeProps = (propsFromState, propsFromDispatch, ownProps) => {\n  const {\n    activeEnabledElement,\n    activeViewportCineData,\n    activeViewportIndex,\n  } = propsFromState;\n\n  return {\n    cineFrameRate: activeViewportCineData.cineFrameRate,\n    isPlaying: activeViewportCineData.isPlaying,\n    onPlayPauseChanged: isPlaying => {\n      const cine = cloneDeep(activeViewportCineData);\n      cine.isPlaying = !cine.isPlaying;\n\n      propsFromDispatch.dispatchSetViewportSpecificData(activeViewportIndex, {\n        cine,\n      });\n    },\n    onFrameRateChanged: frameRate => {\n      const cine = cloneDeep(activeViewportCineData);\n      cine.cineFrameRate = frameRate;\n\n      propsFromDispatch.dispatchSetViewportSpecificData(activeViewportIndex, {\n        cine,\n      });\n    },\n    onClickNextButton: () => {\n      const stackData = csTools.getToolState(activeEnabledElement, 'stack');\n      if (!stackData || !stackData.data || !stackData.data.length) return;\n      const { currentImageIdIndex, imageIds } = stackData.data[0];\n      if (currentImageIdIndex >= imageIds.length - 1) return;\n      scrollToIndex(activeEnabledElement, currentImageIdIndex + 1);\n    },\n    onClickBackButton: () => {\n      const stackData = csTools.getToolState(activeEnabledElement, 'stack');\n      if (!stackData || !stackData.data || !stackData.data.length) return;\n      const { currentImageIdIndex } = stackData.data[0];\n      if (currentImageIdIndex === 0) return;\n      scrollToIndex(activeEnabledElement, currentImageIdIndex - 1);\n    },\n    onClickSkipToStart: () => {\n      const stackData = csTools.getToolState(activeEnabledElement, 'stack');\n      if (!stackData || !stackData.data || !stackData.data.length) return;\n      scrollToIndex(activeEnabledElement, 0);\n    },\n    onClickSkipToEnd: () => {\n      const stackData = csTools.getToolState(activeEnabledElement, 'stack');\n      if (!stackData || !stackData.data || !stackData.data.length) return;\n      const lastIndex = stackData.data[0].imageIds.length - 1;\n      scrollToIndex(activeEnabledElement, lastIndex);\n    },\n  };\n};\n\nconst ConnectedCineDialog = connect(\n  mapStateToProps,\n  mapDispatchToProps,\n  mergeProps\n)(CineDialog);\n\nexport default ConnectedCineDialog;\n","import { LayoutButton } from 'react-viewerbase';\nimport OHIF from 'ohif-core';\nimport { connect } from 'react-redux';\n\nconst { setLayout } = OHIF.redux.actions;\n\nconst mapStateToProps = state => {\n  return {\n    currentLayout: state.viewports.layout,\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    // TODO: Change if layout switched becomes more complex\n    onChange: selectedCell => {\n      let viewports = [];\n      const rows = selectedCell.row + 1;\n      const columns = selectedCell.col + 1;\n      const numViewports = rows * columns;\n      for (let i = 0; i < numViewports; i++) {\n        viewports.push({\n          height: `${100 / rows}%`,\n          width: `${100 / columns}%`,\n        });\n      }\n      const layout = {\n        viewports,\n      };\n\n      dispatch(setLayout(layout));\n    },\n  };\n};\n\nconst ConnectedLayoutButton = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(LayoutButton);\n\nexport default ConnectedLayoutButton;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { ExpandableToolMenu } from 'react-viewerbase';\nimport './PluginSwitch.css';\n\nclass PluginSwitch extends Component {\n  static propTypes = {\n    buttons: PropTypes.array,\n  };\n\n  static defaultProps = {};\n\n  render() {\n    return (\n      <div className=\"PluginSwitch\">\n        <ExpandableToolMenu buttons={this.props.buttons} text={'View'} />\n      </div>\n    );\n  }\n}\n\nexport default PluginSwitch;\n","import OHIF from 'ohif-core';\nimport PluginSwitch from './PluginSwitch.js';\nimport { commandsManager } from './../App.js';\nimport { connect } from 'react-redux';\n\nconst { setLayout } = OHIF.redux.actions;\n\nconst mapStateToProps = state => {\n  const { activeViewportIndex, layout, viewportSpecificData } = state.viewports;\n\n  return {\n    activeViewportIndex,\n    viewportSpecificData,\n    layout,\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    setLayout: data => {\n      dispatch(setLayout(data));\n    },\n  };\n};\n\n/*function setSingleLayoutData(originalArray, viewportIndex, data) {\n  const viewports = originalArray.slice();\n  const layoutData = Object.assign({}, viewports[viewportIndex], data);\n\n  viewports[viewportIndex] = layoutData;\n\n  return viewports;\n}*/\n\nconst mergeProps = (propsFromState, propsFromDispatch, ownProps) => {\n  //const { activeViewportIndex, layout } = propsFromState;\n  //const { setLayout } = propsFromDispatch;\n\n  // TODO: Do not display certain options if the current display set\n  // cannot be displayed using these view types\n  const buttons = [\n    /*{\n      text: 'Acquired',\n      type: 'command',\n      icon: 'bars',\n      active: false,\n      onClick: () => {\n        console.warn('Original Acquisition');\n\n        const layoutData = setSingleLayoutData(\n          layout.viewports,\n          activeViewportIndex,\n          { plugin: 'cornerstone' }\n        );\n\n        setLayout({ viewports: layoutData });\n      },\n    },\n    {\n      text: 'Axial',\n      icon: 'cube',\n      active: false,\n      onClick: () => {\n        commandsManager.runCommand('axial');\n      },\n    },\n    {\n      text: 'Sagittal',\n      icon: 'cube',\n      active: false,\n      onClick: () => {\n        commandsManager.runCommand('sagittal');\n      },\n    },\n    {\n      text: 'Coronal',\n      icon: 'cube',\n      active: false,\n      onClick: () => {\n        commandsManager.runCommand('coronal');\n      },\n    },*/\n    {\n      label: '2D MPR',\n      icon: 'cube',\n      onClick: () => {\n        commandsManager.runCommand('mpr2d');\n      },\n    },\n  ];\n\n  return {\n    buttons,\n  };\n};\n\nconst ConnectedPluginSwitch = connect(\n  mapStateToProps,\n  mapDispatchToProps,\n  mergeProps\n)(PluginSwitch);\n\nexport default ConnectedPluginSwitch;\n","import './ToolbarRow.css';\n\nimport React, { Component } from 'react';\nimport {\n  ExpandableToolMenu,\n  RoundedButtonGroup,\n  ToolbarButton,\n} from 'react-viewerbase';\nimport { commandsManager, extensionManager } from './../App.js';\n\nimport ConnectedCineDialog from './ConnectedCineDialog';\nimport ConnectedLayoutButton from './ConnectedLayoutButton';\nimport ConnectedPluginSwitch from './ConnectedPluginSwitch.js';\nimport { MODULE_TYPES } from 'ohif-core';\nimport PropTypes from 'prop-types';\nimport { withTranslation } from 'react-i18next';\n\nclass ToolbarRow extends Component {\n  // TODO: Simplify these? isOpen can be computed if we say \"any\" value for selected,\n  // closed if selected is null/undefined\n  static propTypes = {\n    isLeftSidePanelOpen: PropTypes.bool.isRequired,\n    isRightSidePanelOpen: PropTypes.bool.isRequired,\n    selectedLeftSidePanel: PropTypes.string.isRequired,\n    selectedRightSidePanel: PropTypes.string.isRequired,\n    handleSidePanelChange: PropTypes.func,\n    activeContexts: PropTypes.arrayOf(PropTypes.string).isRequired,\n  };\n\n  constructor(props) {\n    super(props);\n\n    const toolbarButtonDefinitions = _getVisibleToolbarButtons.call(this);\n    // TODO:\n    // If it's a tool that can be active... Mark it as active?\n    // - Tools that are on/off?\n    // - Tools that can be bound to multiple buttons?\n\n    // Normal ToolbarButtons...\n    // Just how high do we need to hoist this state?\n    // Why ToolbarRow instead of just Toolbar? Do we have any others?\n    this.state = {\n      toolbarButtons: toolbarButtonDefinitions,\n      activeButtons: [],\n      isCineDialogOpen: false,\n    };\n\n    this._handleBuiltIn = _handleBuiltIn.bind(this);\n\n    const panelModules = extensionManager.modules[MODULE_TYPES.PANEL];\n    this.buttonGroups = {\n      left: [\n        // TODO: This should come from extensions, instead of being baked in\n        {\n          value: 'studies',\n          icon: 'th-large',\n          bottomLabel: this.props.t('Series'),\n        },\n      ],\n      right: [],\n    };\n\n    panelModules.forEach(panelExtension => {\n      const panelModule = panelExtension.module;\n      const defaultContexts = Array.from(panelModule.defaultContext);\n\n      // MENU OPTIONS\n      panelModule.menuOptions.forEach(menuOption => {\n        const contexts = Array.from(menuOption.context || defaultContexts);\n\n        const activeContextIncludesAnyPanelContexts = this.props.activeContexts.some(\n          actx => contexts.includes(actx)\n        );\n        if (activeContextIncludesAnyPanelContexts) {\n          const menuOptionEntry = {\n            value: menuOption.target,\n            icon: menuOption.icon,\n            bottomLabel: menuOption.label,\n          };\n          const from = menuOption.from || 'right';\n\n          this.buttonGroups[from].push(menuOptionEntry);\n        }\n      });\n    });\n  }\n\n  componentDidUpdate(prevProps) {\n    const activeContextsChanged =\n      prevProps.activeContexts !== this.props.activeContexts;\n\n    if (activeContextsChanged) {\n      this.setState({\n        toolbarButtons: _getVisibleToolbarButtons.call(this),\n      });\n    }\n  }\n\n  render() {\n    const buttonComponents = _getButtonComponents.call(\n      this,\n      this.state.toolbarButtons,\n      this.state.activeButtons\n    );\n\n    const cineDialogContainerStyle = {\n      display: this.state.isCineDialogOpen ? 'block' : 'none',\n      position: 'absolute',\n      top: '82px',\n      zIndex: 999,\n    };\n\n    const onPress = (side, value) => {\n      this.props.handleSidePanelChange(side, value);\n    };\n    const onPressLeft = onPress.bind(this, 'left');\n    const onPressRight = onPress.bind(this, 'right');\n\n    return (\n      <>\n        <div className=\"ToolbarRow\">\n          <div className=\"pull-left m-t-1 p-y-1\" style={{ padding: '10px' }}>\n            <RoundedButtonGroup\n              options={this.buttonGroups.left}\n              value={this.props.selectedLeftSidePanel || ''}\n              onValueChanged={onPressLeft}\n            />\n          </div>\n          {buttonComponents}\n          <ConnectedLayoutButton />\n          <ConnectedPluginSwitch />\n          <div\n            className=\"pull-right m-t-1 rm-x-1\"\n            style={{ marginLeft: 'auto' }}\n          >\n            {this.buttonGroups.right.length && (\n              <RoundedButtonGroup\n                options={this.buttonGroups.right}\n                value={this.props.selectedRightSidePanel || ''}\n                onValueChanged={onPressRight}\n              />\n            )}\n          </div>\n        </div>\n        <div className=\"CineDialogContainer\" style={cineDialogContainerStyle}>\n          <ConnectedCineDialog />\n        </div>\n      </>\n    );\n  }\n}\n\n/**\n * Determine which extension buttons should be showing, if they're\n * active, and what their onClick behavior should be.\n */\nfunction _getButtonComponents(toolbarButtons, activeButtons) {\n  return toolbarButtons.map((button, index) => {\n    let activeCommand = undefined;\n\n    if (button.buttons && button.buttons.length) {\n      // Iterate over button definitions and update `onClick` behavior\n      const childButtons = button.buttons.map(childButton => {\n        childButton.onClick = _handleToolbarButtonClick.bind(this, childButton);\n\n        if (activeButtons.indexOf(childButton.id) > -1) {\n          activeCommand = childButton.id;\n        }\n\n        return childButton;\n      });\n\n      return (\n        <ExpandableToolMenu\n          key={button.id}\n          text={button.label}\n          icon={button.icon}\n          buttons={childButtons}\n          activeCommand={activeCommand}\n        />\n      );\n    }\n    return (\n      <ToolbarButton\n        key={button.id}\n        label={button.label}\n        icon={button.icon}\n        onClick={_handleToolbarButtonClick.bind(this, button)}\n        isActive={activeButtons.includes(button.id)}\n      />\n    );\n  });\n}\n\n/**\n * A handy way for us to handle different button types. IE. firing commands for\n * buttons, or initiation built in behavior.\n *\n * @param {*} button\n * @param {*} evt\n * @param {*} props\n */\nfunction _handleToolbarButtonClick(button, evt, props) {\n  if (button.commandName) {\n    const options = Object.assign({ evt }, button.commandOptions);\n    commandsManager.runCommand(button.commandName, options);\n  }\n\n  // TODO: Use Types ENUM\n  // TODO: We can update this to be a `getter` on the extension to query\n  //       For the active tools after we apply our updates?\n  if (button.type === 'setToolActive') {\n    this.setState({\n      activeButtons: [button.id],\n    });\n  } else if (button.type === 'builtIn') {\n    this._handleBuiltIn(button.options);\n  }\n}\n\n/**\n *\n */\nfunction _getVisibleToolbarButtons() {\n  const toolbarModules = extensionManager.modules[MODULE_TYPES.TOOLBAR];\n  const toolbarButtonDefinitions = [];\n\n  toolbarModules.forEach(extension => {\n    const { definitions, defaultContext } = extension.module;\n    definitions.forEach(definition => {\n      const context = definition.context || defaultContext;\n\n      if (this.props.activeContexts.includes(context)) {\n        toolbarButtonDefinitions.push(definition);\n      }\n    });\n  });\n\n  return toolbarButtonDefinitions;\n}\n\nfunction _handleBuiltIn({ behavior } = {}) {\n  if (behavior === 'CINE') {\n    this.setState({\n      isCineDialogOpen: !this.state.isCineDialogOpen,\n    });\n  }\n}\n\nexport default withTranslation('Common')(ToolbarRow);\n","import { createSelector } from 'reselect';\n\nconst getActiveViewportIndex = state => state.viewports.activeViewportIndex;\nconst getLayoutViewports = state => state.viewports.layout.viewports;\nconst getViewportSpecificData = state => state.viewports.viewportSpecificData;\n\n/**\n * Think of this as a computed getter for our store. It lets us watch parts of\n * our redux state, and only update/recalculate when those values change.\n */\nexport const getActiveContexts = createSelector(\n  [getActiveViewportIndex, getLayoutViewports, getViewportSpecificData],\n  (activeViewportIndex, layoutViewports, viewportSpecificData) => {\n    const activeContexts = ['VIEWER'];\n    const activeLayoutViewport = layoutViewports[activeViewportIndex] || {};\n    const activeViewportSpecificData =\n      viewportSpecificData[activeViewportIndex] || {};\n    const activeViewportPluginName =\n      activeLayoutViewport.plugin || activeViewportSpecificData.plugin;\n\n    if (activeViewportPluginName) {\n      const activeViewportExtension = `ACTIVE_VIEWPORT::${activeViewportPluginName.toUpperCase()}`;\n      activeContexts.push(activeViewportExtension);\n    }\n\n    return activeContexts;\n  }\n);\n","// TODO: REPLACE THIS WITH A CONTEXT PROVIDER\n// EVERYTHING IN `VIEWER.JS` COULD USE THIS FOR APPROPRIATE CONTEXT\nimport ToolbarRow from './ToolbarRow';\nimport { connect } from 'react-redux';\nimport { getActiveContexts } from './../store/layout/selectors.js';\n\nconst mapStateToProps = state => {\n  return {\n    activeContexts: getActiveContexts(state),\n  };\n};\n\nconst ConnectedToolbarRow = connect(mapStateToProps)(ToolbarRow);\n\nexport default ConnectedToolbarRow;\n","import { Component } from 'react';\nimport React from 'react';\nimport PropTypes from 'prop-types';\n\nimport './SimpleDialog.css';\n\nclass SimpleDialog extends Component {\n  static defaultProps = {\n    componentStyle: {},\n    rootClass: '',\n  };\n\n  render() {\n    return (\n      <div\n        className={`simpleDialog ${this.props.rootClass}`}\n        ref={this.props.componentRef}\n        style={this.props.componentStyle}\n      >\n        <form onSubmit={this.props.onConfirm}>\n          <div className=\"header\">\n            <span className=\"closeBtn\" onClick={this.props.onClose}>\n              <span className=\"closeIcon\">x</span>\n            </span>\n            <h4 className=\"title\">{this.props.headerTitle}</h4>\n          </div>\n          <div className=\"content\">{this.props.children}</div>\n          <div className=\"footer\">\n            <button\n              type=\"button\"\n              className=\"btn btn-cancel\"\n              onClick={this.props.onClose}\n            >\n              Cancel\n            </button>\n            <button\n              type=\"button\"\n              className=\"btn btn-confirm\"\n              onClick={this.props.onConfirm}\n            >\n              Confirm\n            </button>\n          </div>\n        </form>\n      </div>\n    );\n  }\n}\n\nSimpleDialog.propTypes = {\n  headerTitle: PropTypes.string.isRequired,\n  onClose: PropTypes.func.isRequired,\n  onConfirm: PropTypes.func.isRequired,\n};\n\nexport default SimpleDialog;\n","export default function bounding(elementRef, currentPosition = {}) {\n  if (!elementRef.current) {\n    return;\n  }\n\n  const currentElement = elementRef.current;\n  const {\n    offsetParent,\n    offsetTop,\n    offsetHeight,\n    offsetLeft,\n    offsetWidth,\n  } = currentElement;\n  let top = currentPosition.top || offsetTop;\n  let left = currentPosition.left || offsetLeft;\n\n  if (!offsetParent) {\n    return;\n  }\n\n  let maxHeight = `${offsetParent.offsetHeight}px`;\n\n  if (offsetHeight + top > offsetParent.offsetHeight) {\n    top = top - (offsetHeight + top - offsetParent.offsetHeight);\n    if (top < 0) {\n      top = 0;\n    }\n  }\n\n  if (left + offsetWidth > offsetParent.offsetWidth) {\n    left = offsetParent.offsetWidth - offsetWidth;\n    if (left < 0) {\n      left = 0;\n    }\n  }\n\n  if (maxHeight && currentElement.style.maxHeight !== maxHeight) {\n    currentElement.style.maxHeight = maxHeight;\n  }\n  if (currentElement.style.top !== `${top}px`) {\n    currentElement.style.top = `${top}px`;\n  }\n  if (currentElement.style.left !== `${left}px`) {\n    currentElement.style.left = `${left}px`;\n  }\n}\n","import cornerstone from 'cornerstone-core';\n\nconst buttonSize = {\n  width: 96,\n  height: 28,\n};\n\nexport function getAddLabelButtonStyle(measurementData, eventData) {\n  const { start, end } = measurementData.handles;\n  const { client } = eventData.currentPoints;\n  const clientStart = cornerstone.pixelToCanvas(eventData.element, start);\n  const clientEnd = cornerstone.pixelToCanvas(eventData.element, end);\n  const canvasOffSetLeft = client.x - clientStart.x;\n  const canvasOffSetTop = client.y - clientStart.y;\n  const position = {\n    left: clientEnd.x + canvasOffSetLeft,\n    top: clientEnd.y + canvasOffSetTop,\n  };\n\n  if (start.y > end.y) {\n    position.top -= buttonSize.height;\n  }\n  if (start.x > end.x) {\n    position.left -= buttonSize.width;\n  }\n\n  return position;\n}\n\nexport function getDialogStyle(componentStyle) {\n  const style = Object.assign({}, componentStyle);\n  const dialogProps = {\n    width: 320,\n    height: 230,\n  };\n\n  // Get max values to avoid position out of the screen\n  const maxLeft = window.innerWidth - dialogProps.width;\n  const maxTop = window.innerHeight - dialogProps.height;\n\n  // Positioning the dialog with its center on the click event\n  style.left -= dialogProps.width / 2;\n  style.top -= dialogProps.height / 2;\n\n  if (style.left > maxLeft) {\n    style.left = maxLeft;\n  }\n  if (style.top > maxTop) {\n    style.top = maxTop;\n  }\n\n  return style;\n}\n","import { Component } from 'react';\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport SimpleDialog from '../SimpleDialog/SimpleDialog.js';\n\nimport bounding from '../../lib/utils/bounding.js';\nimport { getDialogStyle } from './../Labelling/labellingPositionUtils.js';\n\nimport './EditDescriptionDialog.css';\n\nexport default class EditDescriptionDialog extends Component {\n  static defaultProps = {\n    componentRef: React.createRef(),\n    componentStyle: {},\n  };\n\n  static propTypes = {\n    measurementData: PropTypes.object.isRequired,\n    onCancel: PropTypes.func.isRequired,\n    componentRef: PropTypes.object,\n    componentStyle: PropTypes.object,\n    onUpdate: PropTypes.func.isRequired,\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      description: props.measurementData.description || '',\n    };\n\n    this.mainElement = React.createRef();\n  }\n\n  componentDidMount = () => {\n    bounding(this.mainElement);\n  };\n\n  componentDidUpdate(prevProps) {\n    if (this.props.description !== prevProps.description) {\n      this.setState({\n        description: this.props.description,\n      });\n    }\n  }\n\n  render() {\n    const style = getDialogStyle(this.props.componentStyle);\n\n    return (\n      <SimpleDialog\n        headerTitle=\"Edit Description\"\n        onClose={this.onClose}\n        onConfirm={this.onConfirm}\n        rootClass=\"editDescriptionDialog\"\n        componentRef={this.mainElement}\n        componentStyle={style}\n      >\n        <input\n          value={this.state.description}\n          className=\"simpleDialogInput\"\n          id=\"description\"\n          autoComplete=\"off\"\n          autoFocus\n          onChange={this.handleChange}\n        />\n      </SimpleDialog>\n    );\n  }\n\n  onClose = () => {\n    this.props.onCancel();\n  };\n\n  onConfirm = e => {\n    e.preventDefault();\n    this.props.onUpdate(this.state.description);\n  };\n\n  handleChange = event => {\n    this.setState({ description: event.target.value });\n  };\n}\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { CSSTransition } from 'react-transition-group';\n\nimport './LabellingTransition.css';\n\n// If these variables changes, CSS must be updated\nconst transitionDuration = 500;\nconst transitionClassName = 'labelling';\nconst transitionOnAppear = true;\n\nexport default class LabellingTransition extends Component {\n  static propTypes = {\n    children: PropTypes.node.isRequired,\n    displayComponent: PropTypes.bool.isRequired,\n    onTransitionExit: PropTypes.func.isRequired,\n  };\n  render() {\n    return (\n      <CSSTransition\n        in={this.props.displayComponent}\n        appear={transitionOnAppear}\n        timeout={transitionDuration}\n        classNames={transitionClassName}\n        onExited={this.props.onTransitionExit}\n      >\n        {this.props.children}\n      </CSSTransition>\n    );\n  }\n}\n","const items = [\n  'Abdomen/Chest Wall',\n  'Adrenal',\n  'Bladder',\n  'Bone',\n  'Brain',\n  'Breast',\n  'Colon',\n  'Esophagus',\n  'Extremities',\n  'Gallbladder',\n  'Kidney',\n  'Liver',\n  'Lung',\n  'Lymph Node',\n  'Mediastinum/Hilum',\n  'Muscle',\n  'Neck',\n  'Other Soft Tissue',\n  'Ovary',\n  'Pancreas',\n  'Pelvis',\n  'Peritoneum/Omentum',\n  'Prostate',\n  'Retroperitoneum',\n  'Small Bowel',\n  'Spleen',\n  'Stomach',\n  'Subcutaneous',\n];\n\nconst OHIFLabellingData = items.map(item => {\n  return {\n    label: item,\n    value: item,\n  };\n});\n\nexport default OHIFLabellingData;\n","import { Icon, SelectTree } from 'react-viewerbase';\nimport React, { Component } from 'react';\n\nimport LabellingTransition from './LabellingTransition.js';\nimport OHIFLabellingData from './OHIFLabellingData.js';\nimport PropTypes from 'prop-types';\nimport bounding from '../../lib/utils/bounding.js';\nimport cloneDeep from 'lodash.clonedeep';\nimport { getAddLabelButtonStyle } from './labellingPositionUtils.js';\n\nexport default class LabellingFlow extends Component {\n  static propTypes = {\n    eventData: PropTypes.object.isRequired,\n    measurementData: PropTypes.object.isRequired,\n    labellingDoneCallback: PropTypes.func.isRequired,\n    updateLabelling: PropTypes.func.isRequired,\n\n    initialTopDistance: PropTypes.number,\n    skipAddLabelButton: PropTypes.bool,\n    editLocation: PropTypes.bool,\n    editDescription: PropTypes.bool,\n  };\n\n  constructor(props) {\n    super(props);\n\n    const { location, locationLabel, description } = props.measurementData;\n\n    let style = props.componentStyle;\n    if (!props.skipAddLabelButton) {\n      style = getAddLabelButtonStyle(props.measurementData, props.eventData);\n    }\n\n    this.state = {\n      location,\n      locationLabel,\n      description,\n      skipAddLabelButton: props.skipAddLabelButton,\n      editDescription: props.editDescription,\n      editLocation: props.editLocation,\n      componentStyle: style,\n      confirmationState: false,\n      displayComponent: true,\n    };\n\n    this.mainElement = React.createRef();\n    this.descriptionInput = React.createRef();\n\n    this.initialItems = OHIFLabellingData;\n    this.currentItems = cloneDeep(this.initialItems);\n  }\n\n  componentDidUpdate = () => {\n    this.repositionComponent();\n    if (this.state.editDescription) {\n      this.descriptionInput.current.focus();\n    }\n  };\n\n  render() {\n    let mainElementClassName = 'labellingComponent';\n    if (this.state.editDescription) {\n      mainElementClassName += ' editDescription';\n    }\n\n    const style = Object.assign({}, this.state.componentStyle);\n    if (this.state.skipAddLabelButton) {\n      if (style.left - 160 < 0) {\n        style.left = 0;\n      } else {\n        style.left -= 160;\n      }\n    }\n\n    if (this.state.editLocation) {\n      style.maxHeight = '70vh';\n      if (!this.initialTopDistance) {\n        this.initialTopDistance = window.innerHeight - window.innerHeight * 0.3;\n        style.top = `${this.state.componentStyle.top -\n          this.initialTopDistance / 2}px`;\n      } else {\n        style.top = `${this.state.componentStyle.top}px`;\n      }\n    }\n\n    return (\n      <LabellingTransition\n        displayComponent={this.state.displayComponent}\n        onTransitionExit={this.props.labellingDoneCallback}\n      >\n        <>\n          <div className=\"labellingComponent-overlay\"></div>\n          <div\n            className={mainElementClassName}\n            style={style}\n            ref={this.mainElement}\n            onMouseLeave={this.fadeOutAndLeave}\n            onMouseEnter={this.clearFadeOutTimer}\n          >\n            {this.labellingStateFragment()}\n          </div>\n        </>\n      </LabellingTransition>\n    );\n  }\n\n  labellingStateFragment = () => {\n    const {\n      skipAddLabelButton,\n      editLocation,\n      description,\n      locationLabel,\n    } = this.state;\n\n    if (!skipAddLabelButton) {\n      return (\n        <>\n          <button\n            type=\"button\"\n            className=\"addLabelButton\"\n            onClick={this.showLabelling}\n          >\n            {this.state.location ? 'Edit' : 'Add'} Label\n          </button>\n        </>\n      );\n    } else {\n      if (editLocation) {\n        return (\n          <SelectTree\n            items={this.currentItems}\n            columns={1}\n            onSelected={this.selectTreeSelectCalback}\n            selectTreeFirstTitle=\"Assign Label\"\n            onComponentChange={this.repositionComponent}\n          />\n        );\n      } else {\n        return (\n          <>\n            <div\n              className=\"checkIconWrapper\"\n              onClick={this.fadeOutAndLeaveFast}\n            >\n              <Icon name=\"check\" className=\"checkIcon\" />\n            </div>\n            <div className=\"locationDescriptionWrapper\">\n              <div className=\"location\">{locationLabel}</div>\n              <div className=\"description\">\n                <input\n                  id=\"descriptionInput\"\n                  ref={this.descriptionInput}\n                  defaultValue={description || ''}\n                  autoComplete=\"off\"\n                />\n              </div>\n            </div>\n            <div className=\"commonButtons\">\n              <button\n                type=\"button\"\n                className=\"commonButton left\"\n                onClick={this.relabel}\n              >\n                Relabel\n              </button>\n              <button\n                type=\"button\"\n                className=\"commonButton right\"\n                onClick={this.setDescriptionUpdateMode}\n              >\n                {description ? 'Edit ' : 'Add '}\n                Description\n              </button>\n            </div>\n            <div className=\"editDescriptionButtons\">\n              <button\n                type=\"button\"\n                className=\"commonButton left\"\n                onClick={this.descriptionCancel}\n              >\n                Cancel\n              </button>\n              <button\n                type=\"button\"\n                className=\"commonButton right\"\n                onClick={this.descriptionSave}\n              >\n                Save\n              </button>\n            </div>\n          </>\n        );\n      }\n    }\n  };\n\n  relabel = event => {\n    const viewportTopPosition = this.mainElement.current.offsetParent.offsetTop;\n    const componentStyle = {\n      top: event.nativeEvent.y - viewportTopPosition - 55,\n      left: event.nativeEvent.x,\n    };\n    this.setState({\n      editLocation: true,\n      componentStyle,\n    });\n  };\n\n  setDescriptionUpdateMode = () => {\n    this.descriptionInput.current.focus();\n\n    this.setState({\n      editDescription: true,\n    });\n  };\n\n  descriptionCancel = () => {\n    const { description = '' } = cloneDeep(this.state);\n    this.descriptionInput.current.value = description;\n\n    this.setState({\n      editDescription: false,\n    });\n  };\n\n  descriptionSave = () => {\n    const description = this.descriptionInput.current.value;\n    this.props.updateLabelling({ description });\n\n    this.setState({\n      description,\n      editDescription: false,\n    });\n  };\n\n  selectTreeSelectCalback = (event, itemSelected) => {\n    const location = itemSelected.value;\n    this.props.updateLabelling({ location });\n\n    const viewportTopPosition = this.mainElement.current.offsetParent.offsetTop;\n    const componentStyle = {\n      top: event.nativeEvent.y - viewportTopPosition - 25,\n      left: event.nativeEvent.x,\n    };\n\n    this.setState({\n      editLocation: false,\n      confirmationState: true,\n      location: itemSelected.value,\n      locationLabel: itemSelected.label,\n      componentStyle,\n    });\n\n    if (this.isTouchScreen) {\n      this.setTimeout = setTimeout(() => {\n        this.setState({\n          displayComponent: false,\n        });\n      }, 2000);\n    }\n  };\n\n  showLabelling = () => {\n    this.setState({\n      skipAddLabelButton: true,\n      editLocation: false,\n    });\n  };\n\n  fadeOutAndLeave = () => {\n    // Wait for 1 sec to dismiss the labelling component\n    this.fadeOutTimer = setTimeout(() => {\n      this.setState({\n        displayComponent: false,\n      });\n    }, 1000);\n  };\n\n  fadeOutAndLeaveFast = () => {\n    this.setState({\n      displayComponent: false,\n    });\n  };\n\n  clearFadeOutTimer = () => {\n    if (!this.fadeOutTimer) {\n      return;\n    }\n\n    clearTimeout(this.fadeOutTimer);\n  };\n\n  calculateTopDistance = () => {\n    const height = window.innerHeight - window.innerHeight * 0.3;\n    let top = this.state.componentStyle.top - height / 2 + 55;\n    if (top < 0) {\n      top = 0;\n    } else {\n      if (top + height > window.innerHeight) {\n        top -= top + height - window.innerHeight;\n      }\n    }\n    return top;\n  };\n\n  repositionComponent = () => {\n    // SetTimeout for the css animation to end.\n    setTimeout(() => {\n      bounding(this.mainElement);\n      if (this.state.editLocation) {\n        this.mainElement.current.style.maxHeight = '70vh';\n        const top = this.calculateTopDistance();\n        this.mainElement.current.style.top = `${top}px`;\n      }\n    }, 200);\n  };\n}\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nimport cloneDeep from 'lodash.clonedeep';\n\nimport EditDescriptionDialog from './../EditDescriptionDialog/EditDescriptionDialog.js';\nimport LabellingFlow from './LabellingFlow.js';\n\nimport './LabellingManager.css';\n\nexport default class LabellingManager extends Component {\n  static propTypes = {\n    eventData: PropTypes.object.isRequired,\n    measurementData: PropTypes.object.isRequired,\n\n    labellingDoneCallback: PropTypes.func.isRequired,\n    updateLabelling: PropTypes.func.isRequired,\n\n    skipAddLabelButton: PropTypes.bool,\n    editLocation: PropTypes.bool,\n    editDescription: PropTypes.bool,\n    editDescriptionOnDialog: PropTypes.bool,\n  };\n\n  static defaultProps = {\n    skipAddLabelButton: false,\n    editLocation: false,\n    editDescription: false,\n    editDescriptionOnDialog: false,\n  };\n\n  constructor(props) {\n    super(props);\n\n    const measurementData = cloneDeep(props.measurementData);\n    this.treatMeasurementData(measurementData);\n\n    let editLocation = props.editLocation;\n    if (!props.editDescription && !props.editLocation) {\n      editLocation = true;\n    }\n\n    this.state = {\n      componentStyle: getComponentPosition(props.eventData),\n      skipAddLabelButton: props.skipAddLabelButton,\n      editLocation: editLocation,\n      editDescription: props.editDescription,\n      editDescriptionOnDialog: props.editDescriptionOnDialog,\n      measurementData: measurementData,\n    };\n  }\n\n  componentDidMount = () => {\n    document.addEventListener('touchstart', this.onTouchStart);\n  };\n\n  componentWillUnmount = () => {\n    document.removeEventListener('touchstart', this.onTouchStart);\n  };\n\n  render() {\n    return this.getRenderComponent();\n  }\n\n  getRenderComponent = () => {\n    const {\n      editLocation,\n      editDescription,\n      editDescriptionOnDialog,\n      measurementData,\n    } = this.state;\n\n    if (editDescriptionOnDialog) {\n      return (\n        <EditDescriptionDialog\n          onCancel={this.props.labellingDoneCallback}\n          onUpdate={this.descriptionDialogUpdate}\n          componentRef={this.editDescriptionDialog}\n          componentStyle={this.state.componentStyle}\n          measurementData={measurementData}\n        />\n      );\n    }\n\n    if (editLocation || editDescription) {\n      return (\n        <LabellingFlow\n          {...this.props}\n          componentStyle={this.state.componentStyle}\n        />\n      );\n    }\n  };\n\n  treatMeasurementData = measurementData => {\n    const { editDescription, editLocation } = this.props;\n\n    if (editDescription) {\n      measurementData.description = undefined;\n    }\n    if (editLocation) {\n      measurementData.location = undefined;\n    }\n  };\n\n  responseDialogUpdate = response => {\n    this.props.updateLabelling({\n      response,\n    });\n    this.props.labellingDoneCallback();\n  };\n\n  descriptionDialogUpdate = description => {\n    this.props.updateLabelling({\n      description,\n    });\n    this.props.labellingDoneCallback();\n  };\n}\n\nfunction getComponentPosition(eventData) {\n  const {\n    event: { clientX: left, clientY: top },\n  } = eventData;\n\n  return {\n    left,\n    top,\n  };\n}\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport LabellingManager from '../components/Labelling/LabellingManager';\n\nclass LabellingOverlay extends Component {\n  static propTypes = {\n    visible: PropTypes.bool.isRequired,\n  };\n\n  static defaultProps = {\n    visible: false,\n  };\n\n  render() {\n    if (!this.props.visible) {\n      return null;\n    }\n\n    return <LabellingManager {...this.props} />;\n  }\n}\n\nexport default LabellingOverlay;\n","import { connect } from 'react-redux';\nimport LabellingOverlay from './LabellingOverlay';\n\nconst mapStateToProps = state => {\n  if (!state.ui || !state.ui.labelling) {\n    return {\n      visible: false,\n    };\n  }\n\n  const labellingFlowData = state.ui.labelling;\n\n  return {\n    visible: false,\n    ...labellingFlowData,\n  };\n};\n\nconst ConnectedLabellingOverlay = connect(\n  mapStateToProps,\n  null\n)(LabellingOverlay);\n\nexport default ConnectedLabellingOverlay;\n","import { connect } from 'react-redux';\nimport { StudyBrowser } from 'react-viewerbase';\nimport cloneDeep from 'lodash.clonedeep';\n\n// TODO\n// - Determine in which display set is active from Redux (activeViewportIndex and layout viewportData)\n// - Pass in errors and stack loading progress from Redux\nconst mapStateToProps = (state, ownProps) => {\n  // If we know that the stack loading progress details have changed,\n  // we can try to update the component state so that the thumbnail\n  // progress bar is updated\n  const stackLoadingProgressMap = state.loading.progress;\n  const studiesWithLoadingData = cloneDeep(ownProps.studies);\n\n  studiesWithLoadingData.forEach(study => {\n    study.thumbnails.forEach(data => {\n      const { displaySetInstanceUid } = data;\n      const stackId = `StackProgress:${displaySetInstanceUid}`;\n      const stackProgressData = stackLoadingProgressMap[stackId];\n\n      let stackPercentComplete = 0;\n      if (stackProgressData) {\n        stackPercentComplete = stackProgressData.percentComplete;\n      }\n\n      data.stackPercentComplete = stackPercentComplete;\n    });\n  });\n\n  return {\n    studies: studiesWithLoadingData,\n  };\n};\n\nconst ConnectedStudyBrowser = connect(\n  mapStateToProps,\n  null\n)(StudyBrowser);\n\nexport default ConnectedStudyBrowser;\n","import { LayoutManager } from 'react-viewerbase';\nimport { MODULE_TYPES } from 'ohif-core';\nimport { connect } from 'react-redux';\nimport { extensionManager } from './../App.js';\n\nconst mapStateToProps = state => {\n  const availableViewportModules = {};\n  const viewportModules = extensionManager.modules[MODULE_TYPES.VIEWPORT];\n\n  viewportModules.forEach(moduleDefinition => {\n    availableViewportModules[moduleDefinition.extensionId] =\n      moduleDefinition.module;\n  });\n\n  // TODO: Use something like state.plugins.defaultPlugin[MODULE_TYPES.VIEWPORT]\n  let defaultPlugin;\n  if (viewportModules.length) {\n    defaultPlugin = viewportModules[0].extensionId;\n  }\n\n  return {\n    layout: state.viewports.layout,\n    activeViewportIndex: state.viewports.activeViewportIndex,\n    // TODO: rename `availableViewportModules`\n    availablePlugins: availableViewportModules,\n    // TODO: rename `defaultViewportModule`\n    defaultPlugin,\n  };\n};\n\nconst ConnectedLayoutManager = connect(\n  mapStateToProps,\n  null\n)(LayoutManager);\n\nexport default ConnectedLayoutManager;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport cornerstone from 'cornerstone-core';\nimport cornerstoneTools from 'cornerstone-tools';\nimport getMeasurementLocationCallback from '../lib/getMeasurementLocationCallback';\n\nimport './ToolContextMenu.css';\n\nconst toolTypes = [\n  'Angle',\n  'Bidirectional',\n  'Length',\n  'FreehandMouse',\n  'EllipticalRoi',\n  'CircleRoi',\n  'RectangleRoi',\n];\n\nlet defaultDropdownItems = [\n  {\n    actionType: 'Delete',\n    action: ({ nearbyToolData, eventData }) => {\n      const element = eventData.element;\n\n      cornerstoneTools.removeToolState(\n        element,\n        nearbyToolData.toolType,\n        nearbyToolData.tool\n      );\n      cornerstone.updateImage(element);\n    },\n  },\n  {\n    actionType: 'setLabel',\n    action: ({ nearbyToolData, eventData }) => {\n      const { tool } = nearbyToolData;\n\n      const options = {\n        skipAddLabelButton: true,\n        editLocation: true,\n      };\n\n      getMeasurementLocationCallback(eventData, tool, options);\n    },\n  },\n  {\n    actionType: 'setDescription',\n    action: ({ nearbyToolData, eventData }) => {\n      const { tool } = nearbyToolData;\n\n      const options = {\n        editDescriptionOnDialog: true,\n      };\n\n      getMeasurementLocationCallback(eventData, tool, options);\n    },\n  },\n];\n\nfunction getNearbyToolData(element, coords, toolTypes) {\n  const nearbyTool = {};\n  let pointNearTool = false;\n\n  toolTypes.forEach(toolType => {\n    const toolData = cornerstoneTools.getToolState(element, toolType);\n    if (!toolData) {\n      return;\n    }\n\n    toolData.data.forEach(function(data, index) {\n      // TODO: Fix this, it's ugly\n      let toolInterface = cornerstoneTools.getToolForElement(element, toolType);\n      if (!toolInterface) {\n        toolInterface = cornerstoneTools.getToolForElement(\n          element,\n          `${toolType}Tool`\n        );\n      }\n\n      if (!toolInterface) {\n        throw new Error('Tool not found.');\n      }\n\n      if (toolInterface.pointNearTool(element, data, coords)) {\n        pointNearTool = true;\n        nearbyTool.tool = data;\n        nearbyTool.index = index;\n        nearbyTool.toolType = toolType;\n      }\n    });\n\n    if (pointNearTool) {\n      return false;\n    }\n  });\n\n  return pointNearTool ? nearbyTool : undefined;\n}\n\nfunction getDropdownItems(eventData, isTouchEvent = false, availableTools) {\n  const nearbyToolData = getNearbyToolData(\n    eventData.element,\n    eventData.currentPoints.canvas,\n    toolTypes,\n    availableTools\n  );\n\n  // Annotate tools for touch events already have a press handle to edit it, has a better UX for deleting it\n  if (\n    isTouchEvent &&\n    nearbyToolData &&\n    nearbyToolData.toolType === 'arrowAnnotate'\n  ) {\n    return;\n  }\n\n  let dropdownItems = [];\n  if (nearbyToolData) {\n    defaultDropdownItems.forEach(function(item) {\n      item.params = {\n        eventData,\n        nearbyToolData,\n      };\n\n      if (item.actionType === 'Delete') {\n        item.text = 'Delete measurement';\n      }\n\n      if (item.actionType === 'setLabel') {\n        item.text = 'Relabel';\n      }\n\n      if (item.actionType === 'setDescription') {\n        item.text = `${\n          nearbyToolData.tool.description ? 'Edit' : 'Add'\n        } Description`;\n      }\n\n      dropdownItems.push(item);\n    });\n  }\n\n  return dropdownItems;\n}\n\nclass ToolContextMenu extends Component {\n  static propTypes = {\n    isTouchEvent: PropTypes.bool.isRequired,\n    eventData: PropTypes.object,\n    onClose: PropTypes.func,\n    availableTools: PropTypes.array,\n    visible: PropTypes.bool.isRequired,\n  };\n\n  static defaultProps = {\n    visible: true,\n    isTouchEvent: false,\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.mainElement = React.createRef();\n  }\n\n  render() {\n    if (!this.props.eventData) {\n      return null;\n    }\n\n    const { isTouchEvent, eventData, availableTools } = this.props;\n    const dropdownItems = getDropdownItems(\n      eventData,\n      isTouchEvent,\n      availableTools\n    );\n\n    // Skip if there is no dropdown item\n    if (!dropdownItems.length) {\n      return '';\n    }\n\n    const dropdownComponents = dropdownItems.map(item => {\n      const itemOnClick = event => {\n        item.action(item.params);\n        if (this.props.onClose) {\n          this.props.onClose();\n        }\n      };\n\n      return (\n        <li key={item.actionType}>\n          <button className=\"form-action\" onClick={itemOnClick}>\n            <span key={item.actionType}>{item.text}</span>\n          </button>\n        </li>\n      );\n    });\n\n    const position = {\n      top: `${eventData.currentPoints.canvas.y}px`,\n      left: `${eventData.currentPoints.canvas.x}px`,\n    };\n\n    return (\n      <div className=\"ToolContextMenu\" style={position} ref={this.mainElement}>\n        <ul className=\"bounded\">{dropdownComponents}</ul>\n      </div>\n    );\n  }\n\n  componentDidMount = () => {\n    if (this.mainElement.current) {\n      this.updateElementPosition();\n    }\n  };\n\n  componentDidUpdate = () => {\n    if (this.mainElement.current) {\n      this.updateElementPosition();\n    }\n  };\n\n  updateElementPosition = () => {\n    const {\n      offsetParent,\n      offsetTop,\n      offsetHeight,\n      offsetWidth,\n      offsetLeft,\n    } = this.mainElement.current;\n\n    const { eventData } = this.props;\n\n    if (offsetTop + offsetHeight > offsetParent.offsetHeight) {\n      const offBoundPixels =\n        offsetTop + offsetHeight - offsetParent.offsetHeight;\n      const top = eventData.currentPoints.canvas.y - offBoundPixels;\n\n      this.mainElement.current.style.top = `${top > 0 ? top : 0}px`;\n    }\n\n    if (offsetLeft + offsetWidth > offsetParent.offsetWidth) {\n      const offBoundPixels =\n        offsetLeft + offsetWidth - offsetParent.offsetWidth;\n      const left = eventData.currentPoints.canvas.x - offBoundPixels;\n\n      this.mainElement.current.style.left = `${left > 0 ? left : 0}px`;\n    }\n  };\n}\n\nexport default ToolContextMenu;\n","import { connect } from 'react-redux';\nimport ToolContextMenu from './ToolContextMenu';\n\nconst mapStateToProps = (state, ownProps) => {\n  if (!state.ui || !state.ui.contextMenu) {\n    return {\n      visible: false,\n    };\n  }\n\n  const { viewportIndex } = ownProps;\n  const toolContextMenuData = state.ui.contextMenu[viewportIndex];\n  let availableTools;\n\n  if (\n    state.extensions &&\n    state.extensions.cornerstone &&\n    state.extensions.cornerstone.availableTools\n  ) {\n    availableTools = state.extensions.cornerstone.availableTools;\n  }\n\n  return {\n    ...toolContextMenuData,\n    availableTools,\n  };\n};\n\nconst ConnectedToolContextMenu = connect(\n  mapStateToProps,\n  null\n)(ToolContextMenu);\n\nexport default ConnectedToolContextMenu;\n","import './ViewerMain.css';\n\nimport { Component } from 'react';\nimport ConnectedLayoutManager from './ConnectedLayoutManager.js';\nimport ConnectedToolContextMenu from './ConnectedToolContextMenu.js';\nimport PropTypes from 'prop-types';\nimport React from 'react';\n\nclass ViewerMain extends Component {\n  static propTypes = {\n    activeViewportIndex: PropTypes.number.isRequired,\n    studies: PropTypes.array,\n    viewportSpecificData: PropTypes.object.isRequired,\n    layout: PropTypes.object.isRequired,\n    setViewportSpecificData: PropTypes.func.isRequired,\n    clearViewportSpecificData: PropTypes.func.isRequired,\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      displaySets: [],\n    };\n\n    this.cachedViewportData = {};\n  }\n\n  getDisplaySets(studies) {\n    const displaySets = [];\n    studies.forEach(study => {\n      study.displaySets.forEach(dSet => {\n        if (!dSet.plugin) {\n          dSet.plugin = 'cornerstone';\n        }\n        displaySets.push(dSet);\n      });\n    });\n\n    return displaySets;\n  }\n\n  findDisplaySet(studies, studyInstanceUid, displaySetInstanceUid) {\n    const study = studies.find(study => {\n      return study.studyInstanceUid === studyInstanceUid;\n    });\n\n    if (!study) {\n      return;\n    }\n\n    return study.displaySets.find(displaySet => {\n      return displaySet.displaySetInstanceUid === displaySetInstanceUid;\n    });\n  }\n\n  componentDidMount() {\n    // Add beforeUnload event handler to check for unsaved changes\n    //window.addEventListener('beforeunload', unloadHandlers.beforeUnload);\n\n    // Get all the display sets for the viewer studies\n    if (this.props.studies) {\n      const displaySets = this.getDisplaySets(this.props.studies);\n\n      this.setState({\n        displaySets,\n      });\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.studies !== prevProps.studies) {\n      const displaySets = this.getDisplaySets(this.props.studies);\n\n      this.setState({\n        displaySets,\n      });\n    }\n  }\n\n  getViewportData = () => {\n    const viewportData = [];\n    const { layout, viewportSpecificData } = this.props;\n\n    for (\n      let viewportIndex = 0;\n      viewportIndex < layout.viewports.length;\n      viewportIndex++\n    ) {\n      let displaySet = viewportSpecificData[viewportIndex];\n\n      // Use the cached display set in viewport if the new one is empty\n      if (displaySet && !displaySet.displaySetInstanceUid) {\n        displaySet = this.cachedViewportData[viewportIndex];\n      }\n\n      if (\n        displaySet &&\n        displaySet.studyInstanceUid &&\n        displaySet.displaySetInstanceUid\n      ) {\n        // Get missing fields from original display set\n        const originalDisplaySet = this.findDisplaySet(\n          this.props.studies,\n          displaySet.studyInstanceUid,\n          displaySet.displaySetInstanceUid\n        );\n        viewportData.push(Object.assign({}, originalDisplaySet, displaySet));\n      } else {\n        // If the viewport is empty, get one available in study\n        const { displaySets } = this.state;\n        displaySet = displaySets.find(\n          ds =>\n            !viewportData.some(\n              v => v.displaySetInstanceUid === ds.displaySetInstanceUid\n            )\n        );\n        viewportData.push(Object.assign({}, displaySet));\n      }\n    }\n\n    this.cachedViewportData = viewportData;\n\n    return viewportData;\n  };\n\n  setViewportData = ({ viewportIndex, item }) => {\n    const displaySet = this.findDisplaySet(\n      this.props.studies,\n      item.studyInstanceUid,\n      item.displaySetInstanceUid\n    );\n\n    this.props.setViewportSpecificData(viewportIndex, displaySet);\n  };\n\n  render() {\n    return (\n      <div className=\"ViewerMain\">\n        {this.state.displaySets.length && (\n          <ConnectedLayoutManager\n            studies={this.props.studies}\n            viewportData={this.getViewportData()}\n            setViewportData={this.setViewportData}\n          >\n            {/* Children to add to each viewport that support children */}\n            <ConnectedToolContextMenu />\n          </ConnectedLayoutManager>\n        )}\n      </div>\n    );\n  }\n\n  componentWillUnmount() {\n    // Clear the entire viewport specific data\n    const { viewportSpecificData } = this.props;\n    Object.keys(viewportSpecificData).forEach(viewportIndex => {\n      this.props.clearViewportSpecificData(viewportIndex);\n    });\n\n    // TODO: These don't have to be viewer specific?\n    // Could qualify for other routes?\n    // hotkeys.destroy();\n\n    // Remove beforeUnload event handler...\n    //window.removeEventListener('beforeunload', unloadHandlers.beforeUnload);\n    // Destroy the synchronizer used to update reference lines\n    //OHIF.viewer.updateImageSynchronizer.destroy();\n    // TODO: Instruct all plugins to clean up themselves\n    //\n    // Clear references to all stacks in the StackManager\n    //StackManager.clearStacks();\n    // @TypeSafeStudies\n    // Clears OHIF.viewer.Studies collection\n    //OHIF.viewer.Studies.removeAll();\n    // @TypeSafeStudies\n    // Clears OHIF.viewer.StudyMetadataList collection\n    //OHIF.viewer.StudyMetadataList.removeAll();\n  }\n}\n\nexport default ViewerMain;\n","import OHIF from 'ohif-core';\nimport ViewerMain from './ViewerMain';\nimport { connect } from 'react-redux';\n\nconst {\n  setViewportSpecificData,\n  clearViewportSpecificData,\n} = OHIF.redux.actions;\n\nconst mapStateToProps = state => {\n  const { activeViewportIndex, layout, viewportSpecificData } = state.viewports;\n\n  return {\n    activeViewportIndex,\n    layout,\n    viewportSpecificData,\n    viewports: state.viewports,\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    setViewportSpecificData: (viewportIndex, data) => {\n      dispatch(setViewportSpecificData(viewportIndex, data));\n    },\n    clearViewportSpecificData: () => {\n      dispatch(clearViewportSpecificData());\n    },\n  };\n};\n\nconst ConnectedViewerMain = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(ViewerMain);\n\nexport default ConnectedViewerMain;\n","import './SidePanel.css';\n\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\n\nclass SidePanel extends Component {\n  static propTypes = {\n    from: PropTypes.string.isRequired,\n    isOpen: PropTypes.bool.isRequired,\n    children: PropTypes.node,\n    width: PropTypes.string,\n  };\n\n  render() {\n    const fromSideClass =\n      this.props.from === 'right' ? 'from-right' : 'from-left';\n\n    const styles = this.props.width\n      ? {\n          maxWidth: this.props.width,\n          marginRight: this.props.isOpen\n            ? '0'\n            : Number.parseInt(this.props.width) * -1,\n        }\n      : {};\n\n    return (\n      <section\n        style={styles}\n        className={classNames('sidepanel', fromSideClass, {\n          'is-open': this.props.isOpen,\n        })}\n      >\n        {this.props.children}\n      </section>\n    );\n  }\n}\n\nexport default SidePanel;\n","import React from 'react';\n\nconst UserManagerContext = React.createContext();\n\nexport default UserManagerContext;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\n\nimport { MODULE_TYPES } from 'ohif-core';\nimport OHIF from 'ohif-core';\nimport moment from 'moment';\nimport WhiteLabellingContext from '../WhiteLabellingContext.js';\nimport ConnectedHeader from './ConnectedHeader.js';\nimport ConnectedToolbarRow from './ConnectedToolbarRow.js';\nimport ConnectedLabellingOverlay from './ConnectedLabellingOverlay';\nimport ConnectedStudyBrowser from './ConnectedStudyBrowser.js';\nimport ConnectedViewerMain from './ConnectedViewerMain.js';\nimport SidePanel from './../components/SidePanel.js';\nimport { extensionManager } from './../App.js';\nimport UserManagerContext from '../UserManagerContext';\nimport './Viewer.css';\n/**\n * Inits OHIF Hanging Protocol's onReady.\n * It waits for OHIF Hanging Protocol to be ready to instantiate the ProtocolEngine\n * Hanging Protocol will use OHIF LayoutManager to render viewports properly\n */\n/*const initHangingProtocol = () => {\n    // When Hanging Protocol is ready\n    HP.ProtocolStore.onReady(() => {\n\n        // Gets all StudyMetadata objects: necessary for Hanging Protocol to access study metadata\n        const studyMetadataList = OHIF.viewer.StudyMetadataList.all();\n\n        // Instantiate StudyMetadataSource: necessary for Hanging Protocol to get study metadata\n        const studyMetadataSource = new OHIF.studies.classes.OHIFStudyMetadataSource();\n\n        // Get prior studies map\n        const studyPriorsMap = OHIF.studylist.functions.getStudyPriorsMap(studyMetadataList);\n\n        // Creates Protocol Engine object with required arguments\n        const ProtocolEngine = new HP.ProtocolEngine(layoutManager, studyMetadataList, studyPriorsMap, studyMetadataSource);\n\n        // Sets up Hanging Protocol engine\n        HP.setEngine(ProtocolEngine);\n    });\n};*/\n\n/*const viewportUtils = OHIF.viewerbase.viewportUtils;\n\nOHIF.viewer.functionList = {\n    toggleCineDialog: viewportUtils.toggleCineDialog,\n    toggleCinePlay: viewportUtils.toggleCinePlay,\n    clearTools: viewportUtils.clearTools,\n    resetViewport: viewportUtils.resetViewport,\n    invert: viewportUtils.invert\n};*/\n\nclass Viewer extends Component {\n  static propTypes = {\n    studies: PropTypes.array,\n    studyInstanceUids: PropTypes.array,\n    onTimepointsUpdated: PropTypes.func,\n    onMeasurementsUpdated: PropTypes.func,\n    // window.store.getState().viewports.viewportSpecificData\n    viewports: PropTypes.object.isRequired,\n    // window.store.getState().viewports.activeViewportIndex\n    activeViewportIndex: PropTypes.number.isRequired,\n  };\n\n  constructor(props) {\n    super(props);\n    OHIF.measurements.MeasurementApi.setConfiguration({\n      dataExchange: {\n        retrieve: this.retrieveMeasurements,\n        store: this.storeMeasurements,\n      },\n    });\n\n    OHIF.measurements.TimepointApi.setConfiguration({\n      dataExchange: {\n        retrieve: this.retrieveTimepoints,\n        store: this.storeTimepoints,\n        remove: this.removeTimepoint,\n        update: this.updateTimepoint,\n        disassociate: this.disassociateStudy,\n      },\n    });\n  }\n\n  state = {\n    isLeftSidePanelOpen: true,\n    isRightSidePanelOpen: false,\n    selectedRightSidePanel: '',\n    selectedLeftSidePanel: 'studies', // TODO: Don't hardcode this\n    thumbnails: [],\n  };\n\n  retrieveMeasurements = (patientId, timepointIds) => {\n    OHIF.log.info('retrieveMeasurements');\n    // TODO: Retrieve the measurements from the latest available SR\n    return Promise.resolve();\n  };\n\n  storeMeasurements = (measurementData, timepointIds) => {\n    OHIF.log.info('storeMeasurements');\n    // TODO: Store the measurements into a new SR sent to the active server\n    return Promise.resolve();\n  };\n\n  retrieveTimepoints = filter => {\n    OHIF.log.info('retrieveTimepoints');\n\n    // Get the earliest and latest study date\n    let earliestDate = new Date().toISOString();\n    let latestDate = new Date().toISOString();\n    if (this.props.studies) {\n      latestDate = new Date('1000-01-01').toISOString();\n      this.props.studies.forEach(study => {\n        const studyDate = moment(study.studyDate, 'YYYYMMDD').toISOString();\n        if (studyDate < earliestDate) {\n          earliestDate = studyDate;\n        }\n        if (studyDate > latestDate) {\n          latestDate = studyDate;\n        }\n      });\n    }\n\n    // Return a generic timepoint\n    return Promise.resolve([\n      {\n        timepointType: 'baseline',\n        timepointId: 'TimepointId',\n        studyInstanceUids: this.props.studyInstanceUids,\n        patientId: filter.patientId,\n        earliestDate,\n        latestDate,\n        isLocked: false,\n      },\n    ]);\n  };\n\n  storeTimepoints = timepointData => {\n    OHIF.log.info('storeTimepoints');\n    return Promise.resolve();\n  };\n\n  updateTimepoint = (timepointData, query) => {\n    OHIF.log.info('updateTimepoint');\n    return Promise.resolve();\n  };\n\n  removeTimepoint = timepointId => {\n    OHIF.log.info('removeTimepoint');\n    return Promise.resolve();\n  };\n\n  disassociateStudy = (timepointIds, studyInstanceUid) => {\n    OHIF.log.info('disassociateStudy');\n    return Promise.resolve();\n  };\n\n  onTimepointsUpdated = timepoints => {\n    if (this.props.onTimepointsUpdated) {\n      this.props.onTimepointsUpdated(timepoints);\n    }\n  };\n\n  onMeasurementsUpdated = measurements => {\n    if (this.props.onMeasurementsUpdated) {\n      this.props.onMeasurementsUpdated(measurements);\n    }\n  };\n\n  componentDidMount() {\n    const { studies } = this.props;\n    const { TimepointApi, MeasurementApi } = OHIF.measurements;\n    const currentTimepointId = 'TimepointId';\n\n    const timepointApi = new TimepointApi(currentTimepointId, {\n      onTimepointsUpdated: this.onTimepointsUpdated,\n    });\n\n    const measurementApi = new MeasurementApi(timepointApi, {\n      onMeasurementsUpdated: this.onMeasurementsUpdated,\n    });\n\n    this.currentTimepointId = currentTimepointId;\n    this.timepointApi = timepointApi;\n    this.measurementApi = measurementApi;\n\n    if (studies) {\n      const patientId = studies[0] && studies[0].patientId;\n\n      timepointApi.retrieveTimepoints({ patientId });\n      measurementApi.retrieveMeasurements(patientId, [currentTimepointId]);\n\n      this.setState({\n        thumbnails: _mapStudiesToThumbnails(studies),\n      });\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.studies !== prevProps.studies) {\n      const { studies } = this.props;\n      const patientId = studies[0] && studies[0].patientId;\n      const currentTimepointId = this.currentTimepointId;\n\n      this.timepointApi.retrieveTimepoints({ patientId });\n      this.measurementApi.retrieveMeasurements(patientId, [currentTimepointId]);\n\n      this.setState({\n        thumbnails: _mapStudiesToThumbnails(studies),\n      });\n    }\n  }\n\n  render() {\n    let VisiblePanelLeft, VisiblePanelRight;\n    const panelExtensions = extensionManager.modules[MODULE_TYPES.PANEL];\n\n    panelExtensions.forEach(panelExt => {\n      panelExt.module.components.forEach(comp => {\n        if (comp.id === this.state.selectedRightSidePanel) {\n          VisiblePanelRight = comp.component;\n        } else if (comp.id === this.state.selectedLeftSidePanel) {\n          VisiblePanelLeft = comp.component;\n        }\n      });\n    });\n\n    return (\n      <>\n        {/* HEADER */}\n        <WhiteLabellingContext.Consumer>\n          {whiteLabelling => (\n            <UserManagerContext.Consumer>\n              { userManager => (\n                  <ConnectedHeader home={false} userManager={userManager}>\n                    {whiteLabelling.logoComponent}\n                  </ConnectedHeader>\n                )\n              }\n            </UserManagerContext.Consumer>\n          )}\n        </WhiteLabellingContext.Consumer>\n\n        {/* TOOLBAR */}\n        <ConnectedToolbarRow\n          isLeftSidePanelOpen={this.state.isLeftSidePanelOpen}\n          isRightSidePanelOpen={this.state.isRightSidePanelOpen}\n          selectedLeftSidePanel={\n            this.state.isLeftSidePanelOpen\n              ? this.state.selectedLeftSidePanel\n              : ''\n          }\n          selectedRightSidePanel={\n            this.state.isRightSidePanelOpen\n              ? this.state.selectedRightSidePanel\n              : ''\n          }\n          handleSidePanelChange={(side, selectedPanel) => {\n            const sideClicked = side && side[0].toUpperCase() + side.slice(1);\n            const openKey = `is${sideClicked}SidePanelOpen`;\n            const selectedKey = `selected${sideClicked}SidePanel`;\n            const updatedState = Object.assign({}, this.state);\n\n            const isOpen = updatedState[openKey];\n            const prevSelectedPanel = updatedState[selectedKey];\n            // RoundedButtonGroup returns `null` if selected button is clicked\n            const isSameSelectedPanel =\n              prevSelectedPanel === selectedPanel || selectedPanel === null;\n\n            updatedState[selectedKey] = selectedPanel || prevSelectedPanel;\n\n            const isClosedOrShouldClose = !isOpen || isSameSelectedPanel;\n            if (isClosedOrShouldClose) {\n              updatedState[openKey] = !updatedState[openKey];\n            }\n\n            this.setState(updatedState);\n          }}\n        />\n\n        {/*<ConnectedStudyLoadingMonitor studies={this.props.studies} />*/}\n        {/*<StudyPrefetcher studies={this.props.studies} />*/}\n\n        {/* VIEWPORTS + SIDEPANELS */}\n        <div className=\"FlexboxLayout\">\n          {/* LEFT */}\n          <SidePanel from=\"left\" isOpen={this.state.isLeftSidePanelOpen}>\n            {VisiblePanelLeft ? (\n              <VisiblePanelLeft\n                viewports={this.props.viewports}\n                activeIndex={this.props.activeViewportIndex}\n              />\n            ) : (\n              <ConnectedStudyBrowser studies={this.state.thumbnails} />\n            )}\n          </SidePanel>\n\n          {/* MAIN */}\n          <div className={classNames('main-content')}>\n            <ConnectedViewerMain studies={this.props.studies} />\n          </div>\n\n          {/* RIGHT */}\n          <SidePanel from=\"right\" isOpen={this.state.isRightSidePanelOpen}>\n            {VisiblePanelRight && (\n              <VisiblePanelRight\n                viewports={this.props.viewports}\n                activeIndex={this.props.activeViewportIndex}\n              />\n            )}\n          </SidePanel>\n        </div>\n        <ConnectedLabellingOverlay />\n      </>\n    );\n  }\n}\n\nexport default Viewer;\n\n/**\n * What types are these? Why do we have \"mapping\" dropped in here instead of in\n * a mapping layer?\n *\n * TODO[react]:\n * - Add sorting of display sets\n * - Add showStackLoadingProgressBar option\n *\n * @param {Study[]} studies\n * @param {DisplaySet[]} studies[].displaySets\n */\nconst _mapStudiesToThumbnails = function(studies) {\n  return studies.map(study => {\n    const { studyInstanceUid } = study;\n\n    const thumbnails = study.displaySets.map(displaySet => {\n      const {\n        displaySetInstanceUid,\n        seriesDescription,\n        seriesNumber,\n        instanceNumber,\n        numImageFrames,\n      } = displaySet;\n\n      let imageId;\n      let altImageText;\n\n      if (displaySet.modality && displaySet.modality === 'SEG') {\n        // TODO: We want to replace this with a thumbnail showing\n        // the segmentation map on the image, but this is easier\n        // and better than what we have right now.\n        altImageText = 'SEG';\n      } else if (displaySet.images && displaySet.images.length) {\n        const imageIndex = Math.floor(displaySet.images.length / 2);\n\n        imageId = displaySet.images[imageIndex].getImageId();\n      } else {\n        altImageText = displaySet.modality ? displaySet.modality : 'UN';\n      }\n\n      return {\n        imageId,\n        altImageText,\n        displaySetInstanceUid,\n        seriesDescription,\n        seriesNumber,\n        instanceNumber,\n        numImageFrames,\n      };\n    });\n\n    return {\n      studyInstanceUid,\n      thumbnails,\n    };\n  });\n};\n","import { connect } from 'react-redux';\nimport Viewer from './Viewer.js';\nimport OHIF from 'ohif-core';\n\nconst { setTimepoints, setMeasurements } = OHIF.redux.actions;\n\nconst mapStateToProps = (state, ownProps) => {\n  return {\n    viewports: state.viewports.viewportSpecificData,\n    activeViewportIndex: state.viewports.activeViewportIndex,\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    onTimepointsUpdated: timepoints => {\n      dispatch(setTimepoints(timepoints));\n    },\n    onMeasurementsUpdated: measurements => {\n      dispatch(setMeasurements(measurements));\n    },\n  };\n};\n\nconst ConnectedViewer = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Viewer);\n\nexport default ConnectedViewer;\n","import React, { Component } from 'react';\nimport { metadata, studies, utils } from 'ohif-core';\n\nimport ConnectedViewer from './ConnectedViewer.js';\nimport PropTypes from 'prop-types';\nimport { extensionManager } from './../App.js';\n\nconst { OHIFStudyMetadata } = metadata;\nconst { retrieveStudiesMetadata } = studies;\nconst { studyMetadataManager, updateMetaDataManager } = utils;\n\nclass ViewerRetrieveStudyData extends Component {\n  static propTypes = {\n    studyInstanceUids: PropTypes.array.isRequired,\n    seriesInstanceUids: PropTypes.array,\n    server: PropTypes.object,\n  };\n\n  state = {\n    studies: null,\n    error: null,\n  };\n\n  async componentDidMount() {\n    // TODO: Avoid using timepoints here\n    //const params = { studyInstanceUids, seriesInstanceUids, timepointId, timepointsFilter={} };\n    const { studyInstanceUids, seriesInstanceUids, server } = this.props;\n\n    try {\n      const studies = await retrieveStudiesMetadata(\n        server,\n        studyInstanceUids,\n        seriesInstanceUids\n      );\n\n      // Render the viewer when the data is ready\n      // TODO: CLEAR THIS SOMEWHERE ELSE\n      studyMetadataManager.purge();\n\n      // Map studies to new format, update metadata manager?\n      const updatedStudies = studies.map(study => {\n        const studyMetadata = new OHIFStudyMetadata(\n          study,\n          study.studyInstanceUid\n        );\n        const sopClassHandlerModules =\n          extensionManager.modules['sopClassHandlerModule'];\n\n        study.displaySets =\n          study.displaySets ||\n          studyMetadata.createDisplaySets(sopClassHandlerModules);\n        studyMetadata.setDisplaySets(study.displaySets);\n\n        // Updates WADO-RS metaDataManager\n        updateMetaDataManager(study);\n\n        studyMetadataManager.add(studyMetadata);\n\n        return study;\n      });\n\n      this.setState({\n        studies: updatedStudies,\n      });\n    } catch (err) {\n      this.setState({\n        error: true,\n      });\n\n      // TODO: Handle gracefully instead of throwing?\n      throw new Error(err);\n    }\n  }\n\n  render() {\n    if (this.state.error) {\n      return <div>Error: {JSON.stringify(this.state.error)}</div>;\n    }\n\n    return (\n      <ConnectedViewer\n        studies={this.state.studies}\n        studyInstanceUids={this.props.studyInstanceUids}\n      />\n    );\n  }\n}\n\nexport default ViewerRetrieveStudyData;\n","import { connect } from 'react-redux';\nimport ViewerRetrieveStudyData from './ViewerRetrieveStudyData.js';\n\nconst isActive = a => a.active === true;\n\nconst mapStateToProps = state => {\n  const activeServer = state.servers.servers.find(isActive);\n\n  return {\n    server: activeServer,\n  };\n};\n\nconst ConnectedViewerRetrieveStudyData = connect(\n  mapStateToProps,\n  null\n)(ViewerRetrieveStudyData);\n\nexport default ConnectedViewerRetrieveStudyData;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { withRouter } from 'react-router-dom';\nimport queryString from 'query-string';\nimport ConnectedViewerRetrieveStudyData from '../connectedComponents/ConnectedViewerRetrieveStudyData.js';\n\nfunction decodeStudyUids(studyUids) {\n  const decodedData = window.atob(studyUids);\n\n  return decodedData.split(';');\n}\n\nfunction getQueryParameters(location) {\n  if (location) {\n    return queryString.parse(location.search);\n  }\n\n  return {};\n}\n\nfunction IHEInvokeImageDisplay({ location }) {\n  const {\n    // patientID,\n    requestType,\n    studyUID,\n  } = getQueryParameters(location);\n\n  switch (requestType) {\n    case 'STUDY':\n      return (\n        <ConnectedViewerRetrieveStudyData\n          studyInstanceUids={studyUID.split(';')}\n        />\n      );\n\n    case 'STUDYBASE64':\n      return (\n        <ConnectedViewerRetrieveStudyData\n          studyInstanceUids={decodeStudyUids(studyUID)}\n        />\n      );\n\n    case 'PATIENT':\n      // TODO: connect this to the StudyList when we have the filter parameters set up\n      // return <StudyList patientUids={patientID.split(';')} />;\n      return '';\n\n    default:\n      // TODO: Figure out what to do here, this won't work because StudyList expects studies\n      // return <StudyList />;\n      return '';\n  }\n}\n\nIHEInvokeImageDisplay.propTypes = {\n  location: PropTypes.shape({\n    search: PropTypes.string,\n  }).isRequired,\n};\n\nexport default withRouter(IHEInvokeImageDisplay);\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport ConnectedViewerRetrieveStudyData from '../connectedComponents/ConnectedViewerRetrieveStudyData';\n\nfunction ViewerRouting({ match }) {\n  const { studyInstanceUids, seriesInstanceUids } = match.params;\n\n  let studyUIDs;\n  let seriesUIDs;\n\n  if (studyInstanceUids && !seriesInstanceUids) {\n    studyUIDs = studyInstanceUids.split(';');\n  } else if (studyInstanceUids && seriesInstanceUids) {\n    studyUIDs = [studyInstanceUids];\n    seriesUIDs = match.params.seriesInstanceUids.split(';');\n  }\n\n  return (\n    <ConnectedViewerRetrieveStudyData\n      studyInstanceUids={studyUIDs}\n      seriesInstanceUids={seriesUIDs}\n    />\n  );\n}\n\nViewerRouting.propTypes = {\n  match: PropTypes.shape({\n    params: PropTypes.shape({\n      studyInstanceUids: PropTypes.string.isRequired,\n      seriesInstanceUids: PropTypes.string,\n    }),\n  }),\n};\n\nexport default ViewerRouting;\n","import cornerstone from 'cornerstone-core';\nimport cornerstoneWADOImageLoader from 'cornerstone-wado-image-loader';\nimport * as dcmjs from 'dcmjs';\n\nfunction datasetsToStudies(datasets) {\n  const StudyInstanceUIDs = new Set();\n  datasets.forEach(ds => {\n    StudyInstanceUIDs.add(ds.StudyInstanceUID);\n  });\n\n  const studies = [];\n  Array.from(StudyInstanceUIDs).forEach(studyInstanceUid => {\n    const studyDatasets = datasets.filter(\n      ds => ds.StudyInstanceUID === studyInstanceUid\n    );\n    const firstDataset = studyDatasets[0];\n    const study = {\n      studyInstanceUid: firstDataset.StudyInstanceUID,\n      studyDate: firstDataset.StudyDate,\n      studyTime: firstDataset.StudyTime,\n      accessionNumber: firstDataset.AccessionNumber,\n      referringPhysicianName: firstDataset.ReferringPhysicianName,\n      patientName: firstDataset.PatientName,\n      patientId: firstDataset.PatientID,\n      patientBirthdate: firstDataset.PatientBirthDate,\n      patientSex: firstDataset.PatientSex,\n      studyId: firstDataset.StudyID,\n      studyDescription: firstDataset.StudyDescription,\n      //numberOfStudyRelatedSeries: DICOMWeb.getString(study['00201206']),\n      //numberOfStudyRelatedInstances: DICOMWeb.getString(study['00201208']),\n      // modality: DICOMWeb.getString(study['00080060']),\n      // modalitiesInStudy: DICOMWeb.getString(study['00080061']),\n      //modalities:\n      seriesList: [],\n    };\n\n    const SeriesInstanceUIDs = new Set();\n    studyDatasets.forEach(ds => {\n      SeriesInstanceUIDs.add(ds.SeriesInstanceUID);\n    });\n\n    Array.from(SeriesInstanceUIDs).forEach(seriesInstanceUid => {\n      const seriesDatasets = studyDatasets.filter(\n        ds => ds.SeriesInstanceUID === seriesInstanceUid\n      );\n\n      const SOPInstanceUIDs = new Set();\n      seriesDatasets.forEach(ds => {\n        SOPInstanceUIDs.add(ds.SOPInstanceUID);\n\n        study.seriesList.push({\n          seriesInstanceUid: ds.SeriesInstanceUID,\n          seriesDescription: ds.SeriesDescription,\n          seriesNumber: ds.SeriesNumber,\n          instances: [],\n        });\n      });\n\n      Array.from(SOPInstanceUIDs).forEach(sopInstanceUid => {\n        const instance = seriesDatasets.find(\n          a => a.SOPInstanceUID === sopInstanceUid\n        );\n        const series = study.seriesList.find(\n          a => a.seriesInstanceUid === seriesInstanceUid\n        );\n\n        series.instances.push({\n          sopInstanceUid: instance.SOPInstanceUID,\n          sopClassUid: instance.SOPClassUID,\n          rows: instance.Rows,\n          columns: instance.Columns,\n          numberOfFrames: instance.NumberOfFrames,\n          instanceNumber: instance.InstanceNumber,\n          getImageId: () => instance.imageId, // TODO: Change getImageId to check for instance.imageId property first.\n          /*imageType: DICOMWeb.getString(instance['00080008']),\n          modality: DICOMWeb.getString(instance['00080060']),\n          instanceNumber: DICOMWeb.getNumber(instance['00200013']),\n          imagePositionPatient: DICOMWeb.getString(instance['00200032']),\n          imageOrientationPatient: DICOMWeb.getString(instance['00200037']),\n          frameOfReferenceUID: DICOMWeb.getString(instance['00200052']),\n          sliceLocation: DICOMWeb.getNumber(instance['00201041']),\n          samplesPerPixel: DICOMWeb.getNumber(instance['00280002']),\n          photometricInterpretation: DICOMWeb.getString(instance['00280004']),\n          planarConfiguration: DICOMWeb.getNumber(instance['00280006']),\n          pixelSpacing: DICOMWeb.getString(instance['00280030']),\n          pixelAspectRatio: DICOMWeb.getString(instance['00280034']),\n          bitsAllocated: DICOMWeb.getNumber(instance['00280100']),\n          bitsStored: DICOMWeb.getNumber(instance['00280101']),\n          highBit: DICOMWeb.getNumber(instance['00280102']),\n          pixelRepresentation: DICOMWeb.getNumber(instance['00280103']),\n          smallestPixelValue: DICOMWeb.getNumber(instance['00280106']),\n          largestPixelValue: DICOMWeb.getNumber(instance['00280107']),\n          windowCenter: DICOMWeb.getString(instance['00281050']),\n          windowWidth: DICOMWeb.getString(instance['00281051']),\n          rescaleIntercept: DICOMWeb.getNumber(instance['00281052']),\n          rescaleSlope: DICOMWeb.getNumber(instance['00281053']),\n          rescaleType: DICOMWeb.getNumber(instance['00281054']),\n          sourceImageInstanceUid: getSourceImageInstanceUid(instance),\n          laterality: DICOMWeb.getString(instance['00200062']),\n          viewPosition: DICOMWeb.getString(instance['00185101']),\n          acquisitionDateTime: DICOMWeb.getString(instance['0008002A']),\n          frameIncrementPointer: getFrameIncrementPointer(instance['00280009']),\n          frameTime: DICOMWeb.getNumber(instance['00181063']),\n          frameTimeVector: parseFloatArray(\n            DICOMWeb.getString(instance['00181065'])\n          ),\n          sliceThickness: DICOMWeb.getNumber(instance['00180050']),\n          spacingBetweenSlices: DICOMWeb.getString(instance['00180088']),\n          lossyImageCompression: DICOMWeb.getString(instance['00282110']),\n          derivationDescription: DICOMWeb.getString(instance['00282111']),\n          lossyImageCompressionRatio: DICOMWeb.getString(instance['00282112']),\n          lossyImageCompressionMethod: DICOMWeb.getString(instance['00282114']),\n          echoNumber: DICOMWeb.getString(instance['00180086']),\n          contrastBolusAgent: DICOMWeb.getString(instance['00180010']),\n          radiopharmaceuticalInfo: getRadiopharmaceuticalInfo(instance),\n          wadouri: WADOProxy.convertURL(wadouri, server),\n          wadorsuri: WADOProxy.convertURL(wadorsuri, server),*/\n        });\n      });\n    });\n\n    studies.push(study);\n  });\n\n  console.warn(studies);\n\n  return studies;\n}\n\nexport default async function filesToStudies(files) {\n  const imagePromises = files.map(file => {\n    const imageId = cornerstoneWADOImageLoader.wadouri.fileManager.add(file);\n    return cornerstone\n      .loadAndCacheImage(imageId)\n      .catch(error => console.warn(error));\n  });\n\n  const images = await Promise.all(imagePromises);\n  const datasets = [];\n\n  images.forEach(image => {\n    if (!image || !image.data) {\n      return;\n    }\n\n    const arrayBuffer = image.data.byteArray.buffer;\n    const dicomData = dcmjs.data.DicomMessage.readFile(arrayBuffer);\n    const dataset = dcmjs.data.DicomMetaDictionary.naturalizeDataset(\n      dicomData.dict\n    );\n    dataset._meta = dcmjs.data.DicomMetaDictionary.namifyDataset(\n      dicomData.meta\n    );\n    dataset.imageId = image.imageId;\n\n    datasets.push(dataset);\n  });\n\n  return datasetsToStudies(datasets);\n}\n","import React, { Component } from 'react';\nimport { metadata, utils } from 'ohif-core';\n\nimport ConnectedViewer from './ConnectedViewer.js';\nimport PropTypes from 'prop-types';\nimport { extensionManager } from './../App.js';\nimport Dropzone from 'react-dropzone';\nimport filesToStudies from '../lib/filesToStudies';\nimport './ViewerLocalFileData.css';\nimport { withTranslation } from 'react-i18next';\n\nconst { OHIFStudyMetadata } = metadata;\nconst { studyMetadataManager, updateMetaDataManager } = utils;\n\nclass ViewerLocalFileData extends Component {\n  static propTypes = {\n    studies: PropTypes.array,\n  };\n\n  state = {\n    studies: null,\n    loading: false,\n    error: null,\n  };\n\n  updateStudies = studies => {\n    // Render the viewer when the data is ready\n    studyMetadataManager.purge();\n\n    // Map studies to new format, update metadata manager?\n    const updatedStudies = studies.map(study => {\n      const studyMetadata = new OHIFStudyMetadata(\n        study,\n        study.studyInstanceUid\n      );\n      const sopClassHandlerModules =\n        extensionManager.modules['sopClassHandlerModule'];\n\n      study.displaySets =\n        study.displaySets ||\n        studyMetadata.createDisplaySets(sopClassHandlerModules);\n      studyMetadata.setDisplaySets(study.displaySets);\n\n      // Updates WADO-RS metaDataManager\n      updateMetaDataManager(study);\n\n      studyMetadataManager.add(studyMetadata);\n\n      return study;\n    });\n\n    this.setState({\n      studies: updatedStudies,\n    });\n  };\n\n  render() {\n    const onDrop = async acceptedFiles => {\n      this.setState({ loading: true });\n\n      const studies = await filesToStudies(acceptedFiles);\n      const updatedStudies = this.updateStudies(studies);\n\n      if (!updatedStudies) {\n        return;\n      }\n\n      this.setState({ studies: updatedStudies, loading: false });\n    };\n\n    if (this.state.error) {\n      return <div>Error: {JSON.stringify(this.state.error)}</div>;\n    }\n\n    return (\n      <Dropzone onDrop={onDrop}>\n        {({ getRootProps, getInputProps }) => (\n          <div {...getRootProps()} style={{ width: '100%', height: '100%' }}>\n            {this.state.studies ? (\n              <ConnectedViewer\n                studies={this.state.studies}\n                studyInstanceUids={\n                  this.state.studies &&\n                  this.state.studies.map(a => a.studyInstanceUid)\n                }\n              />\n            ) : (\n              <div className={'drag-drop-instructions'}>\n                <div className={'drag-drop-contents'}>\n                  {this.state.loading ? (\n                    <h3>{this.props.t('Loading...')}</h3>\n                  ) : (\n                    <>\n                      <h3>\n                        {this.props.t(\n                          'Drag and Drop DICOM files here to load them in the Viewer'\n                        )}\n                      </h3>\n                      <h4>\n                        {this.props.t(\n                          \"Or click to load the browser's file selector\"\n                        )}\n                      </h4>\n                    </>\n                  )}\n                </div>\n                <input {...getInputProps()} style={{ display: 'none' }} />\n              </div>\n            )}\n          </div>\n        )}\n      </Dropzone>\n    );\n  }\n}\n\nexport default withTranslation('Common')(ViewerLocalFileData);\n","export function formatFileSize(size) {\n  if (size === 0) return '0 B';\n  const n = Math.floor(Math.log(size) / Math.log(1024));\n  return (\n    (size / Math.pow(1024, n)).toFixed(2) * 1 +\n    ' ' +\n    ['B', 'kB', 'MB', 'GB', 'TB'][n]\n  );\n}\n\nexport function httpErrorToStr(error) {\n  if (!error) return 'Unknown error';\n  if (error.response) {\n    try {\n      const jsonResponse = JSON.parse(error.response);\n      if (\n        jsonResponse.error &&\n        jsonResponse.error.code &&\n        jsonResponse.error.message\n      )\n        return jsonResponse.error.code + ' - ' + jsonResponse.error.message;\n    } catch (err) {\n      return error.response;\n    }\n  }\n  return error.message || 'Unknown error.';\n}\n\n/* eslint-disable */\nexport function checkDicomFile(arrayBuffer) {\n  if (arrayBuffer.length <= 132) return false;\n  const arr = new Uint8Array(arrayBuffer.slice(128, 132));\n  // bytes from 128 to 132 must be \"DICM\"\n  return Array.from('DICM').every((char, i) => char.charCodeAt(0) === arr[i]);\n}\n","export default class CancellationToken {\n  constructor() {\n    this.cancelled = false;\n  }\n\n  get() {\n    return this.cancelled;\n  }\n\n  set(value) {\n    this.cancelled = value;\n  }\n}\n","import { httpErrorToStr, checkDicomFile } from '../utils/helpers';\nimport { api } from 'dicomweb-client';\n\nclass DicomUploadService {\n  async smartUpload(files, url, uploadCallback, cancellationToken) {\n    const CHUNK_SIZE = 1; // Only one file per request is supported so far\n    const MAX_PARALLEL_JOBS = 50; // FIXME: tune MAX_PARALLEL_JOBS number\n\n    let filesArray = Array.from(files);\n    if (filesArray.length === 0) {\n      throw new Error('No files were provided.');\n    }\n\n    let parallelJobsCount = Math.min(filesArray.length, MAX_PARALLEL_JOBS);\n    let completed = false;\n\n    const processJob = async (resolve, reject) => {\n      while (filesArray.length > 0) {\n        if (cancellationToken.get()) return;\n        let chunk = filesArray.slice(0, CHUNK_SIZE);\n        filesArray = filesArray.slice(CHUNK_SIZE);\n        let error = null;\n        try {\n          if (chunk.length > 1) throw new Error('Not implemented');\n          if (chunk.length === 1)\n            await this.simpleUpload(chunk[0], url);\n        } catch (err) {\n          // It looks like a stupid bug of Babel that err is not an actual Exception object\n          error = httpErrorToStr(err);\n        }\n        chunk.forEach(file => uploadCallback(file.fileId, error));\n        if (!completed && filesArray.length === 0) {\n          completed = true;\n          resolve();\n          return;\n        }\n      }\n    };\n\n    await new Promise(resolve => {\n      for (let i = 0; i < parallelJobsCount; i++) {\n        processJob(resolve);\n      }\n    });\n  }\n\n  async simpleUpload(file, url) {\n    const client = this.getClient(url);\n    const loadedFile = await this.readFile(file);\n    const content = loadedFile.content;\n    if (!checkDicomFile(content))\n      throw new Error('This is not a valid DICOM file.');\n\n    await client.storeInstances({ datasets: [content] });\n  }\n\n  readFile(file) {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onload = () => {\n        resolve({\n          name: file.name,\n          size: file.size,\n          type: file.type,\n          content: reader.result,\n        });\n      };\n      reader.onerror = error => reject(error);\n      reader.readAsArrayBuffer(file);\n    });\n  }\n\n  setRetrieveAuthHeaderFunction(func) {\n    this.retrieveAuthHeaderFunc = func;\n  }\n\n  getClient(url) {\n    const headers = this.retrieveAuthHeaderFunc();\n\n    // TODO: a bit weird we are creating a new dicomweb client instance for every upload\n    return new api.DICOMwebClient({\n      url,\n      headers\n    });\n  }\n}\n\nexport default new DicomUploadService();\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { formatFileSize } from './utils/helpers';\nimport CancellationToken from './utils/CancellationToken';\nimport dicomUploader from './api/DicomUploadService';\nimport './DicomUploader.css';\n\nexport default class DicomUploader extends Component {\n  state = {\n    status: 'Upload',\n    isCancelled: false,\n    errorsCount: 0,\n    files: null,\n    uploadedVolume: null,\n    wholeVolumeStr: null,\n    isFilesListHidden: true,\n    timeLeft: null,\n    uploadedList: null,\n    totalCount: 0,\n    successfullyUploadedCount: 0,\n    lastFile: '',\n    uploadContext: null, // this is probably not needed, but we use this variable to distinguish between different downloads\n  };\n\n  static propTypes = {\n    id: PropTypes.string,\n    event: PropTypes.string,\n    url: PropTypes.string,\n    retrieveAuthHeaderFunction: PropTypes.func,\n  };\n\n  filesLeft() {\n    return (\n      this.state.uploadedList.length + ' of ' + this.state.totalCount + ' files'\n    );\n  }\n\n  volumeLeft() {\n    let left = formatFileSize(this.state.uploadedVolume);\n    return left + ' of ' + this.state.wholeVolumeStr;\n  }\n\n  percents() {\n    return parseInt(\n      (100 * this.state.uploadedList.length) /\n        Object.keys(this.state.files).length\n    );\n  }\n\n  isFinished() {\n    return (\n      this.state.isCancelled ||\n      Object.keys(this.state.files).length === this.state.uploadedList.length\n    );\n  }\n\n  errorsMessage() {\n    const errors = this.state.errorsCount === 1 ? ' error' : ' errors';\n    return (\n      this.state.errorsCount + errors + ' while uploading, click for more info'\n    );\n  }\n\n  uploadFiles = files => {\n    const filesArray = Array.from(files.target.files);\n    const filesDict = {};\n    filesArray.forEach((file, i) => {\n      const fileDesc = {\n        id: i,\n        name: file.name,\n        path: file.webkitRelativePath || file.name,\n        size: file.size,\n        error: null,\n        processed: false,\n        processedInUI: false,\n      };\n      filesDict[i] = fileDesc;\n      file.fileId = i;\n    });\n    const wholeVolume = filesArray.map(f => f.size).reduce((a, b) => a + b);\n    const uploadContext = Math.random();\n    this.setState({\n      status: 'Uploading...',\n      files: filesDict,\n      uploadedList: [],\n      uploadedVolume: 0,\n      lastFile: filesArray[0].name,\n      totalCount: filesArray.length,\n      wholeVolumeStr: formatFileSize(wholeVolume),\n      uploadContext: uploadContext,\n      cancellationToken: new CancellationToken(),\n    });\n    const cancellationToken = new CancellationToken();\n    const uploadCallback = (fileId, error) =>\n      uploadContext === this.state.uploadContext &&\n      this.uploadCallback.call(this, fileId, error);\n\n    dicomUploader.setRetrieveAuthHeaderFunction(this.props.retrieveAuthHeaderFunction);\n\n    dicomUploader.smartUpload(\n      files.target.files,\n      this.props.url,\n      uploadCallback,\n      cancellationToken\n    );\n  };\n\n  uploadCallback(fileId, error) {\n    const file = this.state.files[fileId];\n    file.processed = true;\n    if (!error) {\n      let uploadedVolume = this.state.uploadedVolume + file.size;\n      this.setState({ uploadedVolume });\n    } else {\n      file.error = error;\n      this.setState({ errorsCount: this.state.errorsCount + 1 });\n    }\n    this.setState({ lastFile: file.name });\n    let uploadedList = this.state.uploadedList;\n    uploadedList.push(file);\n    this.setState({ uploadedList });\n  }\n\n  renderTableRow = file => {\n    let error = null;\n    if (file.error !== null) {\n      error = <p style={{ color: 'red' }}>{file.error}</p>;\n    }\n    return (\n      <tr key={file.id}>\n        <td className=\"project\">\n          {file.name} {error}\n        </td>\n      </tr>\n    );\n  };\n\n  render() {\n    if (this.state.files === null) {\n      return (\n        <div className=\"dicom-uploader\">\n          <div className=\"button\">\n            <label htmlFor=\"file\">\n              <img src=\"./assets/Button_File.svg\" alt=\"upload file\"></img>\n            </label>\n            <input\n              className=\"invisible-input\"\n              onChange={this.uploadFiles}\n              type=\"file\"\n              id=\"file\"\n              multiple\n            />\n          </div>\n\n          <div className=\"button\">\n            <label htmlFor=\"folder\">\n              <img src=\"./assets/Button_Folder.svg\" alt=\"upload folder\"></img>\n            </label>\n            <input\n              className=\"invisible-input\"\n              type=\"file\"\n              onChange={this.uploadFiles}\n              id=\"folder\"\n              webkitdirectory=\"true\"\n              mozdirectory=\"true\"\n              multiple\n            />\n          </div>\n        </div>\n      );\n    }\n\n    return (\n      <table id=\"tblProjectList\" className=\"table noselect\">\n        <thead>\n          <tr>\n            <th className=\"table-header\">\n              {this.percents()}% {this.filesLeft()}\n            </th>\n          </tr>\n        </thead>\n        <tbody id=\"ProjectList\">\n          {this.state.uploadedList.map(this.renderTableRow)}\n        </tbody>\n      </table>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport Modal from 'react-bootstrap-modal';\nimport DicomUploader from './DicomUploader';\nimport { withTranslation } from 'react-i18next';\n\nclass DicomFileUploaderModal extends Component {\n  static propTypes = {\n    url: PropTypes.string,\n    retrieveAuthHeaderFunction: PropTypes.func,\n    onClose: PropTypes.func,\n  };\n\n  state = {\n    uploaded: false,\n  };\n\n  render() {\n    if (!this.props.url) {\n      return null;\n    }\n\n    return (\n      <Modal\n        show={this.props.isOpen}\n        onHide={this.props.onClose}\n        aria-labelledby=\"ModalHeader\"\n        className=\"modal fade themed in\"\n        backdrop={false}\n        size={'md'}\n        keyboard={true}\n      >\n        <Modal.Header closeButton>\n          <Modal.Title>\n            {this.props.t('Upload DICOM Files')}\n          </Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          <DicomUploader\n            url={this.props.url}\n            retrieveAuthHeaderFunction={this.props.retrieveAuthHeaderFunction}\n          />\n        </Modal.Body>\n      </Modal>\n    );\n  }\n}\n\nexport default withTranslation('Common')(DicomFileUploaderModal);\n","import { connect } from 'react-redux';\nimport DicomFileUploaderModal from './DicomFileUploaderModal.js';\nimport OHIF from 'ohif-core';\n\nconst isActive = a => a.active === true;\n\nconst mapStateToProps = state => {\n  const activeServer = state.servers.servers.find(isActive);\n\n  // TODO: Not sure I like this approach since it means we are recreating\n  // this function every time redux changes\n  const retrieveAuthHeaderFunction = () => OHIF.DICOMWeb.getAuthorizationHeader(activeServer);\n\n  return {\n    retrieveAuthHeaderFunction,\n    url: activeServer && activeServer.qidoRoot,\n  };\n};\n\nconst ConnectedDicomFileUploader = connect(\n  mapStateToProps,\n  null\n)(DicomFileUploaderModal);\n\nexport default ConnectedDicomFileUploader;\n","class GoogleCloudApi {\n  setAccessToken(accessToken) {\n    if (!accessToken) console.error('Access token is empty');\n    this.accessToken = accessToken;\n  }\n\n  get fetchConfig() {\n    if (!this.accessToken) throw new Error('OIDC access_token is not set');\n    return {\n      method: 'GET',\n      headers: {\n        Authorization: 'Bearer ' + this.accessToken,\n      },\n    };\n  }\n\n  get urlBase() {\n    return `https://healthcare.googleapis.com/v1beta1`;\n  }\n\n  get urlBaseProject() {\n    return this.urlBase + `/projects`;\n  }\n\n  async doRequest(urlStr, config = {}, params = {}) {\n    const url = new URL(urlStr);\n    let data = null;\n    url.search = new URLSearchParams(params);\n\n    try {\n      const response = await fetch(url, { ...this.fetchConfig, config });\n      try {\n        data = await response.json();\n      } catch (err) {}\n      if (response.status >= 200 && response.status < 300 && data != null) {\n        if (data.nextPageToken != null) {\n          params.pageToken = data.nextPageToken;\n          let subPage = await this.doRequest(urlStr, config, params);\n          for (let key in data) {\n            if (data.hasOwnProperty(key)) {\n              data[key] = data[key].concat(subPage.data[key]);\n            }\n          }\n        }\n        return {\n          isError: false,\n          status: response.status,\n          data,\n        };\n      } else {\n        return {\n          isError: true,\n          status: response.status,\n          message:\n            (data && data.error && data.error.message) || 'Unknown error',\n        };\n      }\n    } catch (err) {\n      if (data && data.error) {\n        return {\n          isError: true,\n          status: err.status,\n          message: err.response.data.error.message || 'Unspecified error',\n        };\n      }\n      return {\n        isError: true,\n        message: (err && err.message) || 'Oops! Something went wrong',\n      };\n    }\n  }\n\n  async loadProjects() {\n    return this.doRequest(\n      'https://cloudresourcemanager.googleapis.com/v1/projects'\n    );\n  }\n\n  async loadLocations(projectId) {\n    return this.doRequest(`${this.urlBaseProject}/${projectId}/locations`);\n  }\n\n  async loadDatasets(projectId, locationId) {\n    return this.doRequest(\n      `${this.urlBaseProject}/${projectId}/locations/${locationId}/datasets`\n    );\n  }\n\n  async loadDicomStores(dataset) {\n    return this.doRequest(`${this.urlBase}/${dataset}/dicomStores`);\n  }\n}\n\nexport default new GoogleCloudApi();\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport './googleCloud.css';\nimport { withTranslation } from 'react-i18next';\nimport { Icon } from 'react-viewerbase';\n\nclass DicomStoreList extends Component {\n  state = {\n    search: '',\n  };\n\n  static propTypes = {\n    stores: PropTypes.array,\n    loading: PropTypes.bool.isRequired,\n    error: PropTypes.string,\n    onSelect: PropTypes.func,\n  };\n\n  static defaultProps = {\n    loading: true,\n  };\n\n  renderTableRow = store => {\n    return (\n      <tr\n        key={store.name}\n        className={\n          this.state.highlightedItem === store.name\n            ? 'noselect active'\n            : 'noselect'\n        }\n        onMouseEnter={() => {\n          this.onHighlightItem(store.name);\n        }}\n        onClick={() => {\n          this.props.onSelect(store);\n        }}\n      >\n        <td className=\"project\">{store.name.split('/')[7]}</td>\n      </tr>\n    );\n  };\n\n  onHighlightItem(store) {\n    this.setState({ highlightedItem: store });\n  }\n\n  render() {\n    if (this.props.error) {\n      return <p>{this.props.error}</p>;\n    }\n\n    const loadingIcon = (\n      <Icon name=\"circle-notch\" className=\"loading-icon-spin loading-icon\" />\n    );\n\n    if (this.props.loading) {\n      return loadingIcon;\n    }\n\n    const body = (\n      <tbody id=\"StoreList\">{this.props.stores.map(this.renderTableRow)}</tbody>\n    );\n\n    return (\n      <table id=\"tblStoreList\" className=\"gcp-table table noselect\">\n        <thead>\n          <tr>\n            <th>{this.props.t('DICOM Store')}</th>\n          </tr>\n        </thead>\n        {this.props.stores && body}\n      </table>\n    );\n  }\n}\n\nexport default withTranslation('Common')(DicomStoreList);\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport api from './api/GoogleCloudApi';\nimport DicomStoreList from './DicomStoreList';\nimport './googleCloud.css';\n\nexport default class DicomStorePicker extends Component {\n  state = {\n    error: null,\n    loading: true,\n    stores: [],\n    locations: [],\n  };\n\n  static propTypes = {\n    dataset: PropTypes.object,\n    onSelect: PropTypes.func,\n    accessToken: PropTypes.string.isRequired\n  };\n\n  async componentDidMount() {\n    api.setAccessToken(this.props.accessToken);\n\n    const response = await api.loadDicomStores(this.props.dataset.name);\n\n    if (response.isError) {\n      this.setState({\n        error: response.message,\n      });\n\n      return;\n    }\n\n    this.setState({\n      stores: response.data.dicomStores || [],\n      loading: false,\n    });\n  }\n\n  render() {\n    const { stores, loading, error } = this.state;\n    const { onSelect } = this.props;\n\n    return (\n      <DicomStoreList\n        stores={stores}\n        loading={loading}\n        error={error}\n        onSelect={onSelect}\n      />\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport './googleCloud.css';\nimport { withTranslation } from 'react-i18next';\nimport { Icon } from 'react-viewerbase';\n\nclass DatasetsList extends Component {\n  state = {\n    search: '',\n  };\n\n  static propTypes = {\n    datasets: PropTypes.array,\n    loading: PropTypes.bool,\n    error: PropTypes.string,\n    onSelect: PropTypes.func,\n  };\n\n  static defaultProps = {\n    loading: true,\n  };\n\n  renderTableRow = dataset => {\n    return (\n      <tr\n        key={dataset.name}\n        className={\n          this.state.highlightedItem === dataset.name\n            ? 'noselect active'\n            : 'noselect'\n        }\n        onMouseEnter={() => {\n          this.onHighlightItem(dataset.name);\n        }}\n        onClick={() => {\n          this.props.onSelect(dataset);\n        }}\n      >\n        <td>{dataset.name.split('/')[5]}</td>\n      </tr>\n    );\n  };\n\n  onHighlightItem(dataset) {\n    this.setState({ highlightedItem: dataset });\n  }\n\n  render() {\n    if (this.props.error) {\n      return <p>{this.props.error}</p>;\n    }\n\n    const loadingIcon = (\n      <Icon name=\"circle-notch\" className=\"loading-icon-spin loading-icon\" />\n    );\n\n    if (this.props.loading) {\n      return loadingIcon;\n    }\n\n    const body = (\n      <tbody id=\"DatasetList\">\n        {this.props.datasets.map(this.renderTableRow)}\n      </tbody>\n    );\n\n    return (\n      <table id=\"tblDatasetList\" className=\"gcp-table table noselect\">\n        <thead>\n          <tr>\n            <th>{this.props.t('Dataset')}</th>\n          </tr>\n        </thead>\n        {this.props.datasets && body}\n      </table>\n    );\n  }\n}\n\nexport default withTranslation('Common')(DatasetsList);\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport api from './api/GoogleCloudApi';\nimport DatasetsList from './DatasetsList';\nimport './googleCloud.css';\n\nexport default class DatasetPicker extends Component {\n  state = {\n    error: null,\n    loading: true,\n    datasets: [],\n  };\n\n  static propTypes = {\n    project: PropTypes.object,\n    location: PropTypes.object,\n    onSelect: PropTypes.func,\n    accessToken: PropTypes.string,\n  };\n\n  async componentDidMount() {\n    api.setAccessToken(this.props.accessToken);\n\n    const response = await api.loadDatasets(\n      this.props.project.projectId,\n      this.props.location.locationId\n    );\n\n    if (response.isError) {\n      this.setState({\n        error: response.message,\n      });\n\n      return;\n    }\n\n    this.setState({\n      datasets: response.data.datasets || [],\n      loading: false,\n    });\n  }\n\n  render() {\n    const { datasets, loading, error } = this.state;\n    const { onSelect } = this.props;\n    return (\n      <DatasetsList\n        datasets={datasets}\n        loading={loading}\n        error={error}\n        onSelect={onSelect}\n      />\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport './googleCloud.css';\nimport { withTranslation } from 'react-i18next';\nimport { Icon } from 'react-viewerbase';\n\nclass ProjectsList extends Component {\n  state = {\n    search: '',\n    highlightedItem: null,\n  };\n\n  static propTypes = {\n    projects: PropTypes.array,\n    loading: PropTypes.bool.isRequired,\n    error: PropTypes.string,\n    onSelect: PropTypes.func.isRequired,\n    t: PropTypes.func,\n  };\n\n  static defaultProps = {\n    loading: true,\n  };\n\n  renderTableRow = project => {\n    return (\n      <tr\n        key={project.projectId}\n        className={\n          this.state.highlightedItem === project.projectId\n            ? 'noselect active'\n            : 'noselect'\n        }\n        onMouseEnter={() => {\n          this.onHighlightItem(project.projectId);\n        }}\n        onClick={() => {\n          this.onHighlightItem(project.projectId);\n          this.props.onSelect(project);\n        }}\n      >\n        <td>{project.name}</td>\n        <td>{project.projectId}</td>\n      </tr>\n    );\n  };\n\n  onHighlightItem(project) {\n    this.setState({ highlightedItem: project });\n  }\n\n  render() {\n    if (this.props.error) {\n      return <p>{this.props.error}</p>;\n    }\n\n    const loadingIcon = (\n      <Icon name=\"circle-notch\" className=\"loading-icon-spin loading-icon\" />\n    );\n\n    if (this.props.loading) {\n      return loadingIcon;\n    }\n\n    const body = (\n      <tbody id=\"ProjectList\">\n        {this.props.projects.map(this.renderTableRow)}\n      </tbody>\n    );\n\n    return (\n      <table id=\"tblProjectList\" className=\"gcp-table table noselect\">\n        <thead>\n          <tr>\n            <th>{this.props.t('Project')}</th>\n            <th>{this.props.t('ID')}</th>\n          </tr>\n        </thead>\n        {this.props.projects && body}\n      </table>\n    );\n  }\n}\n\nexport default withTranslation('Common')(ProjectsList);\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport api from './api/GoogleCloudApi';\nimport ProjectsList from './ProjectsList';\nimport './googleCloud.css';\n\nexport default class ProjectPicker extends Component {\n  state = {\n    error: null,\n    loading: true,\n    projects: [],\n  };\n\n  static propTypes = {\n    onSelect: PropTypes.func,\n    accessToken: PropTypes.string,\n  };\n\n  async componentDidMount() {\n    api.setAccessToken(this.props.accessToken);\n    const response = await api.loadProjects();\n\n    if (response.isError) {\n      this.setState({\n        error: response.message,\n      });\n\n      return;\n    }\n\n    this.setState({\n      projects: response.data.projects || [],\n      loading: false,\n    });\n  }\n\n  render() {\n    const { projects, loading, error } = this.state;\n    const { onSelect } = this.props;\n    return (\n      <ProjectsList\n        projects={projects}\n        loading={loading}\n        error={error}\n        onSelect={onSelect}\n      />\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport './googleCloud.css';\nimport { withTranslation } from 'react-i18next';\nimport { Icon } from 'react-viewerbase';\n\nclass LocationsList extends Component {\n  state = {\n    search: '',\n  };\n\n  static propTypes = {\n    locations: PropTypes.array,\n    loading: PropTypes.bool.isRequired,\n    error: PropTypes.string,\n    onSelect: PropTypes.func,\n  };\n\n  static defaultProps = {\n    loading: true,\n  };\n\n  renderTableRow = location => {\n    return (\n      <tr\n        key={location.locationId}\n        className={\n          this.state.highlightedItem === location.locationId\n            ? 'noselect active'\n            : 'noselect'\n        }\n        onMouseEnter={() => {\n          this.onHighlightItem(location.locationId);\n        }}\n        onClick={() => {\n          this.props.onSelect(location);\n        }}\n      >\n        <td>{location.name.split('/')[3]}</td>\n      </tr>\n    );\n  };\n\n  onHighlightItem(locationId) {\n    this.setState({ highlightedItem: locationId });\n  }\n\n  render() {\n    if (this.props.error) {\n      return <p>{this.props.error}</p>;\n    }\n\n    const loadingIcon = (\n      <Icon name=\"circle-notch\" className=\"loading-icon-spin loading-icon\" />\n    );\n\n    if (this.props.loading) {\n      return loadingIcon;\n    }\n\n    const body = (\n      <tbody id=\"LocationList\">\n        {this.props.locations.map(this.renderTableRow)}\n      </tbody>\n    );\n\n    return (\n      <table id=\"tblLocationList\" className=\"gcp-table table noselect\">\n        <thead>\n          <tr>\n            <th>{this.props.t('Location')}</th>\n          </tr>\n        </thead>\n        {this.props.locations && body}\n      </table>\n    );\n  }\n}\n\nexport default withTranslation('Common')(LocationsList);\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport api from './api/GoogleCloudApi';\nimport LocationsList from './LocationsList';\nimport './googleCloud.css';\n\nexport default class LocationPicker extends Component {\n  state = {\n    error: null,\n    loading: true,\n    locations: [],\n  };\n\n  static propTypes = {\n    project: PropTypes.object,\n    onSelect: PropTypes.func,\n    accessToken: PropTypes.string,\n  };\n\n  async componentDidMount() {\n    api.setAccessToken(this.props.accessToken);\n\n    const response = await api.loadLocations(this.props.project.projectId);\n\n    if (response.isError) {\n      this.setState({\n        error: response.message,\n      });\n\n      return;\n    }\n\n    this.setState({\n      locations: response.data.locations || [],\n      loading: false,\n    });\n  }\n\n  render() {\n    const { locations, loading, error } = this.state;\n    const { onSelect } = this.props;\n    return (\n      <LocationsList\n        locations={locations}\n        loading={loading}\n        error={error}\n        onSelect={onSelect}\n      />\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { withTranslation } from 'react-i18next';\nimport DicomStorePicker from './DicomStorePicker';\nimport DatasetPicker from './DatasetPicker';\nimport ProjectPicker from './ProjectPicker';\nimport LocationPicker from './LocationPicker';\nimport GoogleCloudApi from './api/GoogleCloudApi';\nimport './googleCloud.css';\n\nclass DatasetSelector extends Component {\n  state = {\n    project: null,\n    location: null,\n    dataset: null,\n    unloading: false,\n  };\n\n  static propTypes = {\n    id: PropTypes.string,\n    event: PropTypes.string,\n    user: PropTypes.object,\n    canClose: PropTypes.string,\n    setServers: PropTypes.func.isRequired,\n  };\n\n  onProjectSelect = project => {\n    this.setState({\n      project,\n    });\n  };\n\n  onLocationSelect = location => {\n    this.setState({\n      location,\n    });\n  };\n\n  onDatasetSelect = dataset => {\n    this.setState({\n      dataset,\n    });\n  };\n\n  onProjectClick = () => {\n    this.setState({\n      dataset: null,\n      location: null,\n      project: null,\n    });\n  };\n\n  onLocationClick = () => {\n    this.setState({\n      dataset: null,\n      location: null,\n    });\n  };\n\n  onDatasetClick = () => {\n    this.setState({\n      dataset: null,\n    });\n  };\n\n  onDicomStoreSelect = dicomStoreJson => {\n    const dicomStore = dicomStoreJson.name;\n    const parts = dicomStore.split('/');\n    const result = {\n      wadoUriRoot: GoogleCloudApi.urlBase + `/${dicomStore}/dicomWeb`,\n      qidoRoot: GoogleCloudApi.urlBase + `/${dicomStore}/dicomWeb`,\n      wadoRoot: GoogleCloudApi.urlBase + `/${dicomStore}/dicomWeb`,\n      project: parts[1],\n      location: parts[3],\n      dataset: parts[5],\n      dicomStore: parts[7],\n    };\n    this.props.setServers(result);\n  };\n\n  render() {\n    const accessToken = this.props.user.access_token;\n\n    const { project, location, dataset } = this.state;\n    const {\n      onProjectClick,\n      onLocationClick,\n      onDatasetClick,\n      onProjectSelect,\n      onLocationSelect,\n      onDatasetSelect,\n      onDicomStoreSelect,\n    } = this;\n\n    let projectBreadcrumbs = (\n      <div className=\"gcp-picker--path\">\n        <span>{this.props.t('Select a Project')}</span>\n      </div>\n    );\n\n    if (project) {\n      projectBreadcrumbs = (\n        <div className=\"gcp-picker--path\">\n          <span onClick={onProjectClick}>{project.name}</span>\n          {project && location && (\n            <span onClick={onLocationClick}>\n              {' '}\n              -> {location.name.split('/')[3]}\n            </span>\n          )}\n          {project && location && dataset && (\n            <span onClick={onDatasetClick}>\n              {' '}\n              -> {dataset.name.split('/')[5]}\n            </span>\n          )}\n        </div>\n      );\n    }\n\n    return (\n      <>\n        {projectBreadcrumbs}\n        {!project && (\n          <ProjectPicker\n            accessToken={accessToken}\n            onSelect={onProjectSelect}\n          />\n        )}\n\n        {project && !location && (\n          <LocationPicker\n            accessToken={accessToken}\n            project={project}\n            onSelect={onLocationSelect}\n          />\n        )}\n        {project && location && !dataset && (\n          <DatasetPicker\n            accessToken={accessToken}\n            project={project}\n            location={location}\n            onSelect={onDatasetSelect}\n          />\n        )}\n        {project && location && dataset && (\n          <DicomStorePicker\n            accessToken={accessToken}\n            dataset={dataset}\n            onSelect={onDicomStoreSelect}\n          />\n        )}\n      </>\n    );\n  }\n}\n\nexport default withTranslation('Common')(DatasetSelector);\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport Modal from 'react-bootstrap-modal';\nimport DatasetSelector from './DatasetSelector';\nimport './googleCloud.css';\nimport { withTranslation } from 'react-i18next';\n\nclass DicomStorePickerModal extends Component {\n  static propTypes = {\n    url: PropTypes.string,\n    user: PropTypes.object.isRequired,\n    setServers: PropTypes.func.isRequired,\n    isOpen: PropTypes.bool.isRequired,\n    onClose: PropTypes.func,\n  };\n\n  static defaultProps = {\n    isOpen: false,\n  };\n\n  handleEvent = data => {\n    const servers = [\n      {\n        name: data.dicomStore,\n        imageRendering: 'wadors',\n        thumbnailRendering: 'wadors',\n        qidoSupportsIncludeField: false,\n        type: 'dicomWeb',\n        qidoRoot: data.qidoRoot,\n        wadoRoot: data.wadoRoot,\n        wadoUriRoot: data.wadoUriRoot,\n        active: true,\n        supportsFuzzyMatching: false,\n      },\n    ];\n\n    this.props.setServers(servers);\n  };\n\n  render() {\n    return (\n      <Modal\n        show={this.props.isOpen}\n        onHide={this.props.onClose}\n        aria-labelledby=\"ModalHeader\"\n        className=\"modal fade themed in\"\n        backdrop={false}\n        size={'md'}\n        keyboard={true}\n      >\n        <Modal.Header closeButton>\n          <Modal.Title>\n            {this.props.t('Google Cloud Healthcare API')}\n          </Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          <DatasetSelector\n            setServers={this.handleEvent}\n            user={this.props.user}\n            url={this.props.url}\n          />\n        </Modal.Body>\n      </Modal>\n    );\n  }\n}\n\nexport default withTranslation('Common')(DicomStorePickerModal);\n","import { connect } from 'react-redux';\nimport DicomStorePickerModal from './DicomStorePickerModal.js';\n\nconst isActive = a => a.active === true;\n\nconst mapStateToProps = state => {\n  const activeServer = state.servers.servers.find(isActive);\n\n  return {\n    user: state.oidc && state.oidc.user,\n    url: activeServer && activeServer.qidoRoot,\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    setServers: servers => {\n      const action = {\n        type: 'SET_SERVERS',\n        servers,\n      };\n      dispatch(action);\n    },\n  };\n};\n\nconst ConnectedDicomStorePicker = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(DicomStorePickerModal);\n\nexport default ConnectedDicomStorePicker;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport Dropzone from 'react-dropzone';\nimport OHIF from 'ohif-core';\nimport { withRouter } from 'react-router-dom';\nimport { withTranslation } from 'react-i18next';\nimport { StudyList } from 'react-viewerbase';\nimport ConnectedHeader from '../connectedComponents/ConnectedHeader.js';\nimport moment from 'moment';\nimport ConnectedDicomFilesUploader from '../googleCloud/ConnectedDicomFilesUploader';\nimport ConnectedDicomStorePicker from '../googleCloud/ConnectedDicomStorePicker';\nimport filesToStudies from '../lib/filesToStudies.js';\nimport UserManagerContext from '../UserManagerContext';\nimport WhiteLabellingContext from '../WhiteLabellingContext';\n\nclass StudyListWithData extends Component {\n  state = {\n    searchData: {},\n    studies: [],\n    error: null,\n    modalComponentId: null,\n  };\n\n  static propTypes = {\n    filters: PropTypes.object,\n    patientId: PropTypes.string,\n    server: PropTypes.object,\n    user: PropTypes.object,\n    history: PropTypes.object,\n    studyListFunctionsEnabled: PropTypes.bool,\n  };\n\n  static defaultProps = {\n    studyListFunctionsEnabled: true,\n  };\n\n  static rowsPerPage = 25;\n  static defaultSort = { field: 'patientName', order: 'desc' };\n\n  static studyListDateFilterNumDays = 25000; // TODO: put this in the settings\n  static defaultStudyDateFrom = moment()\n    .subtract(StudyListWithData.studyListDateFilterNumDays, 'days')\n    .toDate();\n  static defaultStudyDateTo = new Date();\n  static defaultSearchData = {\n    currentPage: 0,\n    rowsPerPage: StudyListWithData.rowsPerPage,\n    studyDateFrom: StudyListWithData.defaultStudyDateFrom,\n    studyDateTo: StudyListWithData.defaultStudyDateTo,\n    sortData: StudyListWithData.defaultSort,\n  };\n\n  componentDidMount() {\n    // TODO: Avoid using timepoints here\n    //const params = { studyInstanceUids, seriesInstanceUids, timepointId, timepointsFilter={} };\n    if (!this.props.server && window.config.enableGoogleCloudAdapter) {\n      this.setState({\n        modalComponentId: 'DicomStorePicker',\n      });\n    } else {\n      this.searchForStudies({\n        ...StudyListWithData.defaultSearchData,\n        ...(this.props.filters || {}),\n      });\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    if (!this.state.searchData && !this.state.studies) {\n      this.searchForStudies();\n    }\n    if (this.props.server !== prevProps.server) {\n      this.setState({\n        modalComponentId: null,\n        searchData: null,\n        studies: null,\n      });\n    }\n  }\n\n  searchForStudies = (searchData = StudyListWithData.defaultSearchData) => {\n    const { server } = this.props;\n    const filter = {\n      patientId: searchData.patientId,\n      patientName: searchData.patientName,\n      accessionNumber: searchData.accessionNumber,\n      studyDescription: searchData.studyDescription,\n      modalitiesInStudy: searchData.modalities,\n      studyDateFrom: searchData.studyDateFrom,\n      studyDateTo: searchData.studyDateTo,\n      limit: searchData.rowsPerPage,\n      offset: searchData.currentPage * searchData.rowsPerPage,\n    };\n\n    if (server.supportsFuzzyMatching) {\n      filter.fuzzymatching = true;\n    }\n\n    // TODO: add sorting\n    const promise = OHIF.studies.searchStudies(server, filter);\n\n    // Render the viewer when the data is ready\n    promise\n      .then(studies => {\n        if (!studies) {\n          studies = [];\n        }\n\n        const { field, order } = searchData.sortData;\n        let sortedStudies = studies.map(study => {\n          if (!moment(study.studyDate, 'MMM DD, YYYY', true).isValid()) {\n            study.studyDate = moment(study.studyDate, 'YYYYMMDD').format(\n              'MMM DD, YYYY'\n            );\n          }\n          return study;\n        });\n\n        sortedStudies.sort(function(a, b) {\n          let fieldA = a[field];\n          let fieldB = b[field];\n          if (field === 'studyDate') {\n            fieldA = moment(fieldA).toISOString();\n            fieldB = moment(fieldB).toISOString();\n          }\n          if (order === 'desc') {\n            if (fieldA < fieldB) {\n              return -1;\n            }\n            if (fieldA > fieldB) {\n              return 1;\n            }\n            return 0;\n          } else {\n            if (fieldA > fieldB) {\n              return -1;\n            }\n            if (fieldA < fieldB) {\n              return 1;\n            }\n            return 0;\n          }\n        });\n\n        this.setState({\n          studies: sortedStudies,\n        });\n      })\n      .catch(error => {\n        this.setState({\n          error: true,\n        });\n\n        throw new Error(error);\n      });\n  };\n\n  onImport = () => {\n    this.openModal('DicomFilesUploader');\n  };\n\n  openModal = modalComponentId => {\n    this.setState({\n      modalComponentId,\n    });\n  };\n\n  closeModal = () => {\n    this.setState({ modalComponentId: null });\n  };\n\n  onSelectItem = studyInstanceUID => {\n    this.props.history.push(`/viewer/${studyInstanceUID}`);\n  };\n\n  onSearch = searchData => {\n    this.searchForStudies(searchData);\n  };\n\n  closeModals = () => {\n    this.setState({\n      modalComponentId: null,\n    });\n  };\n\n  render() {\n    const onDrop = async acceptedFiles => {\n      try {\n        const studies = await filesToStudies(acceptedFiles);\n\n        this.setState({ studies });\n      } catch (error) {\n        this.setState({ error });\n      }\n    };\n\n    if (this.state.error) {\n      return <div>Error: {JSON.stringify(this.state.error)}</div>;\n    } else if (this.state.studies === null && !this.state.modalComponentId) {\n      return <div>Loading...</div>;\n    }\n\n    let healthCareApiButtons = null;\n    let healthCareApiWindows = null;\n\n    // TODO: This should probably be a prop\n    if (window.config.enableGoogleCloudAdapter) {\n      healthCareApiWindows = (\n        <ConnectedDicomStorePicker\n          isOpen={this.state.modalComponentId === 'DicomStorePicker'}\n          onClose={this.closeModals}\n        />\n      );\n\n      healthCareApiButtons = (\n        <div\n          className=\"form-inline btn-group pull-right\"\n          style={{ padding: '20px' }}\n        >\n          <button\n            className=\"btn btn-primary\"\n            onClick={() => this.openModal('DicomStorePicker')}\n          >\n            {this.props.t('Change DICOM Store')}\n          </button>\n        </div>\n      );\n    }\n\n    const studyList = (\n      <div className=\"paginationArea\">\n        {this.state.studies ? (\n          <StudyList\n            studies={this.state.studies}\n            studyListFunctionsEnabled={this.props.studyListFunctionsEnabled}\n            onImport={this.onImport}\n            onSelectItem={this.onSelectItem}\n            pageSize={this.rowsPerPage}\n            defaultSort={StudyListWithData.defaultSort}\n            studyListDateFilterNumDays={\n              StudyListWithData.studyListDateFilterNumDays\n            }\n            onSearch={this.onSearch}\n          >\n            {this.props.studyListFunctionsEnabled ? (\n              <ConnectedDicomFilesUploader\n                isOpen={this.state.modalComponentId === 'DicomFilesUploader'}\n                onClose={this.closeModals}\n              />\n            ) : null}\n            {healthCareApiButtons}\n            {healthCareApiWindows}\n          </StudyList>\n        ) : (\n          <Dropzone onDrop={onDrop}>\n            {({ getRootProps, getInputProps }) => (\n              <div {...getRootProps()} className={'drag-drop-instructions'}>\n                <h3>\n                  {this.props.t(\n                    'Drag and Drop DICOM files here to load them in the Viewer'\n                  )}\n                </h3>\n                <h4>\n                  {this.props.t(\"Or click to load the browser's file selector\")}\n                </h4>\n                <input {...getInputProps()} style={{ display: 'none' }} />\n              </div>\n            )}\n          </Dropzone>\n        )}\n      </div>\n    );\n    return (\n      <>\n        <WhiteLabellingContext.Consumer>\n          {whiteLabelling => (\n            <UserManagerContext.Consumer>\n              {userManager => (\n                <ConnectedHeader\n                  home={true}\n                  user={this.props.user}\n                  userManager={userManager}\n                >\n                  {whiteLabelling.logoComponent}\n                </ConnectedHeader>\n              )}\n            </UserManagerContext.Consumer>\n          )}\n        </WhiteLabellingContext.Consumer>\n        {studyList}\n      </>\n    );\n  }\n}\n\nexport default withRouter(withTranslation('Common')(StudyListWithData));\n","import { connect } from 'react-redux';\n\nimport StudyListWithData from './StudyListWithData.js';\n\nconst isActive = a => a.active === true;\n\nconst mapStateToProps = state => {\n  const activeServer = state.servers.servers.find(isActive);\n\n  return {\n    server: activeServer,\n    user: state.oidc.user,\n  };\n};\n\nconst ConnectedStudyList = connect(\n  mapStateToProps,\n  null\n)(StudyListWithData);\n\nexport default ConnectedStudyList;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { withRouter } from 'react-router-dom';\nimport queryString from 'query-string';\nimport ConnectedStudyList from './ConnectedStudyList';\n\n// TODO: Move to react-viewerbase\n\nfunction toLowerCaseFirstLetter(word) {\n  return word[0].toLowerCase() + word.slice(1);\n}\n\nfunction getFilters({ search }) {\n  const searchParameters = queryString.parse(search);\n  const filters = {};\n\n  Object.entries(searchParameters).forEach(([key, value]) => {\n    filters[toLowerCaseFirstLetter(key)] = value;\n  });\n\n  return filters;\n}\n\nfunction StudyListRouting({ location }) {\n  const filters = location ? getFilters(location) : undefined;\n\n  let studyListFunctionsEnabled = false;\n  if (window.config && window.config.studyListFunctionsEnabled) {\n    studyListFunctionsEnabled = window.config.studyListFunctionsEnabled;\n  }\n  return <ConnectedStudyList\n    filters={filters}\n    studyListFunctionsEnabled={studyListFunctionsEnabled}\n  />;\n}\n\nStudyListRouting.propTypes = {\n  location: PropTypes.shape({\n    search: PropTypes.string,\n  }).isRequired,\n};\n\nexport default withRouter(StudyListRouting);\n","import React, { Component } from 'react';\nimport { log, metadata, studies, utils } from 'ohif-core';\n\nimport PropTypes from 'prop-types';\nimport Viewer from '../connectedComponents/Viewer';\nimport { extensionManager } from './../App.js';\nimport qs from 'querystring';\n\nconst { OHIFStudyMetadata } = metadata;\nconst { retrieveStudiesMetadata } = studies;\nconst { studyMetadataManager, updateMetaDataManager } = utils;\n\nclass StandaloneRouting extends Component {\n  state = {\n    studies: null,\n    error: null,\n  };\n\n  static propTypes = {\n    location: PropTypes.object,\n    store: PropTypes.object,\n  };\n\n  static parseQueryAndFetchStudies(query) {\n    return new Promise((resolve, reject) => {\n      const url = query.url;\n\n      if (!url) {\n        reject(new Error('No URL was specified. Use ?url=$yourURL'));\n      }\n\n      // Define a request to the server to retrieve the study data\n      // as JSON, given a URL that was in the Route\n      const oReq = new XMLHttpRequest();\n\n      // Add event listeners for request failure\n      oReq.addEventListener('error', error => {\n        log.warn('An error occurred while retrieving the JSON data');\n        reject(error);\n      });\n\n      // When the JSON has been returned, parse it into a JavaScript Object\n      // and render the OHIF Viewer with this data\n      oReq.addEventListener('load', () => {\n        // Parse the response content\n        // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseText\n        if (!oReq.responseText) {\n          log.warn('Response was undefined');\n          reject(new Error('Response was undefined'));\n        }\n\n        log.info(JSON.stringify(oReq.responseText, null, 2));\n\n        const data = JSON.parse(oReq.responseText);\n        if (data.servers && query.studyInstanceUids) {\n          const server = data.servers.dicomWeb[0];\n          server.type = 'dicomWeb';\n\n          const studyInstanceUids = query.studyInstanceUids.split(';');\n          const seriesInstanceUids = [];\n\n          retrieveStudiesMetadata(\n            server,\n            studyInstanceUids,\n            seriesInstanceUids\n          ).then(\n            studies => {\n              resolve(studies);\n            },\n            error => {\n              reject(error);\n            }\n          );\n        } else {\n          resolve(data.studies);\n        }\n      });\n\n      // Open the Request to the server for the JSON data\n      // In this case we have a server-side route called /api/\n      // which responds to GET requests with the study data\n      log.info(`Sending Request to: ${url}`);\n      oReq.open('GET', url);\n      oReq.setRequestHeader('Accept', 'application/json');\n\n      // Fire the request to the server\n      oReq.send();\n    });\n  }\n\n  async componentDidMount() {\n    try {\n      let { search } = this.props.location;\n\n      // Remove ? prefix which is included for some reason\n      search = search.slice(1, search.length);\n\n      const query = qs.parse(search);\n      const studies = await StandaloneRouting.parseQueryAndFetchStudies(query);\n\n      studyMetadataManager.purge();\n\n      // Map studies to new format, update metadata manager?\n      const updatedStudies = studies.map(study => {\n        const studyMetadata = new OHIFStudyMetadata(\n          study,\n          study.studyInstanceUid\n        );\n        const sopClassHandlerModules =\n          extensionManager.modules['sopClassHandlerModule'];\n\n        study.displaySets =\n          study.displaySets ||\n          studyMetadata.createDisplaySets(sopClassHandlerModules);\n        studyMetadata.setDisplaySets(study.displaySets);\n\n        // Updates WADO-RS metaDataManager\n        updateMetaDataManager(study);\n\n        studyMetadataManager.add(studyMetadata);\n\n        return study;\n      });\n\n      this.setState({ studies: updatedStudies });\n    } catch (error) {\n      this.setState({ error });\n    }\n  }\n\n  render() {\n    if (this.state.error) {\n      return <div>Error: {JSON.stringify(this.state.error)}</div>;\n    } else if (!this.state.studies) {\n      return <div>Loading...</div>;\n    }\n\n    return <Viewer studies={this.state.studies} />;\n  }\n}\n\nexport default StandaloneRouting;\n","import React, { Component } from 'react';\nimport { withRouter } from 'react-router-dom';\nimport PropTypes from 'prop-types';\nimport { CallbackComponent } from 'redux-oidc';\n\nclass CallbackPage extends Component {\n  static propTypes = {\n    userManager: PropTypes.object.isRequired,\n    history: PropTypes.object.isRequired,\n  };\n\n  render() {\n    return (\n      <CallbackComponent\n        userManager={this.props.userManager}\n        successCallback={() => {\n          const pathname = sessionStorage.getItem('ohif-redirect-to');\n\n          this.props.history.push(pathname);\n        }}\n        errorCallback={error => {\n          //this.props.history.push(\"/\");\n          throw new Error(error);\n        }}\n      >\n        <div>Redirecting...</div>\n      </CallbackComponent>\n    );\n  }\n}\n\nexport default withRouter(CallbackPage);\n","import React from 'react';\nimport './NotFound.css';\nimport { Link } from 'react-router-dom';\n\nexport default function NotFound() {\n  return (\n    <div className={'not-found'}>\n      <div>\n        <h4>Sorry, this page does not exist.</h4>\n        <h5>\n          <Link to={'/'}>Go back to the Study List</Link>\n        </h5>\n      </div>\n    </div>\n  );\n}\n","import React from 'react';\n\nconst Bar = ({ progress, animationDuration }) => (\n  <div\n    style={{\n      background: '#29d',\n      height: 2,\n      left: 0,\n      marginLeft: `${(-1 + progress) * 100}%`,\n      position: 'fixed',\n      top: 0,\n      transition: `margin-left ${animationDuration}ms linear`,\n      width: '100%',\n      zIndex: 1031,\n    }}\n  >\n    <div\n      style={{\n        boxShadow: '0 0 10px #29d, 0 0 5px #29d',\n        display: 'block',\n        height: '100%',\n        opacity: 1,\n        position: 'absolute',\n        right: 0,\n        transform: 'rotate(3deg) translate(0px, -4px)',\n        width: 100,\n      }}\n    />\n  </div>\n);\n\nexport default Bar;\n","import React from 'react';\n\nconst Container = ({ children, isFinished, animationDuration }) => (\n  <div\n    style={{\n      opacity: isFinished ? 0 : 1,\n      pointerEvents: 'none',\n      transition: `opacity ${animationDuration}ms linear`,\n    }}\n  >\n    {children}\n  </div>\n);\n\nexport default Container;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { withRouter, matchPath } from 'react-router';\nimport { Route, Switch } from 'react-router-dom';\nimport { NProgress } from '@tanem/react-nprogress';\nimport { CSSTransition } from 'react-transition-group';\nimport { connect } from 'react-redux';\nimport { SignoutCallbackComponent } from 'redux-oidc';\nimport { ViewerbaseDragDropContext } from 'react-viewerbase';\n// import asyncComponent from './components/AsyncComponent.js'\nimport IHEInvokeImageDisplay from './routes/IHEInvokeImageDisplay.js';\nimport ViewerRouting from './routes/ViewerRouting.js';\nimport ViewerLocalFileData from './connectedComponents/ViewerLocalFileData.js';\nimport StudyListRouting from './studylist/StudyListRouting.js';\nimport StandaloneRouting from './routes/StandaloneRouting.js';\nimport CallbackPage from './routes/CallbackPage.js';\nimport NotFound from './routes/NotFound.js';\nimport { Bar, Container } from './components/LoadingBar/';\nimport './OHIFStandaloneViewer.css';\nimport './variables.css';\nimport './theme-tide.css';\n\n// Dynamic Import Routes (CodeSplitting)\n// const IHEInvokeImageDisplay = asyncComponent(() =>\n//   import('./routes/IHEInvokeImageDisplay.js')\n// )\n// const ViewerRouting = asyncComponent(() => import('./routes/ViewerRouting.js'))\n// const StudyListRouting = asyncComponent(() =>\n//   import('./studylist/StudyListRouting.js')\n// )\n// const StandaloneRouting = asyncComponent(() =>\n//   import('./routes/StandaloneRouting.js')\n// )\n// const CallbackPage = asyncComponent(() => import('./CallbackPage.js'))\n//\n\nconst reload = () => window.location.reload();\n\nclass OHIFStandaloneViewer extends Component {\n  state = {\n    isLoading: false,\n  };\n\n  static propTypes = {\n    history: PropTypes.object.isRequired,\n    user: PropTypes.object,\n    setContext: PropTypes.func,\n    userManager: PropTypes.object,\n    location: PropTypes.object,\n  };\n\n  componentDidMount() {\n    this.unlisten = this.props.history.listen((location, action) => {\n      if (this.props.setContext) {\n        this.props.setContext(window.location.pathname);\n      }\n    });\n  }\n\n  componentWillUnmount() {\n    this.unlisten();\n  }\n\n  render() {\n    const { user, userManager } = this.props;\n\n    const userNotLoggedIn = userManager && (!user || user.expired);\n    if (userNotLoggedIn) {\n      const pathname = this.props.location.pathname;\n\n      if (pathname !== '/callback') {\n        sessionStorage.setItem('ohif-redirect-to', pathname);\n      }\n\n      return (\n        <Switch>\n          <Route exact path=\"/silent-refresh.html\" onEnter={reload} />\n          <Route exact path=\"/logout-redirect\" render={() =>\n            <SignoutCallbackComponent\n              userManager={userManager}\n              successCallback={() => console.log('Signout successful')}\n              errorCallback={(error) => {\n                console.warn(error);\n                console.warn('Signout failed');\n              }}\n            />\n          }/>\n          <Route\n            path=\"/callback\"\n            render={() => <CallbackPage userManager={userManager} />}\n          />\n          <Route\n            component={() => {\n              userManager.getUser().then(user => {\n                if (user) {\n                  userManager.signinSilent();\n                } else {\n                  userManager.signinRedirect();\n                }\n              });\n\n              return null;\n            }}\n          />\n        </Switch>\n      );\n    }\n\n    /**\n     * Note: this approach for routing is caused by the conflict between\n     * react-transition-group and react-router's <Switch> component.\n     *\n     * See http://reactcommunity.org/react-transition-group/with-react-router/\n     */\n    const routes = [\n      {\n        path: '/local',\n        Component: ViewerLocalFileData,\n      },\n      {\n        path: '/viewer',\n        Component: StandaloneRouting,\n      },\n      {\n        path: '/viewer/:studyInstanceUids',\n        Component: ViewerRouting,\n      },\n      {\n        path: '/study/:studyInstanceUids/series/:seriesInstanceUids',\n        Component: ViewerRouting,\n      },\n      {\n        path: '/IHEInvokeImageDisplay',\n        Component: IHEInvokeImageDisplay,\n      },\n    ];\n\n    const showStudyList =\n      window.config && window.config.showStudyList !== undefined\n        ? window.config.showStudyList\n        : true;\n    if (showStudyList) {\n      routes.push({\n        path: '/studylist',\n        Component: StudyListRouting,\n      });\n      routes.push({\n        path: '/',\n        Component: StudyListRouting,\n      });\n    }\n\n    const currentPath = this.props.location.pathname;\n    const noMatchingRoutes = !routes.find(r =>\n      matchPath(currentPath, {\n        path: r.path,\n        exact: true,\n      })\n    );\n\n    return (\n      <>\n        <NProgress isAnimating={this.state.isLoading}>\n          {({ isFinished, progress, animationDuration }) => (\n            <Container\n              isFinished={isFinished}\n              animationDuration={animationDuration}\n            >\n              <Bar progress={progress} animationDuration={animationDuration} />\n            </Container>\n          )}\n        </NProgress>\n        <Route exact path=\"/silent-refresh.html\" onEnter={reload} />\n        <Route exact path=\"/logout-redirect.html\" onEnter={reload} />\n        {!noMatchingRoutes &&\n          routes.map(({ path, Component }) => (\n            <Route key={path} exact path={path}>\n              {({ match }) => (\n                <CSSTransition\n                  in={match !== null}\n                  timeout={300}\n                  classNames=\"fade\"\n                  unmountOnExit\n                  onEnter={() => {\n                    this.setState({ isLoading: true });\n                  }}\n                  onEntered={() => {\n                    this.setState({ isLoading: false });\n                  }}\n                >\n                  {match === null ? <></> : <Component match={match} location={this.props.location}/>}\n                </CSSTransition>\n              )}\n            </Route>\n          ))}\n        {noMatchingRoutes && <NotFound />}\n      </>\n    );\n  }\n}\n\nconst mapStateToProps = state => {\n  return {\n    user: state.oidc.user,\n  };\n};\n\nconst ConnectedOHIFStandaloneViewer = connect(\n  mapStateToProps,\n  null\n)(OHIFStandaloneViewer);\n\nexport default ViewerbaseDragDropContext(\n  withRouter(ConnectedOHIFStandaloneViewer)\n);\n","import OHIF from 'ohif-core';\nimport updateTableWithNewMeasurementData from './lib/updateTableWithNewMeasurementData';\n\nfunction getToolLabellingFlowCallback(store) {\n  const setLabellingFlowDataAction = labellingFlowData => ({\n    type: 'SET_LABELLING_FLOW_DATA',\n    labellingFlowData,\n  });\n\n  const setLabellingFlowData = labellingFlowData => {\n    store.dispatch(setLabellingFlowDataAction(labellingFlowData));\n  };\n\n  return function toolLabellingFlowCallback(\n    measurementData,\n    eventData,\n    doneCallback,\n    options = {}\n  ) {\n    const updateLabelling = ({ location, response, description }) => {\n      // Update the measurement data with the labelling parameters\n\n      if (location) {\n        measurementData.location = location;\n      }\n      if (description) {\n        measurementData.description = description;\n      }\n      if (response) {\n        measurementData.response = response;\n      }\n\n      updateTableWithNewMeasurementData(measurementData);\n    };\n\n    const labellingDoneCallback = () => {\n      setLabellingFlowData({ visible: false });\n    };\n\n    const labellingFlowData = {\n      visible: true,\n      eventData,\n      measurementData,\n      skipAddLabelButton: options.skipAddLabelButton,\n      editLocation: options.editLocation,\n      editDescription: options.editDescription,\n      editResponse: options.editResponse,\n      editDescriptionOnDialog: options.editDescriptionOnDialog,\n      labellingDoneCallback,\n      updateLabelling,\n    };\n\n    setLabellingFlowData(labellingFlowData);\n  };\n}\n\nconst resetLabellingAndContextMenuAction = state => ({\n  type: 'RESET_LABELLING_AND_CONTEXT_MENU',\n  state,\n});\n\nconst setToolContextMenuDataAction = (viewportIndex, toolContextMenuData) => ({\n  type: 'SET_TOOL_CONTEXT_MENU_DATA',\n  viewportIndex,\n  toolContextMenuData,\n});\n\nfunction getOnRightClickCallback(store) {\n  const setToolContextMenuData = (viewportIndex, toolContextMenuData) => {\n    store.dispatch(resetLabellingAndContextMenuAction());\n    store.dispatch(\n      setToolContextMenuDataAction(viewportIndex, toolContextMenuData)\n    );\n  };\n\n  const getOnCloseCallback = viewportIndex => {\n    return function onClose() {\n      const toolContextMenuData = {\n        visible: false,\n      };\n\n      store.dispatch(\n        setToolContextMenuDataAction(viewportIndex, toolContextMenuData)\n      );\n    };\n  };\n\n  return function onRightClick(event) {\n    const eventData = event.detail;\n    const viewportIndex = parseInt(eventData.element.dataset.viewportIndex, 10);\n\n    const toolContextMenuData = {\n      eventData,\n      isTouchEvent: false,\n      onClose: getOnCloseCallback(viewportIndex),\n    };\n\n    setToolContextMenuData(viewportIndex, toolContextMenuData);\n  };\n}\n\nfunction getOnTouchPressCallback(store) {\n  const setToolContextMenuData = (viewportIndex, toolContextMenuData) => {\n    store.dispatch(resetLabellingAndContextMenuAction());\n    store.dispatch(\n      setToolContextMenuDataAction(viewportIndex, toolContextMenuData)\n    );\n  };\n\n  const getOnCloseCallback = viewportIndex => {\n    return function onClose() {\n      const toolContextMenuData = {\n        visible: false,\n      };\n\n      store.dispatch(\n        setToolContextMenuDataAction(viewportIndex, toolContextMenuData)\n      );\n    };\n  };\n\n  return function onTouchPress(event) {\n    const eventData = event.detail;\n    const viewportIndex = parseInt(eventData.element.dataset.viewportIndex, 10);\n\n    const toolContextMenuData = {\n      eventData,\n      isTouchEvent: true,\n      onClose: getOnCloseCallback(viewportIndex),\n    };\n\n    setToolContextMenuData(viewportIndex, toolContextMenuData);\n  };\n}\n\nfunction getResetLabellingAndContextMenu(store) {\n  return function resetLabellingAndContextMenu() {\n    store.dispatch(resetLabellingAndContextMenuAction());\n  };\n}\n\nexport default function setupTools(store) {\n  const toolLabellingFlowCallback = getToolLabellingFlowCallback(store);\n  const availableTools = [\n    { name: 'Pan', mouseButtonMasks: [1, 4] },\n    { name: 'Zoom', mouseButtonMasks: [1, 2] },\n    { name: 'Wwwc', mouseButtonMasks: [1] },\n    { name: 'Magnify', mouseButtonMasks: [1] },\n    { name: 'WwwcRegion', mouseButtonMasks: [1] },\n    {\n      name: 'Bidirectional',\n      props: {\n        configuration: {\n          getMeasurementLocationCallback: toolLabellingFlowCallback,\n        },\n      },\n      mouseButtonMasks: [1],\n    },\n    {\n      name: 'Length',\n      props: {\n        configuration: {\n          getMeasurementLocationCallback: toolLabellingFlowCallback,\n        },\n      },\n      mouseButtonMasks: [1],\n    },\n    {\n      name: 'Angle',\n      props: {\n        configuration: {\n          getMeasurementLocationCallback: toolLabellingFlowCallback,\n        },\n      },\n      mouseButtonMasks: [1],\n    },\n    { name: 'StackScroll', mouseButtonMasks: [1] },\n    { name: 'Brush', mouseButtonMasks: [1] },\n    {\n      name: 'FreehandMouse',\n      props: {\n        configuration: {\n          getMeasurementLocationCallback: toolLabellingFlowCallback,\n        },\n      },\n      mouseButtonMasks: [1],\n    },\n    {\n      name: 'EllipticalRoi',\n      props: {\n        configuration: {\n          getMeasurementLocationCallback: toolLabellingFlowCallback,\n        },\n      },\n      mouseButtonMasks: [1],\n    },\n    {\n      name: 'CircleRoi',\n      props: {\n        configuration: {\n          getMeasurementLocationCallback: toolLabellingFlowCallback,\n        },\n      },\n      mouseButtonMasks: [1],\n    },\n    {\n      name: 'RectangleRoi',\n      props: {\n        configuration: {\n          getMeasurementLocationCallback: toolLabellingFlowCallback,\n        },\n      },\n      mouseButtonMasks: [1],\n    },\n    { name: 'DragProbe', mouseButtonMasks: [1] },\n    { name: 'PanMultiTouch' },\n    { name: 'ZoomTouchPinch' },\n    { name: 'StackScrollMouseWheel' },\n    { name: 'StackScrollMultiTouch' },\n    { name: 'Eraser' },\n    {\n      name: 'ArrowAnnotate',\n      props: {\n        configuration: {\n          getMeasurementLocationCallback: toolLabellingFlowCallback,\n        },\n      },\n    },\n  ];\n\n  const onRightClick = getOnRightClickCallback(store);\n  const onTouchPress = getOnTouchPressCallback(store);\n  const onNewImage = getResetLabellingAndContextMenu(store);\n  const onMouseClick = getResetLabellingAndContextMenu(store);\n  const onTouchStart = getResetLabellingAndContextMenu(store);\n  const toolAction = OHIF.redux.actions.setExtensionData('cornerstone', {\n    availableTools,\n    onNewImage,\n    onRightClick,\n    onTouchPress,\n    onTouchStart,\n    onMouseClick,\n  });\n\n  store.dispatch(toolAction);\n}\n","import Hammer from 'hammerjs';\nimport cornerstone from 'cornerstone-core';\nimport cornerstoneMath from 'cornerstone-math';\nimport cornerstoneTools from 'cornerstone-tools';\n\nexport default function(configuration = {}) {\n  // For debugging\n  window.cornerstoneTools = cornerstoneTools;\n\n  cornerstoneTools.external.cornerstone = cornerstone;\n  cornerstoneTools.external.Hammer = Hammer;\n  cornerstoneTools.external.cornerstoneMath = cornerstoneMath;\n  cornerstoneTools.init(configuration);\n\n  // Set the tool font and font size\n  // context.font = \"[style] [variant] [weight] [size]/[line height] [font family]\";\n  const fontFamily =\n    'Roboto, OpenSans, HelveticaNeue-Light, Helvetica Neue Light, Helvetica Neue, Helvetica, Arial, Lucida Grande, sans-serif';\n  cornerstoneTools.textStyle.setFont(`16px ${fontFamily}`);\n\n  // Tool styles/colors\n  cornerstoneTools.toolStyle.setToolWidth(2);\n  cornerstoneTools.toolColors.setToolColor('rgb(255, 255, 0)');\n  cornerstoneTools.toolColors.setActiveColor('rgb(0, 255, 0)');\n\n  cornerstoneTools.store.state.touchProximity = 40;\n}\n","import './config';\n// Imported flat feature since is not transpiled for old browser versions\nimport 'core-js/features/array/flat';\nimport 'core-js/stable';\nimport 'regenerator-runtime/runtime';\n\nimport {\n  CommandsManager,\n  ExtensionManager,\n  HotkeysManager,\n  utils,\n} from 'ohif-core';\nimport React, { Component } from 'react';\nimport {\n  getUserManagerForOpenIdConnectClient,\n  initWebWorkers,\n} from './utils/index.js';\n\nimport { I18nextProvider } from 'react-i18next';\nimport initCornerstoneTools from './initCornerstoneTools.js';\n\n// ~~ EXTENSIONS\nimport { GenericViewerCommands, MeasurementsPanel } from './appExtensions';\nimport OHIFCornerstoneExtension from '@ohif/extension-cornerstone';\nimport OHIFDicomHtmlExtension from '@ohif/extension-dicom-html';\nimport OHIFDicomMicroscopyExtension from '@ohif/extension-dicom-microscopy';\nimport OHIFDicomPDFExtension from '@ohif/extension-dicom-pdf';\nimport OHIFStandaloneViewer from './OHIFStandaloneViewer';\nimport OHIFVTKExtension from '@ohif/extension-vtk';\n// ~~ EXTENSIONS\nimport { OidcProvider } from 'redux-oidc';\nimport PropTypes from 'prop-types';\nimport { Provider } from 'react-redux';\nimport { BrowserRouter as Router } from 'react-router-dom';\nimport WhiteLabellingContext from './WhiteLabellingContext';\nimport { getActiveContexts } from './store/layout/selectors.js';\nimport i18n from '@ohif/i18n';\nimport setupTools from './setupTools.js';\nimport store from './store';\nimport UserManagerContext from './UserManagerContext';\n\n// ~~~~ APP SETUP\ninitCornerstoneTools({\n  globalToolSyncEnabled: true,\n  showSVGCursors: true,\n});\n\nconst commandsManagerConfig = {\n  getAppState: () => store.getState(),\n  getActiveContexts: () => getActiveContexts(store.getState()),\n};\n\nconst commandsManager = new CommandsManager(commandsManagerConfig);\nconst hotkeysManager = new HotkeysManager(commandsManager);\nconst extensionManager = new ExtensionManager({ commandsManager });\n\n// CornerstoneTools and labeling/measurements?\nsetupTools(store);\n// ~~~~ END APP SETUP\n\n/** TODO: extensions should be passed in as prop as soon as we have the extensions as separate packages and then registered by ExtensionsManager */\nextensionManager.registerExtensions([\n  // Core\n  GenericViewerCommands,\n  MeasurementsPanel,\n  //\n  OHIFCornerstoneExtension,\n  OHIFVTKExtension,\n  OHIFDicomPDFExtension,\n  OHIFDicomHtmlExtension,\n  OHIFDicomMicroscopyExtension,\n]);\n\n// Must run after extension commands are registered\nif (window.config && window.config.hotkeys) {\n  hotkeysManager.setHotkeys(window.config.hotkeys, true);\n}\n\n// TODO[react] Use a provider when the whole tree is React\nwindow.store = store;\n\nfunction handleServers(servers) {\n  if (servers) {\n    utils.addServers(servers, store);\n  }\n}\n\nfunction isAbsoluteUrl(url) {\n  return url.includes('http://') || url.includes('https://');\n}\n\nfunction makeAbsoluteIfNecessary(url, base_url) {\n  if (isAbsoluteUrl(url)) {\n    return url;\n  }\n\n  // Make sure base_url and url are not duplicating slashes\n  if (base_url[base_url.length - 1] === \"/\") {\n    base_url = base_url.slice(0, base_url.length - 1);\n  }\n\n  return base_url + url;\n}\n\nclass App extends Component {\n  static propTypes = {\n    routerBasename: PropTypes.string.isRequired,\n    servers: PropTypes.object.isRequired,\n    oidc: PropTypes.array,\n    whiteLabelling: PropTypes.object,\n  };\n\n  static defaultProps = {\n    whiteLabelling: {},\n    oidc: [],\n  };\n\n  constructor(props) {\n    super(props);\n\n    if (this.props.oidc.length) {\n      const firstOpenIdClient = this.props.oidc[0];\n\n      const { protocol, host } = window.location;\n      const { routerBasename } = this.props;\n      const baseUri = `${protocol}//${host}${routerBasename}`;\n\n      const redirect_uri = firstOpenIdClient.redirect_uri || '/callback';\n      const silent_redirect_uri = firstOpenIdClient.silent_redirect_uri || '/silent-refresh.html';\n      const post_logout_redirect_uri = firstOpenIdClient.post_logout_redirect_uri || '/';\n\n      const openIdConnectConfiguration = Object.assign({}, firstOpenIdClient, {\n        redirect_uri: makeAbsoluteIfNecessary(redirect_uri, baseUri),\n        silent_redirect_uri: makeAbsoluteIfNecessary(silent_redirect_uri, baseUri),\n        post_logout_redirect_uri: makeAbsoluteIfNecessary(post_logout_redirect_uri, baseUri),\n      });\n\n      this.userManager = getUserManagerForOpenIdConnectClient(\n        store,\n        openIdConnectConfiguration,\n      );\n    }\n    handleServers(this.props.servers);\n    initWebWorkers();\n  }\n\n  render() {\n    const userManager = this.userManager;\n\n    if (userManager) {\n      return (\n        <Provider store={store}>\n          <I18nextProvider i18n={i18n}>\n            <OidcProvider store={store} userManager={userManager}>\n              <UserManagerContext.Provider value={userManager}>\n                <Router basename={this.props.routerBasename}>\n                  <WhiteLabellingContext.Provider\n                    value={this.props.whiteLabelling}\n                  >\n                    <OHIFStandaloneViewer userManager={userManager} />\n                  </WhiteLabellingContext.Provider>\n                </Router>\n              </UserManagerContext.Provider>\n            </OidcProvider>\n          </I18nextProvider>\n        </Provider>\n      );\n    }\n\n    return (\n      <Provider store={store}>\n        <I18nextProvider i18n={i18n}>\n          <Router basename={this.props.routerBasename}>\n            <WhiteLabellingContext.Provider value={this.props.whiteLabelling}>\n              <OHIFStandaloneViewer />\n            </WhiteLabellingContext.Provider>\n          </Router>\n        </I18nextProvider>\n      </Provider>\n    );\n  }\n}\n\nexport default App;\n\n// Make our managers accessible\nexport { commandsManager, extensionManager, hotkeysManager };\n","import cornerstoneWADOImageLoader from 'cornerstone-wado-image-loader';\n\nexport default function initWebWorkers() {  \n  const config = {\n    maxWebWorkers: Math.max(navigator.hardwareConcurrency - 1, 1),\n    startWebWorkersOnDemand: true,\n    taskConfiguration: {\n      decodeTask: {\n        initializeCodecsOnStartup: false,\n        usePDFJS: false,\n        strict: false,\n      },\n    },\n  };\n\n  cornerstoneWADOImageLoader.webWorkerManager.initialize(config);\n}\n","/**\n * Entry point for development and production PWA builds.\n * Packaged (NPM) builds go through `index_publish.js`\n */\nimport App from './App.js';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\n\nexport { App };\n\nwindow.config = window.config || {};\nconst applicationDefaults = {\n  routerBasename: '/',\n};\nconst applicationProps = Object.assign({}, applicationDefaults, window.config);\nconst app = React.createElement(App, applicationProps, null);\n\nReactDOM.render(app, document.getElementById('root'));\n\n/*\nExample config with OIDC\n*/\n// Uncomment the next two blocks, comment out the config without OIDC\n// Try going to:\n// http://localhost:5000/viewer/1.2.276.0.7230010.3.1.2.0.94237.1537373823.634387 //PDF\n// http://localhost:5000/viewer/1.3.6.1.4.1.25403.345050719074.3824.20170126082328.1\n// http://ohif-viewer-react.s3-website-us-east-1.amazonaws.com/viewer/1.3.6.1.4.1.25403.345050719074.3824.20170126082328.1\n/*props.servers = {\n  dicomWeb: [\n    {\n      name: 'DCM4CHEE',\n      wadoUriRoot:\n        'https://cancer.crowds-cure.org/dcm4chee-arc/aets/DCM4CHEE/wado',\n      qidoRoot: 'https://cancer.crowds-cure.org/dcm4chee-arc/aets/DCM4CHEE/rs',\n      wadoRoot: 'https://cancer.crowds-cure.org/dcm4chee-arc/aets/DCM4CHEE/rs',\n      qidoSupportsIncludeField: true,\n      imageRendering: 'wadors',\n      thumbnailRendering: 'wadors',\n      requestOptions: {\n        requestFromBrowser: true\n      }\n    }\n  ]\n};\n\nprops.oidc = [\n  {\n    authServerUrl: 'https://cancer.crowds-cure.org/auth/realms/dcm4che',\n    authRedirectUri: rootUrl + '/callback',\n    postLogoutRedirectUri: rootUrl + '/logout-redirect.html',\n    clientId: 'crowds-cure-cancer',\n    responseType: 'id_token token',\n    scope: 'email profile openid',\n    revokeAccessTokenOnSignout: true,\n    extraQueryParams: {\n      kc_idp_hint: 'crowds-cure-cancer-auth0-oidc',\n      client_id: 'crowds-cure-cancer'\n    }\n  }\n];*/\n\n/* props.servers = {\n  dicomWeb: [\n    {\n      name: 'DCM4CHEE',\n      wadoUriRoot:\n        'https://k8s-testing.ohif.org/dcm4chee-arc/aets/DCM4CHEE/wado',\n      qidoRoot: 'https://k8s-testing.ohif.org/dcm4chee-arc/aets/DCM4CHEE/rs',\n      wadoRoot: 'https://k8s-testing.ohif.org/dcm4chee-arc/aets/DCM4CHEE/rs',\n      qidoSupportsIncludeField: true,\n      imageRendering: 'wadors',\n      thumbnailRendering: 'wadors',\n      requestOptions: {\n        requestFromBrowser: true\n      }\n    }\n  ]\n};\n\nprops.oidc = [\n  {\n    authServerUrl: 'https://k8s-testing.ohif.org/auth/realms/dcm4che',\n    authRedirectUri: rootUrl + '/callback',\n    postLogoutRedirectUri: rootUrl + '/logout-redirect.html',\n    clientId: 'ohif-viewer',\n    responseType: 'id_token token',\n    scope: 'email profile openid',\n    revokeAccessTokenOnSignout: true\n  }\n]; */\n\n/*props.servers = {\n  \"dicomWeb\": [\n    {\n      \"name\": \"DCM4CHEE\",\n      \"wadoUriRoot\": \"http://localhost:8080/dcm4chee-arc/aets/DCM4CHEE/wado\",\n      \"qidoRoot\": \"http://localhost:8080/dcm4chee-arc/aets/DCM4CHEE/rs\",\n      \"wadoRoot\": \"http://localhost:8080/dcm4chee-arc/aets/DCM4CHEE/rs\",\n      \"qidoSupportsIncludeField\": true,\n      \"imageRendering\": \"wadors\",\n      \"thumbnailRendering\": \"wadors\",\n      \"requestOptions\": {\n        \"requestFromBrowser\": true,\n        \"auth\": \"admin:admin\"\n      }\n    }\n  ]\n};*/\n\n/*\n/*\"PUBLIC_SETTINGS\": {\n    \"ui\": {\n      \"studyListFunctionsEnabled\": true,\n      \"displaySetNavigationLoopOverSeries\": false,\n      \"displaySetNavigationMultipleViewports\": true,\n      \"autoPositionMeasurementsTextCallOuts\": \"TRLB\"\n    },\n    \"prefetch\": {\n      \"order\": \"topdown\",\n      \"displaySetCount\": 1\n    }\n */\n"],"sourceRoot":""}