(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{114:function(e,t,n){e.exports=n(203)},180:function(e,t,n){},182:function(e,t,n){},183:function(e,t,n){},184:function(e,t,n){},185:function(e,t,n){},186:function(e,t,n){},187:function(e,t,n){},188:function(e,t,n){},189:function(e,t,n){},192:function(e,t,n){},193:function(e,t,n){},196:function(e,t,n){},197:function(e,t,n){},198:function(e,t,n){},199:function(e,t,n){},203:function(e,t,n){"use strict";n.r(t);n(115),n(137);var a=n(5),i=n(6),o=n(10),r=n(7),s=n(9),c=n(4),u=n(2),l=n.n(u),p=n(19),d=n.n(p),m=n(30),f=n.n(m);window.info={version:"0.0.21",homepage:"".concat("/demo")},window.cornerstone=l.a,window.cornerstoneWADOImageLoader=d.a,d.a.external.cornerstone=l.a,d.a.external.dicomParser=f.a,c.default.user.getAccessToken=function(){var e=window.store.getState();if(e.oidc&&e.oidc.user)return e.oidc.user.access_token},d.a.configure({beforeSend:function(e){var t=c.default.DICOMWeb.getAuthorizationHeader();t.Authorization&&e.setRequestHeader("Authorization",t.Authorization)}});var h=n(1),v=n.n(h),b=n(33),g=n(31),y=function(e,t){if(e&&t){var n=Object(b.a)({},t,{silent_redirect_uri:"/silent-refresh.html",automaticSilentRenew:!0,revokeAccessTokenOnSignout:!0,filterProtocolClaims:!0,loadUserInfo:!0}),a=Object(g.createUserManager)(n);return Object(g.loadUser)(e,a),a}};var E=n(28),S=n(91),O=n(96),D=n(97),w=n(98),I=n(24),T=n(99),C=n(204),k=n(11),j=n(12),x=n(101),M=n.n(x),L=n(40),N=n.n(L),A=n(51),U=n(29),P=n.n(U);n(180);var B=function(){return v.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",className:"header-brand",href:"http://ohif.org"},v.a.createElement(j.e,{name:"ohif-logo",className:"header-logo-image"}),v.a.createElement("div",{className:"header-logo-text"},"Open Health Imaging Foundation"))},F={logoComponent:B()},R=v.a.createContext(F),V=(n(87),n(22)),_=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(o.a)(this,Object(r.a)(t).call(this,e))).state={isUserPreferencesOpen:!1,isOpen:!1},n.loadOptions(),n}return Object(s.a)(t,e),Object(i.a)(t,[{key:"loadOptions",value:function(){var e=this,t=this.props.t;this.options=[{title:t("About"),icon:{name:"info"},onClick:function(){e.setState({isOpen:!0})}}],this.hotKeysData=nn.hotkeyDefinitions}},{key:"onUserPreferencesSave",value:function(e){e.windowLevelData,e.hotKeysData}},{key:"render",value:function(){var e=this,t=this.props.t;return v.a.createElement("div",{className:"entry-header ".concat(this.props.home?"header-big":"")},v.a.createElement("div",{className:"header-left-box"},this.props.location&&this.props.location.studyLink&&v.a.createElement(V.b,{to:this.props.location.studyLink,className:"header-btn header-viewerLink"},t("Back to Viewer")),this.props.children,!this.props.home&&v.a.createElement(V.b,{className:"header-btn header-studyListLinkSection",to:{pathname:"/",state:{studyLink:this.props.location.pathname}}},t("Study list"))),v.a.createElement("div",{className:"header-menu"},v.a.createElement("span",{className:"research-use"},t("INVESTIGATIONAL USE ONLY")),v.a.createElement(j.c,{title:t("Options"),list:this.options,align:"right"}),v.a.createElement(j.a,Object.assign({},this.state,{onCancel:function(){return e.setState({isOpen:!1})}}))))}}]),t}(h.Component);_.defaultProps={home:!0,children:B()};var W=Object(E.c)("Header")(Object(I.f)(_)),Y=Object(k.connect)(function(e){return{isOpen:e.ui.userPreferencesModalOpen}})(W),H=(n(182),c.measurements.MeasurementApi),G=c.utils.studyMetadataManager;var J=n(3),X=n.n(J);function z(e){var t=e.toolType,n=e.measurementNumber,a=e.location,i=e.description,o=c.default.measurements.MeasurementApi.Instance;o.tools[t].filter(function(e){return e.measurementNumber===n}).forEach(function(e){e.location=a,e.description=i,o.updateMeasurement(e.toolType,e)}),o.syncMeasurementsAndToolData(),l.a.getEnabledElements().forEach(function(e){l.a.updateImage(e.element)})}function K(e,t,n){var a=t.toolType,i=e.element,o=z;X.a.getToolForElement(i,a).configuration.getMeasurementLocationCallback(t,e,o,n)}var q=c.default.redux.actions.setViewportSpecificData,Q=c.default.measurements.MeasurementApi;function Z(e){var t=e.location,n=e.description,a="...";return t&&(a=t,n&&(a+="(".concat(n,")"))),a}function $(e,t,n){var a=[];return e.forEach(function(e){t.forEach(function(t){var i={displayText:"..."};e.timepointId===t.timepointId&&(i.displayText=n(e)),a.push(i)})}),a}function ee(e,t){var n=c.default.measurements.MeasurementApi.getConfiguration().measurementTools,a=function(){var e=c.default.measurements.MeasurementApi.getConfiguration(),t=[];return e.measurementTools.forEach(function(e){return t=t.concat(e.childTools)}),t}(),i=n.map(function(e){return{groupName:e.name,groupId:e.id,measurements:[]}});return Object.keys(e).forEach(function(n){var o,r=e[n],s=a.find(function(e){return e.id===n}),c=s.options.measurementTable.displayFunction,u=(o="measurementNumber",r.reduce(function(e,t){return(e[t[o]]=e[t[o]]||[]).push(t),e},{}));Object.keys(u).forEach(function(e){var n=u[e],a=n[0],o=a.measurementNumber,r=a.lesionNamingNumber,l=a.toolType,p=a._id,d={itemNumber:r,label:Z(a),measurementId:p,measurementNumber:o,lesionNamingNumber:r,toolType:l,hasWarnings:!1,warningTitle:"",isSplitLesion:!1,warningList:[],data:$(n,t,c)};i.find(function(e){return e.groupId===s.toolGroup}).measurements.push(d)})}),i.forEach(function(e){e.measurements.sort(function(e,t){return e.lesionNamingNumber>t.lesionNamingNumber?1:-1})}),i}function te(e){return e&&e.length?[{label:"Study date:",date:P()(e[0].latestDate).format("DD-MMM-YY")}]:[]}var ne=Object(k.connect)(function(e){var t=e.timepointManager,n=t.timepoints,a=t.measurements;return{timepoints:te(n),measurementCollection:ee(a,n),timepointManager:e.timepointManager,viewports:e.viewports}},function(e){return{dispatchRelabel:function(e,t,n){var a=n&&n.activeViewportIndex||0,i=l.a.getEnabledElements();if(!i||i.length<=a)c.default.log.error("Failed to find the enabled element");else{var o=i[a].element,r={event:{clientX:e.clientX,clientY:e.clientY},element:o},s=t.toolType,u=t.measurementId,p=Q.Instance.tools[s].find(function(e){return e._id===u});K(r,Object.assign({},p,{location:null}),{skipAddLabelButton:!0,editLocation:!0})}},dispatchEditDescription:function(e,t,n){var a=n&&n.activeViewportIndex||0,i=l.a.getEnabledElements();if(!i||i.length<=a)c.default.log.error("Failed to find the enabled element");else{var o=i[a].element,r={event:{clientX:e.clientX,clientY:e.clientY},element:o},s=t.toolType,u=t.measurementId;K(r,Q.Instance.tools[s].find(function(e){return e._id===u}),{editDescriptionOnDialog:!0})}},dispatchJumpToRowItem:function(t,n,a,i){(function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{invertViewportTimepointsOrder:!1,childToolKey:null},i=t.layout.viewports.length,o=n.timepoints.length,r=n.measurements,s=n.timepoints,c=Math.min(o,i),u=e.toolType,l=e.measurementNumber;a.invertViewportTimepointsOrder&&s.reverse();for(var p=r[u],d=[],m=function(e){var t=s[e].timepointId,n=p.find(function(e){return e.timepointId===t&&e.measurementNumber===l});if(!n)return d.push(null),"continue";var i=n,o=H.getToolConfiguration(u).tool;if(a.childToolKey)i=n[a.childToolKey];else if(Array.isArray(o.childTools)){var r=o.childTools.find(function(e){return!!n[e]});i=n[r]}d.push(i)},f=0;f<c;f++)m(f);var h=[];return d.forEach(function(e,t){if(e){var n=G.get(e.studyInstanceUid);if(!n)throw new Error("Study not found.");var a=n.findDisplaySet(function(t){return function(e,t){return e.images.find(function(e){return e.getSOPInstanceUID()===t})}(t,e.sopInstanceUid)});if(!a)throw new Error("Display set not found.");a.sopInstanceUid=e.sopInstanceUid,e.frameIndex&&(a.frameIndex=e.frameIndex),h.push({viewportIndex:t,displaySet:a})}}),{viewportSpecificData:h,layout:[]}})(t,n,a,e,i).viewportSpecificData.forEach(function(t){var n=t.viewportIndex,a=t.displaySet;e(q(n,a))});var o=t.toolType,r=t.measurementNumber,s=Q.Instance;Object.keys(s.tools).forEach(function(e){s.tools[e].forEach(function(e){e.active=!1})}),s.tools[o].filter(function(e){return e.measurementNumber===r}).forEach(function(e){e.active=!0}),s.syncMeasurementsAndToolData(),l.a.getEnabledElements().forEach(function(e){l.a.updateImage(e.element)})}}},function(e,t,n){return Object(b.a)({timepoints:e.timepoints,measurementCollection:e.measurementCollection,selectedMeasurementNumber:n.selectedMeasurementNumber},t,{onItemClick:function(n,a){var i=e.viewports,o=e.timepointManager;t.dispatchJumpToRowItem(a,i,o,{invertViewportTimepointsOrder:!1,childToolKey:null})},onRelabelClick:function(n,a){var i=e.viewports;t.dispatchRelabel(n,a,i)},onEditDescriptionClick:function(n,a){var i=e.viewports;t.dispatchEditDescription(n,a,i)},onDeleteClick:function(e,t){c.default.measurements.MeasurementHandlers.onRemoved({detail:{toolType:t.toolType,measurementData:{_id:t.measurementId,lesionNamingNumber:t.lesionNamingNumber,measurementNumber:t.measurementNumber}}})}})})(j.h),ae=n(27),ie=n.n(ae),oe=Object(k.connect)(function(e,t){var n=e.loading.progress,a=ie()(t.studies);return a.forEach(function(e){e.thumbnails.forEach(function(e){var t=e.displaySetInstanceUid,a="StackProgress:".concat(t),i=n[a],o=0;i&&(o=i.percentComplete),e.stackPercentComplete=o})}),{studies:a}},null)(j.k),re=(n(183),Object(k.connect)(function(e){var t,n={},a=an.modules[c.MODULE_TYPES.VIEWPORT];return a.forEach(function(e){n[e.extensionId]=e.module}),a.length&&(t=a[0].extensionId),{layout:e.viewports.layout,activeViewportIndex:e.viewports.activeViewportIndex,availablePlugins:n,defaultPlugin:t}},null)(j.g)),se=(n(184),["Angle","Bidirectional","Length","FreehandMouse","EllipticalRoi","CircleRoi","RectangleRoi"]),ce=[{actionType:"Delete",action:function(e){var t=e.nearbyToolData,n=e.eventData.element;X.a.removeToolState(n,t.toolType,t.tool),l.a.updateImage(n)}},{actionType:"setLabel",action:function(e){var t=e.nearbyToolData;K(e.eventData,t.tool,{skipAddLabelButton:!0,editLocation:!0})}},{actionType:"setDescription",action:function(e){var t=e.nearbyToolData;K(e.eventData,t.tool,{editDescriptionOnDialog:!0})}}];function ue(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(arguments.length>2&&arguments[2],function(e,t,n){var a={},i=!1;return n.forEach(function(n){var o=X.a.getToolState(e,n);if(o)return o.data.forEach(function(o,r){var s=X.a.getToolForElement(e,n);if(s||(s=X.a.getToolForElement(e,"".concat(n,"Tool"))),!s)throw new Error("Tool not found.");s.pointNearTool(e,o,t)&&(i=!0,a.tool=o,a.index=r,a.toolType=n)}),!i&&void 0}),i?a:void 0}(e.element,e.currentPoints.canvas,se));if(!t||!n||"arrowAnnotate"!==n.toolType){var a=[];return n&&ce.forEach(function(t){t.params={eventData:e,nearbyToolData:n},"Delete"===t.actionType&&(t.text="Delete measurement"),"setLabel"===t.actionType&&(t.text="Relabel"),"setDescription"===t.actionType&&(t.text="".concat(n.tool.description?"Edit":"Add"," Description")),a.push(t)}),a}}var le=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(o.a)(this,Object(r.a)(t).call(this,e))).componentDidMount=function(){n.mainElement.current&&n.updateElementPosition()},n.componentDidUpdate=function(){n.mainElement.current&&n.updateElementPosition()},n.updateElementPosition=function(){var e=n.mainElement.current,t=e.offsetParent,a=e.offsetTop,i=e.offsetHeight,o=e.offsetWidth,r=e.offsetLeft,s=n.props.eventData;if(a+i>t.offsetHeight){var c=a+i-t.offsetHeight,u=s.currentPoints.canvas.y-c;n.mainElement.current.style.top="".concat(u>0?u:0,"px")}if(r+o>t.offsetWidth){var l=r+o-t.offsetWidth,p=s.currentPoints.canvas.x-l;n.mainElement.current.style.left="".concat(p>0?p:0,"px")}},n.mainElement=v.a.createRef(),n}return Object(s.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;if(!this.props.eventData)return null;var t=this.props,n=t.isTouchEvent,a=t.eventData,i=ue(a,n,t.availableTools);if(!i.length)return"";var o=i.map(function(t){return v.a.createElement("li",{key:t.actionType},v.a.createElement("button",{className:"form-action",onClick:function(n){t.action(t.params),e.props.onClose&&e.props.onClose()}},v.a.createElement("span",{key:t.actionType},t.text)))}),r={top:"".concat(a.currentPoints.canvas.y,"px"),left:"".concat(a.currentPoints.canvas.x,"px")};return v.a.createElement("div",{className:"ToolContextMenu",style:r,ref:this.mainElement},v.a.createElement("ul",{className:"bounded"},o))}}]),t}(h.Component);le.defaultProps={visible:!0,isTouchEvent:!1};var pe=le,de=Object(k.connect)(function(e,t){if(!e.ui||!e.ui.contextMenu)return{visible:!1};var n,a=t.viewportIndex,i=e.ui.contextMenu[a];return e.extensions&&e.extensions.cornerstone&&e.extensions.cornerstone.availableTools&&(n=e.extensions.cornerstone.availableTools),Object(b.a)({},i,{availableTools:n})},null)(pe),me=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(o.a)(this,Object(r.a)(t).call(this,e))).getViewportData=function(){for(var e=[],t=n.props,a=t.layout,i=t.viewportSpecificData,o=0;o<a.viewports.length;o++){var r=i[o];if(r&&!r.displaySetInstanceUid&&(r=n.cachedViewportData[o]),r&&r.studyInstanceUid&&r.displaySetInstanceUid){var s=n.findDisplaySet(n.props.studies,r.studyInstanceUid,r.displaySetInstanceUid);e.push(Object.assign({},s,r))}else{r=n.state.displaySets.find(function(t){return!e.some(function(e){return e.displaySetInstanceUid===t.displaySetInstanceUid})}),e.push(Object.assign({},r))}}return n.cachedViewportData=e,e},n.setViewportData=function(e){var t=e.viewportIndex,a=e.item,i=n.findDisplaySet(n.props.studies,a.studyInstanceUid,a.displaySetInstanceUid);n.props.setViewportSpecificData(t,i)},n.state={displaySets:[]},n.cachedViewportData={},n}return Object(s.a)(t,e),Object(i.a)(t,[{key:"getDisplaySets",value:function(e){var t=[];return e.forEach(function(e){e.displaySets.forEach(function(e){e.plugin||(e.plugin="cornerstone"),t.push(e)})}),t}},{key:"findDisplaySet",value:function(e,t,n){var a=e.find(function(e){return e.studyInstanceUid===t});if(a)return a.displaySets.find(function(e){return e.displaySetInstanceUid===n})}},{key:"componentDidMount",value:function(){if(this.props.studies){var e=this.getDisplaySets(this.props.studies);this.setState({displaySets:e})}}},{key:"componentDidUpdate",value:function(e){if(this.props.studies!==e.studies){var t=this.getDisplaySets(this.props.studies);this.setState({displaySets:t})}}},{key:"render",value:function(){return v.a.createElement("div",{className:"ViewerMain"},this.state.displaySets.length&&v.a.createElement(re,{studies:this.props.studies,viewportData:this.getViewportData(),setViewportData:this.setViewportData},v.a.createElement(de,null)))}},{key:"componentWillUnmount",value:function(){var e=this,t=this.props.viewportSpecificData;Object.keys(t).forEach(function(t){e.props.clearViewportSpecificData(t)})}}]),t}(h.Component),fe=c.default.redux.actions,he=fe.setViewportSpecificData,ve=fe.clearViewportSpecificData,be=Object(k.connect)(function(e){var t=e.viewports;return{activeViewportIndex:t.activeViewportIndex,layout:t.layout,viewportSpecificData:t.viewportSpecificData,viewports:e.viewports}},function(e){return{setViewportSpecificData:function(t,n){e(he(t,n))},clearViewportSpecificData:function(){e(ve())}}})(me),ge=function(e){function t(){var e,n;Object(a.a)(this,t);for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(r.a)(t)).call.apply(e,[this].concat(s)))).state={studiesForBrowser:[]},n.getStudiesForBrowser=function(){return n.props.studies.map(function(e){return{studyInstanceUid:e.studyInstanceUid,thumbnails:e.displaySets.map(function(e){var t,n=e.displaySetInstanceUid,a=e.seriesDescription,i=e.seriesNumber,o=e.instanceNumber,r=e.numImageFrames,s=" ";return e.images&&e.images.length?t=e.images[0].getImageId():s="SR",{imageId:t,altImageText:s,displaySetInstanceUid:n,seriesDescription:a,seriesNumber:i,instanceNumber:o,numImageFrames:r}})}})},n}return Object(s.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){if(this.props.studies){var e=this.getStudiesForBrowser();this.setState({studiesForBrowser:e})}}},{key:"componentDidUpdate",value:function(e){if(this.props.studies!==e.studies){var t=this.getStudiesForBrowser();this.setState({studiesForBrowser:t})}}},{key:"render",value:function(){var e="main-content";return this.props.leftSidebarOpen&&(e+=" sidebar-left-open"),this.props.rightSidebarOpen&&(e+=" sidebar-right-open"),v.a.createElement("div",{className:"FlexboxLayout"},v.a.createElement("div",{className:this.props.leftSidebarOpen?"sidebar-menu sidebar-left sidebar-open":"sidebar-menu sidebar-left"},v.a.createElement(oe,{studies:this.state.studiesForBrowser})),v.a.createElement("div",{className:e},v.a.createElement(be,{studies:this.props.studies})),v.a.createElement("div",{className:this.props.rightSidebarOpen?"sidebar-menu sidebar-right sidebar-open":"sidebar-menu sidebar-right"},v.a.createElement(ne,null)))}}]),t}(h.Component),ye=Object(k.connect)(function(e){return{leftSidebarOpen:e.ui.leftSidebarOpen,rightSidebarOpen:e.ui.rightSidebarOpen}},null)(ge),Ee=function(e){return{type:"SET_LEFT_SIDEBAR_OPEN",state:e}},Se=function(e){return{type:"SET_RIGHT_SIDEBAR_OPEN",state:e}},Oe=n(35),De=(n(185),(0,X.a.import)("util/scrollToIndex")),we=c.default.redux.actions.setViewportSpecificData,Ie=Object(k.connect)(function(e){var t=e.viewports,n=t.viewportSpecificData[t.activeViewportIndex]||{},a=n.cine;return{activeEnabledElement:n.dom,activeViewportCineData:a||{isPlaying:!1,cineFrameRate:24},activeViewportIndex:e.viewports.activeViewportIndex}},function(e){return{dispatchSetViewportSpecificData:function(t,n){e(we(t,n))}}},function(e,t,n){var a=e.activeEnabledElement,i=e.activeViewportCineData,o=e.activeViewportIndex;return{cineFrameRate:i.cineFrameRate,isPlaying:i.isPlaying,onPlayPauseChanged:function(e){var n=ie()(i);n.isPlaying=!n.isPlaying,t.dispatchSetViewportSpecificData(o,{cine:n})},onFrameRateChanged:function(e){var n=ie()(i);n.cineFrameRate=e,t.dispatchSetViewportSpecificData(o,{cine:n})},onClickNextButton:function(){var e=X.a.getToolState(a,"stack");if(e&&e.data&&e.data.length){var t=e.data[0],n=t.currentImageIdIndex;n>=t.imageIds.length-1||De(a,n+1)}},onClickBackButton:function(){var e=X.a.getToolState(a,"stack");if(e&&e.data&&e.data.length){var t=e.data[0].currentImageIdIndex;0!==t&&De(a,t-1)}},onClickSkipToStart:function(){var e=X.a.getToolState(a,"stack");e&&e.data&&e.data.length&&De(a,0)},onClickSkipToEnd:function(){var e=X.a.getToolState(a,"stack");if(e&&e.data&&e.data.length){var t=e.data[0].imageIds.length-1;De(a,t)}}}})(j.b),Te=c.default.redux.actions.setLayout,Ce=Object(k.connect)(function(e){return{currentLayout:e.viewports.layout}},function(e){return{onChange:function(t){for(var n=[],a=t.row+1,i=t.col+1,o=a*i,r=0;r<o;r++)n.push({height:"".concat(100/a,"%"),width:"".concat(100/i,"%")});e(Te({viewports:n}))}}})(j.f),ke=(n(186),function(e){function t(){return Object(a.a)(this,t),Object(o.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return v.a.createElement("div",{className:"PluginSwitch"},v.a.createElement(j.d,{buttons:this.props.buttons}))}}]),t}(h.Component));ke.defaultProps={};var je=ke,xe=c.default.redux.actions.setLayout,Me=Object(k.connect)(function(e){var t=e.viewports,n=t.activeViewportIndex,a=t.layout;return{activeViewportIndex:n,viewportSpecificData:t.viewportSpecificData,layout:a}},function(e){return{setLayout:function(t){e(xe(t))}}},function(e,t,n){return{buttons:[{label:"2D MPR",icon:"cube",onClick:function(){tn.runCommand("mpr2d")}}]}})(je),Le=function(e){function t(e){var n;Object(a.a)(this,t),(n=Object(o.a)(this,Object(r.a)(t).call(this,e))).onLeftSidebarValueChanged=function(e){n.props.setLeftSidebarOpen(!!e)},n.onRightSidebarValueChanged=function(e){n.props.setRightSidebarOpen(!!e)};var i=Ne.call(Object(Oe.a)(n));return n.state={toolbarButtons:i,activeButtons:[],isCineDialogOpen:!1},n._handleBuiltIn=function(){"CINE"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).behavior&&this.setState({isCineDialogOpen:!this.state.isCineDialogOpen})}.bind(Object(Oe.a)(n)),n}return Object(s.a)(t,e),Object(i.a)(t,[{key:"componentDidUpdate",value:function(e){e.activeContexts!==this.props.activeContexts&&this.setState({toolbarButtons:Ne.call(this)})}},{key:"render",value:function(){var e=[{value:"studies",icon:"th-large",bottomLabel:"Series"}],t=[{value:"measurements",icon:"list",bottomLabel:"Measurements"}],n=this.props.leftSidebarOpen?e[0].value:null,a=this.props.rightSidebarOpen?t[0].value:null,i=function(e,t){var n=this;return e.map(function(e,a){return v.a.createElement(j.m,{key:e.id,label:e.label,icon:e.icon,onClick:function(t,a){if(e.commandName){var i=Object.assign({evt:t},e.commandOptions);tn.runCommand(e.commandName,i)}"setToolActive"===e.type?n.setState({activeButtons:[e.id]}):"builtIn"===e.type&&n._handleBuiltIn(e.options)},isActive:t.includes(e.id)})})}.call(this,this.state.toolbarButtons,this.state.activeButtons),o={display:this.state.isCineDialogOpen?"block":"none",position:"absolute",top:"82px",zIndex:999};return v.a.createElement(v.a.Fragment,null,v.a.createElement("div",{className:"ToolbarRow"},v.a.createElement("div",{className:"pull-left m-t-1 p-y-1",style:{padding:"10px"}},v.a.createElement(j.i,{options:e,value:n,onValueChanged:this.onLeftSidebarValueChanged})),i,v.a.createElement(Ce,null),v.a.createElement(Me,null),v.a.createElement("div",{className:"pull-right m-t-1 rm-x-1",style:{marginLeft:"auto"}},v.a.createElement(j.i,{options:t,value:a,onValueChanged:this.onRightSidebarValueChanged}))),v.a.createElement("div",{className:"CineDialogContainer",style:o},v.a.createElement(Ie,null)))}}]),t}(h.Component);function Ne(){var e=this,t=an.modules[c.MODULE_TYPES.TOOLBAR],n=[];return t.forEach(function(t){var a=t.module,i=a.definitions,o=a.defaultContext;i.forEach(function(t){var a=t.context||o;e.props.activeContexts.includes(a)&&n.push(t)})}),n}Le.defaultProps={leftSidebarOpen:!1,rightSidebarOpen:!1};var Ae=Le,Ue=n(103),Pe=Object(Ue.a)([function(e){return e.viewports.activeViewportIndex},function(e){return e.viewports.layout.viewports},function(e){return e.viewports.viewportSpecificData}],function(e,t,n){var a=["VIEWER"],i=t[e]||{},o=n[e]||{},r=i.plugin||o.plugin;if(r){var s="ACTIVE_VIEWPORT::".concat(r.toUpperCase());a.push(s)}return a}),Be=Object(k.connect)(function(e){return{activeContexts:Pe(e),leftSidebarOpen:e.ui.leftSidebarOpen,rightSidebarOpen:e.ui.rightSidebarOpen}},function(e){return{setLeftSidebarOpen:function(t){e(Ee(t))},setRightSidebarOpen:function(t){e(Se(t))}}})(Ae),Fe=(n(187),function(e){function t(){return Object(a.a)(this,t),Object(o.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return v.a.createElement("div",{className:"simpleDialog ".concat(this.props.rootClass),ref:this.props.componentRef,style:this.props.componentStyle},v.a.createElement("form",null,v.a.createElement("div",{className:"header"},v.a.createElement("span",{className:"closeBtn",onClick:this.props.onClose},v.a.createElement("span",{className:"closeIcon"},"x")),v.a.createElement("h4",{className:"title"},this.props.headerTitle)),v.a.createElement("div",{className:"content"},this.props.children),v.a.createElement("div",{className:"footer"},v.a.createElement("button",{type:"button",className:"btn btn-cancel",onClick:this.props.onClose},"Cancel"),v.a.createElement("button",{type:"button",className:"btn btn-confirm",onClick:this.props.onConfirm},"Confirm"))))}}]),t}(h.Component));Fe.defaultProps={componentStyle:{},rootClass:""};var Re=Fe;function Ve(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.current){var n=e.current,a=n.offsetParent,i=n.offsetTop,o=n.offsetHeight,r=n.offsetLeft,s=n.offsetWidth,c=t.top||i,u=t.left||r;if(a){var l="".concat(a.offsetHeight,"px");o+c>a.offsetHeight&&(c-=o+c-a.offsetHeight)<0&&(c=0),u+s>a.offsetWidth&&(u=a.offsetWidth-s)<0&&(u=0),l&&n.style.maxHeight!==l&&(n.style.maxHeight=l),n.style.top!=="".concat(c,"px")&&(n.style.top="".concat(c,"px")),n.style.left!=="".concat(u,"px")&&(n.style.left="".concat(u,"px"))}}}var _e={width:96,height:28};n(188);var We=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(o.a)(this,Object(r.a)(t).call(this,e))).componentDidMount=function(){Ve(n.mainElement)},n.onClose=function(){n.props.onCancel()},n.onConfirm=function(){n.props.onUpdate(n.state.description)},n.handleChange=function(e){n.setState({description:e.target.value})},n.state={description:e.measurementData.description||""},n.mainElement=v.a.createRef(),n}return Object(s.a)(t,e),Object(i.a)(t,[{key:"componentDidUpdate",value:function(e){this.props.description!==e.description&&this.setState({description:this.props.description})}},{key:"render",value:function(){var e=function(e){var t=Object.assign({},e),n=320,a=230,i=window.innerWidth-n,o=window.innerHeight-a;return t.left-=n/2,t.top-=a/2,t.left>i&&(t.left=i),t.top>o&&(t.top=o),t}(this.props.componentStyle);return v.a.createElement(Re,{headerTitle:"Edit Description",onClose:this.onClose,onConfirm:this.onConfirm,rootClass:"editDescriptionDialog",componentRef:this.mainElement,componentStyle:e},v.a.createElement("input",{value:this.state.description,className:"simpleDialogInput",id:"description",autoComplete:"off",autoFocus:!0,onChange:this.handleChange}))}}]),t}(h.Component);We.defaultProps={componentRef:v.a.createRef(),componentStyle:{}};n(189);var Ye=function(e){function t(){return Object(a.a)(this,t),Object(o.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return v.a.createElement(C.a,{in:this.props.displayComponent,appear:!0,timeout:500,classNames:"labelling",onExited:this.props.onTransitionExit},this.props.children)}}]),t}(h.Component),He=["Abdomen/Chest Wall","Adrenal","Bladder","Bone","Brain","Breast","Colon","Esophagus","Extremities","Gallbladder","Kidney","Liver","Lung","Lymph Node","Mediastinum/Hilum","Muscle","Neck","Other Soft Tissue","Ovary","Pancreas","Pelvis","Peritoneum/Omentum","Prostate","Retroperitoneum","Small Bowel","Spleen","Stomach","Subcutaneous"].map(function(e){return{label:e,value:e}}),Ge=function(e){function t(e){var n;Object(a.a)(this,t),(n=Object(o.a)(this,Object(r.a)(t).call(this,e))).componentDidUpdate=function(){n.repositionComponent()},n.labellingStateFragment=function(){var e=n.state,t=e.skipAddLabelButton,a=e.editLocation,i=e.description,o=e.locationLabel;return t?a?v.a.createElement(j.j,{items:n.currentItems,columns:1,onSelected:n.selectTreeSelectCalback,selectTreeFirstTitle:"Assign Label",onComponentChange:n.repositionComponent}):v.a.createElement(v.a.Fragment,null,v.a.createElement("div",{className:"checkIconWrapper",onClick:n.fadeOutAndLeaveFast},v.a.createElement(j.e,{name:"check",className:"checkIcon"})),v.a.createElement("div",{className:"locationDescriptionWrapper"},v.a.createElement("div",{className:"location"},o),v.a.createElement("div",{className:"description"},v.a.createElement("input",{id:"descriptionInput",ref:n.descriptionInput,defaultValue:i||"",autoComplete:"off"}))),v.a.createElement("div",{className:"commonButtons"},v.a.createElement("button",{type:"button",className:"commonButton left",onClick:n.relabel},"Relabel"),v.a.createElement("button",{type:"button",className:"commonButton right",onClick:n.setDescriptionUpdateMode},i?"Edit ":"Add ","Description")),v.a.createElement("div",{className:"editDescriptionButtons"},v.a.createElement("button",{type:"button",className:"commonButton left",onClick:n.descriptionCancel},"Cancel"),v.a.createElement("button",{type:"button",className:"commonButton right",onClick:n.descriptionSave},"Save"))):v.a.createElement(v.a.Fragment,null,v.a.createElement("button",{type:"button",className:"addLabelButton",onClick:n.showLabelling},n.state.location?"Edit":"Add"," Label"))},n.relabel=function(){n.setState({editLocation:!0})},n.setDescriptionUpdateMode=function(){n.descriptionInput.current.focus(),n.setState({editDescription:!0})},n.descriptionCancel=function(){var e=ie()(n.state).description,t=void 0===e?"":e;n.descriptionInput.current.value=t,n.setState({editDescription:!1})},n.descriptionSave=function(){var e=n.descriptionInput.current.value;n.props.updateLabelling({description:e}),n.setState({description:e,editDescription:!1})},n.selectTreeSelectCalback=function(e,t){var a=t.value;n.props.updateLabelling({location:a});var i=n.mainElement.current.offsetParent.offsetTop,o={top:e.nativeEvent.y-i-25,left:n.state.componentStyle.left};n.setState({editLocation:!1,confirmationState:!0,location:t.value,locationLabel:t.label,componentStyle:o}),n.isTouchScreen&&(n.setTimeout=setTimeout(function(){n.setState({displayComponent:!1})},2e3))},n.showLabelling=function(){n.setState({skipAddLabelButton:!0,editLocation:!1})},n.fadeOutAndLeave=function(){n.fadeOutTimer=setTimeout(function(){n.setState({displayComponent:!1})},1e3)},n.fadeOutAndLeaveFast=function(){n.setState({displayComponent:!1})},n.clearFadeOutTimer=function(){n.fadeOutTimer&&clearTimeout(n.fadeOutTimer)},n.repositionComponent=function(){setTimeout(function(){Ve(n.mainElement)},200)};var i=e.measurementData,s=i.location,c=i.locationLabel,u=i.description,p=e.componentStyle;return e.skipAddLabelButton||(p=function(e,t){var n=e.handles,a=n.start,i=n.end,o=t.currentPoints.client,r=l.a.pixelToCanvas(t.element,a),s=l.a.pixelToCanvas(t.element,i),c=o.x-r.x,u=o.y-r.y,p={left:s.x+c,top:s.y+u};return a.y>i.y&&(p.top-=_e.height),a.x>i.x&&(p.left-=_e.width),p}(e.measurementData,e.eventData)),n.state={location:s,locationLabel:c,description:u,skipAddLabelButton:e.skipAddLabelButton,editDescription:e.editDescription,editLocation:e.editLocation,componentStyle:p,confirmationState:!1,displayComponent:!0},n.mainElement=v.a.createRef(),n.descriptionInput=v.a.createRef(),n.initialItems=He,n.currentItems=ie()(n.initialItems),n}return Object(s.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e="labellingComponent";this.state.editDescription&&(e+=" editDescription");var t=Object.assign({},this.state.componentStyle);return this.state.skipAddLabelButton&&(t.left-=160),v.a.createElement(Ye,{displayComponent:this.state.displayComponent,onTransitionExit:this.props.labellingDoneCallback},v.a.createElement("div",{className:e,style:t,ref:this.mainElement,onMouseLeave:this.fadeOutAndLeave,onMouseEnter:this.clearFadeOutTimer},this.labellingStateFragment()))}}]),t}(h.Component),Je=(n(192),function(e){function t(e){var n;Object(a.a)(this,t),(n=Object(o.a)(this,Object(r.a)(t).call(this,e))).componentDidMount=function(){document.addEventListener("touchstart",n.onTouchStart)},n.componentWillUnmount=function(){document.removeEventListener("touchstart",n.onTouchStart)},n.getRenderComponent=function(){var e=n.state,t=e.editLocation,a=e.editDescription,i=e.editDescriptionOnDialog,o=e.measurementData;return i?v.a.createElement(We,{onCancel:n.props.labellingDoneCallback,onUpdate:n.descriptionDialogUpdate,componentRef:n.editDescriptionDialog,componentStyle:n.state.componentStyle,measurementData:o}):t||a?v.a.createElement(Ge,Object.assign({},n.props,{componentStyle:n.state.componentStyle})):void 0},n.treatMeasurementData=function(e){var t=n.props,a=t.editDescription,i=t.editLocation;a&&(e.description=void 0),i&&(e.location=void 0)},n.responseDialogUpdate=function(e){n.props.updateLabelling({response:e}),n.props.labellingDoneCallback()},n.descriptionDialogUpdate=function(e){n.props.updateLabelling({description:e}),n.props.labellingDoneCallback()};var i=ie()(e.measurementData);n.treatMeasurementData(i);var s=e.editLocation;return e.editDescription||e.editLocation||(s=!0),n.state={componentStyle:Xe(e.eventData),skipAddLabelButton:e.skipAddLabelButton,editLocation:s,editDescription:e.editDescription,editDescriptionOnDialog:e.editDescriptionOnDialog,measurementData:i},n}return Object(s.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return this.getRenderComponent()}}]),t}(h.Component));function Xe(e){var t=e.event;return{left:t.clientX,top:t.clientY}}Je.defaultProps={skipAddLabelButton:!1,editLocation:!1,editDescription:!1,editDescriptionOnDialog:!1};var ze=function(e){function t(){return Object(a.a)(this,t),Object(o.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return this.props.visible?v.a.createElement(Je,this.props):null}}]),t}(h.Component);ze.defaultProps={visible:!1};var Ke=ze,qe=Object(k.connect)(function(e){if(!e.ui||!e.ui.labelling)return{visible:!1};var t=e.ui.labelling;return Object(b.a)({visible:!1},t)},null)(Ke),Qe=(n(193),function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(o.a)(this,Object(r.a)(t).call(this,e))).retrieveMeasurements=function(e,t){return c.default.log.info("retrieveMeasurements"),Promise.resolve()},n.storeMeasurements=function(e,t){return c.default.log.info("storeMeasurements"),Promise.resolve()},n.retrieveTimepoints=function(e){c.default.log.info("retrieveTimepoints");var t=(new Date).toISOString(),a=(new Date).toISOString();return n.props.studies&&(a=new Date("1000-01-01").toISOString(),n.props.studies.forEach(function(e){var n=P()(e.studyDate,"YYYYMMDD").toISOString();n<t&&(t=n),n>a&&(a=n)})),Promise.resolve([{timepointType:"baseline",timepointId:"TimepointId",studyInstanceUids:n.props.studyInstanceUids,patientId:e.patientId,earliestDate:t,latestDate:a,isLocked:!1}])},n.storeTimepoints=function(e){return c.default.log.info("storeTimepoints"),Promise.resolve()},n.updateTimepoint=function(e,t){return c.default.log.info("updateTimepoint"),Promise.resolve()},n.removeTimepoint=function(e){return c.default.log.info("removeTimepoint"),Promise.resolve()},n.disassociateStudy=function(e,t){return c.default.log.info("disassociateStudy"),Promise.resolve()},n.onTimepointsUpdated=function(e){n.props.onTimepointsUpdated&&n.props.onTimepointsUpdated(e)},n.onMeasurementsUpdated=function(e){n.props.onMeasurementsUpdated&&n.props.onMeasurementsUpdated(e)},c.default.measurements.MeasurementApi.setConfiguration({dataExchange:{retrieve:n.retrieveMeasurements,store:n.storeMeasurements}}),c.default.measurements.TimepointApi.setConfiguration({dataExchange:{retrieve:n.retrieveTimepoints,store:n.storeTimepoints,remove:n.removeTimepoint,update:n.updateTimepoint,disassociate:n.disassociateStudy}}),n}return Object(s.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.studies,t=c.default.measurements,n=t.TimepointApi,a=t.MeasurementApi,i=new n("TimepointId",{onTimepointsUpdated:this.onTimepointsUpdated}),o=new a(i,{onMeasurementsUpdated:this.onMeasurementsUpdated});if(this.currentTimepointId="TimepointId",this.timepointApi=i,this.measurementApi=o,e){var r=e[0]&&e[0].patientId;i.retrieveTimepoints({patientId:r}),o.retrieveMeasurements(r,["TimepointId"])}}},{key:"componentDidUpdate",value:function(e){if(this.props.studies!==e.studies){var t=this.props.studies,n=t[0]&&t[0].patientId,a=this.currentTimepointId;this.timepointApi.retrieveTimepoints({patientId:n}),this.measurementApi.retrieveMeasurements(n,[a])}}},{key:"render",value:function(){return v.a.createElement(v.a.Fragment,null,v.a.createElement(R.Consumer,null,function(e){return v.a.createElement(Y,{home:!1},e.logoComponent)}),v.a.createElement("div",{id:"viewer",className:"Viewer"},v.a.createElement(Be,null),v.a.createElement(ye,{studies:this.props.studies}),v.a.createElement(qe,null)))}}]),t}(h.Component)),Ze=c.default.redux.actions,$e=Ze.setTimepoints,et=Ze.setMeasurements,tt=Object(k.connect)(null,function(e){return{onTimepointsUpdated:function(t){e($e(t))},onMeasurementsUpdated:function(t){e(et(t))}}})(Qe),nt=c.metadata.OHIFStudyMetadata,at=c.studies.retrieveStudiesMetadata,it=c.utils.studyMetadataManager,ot=c.utils.updateMetaDataManager,rt=function(e){function t(){var e,n;Object(a.a)(this,t);for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(r.a)(t)).call.apply(e,[this].concat(s)))).state={studies:null,error:null},n}return Object(s.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=Object(A.a)(N.a.mark(function e(){var t,n,a,i,o,r;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props,n=t.studyInstanceUids,a=t.seriesInstanceUids,i=t.server,e.prev=1,e.next=4,at(i,n,a);case 4:o=e.sent,it.purge(),r=o.map(function(e){var t=new nt(e,e.studyInstanceUid),n=an.modules.sopClassHandlerModule;return e.displaySets=e.displaySets||t.createDisplaySets(n),t.setDisplaySets(e.displaySets),ot(e),it.add(t),e}),this.setState({studies:r}),e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(1),this.setState({error:!0}),new Error(e.t0);case 14:case"end":return e.stop()}},e,this,[[1,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return this.state.error?v.a.createElement("div",null,"Error: ",JSON.stringify(this.state.error)):v.a.createElement(tt,{studies:this.state.studies,studyInstanceUids:this.props.studyInstanceUids})}}]),t}(h.Component),st=function(e){return!0===e.active},ct=Object(k.connect)(function(e){return{server:e.servers.servers.find(st)}},null)(rt);var ut=Object(I.f)(function(e){var t,n=function(e){return e?M.a.parse(e.search):{}}(e.location),a=n.requestType,i=n.studyUID;switch(a){case"STUDY":return v.a.createElement(ct,{studyInstanceUids:i.split(";")});case"STUDYBASE64":return v.a.createElement(ct,{studyInstanceUids:(t=i,window.atob(t).split(";"))});case"PATIENT":default:return""}});var lt=function(e){var t,n,a=e.match,i=a.params,o=i.studyInstanceUids,r=i.seriesInstanceUids;return o&&!r?t=o.split(";"):o&&r&&(t=[a.params.studyInstanceUid],n=a.params.seriesInstanceUids.split(";")),v.a.createElement(ct,{studyInstanceUids:t,seriesInstanceUids:n})},pt=function(e){function t(){var e,n;Object(a.a)(this,t);for(var i=arguments.length,s=new Array(i),u=0;u<i;u++)s[u]=arguments[u];return(n=Object(o.a)(this,(e=Object(r.a)(t)).call.apply(e,[this].concat(s)))).state={searchData:{},studies:null,error:null},n.searchForStudies=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{currentPage:0,rowsPerPage:t.rowsPerPage,studyDateFrom:t.defaultStudyDateFrom,studyDateTo:t.defaultStudyDateTo,sortData:t.defaultSort},a=n.props.server,i={patientId:e.patientId,patientName:e.patientName,accessionNumber:e.accessionNumber,studyDescription:e.studyDescription,modalitiesInStudy:e.modalities,studyDateFrom:e.studyDateFrom,studyDateTo:e.studyDateTo,limit:e.rowsPerPage,offset:e.currentPage*e.rowsPerPage};c.default.studies.searchStudies(a,i).then(function(t){t||(t=[]);var a=e.sortData,i=a.field,o=a.order,r=t.map(function(e){return P()(e.studyDate,"MMM DD, YYYY",!0).isValid()||(e.studyDate=P()(e.studyDate,"YYYYMMDD").format("MMM DD, YYYY")),e});r.sort(function(e,t){var n=e[i],a=t[i];return"studyDate"===i&&(n=P()(n).toISOString(),a=P()(a).toISOString()),"desc"===o?n<a?-1:n>a?1:0:n>a?-1:n<a?1:0}),n.setState({studies:r})}).catch(function(e){throw n.setState({error:!0}),new Error(e)})},n.onImport=function(){},n.onSelectItem=function(e){n.props.history.push("/viewer/".concat(e))},n.onSearch=function(e){n.searchForStudies(e)},n}return Object(s.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.searchForStudies()}},{key:"render",value:function(){return this.state.error?v.a.createElement("div",null,"Error: ",JSON.stringify(this.state.error)):null===this.state.studies?v.a.createElement("div",null,"Loading..."):v.a.createElement(v.a.Fragment,null,v.a.createElement(Y,{home:!0,user:this.props.user}),v.a.createElement(j.l,{studies:this.state.studies,studyListFunctionsEnabled:!1,onImport:this.onImport,onSelectItem:this.onSelectItem,pageSize:this.rowsPerPage,defaultSort:t.defaultSort,studyListDateFilterNumDays:t.studyListDateFilterNumDays,onSearch:this.onSearch}))}}]),t}(h.Component);pt.rowsPerPage=25,pt.defaultSort={field:"patientName",order:"desc"},pt.studyListDateFilterNumDays=25e3,pt.defaultStudyDateFrom=P()().subtract(pt.studyListDateFilterNumDays,"days").toDate(),pt.defaultStudyDateTo=new Date;var dt=Object(I.f)(pt),mt=function(e){return!0===e.active},ft=Object(k.connect)(function(e){return{server:e.servers.servers.find(mt),user:e.oidc.user}},null)(dt);var ht=function(e){return e.match,v.a.createElement(ft,null)},vt=n(106),bt=n.n(vt),gt=c.metadata.OHIFStudyMetadata,yt=c.studies.retrieveStudiesMetadata,Et=c.utils.studyMetadataManager,St=c.utils.updateMetaDataManager,Ot=function(e){function t(){var e,n;Object(a.a)(this,t);for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(r.a)(t)).call.apply(e,[this].concat(s)))).state={studies:null,error:null},n}return Object(s.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=Object(A.a)(N.a.mark(function e(){var n,a,i;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=bt.a.parse(this.props.location.search),e.next=4,t.parseQueryAndFetchStudies(n);case 4:a=e.sent,Et.purge(),i=a.map(function(e){var t=new gt(e,e.studyInstanceUid),n=an.modules.sopClassHandlerModule;return e.displaySets=e.displaySets||t.createDisplaySets(n),t.setDisplaySets(e.displaySets),St(e),Et.add(t),e}),this.setState({studies:i}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),this.setState({error:e.t0});case 13:case"end":return e.stop()}},e,this,[[0,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return this.state.error?v.a.createElement("div",null,"Error: ",JSON.stringify(this.state.error)):this.state.studies?v.a.createElement(Qe,{studies:this.state.studies}):v.a.createElement("div",null,"Loading...")}}],[{key:"parseQueryAndFetchStudies",value:function(e){return new Promise(function(t,n){var a=e.url;a||n(new Error("No URL was specified. Use ?url=$yourURL"));var i=new XMLHttpRequest;i.addEventListener("error",function(e){c.log.warn("An error occurred while retrieving the JSON data"),n(e)}),i.addEventListener("load",function(){i.responseText||(c.log.warn("Response was undefined"),n(new Error("Response was undefined"))),c.log.info(JSON.stringify(i.responseText,null,2));var a=JSON.parse(i.responseText);if(a.servers&&e.studyInstanceUids){var o=a.servers.dicomWeb[0];o.type="dicomWeb";var r=e.studyInstanceUids.split(";");yt(o,r,[]).then(function(e){t(e)},function(e){n(e)})}else t(a.studies)}),c.log.info("Sending Request to: ".concat(a)),i.open("GET",a),i.setRequestHeader("Accept","application/json"),i.send()})}}]),t}(h.Component),Dt=function(e){function t(){return Object(a.a)(this,t),Object(o.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return v.a.createElement(g.CallbackComponent,{userManager:this.props.userManager,successCallback:function(){var t=sessionStorage.getItem("ohif-redirect-to");e.props.history.push(t)},errorCallback:function(e){throw new Error(e)}},v.a.createElement("div",null,"Redirecting..."))}}]),t}(h.Component),wt=Object(I.f)(Dt);n(196);function It(){return v.a.createElement("div",{className:"not-found"},v.a.createElement("div",null,v.a.createElement("h4",null,"Sorry, this page does not exist."),v.a.createElement("h5",null,v.a.createElement(V.b,{to:"/"},"Go back to the Study List"))))}var Tt=function(e){var t=e.progress,n=e.animationDuration;return v.a.createElement("div",{style:{background:"#29d",height:2,left:0,marginLeft:"".concat(100*(-1+t),"%"),position:"fixed",top:0,transition:"margin-left ".concat(n,"ms linear"),width:"100%",zIndex:1031}},v.a.createElement("div",{style:{boxShadow:"0 0 10px #29d, 0 0 5px #29d",display:"block",height:"100%",opacity:1,position:"absolute",right:0,transform:"rotate(3deg) translate(0px, -4px)",width:100}}))},Ct=function(e){var t=e.children,n=e.isFinished,a=e.animationDuration;return v.a.createElement("div",{style:{opacity:n?0:1,pointerEvents:"none",transition:"opacity ".concat(a,"ms linear")}},t)},kt=(n(197),n(198),n(199),function(){return window.location.reload()}),jt=function(e){function t(){var e,n;Object(a.a)(this,t);for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(r.a)(t)).call.apply(e,[this].concat(s)))).state={isLoading:!1},n}return Object(s.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.unlisten=this.props.history.listen(function(t,n){e.props.setContext&&e.props.setContext(window.location.pathname)})}},{key:"componentWillUnmount",value:function(){this.unlisten()}},{key:"render",value:function(){var e=this,t=this.props,n=t.user,a=t.userManager;if(a&&(!n||n.expired)){var i=this.props.location.pathname;return"/callback"!==i&&sessionStorage.setItem("ohif-redirect-to",i),v.a.createElement(I.c,null,v.a.createElement(I.a,{exact:!0,path:"/silent-refresh.html",onEnter:kt}),v.a.createElement(I.a,{exact:!0,path:"/logout-redirect.html",onEnter:kt}),v.a.createElement(I.a,{path:"/callback",render:function(){return v.a.createElement(wt,{userManager:a})}}),v.a.createElement(I.a,{component:function(){return a.signinRedirect(),null}}))}var o=[{path:"/",Component:ht},{path:"/studylist",Component:ht},{path:"/viewer",Component:Ot},{path:"/viewer/:studyInstanceUids",Component:lt},{path:"/study/:studyInstanceUid/series/:seriesInstanceUids",Component:lt},{path:"/IHEInvokeImageDisplay",Component:ut}],r=this.props.location.pathname,s=!o.find(function(e){return Object(I.e)(r,{path:e.path,exact:!0})});return v.a.createElement(v.a.Fragment,null,v.a.createElement(T.a,{isAnimating:this.state.isLoading},function(e){var t=e.isFinished,n=e.progress,a=e.animationDuration;return v.a.createElement(Ct,{isFinished:t,animationDuration:a},v.a.createElement(Tt,{progress:n,animationDuration:a}))}),v.a.createElement(I.a,{exact:!0,path:"/silent-refresh.html",onEnter:kt}),v.a.createElement(I.a,{exact:!0,path:"/logout-redirect.html",onEnter:kt}),!s&&o.map(function(t){var n=t.path,a=t.Component;return v.a.createElement(I.a,{key:n,exact:!0,path:n},function(t){var n=t.match;return v.a.createElement(C.a,{in:null!==n,timeout:300,classNames:"fade",unmountOnExit:!0,onEnter:function(){e.setState({isLoading:!0})},onEntered:function(){e.setState({isLoading:!1})}},null===n?v.a.createElement(v.a.Fragment,null):v.a.createElement(a,{match:n}))})}),s&&v.a.createElement(It,null))}}]),t}(h.Component),xt=Object(k.connect)(function(e){return{user:e.oidc.user}},null)(jt),Mt=Object(j.n)(Object(I.f)(xt)),Lt=n(107),Nt=n.n(Lt),At=n(39),Ut={leftSidebarOpen:!0,rightSidebarOpen:!1,labelling:{},contextMenu:{}},Pt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ut,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_LEFT_SIDEBAR_OPEN":return Object.assign({},e,{leftSidebarOpen:t.state});case"SET_RIGHT_SIDEBAR_OPEN":return Object.assign({},e,{rightSidebarOpen:t.state});case"SET_LABELLING_FLOW_DATA":var n=Object.assign({},t.labellingFlowData);return Object.assign({},e,{labelling:n});case"SET_TOOL_CONTEXT_MENU_DATA":var a=Object.assign({},e.contextMenu);return a[t.viewportIndex]=Object.assign({},t.toolContextMenuData),Object.assign({},e,{contextMenu:a});case"RESET_LABELLING_AND_CONTEXT_MENU":return Object.assign({},e,{labelling:Ut.labelling,contextMenu:Ut.contextMenu});default:return e}},Bt=n(108),Ft=c.redux.reducers,Rt=c.redux.localStorage;Ft.ui=Pt,Ft.oidc=g.reducer;var Vt=Object(At.c)(Ft),_t=Object(At.d)(Vt,Rt.loadState(),Object(At.a)(Bt.a));_t.subscribe(function(){Rt.saveState({preferences:_t.getState().preferences})});var Wt=_t,Yt=c.redux.actions.setViewportActive,Ht={updateViewportDisplaySet:function(e){var t=e.direction;console.warn("updateDisplaySet: ",t)},updateActiveViewport:function(e){var t=e.viewports,n=e.direction,a=t.viewportSpecificData,i=t.activeViewportIndex,o=Object.keys(a).length-1,r=i+n;r=(r=r>o?0:r)<0?o:r,Wt.dispatch(Yt(r))}},Gt={incrementActiveViewport:{commandFn:Ht.updateActiveViewport,storeContexts:["viewports"],options:{direction:1}},decrementActiveViewport:{commandFn:Ht.updateActiveViewport,storeContexts:["viewports"],options:{direction:-1}}},Jt={viewer:"VIEWER"};var Xt={init:function(e){!function(e){var t=Jt.viewer;e.createContext(t),Object.keys(Gt).forEach(function(n){var a=Gt[n];e.registerCommand(t,n,a)})}(e)}},zt=n(32);var Kt=function(e){return{type:"RESET_LABELLING_AND_CONTEXT_MENU",state:e}},qt=function(e,t){return{type:"SET_TOOL_CONTEXT_MENU_DATA",viewportIndex:e,toolContextMenuData:t}};function Qt(e){var t=function(t){return function(){e.dispatch(qt(t,{visible:!1}))}};return function(n){var a=n.detail,i=parseInt(a.element.dataset.viewportIndex,10);!function(t,n){e.dispatch(Kt()),e.dispatch(qt(t,n))}(i,{eventData:a,isTouchEvent:!1,onClose:t(i)})}}function Zt(e){var t=function(t){return function(){e.dispatch(qt(t,{visible:!1}))}};return function(n){var a=n.detail,i=parseInt(a.element.dataset.viewportIndex,10);!function(t,n){e.dispatch(Kt()),e.dispatch(qt(t,n))}(i,{eventData:a,isTouchEvent:!0,onClose:t(i)})}}function $t(e){return function(){e.dispatch(Kt())}}var en={getAppState:function(){return Wt.getState()},getActiveContexts:function(){return Pe(Wt.getState())}},tn=new c.CommandsManager(en),nn=new c.HotkeysManager(tn),an=new c.ExtensionManager({commandsManager:tn});Xt.init(tn),window.config.hotkeys&&nn.setHotkeys(window.config.hotkeys,!0),function(e){var t=function(e){var t=function(t){e.dispatch(function(e){return{type:"SET_LABELLING_FLOW_DATA",labellingFlowData:e}}(t))};return function(e,n,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o={visible:!0,eventData:n,measurementData:e,skipAddLabelButton:i.skipAddLabelButton,editLocation:i.editLocation,editDescription:i.editDescription,editResponse:i.editResponse,editDescriptionOnDialog:i.editDescriptionOnDialog,labellingDoneCallback:function(){t({visible:!1})},updateLabelling:function(t){var n=t.location,a=t.response,i=t.description;n&&(e.location=n),i&&(e.description=i),a&&(e.response=a),z(e)}};t(o)}}(e),n=[{name:"Pan",mouseButtonMasks:[1,4]},{name:"Zoom",mouseButtonMasks:[1,2]},{name:"Wwwc",mouseButtonMasks:[1]},{name:"Bidirectional",configuration:{configuration:{getMeasurementLocationCallback:t}},mouseButtonMasks:[1]},{name:"Length",configuration:{configuration:{getMeasurementLocationCallback:t}},mouseButtonMasks:[1]},{name:"Angle",configuration:{configuration:{getMeasurementLocationCallback:t}},mouseButtonMasks:[1]},{name:"StackScroll",mouseButtonMasks:[1]},{name:"Brush",mouseButtonMasks:[1]},{name:"FreehandMouse",configuration:{configuration:{getMeasurementLocationCallback:t}},mouseButtonMasks:[1]},{name:"EllipticalRoi",configuration:{configuration:{getMeasurementLocationCallback:t}},mouseButtonMasks:[1]},{name:"CircleRoi",configuration:{configuration:{getMeasurementLocationCallback:t}},mouseButtonMasks:[1]},{name:"RectangleRoi",configuration:{configuration:{getMeasurementLocationCallback:t}},mouseButtonMasks:[1]},{name:"PanMultiTouch"},{name:"ZoomTouchPinch"},{name:"StackScrollMouseWheel"},{name:"StackScrollMultiTouch"}],a=Qt(e),i=Zt(e),o=$t(e),r=$t(e),s=$t(e),u=c.default.redux.actions.setExtensionData("cornerstone",{availableTools:n,onNewImage:o,onRightClick:a,onTouchPress:i,onTouchStart:s,onMouseClick:r});e.dispatch(u)}(Wt),an.registerExtensions([S.a,Nt.a,w.a,O.a,D.a]),window.store=Wt;var on=function(e){function t(e){var n,i;if(Object(a.a)(this,t),(n=Object(o.a)(this,Object(r.a)(t).call(this,e))).props.oidc.length){var s=n.props.oidc[0];n.userManager=y(Wt,s)}return(i=n.props.servers)&&c.utils.addServers(i,Wt),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n="".concat(window.location.protocol,"//").concat(window.location.host).concat(e).concat(t);"/"!==n[n.length-1]&&(n+="/");var a={maxWebWorkers:Math.max(navigator.hardwareConcurrency-1,1),startWebWorkersOnDemand:!0,webWorkerPath:"".concat(n,"cornerstoneWADOImageLoaderWebWorker.min.js"),taskConfiguration:{decodeTask:{loadCodecsOnStartup:!0,initializeCodecsOnStartup:!1,codecsPath:"".concat(n,"cornerstoneWADOImageLoaderCodecs.min.js"),usePDFJS:!1,strict:!1}}};d.a.webWorkerManager.initialize(a)}(n.props.routerBasename,n.props.relativeWebWorkerScriptsPath),n}return Object(s.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.userManager;return e?v.a.createElement(k.Provider,{store:Wt},v.a.createElement(E.a,{i18n:zt.default},v.a.createElement(g.OidcProvider,{store:Wt,userManager:e},v.a.createElement(V.a,{basename:this.props.routerBasename},v.a.createElement(R.Provider,{value:this.props.whiteLabelling},v.a.createElement(Mt,{userManager:e})))))):v.a.createElement(k.Provider,{store:Wt},v.a.createElement(E.a,{i18n:zt.default},v.a.createElement(V.a,{basename:this.props.routerBasename},v.a.createElement(R.Provider,{value:this.props.whiteLabelling},v.a.createElement(Mt,null)))))}}]),t}(h.Component);on.defaultProps={whiteLabelling:{},oidc:[]};var rn=on,sn=n(14),cn=n.n(sn);n.d(t,"App",function(){return rn}),window.config=window.config||{};var un=Object.assign({},{routerBasename:"/",relativeWebWorkerScriptsPath:""},window.config),ln=v.a.createElement(rn,un,null);cn.a.render(ln,document.getElementById("root"))},87:function(e,t,n){}},[[114,1,2]]]);
//# sourceMappingURL=main.7463aa62.chunk.js.map