(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{213:function(e,t,n){},244:function(e,t,n){e.exports=n(542)},489:function(e,t,n){},491:function(e,t,n){},492:function(e,t,n){},493:function(e,t,n){},494:function(e,t,n){},495:function(e,t,n){},496:function(e,t,n){},497:function(e,t,n){},498:function(e,t,n){},499:function(e,t,n){},500:function(e,t,n){},535:function(e,t,n){},536:function(e,t,n){},537:function(e,t,n){},538:function(e,t,n){},542:function(e,t,n){"use strict";n.r(t);n(245),n(246),n(247),n(248),n(249),n(250),n(251),n(252),n(253),n(254),n(255),n(256),n(257),n(258),n(259),n(260),n(261),n(262),n(263),n(264),n(265),n(266),n(267),n(268),n(269),n(270),n(271),n(117),n(272),n(273),n(274),n(275),n(276),n(277),n(278),n(279),n(280),n(281),n(282),n(283),n(284),n(285),n(286),n(287),n(288),n(289),n(290),n(292),n(293),n(295),n(296),n(297),n(298),n(299),n(300),n(301),n(302),n(303),n(304),n(305),n(306),n(307),n(309),n(310),n(311),n(312),n(313),n(314),n(315),n(316),n(317),n(318),n(319),n(320),n(321),n(323),n(324),n(325),n(326),n(327),n(328),n(329),n(330),n(331),n(332),n(333),n(334),n(335),n(336),n(337),n(338),n(339),n(340),n(341),n(342),n(343),n(344),n(345),n(346),n(347),n(348),n(349),n(350),n(351),n(352),n(353),n(354),n(356),n(357),n(358),n(359),n(362),n(363),n(364),n(366),n(367),n(368),n(369),n(370),n(371),n(372),n(373),n(374),n(375),n(376),n(377),n(378),n(379),n(380),n(381),n(382),n(383),n(384),n(385),n(198),n(386),n(387),n(388),n(389),n(390),n(391),n(392),n(393),n(394),n(395),n(396),n(397),n(398),n(399),n(400),n(401),n(402),n(403),n(404),n(405),n(406),n(407),n(408),n(409),n(410),n(411),n(412),n(413),n(414),n(415),n(416),n(417),n(418),n(419),n(420),n(421),n(422),n(423),n(424),n(425),n(426),n(427),n(428),n(429),n(430),n(431),n(432),n(433),n(434),n(435),n(436),n(437),n(438),n(439),n(440),n(441),n(442),n(443),n(444),n(445),n(446),n(447),n(448),n(449),n(450),n(451),n(454),n(205);var a=n(4),r=n(5),o=n(10),i=n(8),s=n(9),c=n(7),l=n(3),u=n.n(l),p=n(40),d=n.n(p),m=n(67),f=n.n(m);window.info={version:"0.0.21",homepage:"".concat("/demo")},window.cornerstone=u.a,window.cornerstoneWADOImageLoader=d.a,d.a.external.cornerstone=u.a,d.a.external.dicomParser=f.a,c.default.user.getAccessToken=function(){var e=window.store.getState();if(e.oidc&&e.oidc.user)return e.oidc.user.access_token},d.a.configure({beforeSend:function(e){var t=c.default.DICOMWeb.getAuthorizationHeader();t.Authorization&&e.setRequestHeader("Authorization",t.Authorization)}});n(206);var h=n(1),v=n.n(h),g=n(29),b=n(68),y=function(e,t){if(e&&t){var n=Object(g.a)({},t,{silent_redirect_uri:"/silent-refresh.html",automaticSilentRenew:!0,revokeAccessTokenOnSignout:!0,filterProtocolClaims:!0,loadUserInfo:!0}),a=Object(b.createUserManager)(n);return Object(b.loadUser)(e,a),a}};var E=n(21),O=n(225),S=n.n(O),w=n(161),k=n.n(w),j=n(6),D=n.n(j),C=n(92),I={labelling:{},contextMenu:{}},x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_LABELLING_FLOW_DATA":var n=Object.assign({},t.labellingFlowData);return Object.assign({},e,{labelling:n});case"SET_TOOL_CONTEXT_MENU_DATA":var a=Object.assign({},e.contextMenu);return a[t.viewportIndex]=Object.assign({},t.toolContextMenuData),Object.assign({},e,{contextMenu:a});case"RESET_LABELLING_AND_CONTEXT_MENU":return Object.assign({},e,{labelling:I.labelling,contextMenu:I.contextMenu});default:return e}},T=n(226),L=c.redux.reducers,M=c.redux.localStorage;L.ui=x,L.oidc=b.reducer;var N=Object(C.c)(L),P=Object(C.d)(N,M.loadState(),Object(C.a)(T.a));P.subscribe(function(){M.saveState({preferences:P.getState().preferences})});var A=P,U=c.redux.actions.setViewportActive,R={updateViewportDisplaySet:function(e){e.direction},updateActiveViewport:function(e){var t=e.viewports,n=e.direction,a=t.viewportSpecificData,r=t.activeViewportIndex,o=Object.keys(a).length-1,i=r+n;i=(i=i>o?0:i)<0?o:i,A.dispatch(U(i))}},B={definitions:{incrementActiveViewport:{commandFn:R.updateActiveViewport,storeContexts:["viewports"],options:{direction:1}},decrementActiveViewport:{commandFn:R.updateActiveViewport,storeContexts:["viewports"],options:{direction:-1}}},defaultContext:"VIEWER"},F={id:"generic-viewer-commands",getCommandsModule:function(){return B}},V=n(13),H=n(15),W=n(62),_=n.n(W),K=c.measurements.MeasurementApi,Y=c.utils.studyMetadataManager;function G(e){var t=e.toolType,n=e.measurementNumber,a=e.location,r=e.description,o=c.default.measurements.MeasurementApi.Instance;o.tools[t].filter(function(e){return e.measurementNumber===n}).forEach(function(e){e.location=a,e.description=r,o.updateMeasurement(e.toolType,e)}),o.syncMeasurementsAndToolData(),u.a.getEnabledElements().forEach(function(e){u.a.updateImage(e.element)})}function z(e,t,n){var a=t.toolType,r=e.element,o=G,i=D.a.getToolForElement(r,a);i&&i.configuration&&i.configuration.getMeasurementLocationCallback?i.configuration.getMeasurementLocationCallback(t,e,o,n):console.warn("Tool instance configuration is missing: getMeasurementLocationCallback")}var q=c.default.redux.actions.setViewportSpecificData,J=c.default.measurements.MeasurementApi;function X(e){var t=e.location,n=e.description,a="...";return t&&(a=t,n&&(a+="(".concat(n,")"))),a}function Q(e,t,n){var a=[];return e.forEach(function(e){t.forEach(function(t){var r={displayText:"..."};e.timepointId===t.timepointId&&(r.displayText=n(e)),a.push(r)})}),a}function Z(e,t){var n=c.default.measurements.MeasurementApi.getConfiguration().measurementTools,a=function(){var e=c.default.measurements.MeasurementApi.getConfiguration(),t=[];return e.measurementTools.forEach(function(e){return t=t.concat(e.childTools)}),t}(),r=n.map(function(e){return{groupName:e.name,groupId:e.id,measurements:[]}});return Object.keys(e).forEach(function(n){var o,i=e[n],s=a.find(function(e){return e.id===n}),c=s.options.measurementTable.displayFunction,l=(o="measurementNumber",i.reduce(function(e,t){return(e[t[o]]=e[t[o]]||[]).push(t),e},{}));Object.keys(l).forEach(function(e){var n=l[e],a=n[0],o=a.measurementNumber,i=a.lesionNamingNumber,u=a.toolType,p=a._id,d={itemNumber:i,label:X(a),measurementId:p,measurementNumber:o,lesionNamingNumber:i,toolType:u,hasWarnings:!1,warningTitle:"",isSplitLesion:!1,warningList:[],data:Q(n,t,c)};r.find(function(e){return e.groupId===s.toolGroup}).measurements.push(d)})}),r.forEach(function(e){e.measurements.sort(function(e,t){return e.lesionNamingNumber>t.lesionNamingNumber?1:-1})}),r}function $(e){return e&&e.length?[{label:"Study date:",date:_()(e[0].latestDate).format("DD-MMM-YY")}]:[]}var ee=Object(V.connect)(function(e){var t=e.timepointManager,n=t.timepoints,a=t.measurements;return{timepoints:$(n),measurementCollection:Z(a,n),timepointManager:e.timepointManager,viewports:e.viewports}},function(e){return{dispatchRelabel:function(e,t,n){var a=n&&n.activeViewportIndex||0,r=u.a.getEnabledElements();if(!r||r.length<=a)c.default.log.error("Failed to find the enabled element");else{var o=r[a].element,i={event:{clientX:e.clientX,clientY:e.clientY},element:o},s=t.toolType,l=t.measurementId,p=J.Instance.tools[s].find(function(e){return e._id===l});z(i,Object.assign({},p,{location:null}),{skipAddLabelButton:!0,editLocation:!0})}},dispatchEditDescription:function(e,t,n){var a=n&&n.activeViewportIndex||0,r=u.a.getEnabledElements();if(!r||r.length<=a)c.default.log.error("Failed to find the enabled element");else{var o=r[a].element,i={event:{clientX:e.clientX,clientY:e.clientY},element:o},s=t.toolType,l=t.measurementId;z(i,J.Instance.tools[s].find(function(e){return e._id===l}),{editDescriptionOnDialog:!0})}},dispatchJumpToRowItem:function(t,n,a,r){(function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{invertViewportTimepointsOrder:!1,childToolKey:null},r=t.layout.viewports.length,o=n.timepoints.length,i=n.measurements,s=n.timepoints,c=Math.min(o,r),l=e.toolType,u=e.measurementNumber;a.invertViewportTimepointsOrder&&s.reverse();for(var p=i[l],d=[],m=function(e){var t=s[e].timepointId,n=p.find(function(e){return e.timepointId===t&&e.measurementNumber===u});if(!n)return d.push(null),"continue";var r=n,o=K.getToolConfiguration(l).tool;if(a.childToolKey)r=n[a.childToolKey];else if(Array.isArray(o.childTools)){var i=o.childTools.find(function(e){return!!n[e]});r=n[i]}d.push(r)},f=0;f<c;f++)m(f);var h=[];return d.forEach(function(e,t){if(e){var n=Y.get(e.studyInstanceUid);if(!n)throw new Error("Study not found.");var a=n.findDisplaySet(function(t){return function(e,t){return e.images.find(function(e){return e.getSOPInstanceUID()===t})}(t,e.sopInstanceUid)});if(!a)throw new Error("Display set not found.");a.sopInstanceUid=e.sopInstanceUid,e.frameIndex&&(a.frameIndex=e.frameIndex),h.push({viewportIndex:t,displaySet:a})}}),{viewportSpecificData:h,layout:[]}})(t,n,a,e,r).viewportSpecificData.forEach(function(t){var n=t.viewportIndex,a=t.displaySet;e(q(n,a))});var o=t.toolType,i=t.measurementNumber,s=J.Instance;Object.keys(s.tools).forEach(function(e){s.tools[e].forEach(function(e){e.active=!1})}),s.tools[o].filter(function(e){return e.measurementNumber===i}).forEach(function(e){e.active=!0}),s.syncMeasurementsAndToolData(),u.a.getEnabledElements().forEach(function(e){u.a.updateImage(e.element)})}}},function(e,t,n){return Object(g.a)({timepoints:e.timepoints,measurementCollection:e.measurementCollection,selectedMeasurementNumber:n.selectedMeasurementNumber},t,{onItemClick:function(n,a){var r=e.viewports,o=e.timepointManager;t.dispatchJumpToRowItem(a,r,o,{invertViewportTimepointsOrder:!1,childToolKey:null})},onRelabelClick:function(n,a){var r=e.viewports;t.dispatchRelabel(n,a,r)},onEditDescriptionClick:function(n,a){var r=e.viewports;t.dispatchEditDescription(n,a,r)},onDeleteClick:function(e,t){c.default.measurements.MeasurementHandlers.onRemoved({detail:{toolType:t.toolType,measurementData:{_id:t.measurementId,lesionNamingNumber:t.lesionNamingNumber,measurementNumber:t.measurementNumber}}})}})})(H.h),te={id:"measurements-table",getPanelModule:function(){return{menuOptions:[{icon:"list",label:"Measurements",target:"measurement-panel"}],components:[{id:"measurement-panel",component:ee}],defaultContext:["VIEWER"]}}},ne=n(228),ae=n(231),re=n(232),oe=n(233),ie=n(56),se=n(234),ce=n(543),le=n(131),ue=n.n(le),pe=n(16),de=n.n(pe),me=n(28),fe=n(60),he=n.n(fe);n(489);var ve=function(){return v.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",className:"header-brand",href:"http://ohif.org"},v.a.createElement(H.e,{name:"ohif-logo",className:"header-logo-image"}),v.a.createElement("div",{className:"header-logo-text"},"Open Health Imaging Foundation"))},ge={logoComponent:ve()},be=v.a.createContext(ge),ye=(n(213),n(45)),Ee=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(o.a)(this,Object(i.a)(t).call(this,e))).state={isUserPreferencesOpen:!1,isOpen:!1},n.loadOptions(),n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"loadOptions",value:function(){var e=this,t=this.props.t;this.options=[{title:t("About"),icon:{name:"info"},onClick:function(){e.setState({isOpen:!0})}}],this.hotKeysData=Hn.hotkeyDefinitions}},{key:"onUserPreferencesSave",value:function(e){e.windowLevelData,e.hotKeysData}},{key:"render",value:function(){var e=this,t=this.props.t,n=void 0===window.config.showStudyList||window.config.showStudyList;return v.a.createElement("div",{className:"entry-header ".concat(this.props.home?"header-big":"")},v.a.createElement("div",{className:"header-left-box"},this.props.location&&this.props.location.studyLink&&v.a.createElement(ye.b,{to:this.props.location.studyLink,className:"header-btn header-viewerLink"},t("Back to Viewer")),this.props.children,n&&!this.props.home&&v.a.createElement(ye.b,{className:"header-btn header-studyListLinkSection",to:{pathname:"/",state:{studyLink:this.props.location.pathname}}},t("Study list"))),v.a.createElement("div",{className:"header-menu"},v.a.createElement("span",{className:"research-use"},t("INVESTIGATIONAL USE ONLY")),v.a.createElement(H.c,{title:t("Options"),list:this.options,align:"right"}),v.a.createElement(H.a,Object.assign({},this.state,{onCancel:function(){return e.setState({isOpen:!1})}}))))}}]),t}(h.Component);Ee.defaultProps={home:!0,children:ve()};var Oe=Object(E.c)("Header")(Object(ie.f)(Ee)),Se=Object(V.connect)(function(e){return{isOpen:e.ui.userPreferencesModalOpen}})(Oe),we=n(66),ke=(n(491),n(61)),je=n.n(ke),De=(0,D.a.import)("util/scrollToIndex"),Ce=c.default.redux.actions.setViewportSpecificData,Ie=Object(V.connect)(function(e){var t=e.viewports,n=t.viewportSpecificData[t.activeViewportIndex]||{},a=n.cine;return{activeEnabledElement:n.dom,activeViewportCineData:a||{isPlaying:!1,cineFrameRate:24},activeViewportIndex:e.viewports.activeViewportIndex}},function(e){return{dispatchSetViewportSpecificData:function(t,n){e(Ce(t,n))}}},function(e,t,n){var a=e.activeEnabledElement,r=e.activeViewportCineData,o=e.activeViewportIndex;return{cineFrameRate:r.cineFrameRate,isPlaying:r.isPlaying,onPlayPauseChanged:function(e){var n=je()(r);n.isPlaying=!n.isPlaying,t.dispatchSetViewportSpecificData(o,{cine:n})},onFrameRateChanged:function(e){var n=je()(r);n.cineFrameRate=e,t.dispatchSetViewportSpecificData(o,{cine:n})},onClickNextButton:function(){var e=D.a.getToolState(a,"stack");if(e&&e.data&&e.data.length){var t=e.data[0],n=t.currentImageIdIndex;n>=t.imageIds.length-1||De(a,n+1)}},onClickBackButton:function(){var e=D.a.getToolState(a,"stack");if(e&&e.data&&e.data.length){var t=e.data[0].currentImageIdIndex;0!==t&&De(a,t-1)}},onClickSkipToStart:function(){var e=D.a.getToolState(a,"stack");e&&e.data&&e.data.length&&De(a,0)},onClickSkipToEnd:function(){var e=D.a.getToolState(a,"stack");if(e&&e.data&&e.data.length){var t=e.data[0].imageIds.length-1;De(a,t)}}}})(H.b),xe=c.default.redux.actions.setLayout,Te=Object(V.connect)(function(e){return{currentLayout:e.viewports.layout}},function(e){return{onChange:function(t){for(var n=[],a=t.row+1,r=t.col+1,o=a*r,i=0;i<o;i++)n.push({height:"".concat(100/a,"%"),width:"".concat(100/r,"%")});e(xe({viewports:n}))}}})(H.f),Le=(n(492),function(e){function t(){return Object(a.a)(this,t),Object(o.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return v.a.createElement("div",{className:"PluginSwitch"},v.a.createElement(H.d,{buttons:this.props.buttons,text:"View"}))}}]),t}(h.Component));Le.defaultProps={};var Me=Le,Ne=c.default.redux.actions.setLayout,Pe=Object(V.connect)(function(e){var t=e.viewports,n=t.activeViewportIndex,a=t.layout;return{activeViewportIndex:n,viewportSpecificData:t.viewportSpecificData,layout:a}},function(e){return{setLayout:function(t){e(Ne(t))}}},function(e,t,n){return{buttons:[{label:"2D MPR",icon:"cube",onClick:function(){Vn.runCommand("mpr2d")}}]}})(Me);function Ae(e,t,n){if(e.commandName){var a=Object.assign({evt:t},e.commandOptions);Vn.runCommand(e.commandName,a)}"setToolActive"===e.type?this.setState({activeButtons:[e.id]}):"builtIn"===e.type&&this._handleBuiltIn(e.options)}function Ue(){var e=this,t=Wn.modules[c.MODULE_TYPES.TOOLBAR],n=[];return t.forEach(function(t){var a=t.module,r=a.definitions,o=a.defaultContext;r.forEach(function(t){var a=t.context||o;e.props.activeContexts.includes(a)&&n.push(t)})}),n}var Re=function(e){function t(e){var n;Object(a.a)(this,t),n=Object(o.a)(this,Object(i.a)(t).call(this,e));var r=Ue.call(Object(we.a)(n));n.state={toolbarButtons:r,activeButtons:[],isCineDialogOpen:!1},n._handleBuiltIn=function(){"CINE"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).behavior&&this.setState({isCineDialogOpen:!this.state.isCineDialogOpen})}.bind(Object(we.a)(n));var s=Wn.modules[c.MODULE_TYPES.PANEL];return n.buttonGroups={left:[{value:"studies",icon:"th-large",bottomLabel:"Series"}],right:[]},s.forEach(function(e){var t=e.module,a=Array.from(t.defaultContext);t.menuOptions.forEach(function(e){var t=Array.from(e.context||a);if(n.props.activeContexts.some(function(e){return t.includes(e)})){var r={value:e.target,icon:e.icon,bottomLabel:e.label},o=e.from||"right";n.buttonGroups[o].push(r)}})}),n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"componentDidUpdate",value:function(e){e.activeContexts!==this.props.activeContexts&&this.setState({toolbarButtons:Ue.call(this)})}},{key:"render",value:function(){var e=this,t=function(e,t){var n=this;return e.map(function(e,a){if(e.buttons&&e.buttons.length){var r=e.buttons.map(function(e){return e.onClick=Ae.bind(n,e),e});return v.a.createElement(H.d,{key:e.id,text:e.label,icon:e.icon,buttons:r})}return v.a.createElement(H.m,{key:e.id,label:e.label,icon:e.icon,onClick:Ae.bind(n,e),isActive:t.includes(e.id)})})}.call(this,this.state.toolbarButtons,this.state.activeButtons),n={display:this.state.isCineDialogOpen?"block":"none",position:"absolute",top:"82px",zIndex:999},a=function(t,n){e.props.handleSidePanelChange(t,n)},r=a.bind(this,"left"),o=a.bind(this,"right");return v.a.createElement(v.a.Fragment,null,v.a.createElement("div",{className:"ToolbarRow"},v.a.createElement("div",{className:"pull-left m-t-1 p-y-1",style:{padding:"10px"}},v.a.createElement(H.i,{options:this.buttonGroups.left,value:this.props.selectedLeftSidePanel||"",onValueChanged:r})),t,v.a.createElement(Te,null),v.a.createElement(Pe,null),v.a.createElement("div",{className:"pull-right m-t-1 rm-x-1",style:{marginLeft:"auto"}},this.buttonGroups.right.length&&v.a.createElement(H.i,{options:this.buttonGroups.right,value:this.props.selectedRightSidePanel||"",onValueChanged:o}))),v.a.createElement("div",{className:"CineDialogContainer",style:n},v.a.createElement(Ie,null)))}}]),t}(h.Component),Be=n(236),Fe=Object(Be.a)([function(e){return e.viewports.activeViewportIndex},function(e){return e.viewports.layout.viewports},function(e){return e.viewports.viewportSpecificData}],function(e,t,n){var a=["VIEWER"],r=t[e]||{},o=n[e]||{},i=r.plugin||o.plugin;if(i){var s="ACTIVE_VIEWPORT::".concat(i.toUpperCase());a.push(s)}return a}),Ve=Object(V.connect)(function(e){return{activeContexts:Fe(e)}})(Re),He=(n(493),function(e){function t(){return Object(a.a)(this,t),Object(o.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return v.a.createElement("div",{className:"simpleDialog ".concat(this.props.rootClass),ref:this.props.componentRef,style:this.props.componentStyle},v.a.createElement("form",null,v.a.createElement("div",{className:"header"},v.a.createElement("span",{className:"closeBtn",onClick:this.props.onClose},v.a.createElement("span",{className:"closeIcon"},"x")),v.a.createElement("h4",{className:"title"},this.props.headerTitle)),v.a.createElement("div",{className:"content"},this.props.children),v.a.createElement("div",{className:"footer"},v.a.createElement("button",{type:"button",className:"btn btn-cancel",onClick:this.props.onClose},"Cancel"),v.a.createElement("button",{type:"button",className:"btn btn-confirm",onClick:this.props.onConfirm},"Confirm"))))}}]),t}(h.Component));He.defaultProps={componentStyle:{},rootClass:""};var We=He;function _e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.current){var n=e.current,a=n.offsetParent,r=n.offsetTop,o=n.offsetHeight,i=n.offsetLeft,s=n.offsetWidth,c=t.top||r,l=t.left||i;if(a){var u="".concat(a.offsetHeight,"px");o+c>a.offsetHeight&&(c-=o+c-a.offsetHeight)<0&&(c=0),l+s>a.offsetWidth&&(l=a.offsetWidth-s)<0&&(l=0),u&&n.style.maxHeight!==u&&(n.style.maxHeight=u),n.style.top!=="".concat(c,"px")&&(n.style.top="".concat(c,"px")),n.style.left!=="".concat(l,"px")&&(n.style.left="".concat(l,"px"))}}}var Ke={width:96,height:28};n(494);var Ye=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(o.a)(this,Object(i.a)(t).call(this,e))).componentDidMount=function(){_e(n.mainElement)},n.onClose=function(){n.props.onCancel()},n.onConfirm=function(){n.props.onUpdate(n.state.description)},n.handleChange=function(e){n.setState({description:e.target.value})},n.state={description:e.measurementData.description||""},n.mainElement=v.a.createRef(),n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"componentDidUpdate",value:function(e){this.props.description!==e.description&&this.setState({description:this.props.description})}},{key:"render",value:function(){var e=function(e){var t=Object.assign({},e),n=320,a=230,r=window.innerWidth-n,o=window.innerHeight-a;return t.left-=n/2,t.top-=a/2,t.left>r&&(t.left=r),t.top>o&&(t.top=o),t}(this.props.componentStyle);return v.a.createElement(We,{headerTitle:"Edit Description",onClose:this.onClose,onConfirm:this.onConfirm,rootClass:"editDescriptionDialog",componentRef:this.mainElement,componentStyle:e},v.a.createElement("input",{value:this.state.description,className:"simpleDialogInput",id:"description",autoComplete:"off",autoFocus:!0,onChange:this.handleChange}))}}]),t}(h.Component);Ye.defaultProps={componentRef:v.a.createRef(),componentStyle:{}};n(495);var Ge=function(e){function t(){return Object(a.a)(this,t),Object(o.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return v.a.createElement(ce.a,{in:this.props.displayComponent,appear:!0,timeout:500,classNames:"labelling",onExited:this.props.onTransitionExit},this.props.children)}}]),t}(h.Component),ze=["Abdomen/Chest Wall","Adrenal","Bladder","Bone","Brain","Breast","Colon","Esophagus","Extremities","Gallbladder","Kidney","Liver","Lung","Lymph Node","Mediastinum/Hilum","Muscle","Neck","Other Soft Tissue","Ovary","Pancreas","Pelvis","Peritoneum/Omentum","Prostate","Retroperitoneum","Small Bowel","Spleen","Stomach","Subcutaneous"].map(function(e){return{label:e,value:e}}),qe=function(e){function t(e){var n;Object(a.a)(this,t),(n=Object(o.a)(this,Object(i.a)(t).call(this,e))).componentDidUpdate=function(){n.repositionComponent()},n.labellingStateFragment=function(){var e=n.state,t=e.skipAddLabelButton,a=e.editLocation,r=e.description,o=e.locationLabel;return t?a?v.a.createElement(H.j,{items:n.currentItems,columns:1,onSelected:n.selectTreeSelectCalback,selectTreeFirstTitle:"Assign Label",onComponentChange:n.repositionComponent}):v.a.createElement(v.a.Fragment,null,v.a.createElement("div",{className:"checkIconWrapper",onClick:n.fadeOutAndLeaveFast},v.a.createElement(H.e,{name:"check",className:"checkIcon"})),v.a.createElement("div",{className:"locationDescriptionWrapper"},v.a.createElement("div",{className:"location"},o),v.a.createElement("div",{className:"description"},v.a.createElement("input",{id:"descriptionInput",ref:n.descriptionInput,defaultValue:r||"",autoComplete:"off"}))),v.a.createElement("div",{className:"commonButtons"},v.a.createElement("button",{type:"button",className:"commonButton left",onClick:n.relabel},"Relabel"),v.a.createElement("button",{type:"button",className:"commonButton right",onClick:n.setDescriptionUpdateMode},r?"Edit ":"Add ","Description")),v.a.createElement("div",{className:"editDescriptionButtons"},v.a.createElement("button",{type:"button",className:"commonButton left",onClick:n.descriptionCancel},"Cancel"),v.a.createElement("button",{type:"button",className:"commonButton right",onClick:n.descriptionSave},"Save"))):v.a.createElement(v.a.Fragment,null,v.a.createElement("button",{type:"button",className:"addLabelButton",onClick:n.showLabelling},n.state.location?"Edit":"Add"," Label"))},n.relabel=function(){n.setState({editLocation:!0})},n.setDescriptionUpdateMode=function(){n.descriptionInput.current.focus(),n.setState({editDescription:!0})},n.descriptionCancel=function(){var e=je()(n.state).description,t=void 0===e?"":e;n.descriptionInput.current.value=t,n.setState({editDescription:!1})},n.descriptionSave=function(){var e=n.descriptionInput.current.value;n.props.updateLabelling({description:e}),n.setState({description:e,editDescription:!1})},n.selectTreeSelectCalback=function(e,t){var a=t.value;n.props.updateLabelling({location:a});var r=n.mainElement.current.offsetParent.offsetTop,o={top:e.nativeEvent.y-r-25,left:n.state.componentStyle.left};n.setState({editLocation:!1,confirmationState:!0,location:t.value,locationLabel:t.label,componentStyle:o}),n.isTouchScreen&&(n.setTimeout=setTimeout(function(){n.setState({displayComponent:!1})},2e3))},n.showLabelling=function(){n.setState({skipAddLabelButton:!0,editLocation:!1})},n.fadeOutAndLeave=function(){n.fadeOutTimer=setTimeout(function(){n.setState({displayComponent:!1})},1e3)},n.fadeOutAndLeaveFast=function(){n.setState({displayComponent:!1})},n.clearFadeOutTimer=function(){n.fadeOutTimer&&clearTimeout(n.fadeOutTimer)},n.repositionComponent=function(){setTimeout(function(){_e(n.mainElement)},200)};var r=e.measurementData,s=r.location,c=r.locationLabel,l=r.description,p=e.componentStyle;return e.skipAddLabelButton||(p=function(e,t){var n=e.handles,a=n.start,r=n.end,o=t.currentPoints.client,i=u.a.pixelToCanvas(t.element,a),s=u.a.pixelToCanvas(t.element,r),c=o.x-i.x,l=o.y-i.y,p={left:s.x+c,top:s.y+l};return a.y>r.y&&(p.top-=Ke.height),a.x>r.x&&(p.left-=Ke.width),p}(e.measurementData,e.eventData)),n.state={location:s,locationLabel:c,description:l,skipAddLabelButton:e.skipAddLabelButton,editDescription:e.editDescription,editLocation:e.editLocation,componentStyle:p,confirmationState:!1,displayComponent:!0},n.mainElement=v.a.createRef(),n.descriptionInput=v.a.createRef(),n.initialItems=ze,n.currentItems=je()(n.initialItems),n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e="labellingComponent";this.state.editDescription&&(e+=" editDescription");var t=Object.assign({},this.state.componentStyle);return this.state.skipAddLabelButton&&(t.left-=160),v.a.createElement(Ge,{displayComponent:this.state.displayComponent,onTransitionExit:this.props.labellingDoneCallback},v.a.createElement("div",{className:e,style:t,ref:this.mainElement,onMouseLeave:this.fadeOutAndLeave,onMouseEnter:this.clearFadeOutTimer},this.labellingStateFragment()))}}]),t}(h.Component),Je=(n(496),function(e){function t(e){var n;Object(a.a)(this,t),(n=Object(o.a)(this,Object(i.a)(t).call(this,e))).componentDidMount=function(){document.addEventListener("touchstart",n.onTouchStart)},n.componentWillUnmount=function(){document.removeEventListener("touchstart",n.onTouchStart)},n.getRenderComponent=function(){var e=n.state,t=e.editLocation,a=e.editDescription,r=e.editDescriptionOnDialog,o=e.measurementData;return r?v.a.createElement(Ye,{onCancel:n.props.labellingDoneCallback,onUpdate:n.descriptionDialogUpdate,componentRef:n.editDescriptionDialog,componentStyle:n.state.componentStyle,measurementData:o}):t||a?v.a.createElement(qe,Object.assign({},n.props,{componentStyle:n.state.componentStyle})):void 0},n.treatMeasurementData=function(e){var t=n.props,a=t.editDescription,r=t.editLocation;a&&(e.description=void 0),r&&(e.location=void 0)},n.responseDialogUpdate=function(e){n.props.updateLabelling({response:e}),n.props.labellingDoneCallback()},n.descriptionDialogUpdate=function(e){n.props.updateLabelling({description:e}),n.props.labellingDoneCallback()};var r=je()(e.measurementData);n.treatMeasurementData(r);var s=e.editLocation;return e.editDescription||e.editLocation||(s=!0),n.state={componentStyle:Xe(e.eventData),skipAddLabelButton:e.skipAddLabelButton,editLocation:s,editDescription:e.editDescription,editDescriptionOnDialog:e.editDescriptionOnDialog,measurementData:r},n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return this.getRenderComponent()}}]),t}(h.Component));function Xe(e){var t=e.event;return{left:t.clientX,top:t.clientY}}Je.defaultProps={skipAddLabelButton:!1,editLocation:!1,editDescription:!1,editDescriptionOnDialog:!1};var Qe=function(e){function t(){return Object(a.a)(this,t),Object(o.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return this.props.visible?v.a.createElement(Je,this.props):null}}]),t}(h.Component);Qe.defaultProps={visible:!1};var Ze=Qe,$e=Object(V.connect)(function(e){if(!e.ui||!e.ui.labelling)return{visible:!1};var t=e.ui.labelling;return Object(g.a)({visible:!1},t)},null)(Ze),et=Object(V.connect)(function(e,t){var n=e.loading.progress,a=je()(t.studies);return a.forEach(function(e){e.thumbnails.forEach(function(e){var t=e.displaySetInstanceUid,a="StackProgress:".concat(t),r=n[a],o=0;r&&(o=r.percentComplete),e.stackPercentComplete=o})}),{studies:a}},null)(H.k),tt=(n(497),Object(V.connect)(function(e){var t,n={},a=Wn.modules[c.MODULE_TYPES.VIEWPORT];return a.forEach(function(e){n[e.extensionId]=e.module}),a.length&&(t=a[0].extensionId),{layout:e.viewports.layout,activeViewportIndex:e.viewports.activeViewportIndex,availablePlugins:n,defaultPlugin:t}},null)(H.g)),nt=(n(498),["Angle","Bidirectional","Length","FreehandMouse","EllipticalRoi","CircleRoi","RectangleRoi"]),at=[{actionType:"Delete",action:function(e){var t=e.nearbyToolData,n=e.eventData.element;D.a.removeToolState(n,t.toolType,t.tool),u.a.updateImage(n)}},{actionType:"setLabel",action:function(e){var t=e.nearbyToolData;z(e.eventData,t.tool,{skipAddLabelButton:!0,editLocation:!0})}},{actionType:"setDescription",action:function(e){var t=e.nearbyToolData;z(e.eventData,t.tool,{editDescriptionOnDialog:!0})}}];function rt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(arguments.length>2&&arguments[2],function(e,t,n){var a={},r=!1;return n.forEach(function(n){var o=D.a.getToolState(e,n);if(o)return o.data.forEach(function(o,i){var s=D.a.getToolForElement(e,n);if(s||(s=D.a.getToolForElement(e,"".concat(n,"Tool"))),!s)throw new Error("Tool not found.");s.pointNearTool(e,o,t)&&(r=!0,a.tool=o,a.index=i,a.toolType=n)}),!r&&void 0}),r?a:void 0}(e.element,e.currentPoints.canvas,nt));if(!t||!n||"arrowAnnotate"!==n.toolType){var a=[];return n&&at.forEach(function(t){t.params={eventData:e,nearbyToolData:n},"Delete"===t.actionType&&(t.text="Delete measurement"),"setLabel"===t.actionType&&(t.text="Relabel"),"setDescription"===t.actionType&&(t.text="".concat(n.tool.description?"Edit":"Add"," Description")),a.push(t)}),a}}var ot=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(o.a)(this,Object(i.a)(t).call(this,e))).componentDidMount=function(){n.mainElement.current&&n.updateElementPosition()},n.componentDidUpdate=function(){n.mainElement.current&&n.updateElementPosition()},n.updateElementPosition=function(){var e=n.mainElement.current,t=e.offsetParent,a=e.offsetTop,r=e.offsetHeight,o=e.offsetWidth,i=e.offsetLeft,s=n.props.eventData;if(a+r>t.offsetHeight){var c=a+r-t.offsetHeight,l=s.currentPoints.canvas.y-c;n.mainElement.current.style.top="".concat(l>0?l:0,"px")}if(i+o>t.offsetWidth){var u=i+o-t.offsetWidth,p=s.currentPoints.canvas.x-u;n.mainElement.current.style.left="".concat(p>0?p:0,"px")}},n.mainElement=v.a.createRef(),n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this;if(!this.props.eventData)return null;var t=this.props,n=t.isTouchEvent,a=t.eventData,r=rt(a,n,t.availableTools);if(!r.length)return"";var o=r.map(function(t){return v.a.createElement("li",{key:t.actionType},v.a.createElement("button",{className:"form-action",onClick:function(n){t.action(t.params),e.props.onClose&&e.props.onClose()}},v.a.createElement("span",{key:t.actionType},t.text)))}),i={top:"".concat(a.currentPoints.canvas.y,"px"),left:"".concat(a.currentPoints.canvas.x,"px")};return v.a.createElement("div",{className:"ToolContextMenu",style:i,ref:this.mainElement},v.a.createElement("ul",{className:"bounded"},o))}}]),t}(h.Component);ot.defaultProps={visible:!0,isTouchEvent:!1};var it=ot,st=Object(V.connect)(function(e,t){if(!e.ui||!e.ui.contextMenu)return{visible:!1};var n,a=t.viewportIndex,r=e.ui.contextMenu[a];return e.extensions&&e.extensions.cornerstone&&e.extensions.cornerstone.availableTools&&(n=e.extensions.cornerstone.availableTools),Object(g.a)({},r,{availableTools:n})},null)(it),ct=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(o.a)(this,Object(i.a)(t).call(this,e))).getViewportData=function(){for(var e=[],t=n.props,a=t.layout,r=t.viewportSpecificData,o=0;o<a.viewports.length;o++){var i=r[o];if(i&&!i.displaySetInstanceUid&&(i=n.cachedViewportData[o]),i&&i.studyInstanceUid&&i.displaySetInstanceUid){var s=n.findDisplaySet(n.props.studies,i.studyInstanceUid,i.displaySetInstanceUid);e.push(Object.assign({},s,i))}else{i=n.state.displaySets.find(function(t){return!e.some(function(e){return e.displaySetInstanceUid===t.displaySetInstanceUid})}),e.push(Object.assign({},i))}}return n.cachedViewportData=e,e},n.setViewportData=function(e){var t=e.viewportIndex,a=e.item,r=n.findDisplaySet(n.props.studies,a.studyInstanceUid,a.displaySetInstanceUid);n.props.setViewportSpecificData(t,r)},n.state={displaySets:[]},n.cachedViewportData={},n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"getDisplaySets",value:function(e){var t=[];return e.forEach(function(e){e.displaySets.forEach(function(e){e.plugin||(e.plugin="cornerstone"),t.push(e)})}),t}},{key:"findDisplaySet",value:function(e,t,n){var a=e.find(function(e){return e.studyInstanceUid===t});if(a)return a.displaySets.find(function(e){return e.displaySetInstanceUid===n})}},{key:"componentDidMount",value:function(){if(this.props.studies){var e=this.getDisplaySets(this.props.studies);this.setState({displaySets:e})}}},{key:"componentDidUpdate",value:function(e){if(this.props.studies!==e.studies){var t=this.getDisplaySets(this.props.studies);this.setState({displaySets:t})}}},{key:"render",value:function(){return v.a.createElement("div",{className:"ViewerMain"},this.state.displaySets.length&&v.a.createElement(tt,{studies:this.props.studies,viewportData:this.getViewportData(),setViewportData:this.setViewportData},v.a.createElement(st,null)))}},{key:"componentWillUnmount",value:function(){var e=this,t=this.props.viewportSpecificData;Object.keys(t).forEach(function(t){e.props.clearViewportSpecificData(t)})}}]),t}(h.Component),lt=c.default.redux.actions,ut=lt.setViewportSpecificData,pt=lt.clearViewportSpecificData,dt=Object(V.connect)(function(e){var t=e.viewports;return{activeViewportIndex:t.activeViewportIndex,layout:t.layout,viewportSpecificData:t.viewportSpecificData,viewports:e.viewports}},function(e){return{setViewportSpecificData:function(t,n){e(ut(t,n))},clearViewportSpecificData:function(){e(pt())}}})(ct),mt=(n(499),function(e){function t(){return Object(a.a)(this,t),Object(o.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e="right"===this.props.from?"from-right":"from-left",t=this.props.width?{maxWidth:this.props.width,marginRight:this.props.isOpen?"0":-1*Number.parseInt(this.props.width)}:{};return v.a.createElement("section",{style:t,className:he()("sidepanel",e,{"is-open":this.props.isOpen})},this.props.children)}}]),t}(h.Component)),ft=(n(500),function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(o.a)(this,Object(i.a)(t).call(this,e))).state={isLeftSidePanelOpen:!0,isRightSidePanelOpen:!1,selectedRightSidePanel:"",selectedLeftSidePanel:"studies",thumbnails:[]},n.retrieveMeasurements=function(e,t){return c.default.log.info("retrieveMeasurements"),Promise.resolve()},n.storeMeasurements=function(e,t){return c.default.log.info("storeMeasurements"),Promise.resolve()},n.retrieveTimepoints=function(e){c.default.log.info("retrieveTimepoints");var t=(new Date).toISOString(),a=(new Date).toISOString();return n.props.studies&&(a=new Date("1000-01-01").toISOString(),n.props.studies.forEach(function(e){var n=_()(e.studyDate,"YYYYMMDD").toISOString();n<t&&(t=n),n>a&&(a=n)})),Promise.resolve([{timepointType:"baseline",timepointId:"TimepointId",studyInstanceUids:n.props.studyInstanceUids,patientId:e.patientId,earliestDate:t,latestDate:a,isLocked:!1}])},n.storeTimepoints=function(e){return c.default.log.info("storeTimepoints"),Promise.resolve()},n.updateTimepoint=function(e,t){return c.default.log.info("updateTimepoint"),Promise.resolve()},n.removeTimepoint=function(e){return c.default.log.info("removeTimepoint"),Promise.resolve()},n.disassociateStudy=function(e,t){return c.default.log.info("disassociateStudy"),Promise.resolve()},n.onTimepointsUpdated=function(e){n.props.onTimepointsUpdated&&n.props.onTimepointsUpdated(e)},n.onMeasurementsUpdated=function(e){n.props.onMeasurementsUpdated&&n.props.onMeasurementsUpdated(e)},c.default.measurements.MeasurementApi.setConfiguration({dataExchange:{retrieve:n.retrieveMeasurements,store:n.storeMeasurements}}),c.default.measurements.TimepointApi.setConfiguration({dataExchange:{retrieve:n.retrieveTimepoints,store:n.storeTimepoints,remove:n.removeTimepoint,update:n.updateTimepoint,disassociate:n.disassociateStudy}}),n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.studies,t=c.default.measurements,n=t.TimepointApi,a=t.MeasurementApi,r=new n("TimepointId",{onTimepointsUpdated:this.onTimepointsUpdated}),o=new a(r,{onMeasurementsUpdated:this.onMeasurementsUpdated});if(this.currentTimepointId="TimepointId",this.timepointApi=r,this.measurementApi=o,e){var i=e[0]&&e[0].patientId;r.retrieveTimepoints({patientId:i}),o.retrieveMeasurements(i,["TimepointId"]),this.setState({thumbnails:ht(e)})}}},{key:"componentDidUpdate",value:function(e){if(this.props.studies!==e.studies){var t=this.props.studies,n=t[0]&&t[0].patientId,a=this.currentTimepointId;this.timepointApi.retrieveTimepoints({patientId:n}),this.measurementApi.retrieveMeasurements(n,[a]),this.setState({thumbnails:ht(t)})}}},{key:"render",value:function(){var e,t,n=this;return Wn.modules[c.MODULE_TYPES.PANEL].forEach(function(a){a.module.components.forEach(function(a){a.id===n.state.selectedRightSidePanel?t=a.component:a.id===n.state.selectedLeftSidePanel&&(e=a.component)})}),v.a.createElement(v.a.Fragment,null,v.a.createElement(be.Consumer,null,function(e){return v.a.createElement(Se,{home:!1},e.logoComponent)}),v.a.createElement(Ve,{isLeftSidePanelOpen:this.state.isLeftSidePanelOpen,isRightSidePanelOpen:this.state.isRightSidePanelOpen,selectedLeftSidePanel:this.state.isLeftSidePanelOpen?this.state.selectedLeftSidePanel:"",selectedRightSidePanel:this.state.isRightSidePanelOpen?this.state.selectedRightSidePanel:"",handleSidePanelChange:function(e,t){var a=e&&e[0].toUpperCase()+e.slice(1),r="is".concat(a,"SidePanelOpen"),o="selected".concat(a,"SidePanel"),i=Object.assign({},n.state),s=i[r],c=i[o],l=c===t||null===t;i[o]=t||c,(!s||l)&&(i[r]=!i[r]),n.setState(i)}}),v.a.createElement("div",{className:"FlexboxLayout"},v.a.createElement(mt,{from:"left",isOpen:this.state.isLeftSidePanelOpen},e?v.a.createElement(e,{viewports:this.props.viewports,activeIndex:this.props.activeViewportIndex}):v.a.createElement(et,{studies:this.state.thumbnails})),v.a.createElement("div",{className:he()("main-content")},v.a.createElement(dt,{studies:this.props.studies})),v.a.createElement(mt,{from:"right",isOpen:this.state.isRightSidePanelOpen},t&&v.a.createElement(t,{viewports:this.props.viewports,activeIndex:this.props.activeViewportIndex}))),v.a.createElement($e,null))}}]),t}(h.Component)),ht=function(e){return e.map(function(e){return{studyInstanceUid:e.studyInstanceUid,thumbnails:e.displaySets.map(function(e){var t,n=e.displaySetInstanceUid,a=e.seriesDescription,r=e.seriesNumber,o=e.instanceNumber,i=e.numImageFrames,s=" ";return e.images&&e.images.length?t=e.images[0].getImageId():s="SR",{imageId:t,altImageText:s,displaySetInstanceUid:n,seriesDescription:a,seriesNumber:r,instanceNumber:o,numImageFrames:i}})}})},vt=c.default.redux.actions,gt=vt.setTimepoints,bt=vt.setMeasurements,yt=Object(V.connect)(function(e,t){return{viewports:e.viewports.viewportSpecificData,activeViewportIndex:e.viewports.activeViewportIndex}},function(e){return{onTimepointsUpdated:function(t){e(gt(t))},onMeasurementsUpdated:function(t){e(bt(t))}}})(ft),Et=c.metadata.OHIFStudyMetadata,Ot=c.studies.retrieveStudiesMetadata,St=c.utils.studyMetadataManager,wt=c.utils.updateMetaDataManager,kt=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(s)))).state={studies:null,error:null},n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=Object(me.a)(de.a.mark(function e(){var t,n,a,r,o,i;return de.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props,n=t.studyInstanceUids,a=t.seriesInstanceUids,r=t.server,e.prev=1,e.next=4,Ot(r,n,a);case 4:o=e.sent,St.purge(),i=o.map(function(e){var t=new Et(e,e.studyInstanceUid),n=Wn.modules.sopClassHandlerModule;return e.displaySets=e.displaySets||t.createDisplaySets(n),t.setDisplaySets(e.displaySets),wt(e),St.add(t),e}),this.setState({studies:i}),e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(1),this.setState({error:!0}),new Error(e.t0);case 14:case"end":return e.stop()}},e,this,[[1,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return this.state.error?v.a.createElement("div",null,"Error: ",JSON.stringify(this.state.error)):v.a.createElement(yt,{studies:this.state.studies,studyInstanceUids:this.props.studyInstanceUids})}}]),t}(h.Component),jt=function(e){return!0===e.active},Dt=Object(V.connect)(function(e){return{server:e.servers.servers.find(jt)}},null)(kt);var Ct=Object(ie.f)(function(e){var t,n=function(e){return e?ue.a.parse(e.search):{}}(e.location),a=n.requestType,r=n.studyUID;switch(a){case"STUDY":return v.a.createElement(Dt,{studyInstanceUids:r.split(";")});case"STUDYBASE64":return v.a.createElement(Dt,{studyInstanceUids:(t=r,window.atob(t).split(";"))});case"PATIENT":default:return""}});var It=function(e){var t,n,a=e.match,r=a.params,o=r.studyInstanceUids,i=r.seriesInstanceUids;return o&&!i?t=o.split(";"):o&&i&&(t=[o],n=a.params.seriesInstanceUids.split(";")),v.a.createElement(Dt,{studyInstanceUids:t,seriesInstanceUids:n})},xt=n(110),Tt=n(63),Lt=n.n(Tt);function Mt(e){if(0===e)return"0 B";var t=Math.floor(Math.log(e)/Math.log(1024));return 1*(e/Math.pow(1024,t)).toFixed(2)+" "+["B","kB","MB","GB","TB"][t]}function Nt(e){if(!e)return"Unknown error";if(e.response)try{var t=JSON.parse(e.response);if(t.error&&t.error.code&&t.error.message)return t.error.code+" - "+t.error.message}catch(n){return e.response}return e.message||"Unknown error."}function Pt(e){var t=sessionStorage.getItem(e);if(t)return JSON.parse(t).access_token}function At(e){if(e.length<=132)return!1;var t=new Uint8Array(e.slice(128,132));return Array.from("DICM").every(function(e,n){return e.charCodeAt(0)===t[n]})}var Ut=function(){function e(){Object(a.a)(this,e),this.cancelled=!1}return Object(r.a)(e,[{key:"get",value:function(){return this.cancelled}},{key:"set",value:function(e){this.cancelled=e}}]),e}(),Rt=n(532),Bt=new(function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,[{key:"setOidcStorageKey",value:function(e){e||console.error("OIDC storage key is empty"),this.oidcStorageKey=e}},{key:"smartUpload",value:function(){var e=Object(me.a)(de.a.mark(function e(t,n,a,r,o){var i,s,c,l,u,p,d=this;return de.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=1,s=50,0!==(c=Array.from(t)).length){e.next=6;break}return console.warn("No files are supplied for uploading"),e.abrupt("return");case 6:return l=Math.min(c.length,s),u=!1,p=function(){var e=Object(me.a)(de.a.mark(function e(t,s){var l,p;return de.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:l=de.a.mark(function e(){var s,l;return de.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!o.get()){e.next=2;break}return e.abrupt("return",{v:void 0});case 2:if(s=c.slice(0,i),c=c.slice(i),l=null,e.prev=5,!(s.length>1)){e.next=8;break}throw new Error("Not implemented");case 8:if(1!==s.length){e.next=11;break}return e.next=11,d.simpleUpload(s[0],n,a);case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(5),l=Nt(e.t0);case 16:if(s.forEach(function(e){return r(e.fileId,l)}),u||0!==c.length){e.next=21;break}return u=!0,t(),e.abrupt("return",{v:void 0});case 21:case"end":return e.stop()}},e,null,[[5,13]])});case 1:if(!(c.length>0)){e.next=8;break}return e.delegateYield(l(),"t0",3);case 3:if("object"!==typeof(p=e.t0)){e.next=6;break}return e.abrupt("return",p.v);case 6:e.next=1;break;case 8:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),e.next=11,new Promise(function(e){for(var t=0;t<l;t++)p(e)});case 11:case"end":return e.stop()}},e)}));return function(t,n,a,r,o){return e.apply(this,arguments)}}()},{key:"simpleUpload",value:function(){var e=Object(me.a)(de.a.mark(function e(t,n,a){var r,o,i;return de.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.getClient(n),e.next=3,this.readFile(t);case 3:if(o=e.sent,At(i=o.content)){e.next=7;break}throw new Error("The file has a wrong DICOM header");case 7:return e.next=9,r.storeInstances({datasets:[i]});case 9:case"end":return e.stop()}},e,this)}));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"readFile",value:function(e){return new Promise(function(t,n){var a=new FileReader;a.onload=function(){t({name:e.name,size:e.size,type:e.type,content:a.result})},a.onerror=function(e){return n(e)},a.readAsArrayBuffer(e)})}},{key:"getClient",value:function(e){if(!this.oidcStorageKey)throw new Error("OIDC storage key is not set");var t=Pt(this.oidcStorageKey);if(!t)throw new Error("OIDC access_token is not set");return new Rt.api.DICOMwebClient({url:e,headers:{Authorization:"Bearer "+t}})}}]),e}()),Ft=(n(55),function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(s)))).state={status:"Upload",isCancelled:!1,errorsCount:0,files:null,uploadedVolume:null,wholeVolumeStr:null,isFilesListHidden:!0,timeLeft:null,uploadedList:null,totalCount:0,successfullyUploadedCount:0,lastFile:"",uploadContext:null},n.uploadFiles=function(e){var t=Array.from(e.target.files),a={};t.forEach(function(e,t){var n={id:t,name:e.name,path:e.webkitRelativePath||e.name,size:e.size,error:null,processed:!1,processedInUI:!1};a[t]=n,e.fileId=t});var r=t.map(function(e){return e.size}).reduce(function(e,t){return e+t}),o=Math.random();n.setState({status:"Uploading...",files:a,uploadedList:[],uploadedVolume:0,lastFile:t[0].name,totalCount:t.length,wholeVolumeStr:Mt(r),uploadContext:o,cancellationToken:new Ut});var i=new Ut;Bt.setOidcStorageKey(n.props.oidcKey),Bt.smartUpload(e.target.files,n.props.url,n.props.oidcKey,function(e,t){return o===n.state.uploadContext&&n.uploadCallback.call(Object(we.a)(n),e,t)},i)},n.renderTableRow=function(e){var t=null;return null!==e.error&&(t=v.a.createElement("p",{style:{color:"red"}},e.error)),v.a.createElement("tr",{key:e.id},v.a.createElement("td",{className:"project"},e.name," ",t))},n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"filesLeft",value:function(){return this.state.uploadedList.length+" of "+this.state.totalCount+" files"}},{key:"volumeLeft",value:function(){return Mt(this.state.uploadedVolume)+" of "+this.state.wholeVolumeStr}},{key:"percents",value:function(){return parseInt(100*this.state.uploadedList.length/Object.keys(this.state.files).length)}},{key:"isFinished",value:function(){return this.state.isCancelled||Object.keys(this.state.files).length===this.state.uploadedList.length}},{key:"errorsMessage",value:function(){var e=1===this.state.errorsCount?" error":" errors";return this.state.errorsCount+e+" while uploading, click for more info"}},{key:"uploadCallback",value:function(e,t){var n=this.state.files[e];if(n.processed=!0,t)n.error=t,this.setState({errorsCount:this.state.errorsCount+1});else{var a=this.state.uploadedVolume+n.size;this.setState({uploadedVolume:a})}this.setState({lastFile:n.name});var r=this.state.uploadedList;r.push(n),this.setState({uploadedList:r})}},{key:"render",value:function(){return null===this.state.files?v.a.createElement("div",{className:"gcp-dicom-uploader"},v.a.createElement("div",{className:"button"},v.a.createElement("label",{htmlFor:"file"},v.a.createElement("img",{src:"./assets/Button_File.svg",alt:"upload file"})),v.a.createElement("input",{className:"gcp-invisible-input",accept:".dcm",onChange:this.uploadFiles,type:"file",id:"file",multiple:!0})),v.a.createElement("div",{className:"button"},v.a.createElement("label",{htmlFor:"folder"},v.a.createElement("img",{src:"./assets/Button_Folder.svg",alt:"upload folder"})),v.a.createElement("input",{className:"gcp-invisible-input",type:"file",onChange:this.uploadFiles,id:"folder",webkitdirectory:"true",mozdirectory:"true",multiple:!0}))):v.a.createElement("table",{id:"tblProjectList",className:"table noselect"},v.a.createElement("thead",null,v.a.createElement("tr",null,v.a.createElement("th",{className:"gcp-picker--path"},this.percents(),"% ",this.filesLeft()))),v.a.createElement("tbody",{id:"ProjectList"},this.state.uploadedList.map(this.renderTableRow)))}}]),t}(h.Component)),Vt=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(s)))).state={uploaded:!1},n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return this.props.url?v.a.createElement(Lt.a,{show:this.props.isOpen,onHide:this.props.onClose,"aria-labelledby":"ModalHeader",className:"modal fade themed in",backdrop:!1,size:"md",keyboard:!0},v.a.createElement(Lt.a.Header,{closeButton:!0},v.a.createElement(Lt.a.Title,null,this.props.t("Google Cloud Healthcare API - DICOM Upload"))),v.a.createElement(Lt.a.Body,null,v.a.createElement(Ft,{url:this.props.url,oidcKey:this.props.oidcStorageKey}))):null}}]),t}(h.Component),Ht=Object(E.c)("Common")(Vt),Wt=function(e){return!0===e.active},_t=Object(V.connect)(function(e){var t=e.servers.servers.find(Wt),n=window.config.oidc[0],a=n.authority,r=n.client_id;return{oidcStorageKey:"oidc.user:".concat(a,":").concat(r),url:t&&t.qidoRoot}},null)(Ht),Kt=new(function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,[{key:"setOidcStorageKey",value:function(e){e||console.error("OIDC storage key is empty"),this.oidcStorageKey=e}},{key:"doRequest",value:function(){var e=Object(me.a)(de.a.mark(function e(t){var n,a,r,o,i,s,c,l=arguments;return de.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.length>1&&void 0!==l[1]?l[1]:{},a=l.length>2&&void 0!==l[2]?l[2]:{},r=new URL(t),o=null,r.search=new URLSearchParams(a),e.prev=5,e.next=8,fetch(r,Object(g.a)({},this.fetchConfig,{config:n}));case 8:return i=e.sent,e.prev=9,e.next=12,i.json();case 12:o=e.sent,e.next=17;break;case 15:e.prev=15,e.t0=e.catch(9);case 17:if(!(i.status>=200&&i.status<300&&null!=o)){e.next=27;break}if(null==o.nextPageToken){e.next=24;break}return a.pageToken=o.nextPageToken,e.next=22,this.doRequest(t,n,a);case 22:for(c in s=e.sent,o)o.hasOwnProperty(c)&&(o[c]=o[c].concat(s.data[c]));case 24:return e.abrupt("return",{isError:!1,status:i.status,data:o});case 27:return e.abrupt("return",{isError:!0,status:i.status,message:o&&o.error&&o.error.message||"Unknown error"});case 28:e.next=35;break;case 30:if(e.prev=30,e.t1=e.catch(5),!o||!o.error){e.next=34;break}return e.abrupt("return",{isError:!0,status:e.t1.status,message:e.t1.response.data.error.message||"Unspecified error"});case 34:return e.abrupt("return",{isError:!0,message:e.t1&&e.t1.message||"Oops! Something went wrong"});case 35:case"end":return e.stop()}},e,this,[[5,30],[9,15]])}));return function(t){return e.apply(this,arguments)}}()},{key:"loadProjects",value:function(){var e=Object(me.a)(de.a.mark(function e(){return de.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.doRequest("https://cloudresourcemanager.googleapis.com/v1/projects"));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"loadLocations",value:function(){var e=Object(me.a)(de.a.mark(function e(t){return de.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.doRequest("".concat(this.urlBaseProject,"/").concat(t,"/locations")));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"loadDatasets",value:function(){var e=Object(me.a)(de.a.mark(function e(t,n){return de.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.doRequest("".concat(this.urlBaseProject,"/").concat(t,"/locations/").concat(n,"/datasets")));case 1:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadDicomStores",value:function(){var e=Object(me.a)(de.a.mark(function e(t){return de.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.doRequest("".concat(this.urlBase,"/").concat(t,"/dicomStores")));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"fetchConfig",get:function(){if(!this.oidcStorageKey)throw new Error("OIDC storage key is not set");var e=Pt(this.oidcStorageKey);if(!e)throw new Error("OIDC access_token is not set");return{method:"GET",headers:{Authorization:"Bearer "+e}}}},{key:"urlBase",get:function(){return"https://healthcare.googleapis.com/v1beta1"}},{key:"urlBaseProject",get:function(){return this.urlBase+"/projects"}}]),e}()),Yt=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(s)))).state={search:""},n.renderTableRow=function(e){return v.a.createElement("tr",{key:e.name,className:n.state.highlightedItem===e.name?"noselect active":"noselect",onMouseEnter:function(){n.onHighlightItem(e.name)},onClick:function(){n.props.onSelect(e)}},v.a.createElement("td",{className:"project"},e.name.split("/")[7]))},n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"onHighlightItem",value:function(e){this.setState({highlightedItem:e})}},{key:"render",value:function(){if(this.props.error)return v.a.createElement("p",null,this.props.error);var e=v.a.createElement(H.e,{name:"circle-notch",className:"loading-icon-spin loading-icon"});if(this.props.loading)return e;var t=v.a.createElement("tbody",{id:"StoreList"},this.props.stores.map(this.renderTableRow));return v.a.createElement("table",{id:"tblStoreList",className:"gcp-table table noselect"},v.a.createElement("thead",null,v.a.createElement("tr",null,v.a.createElement("th",null,this.props.t("DICOM Store")))),this.props.stores&&t)}}]),t}(h.Component);Yt.defaultProps={loading:!0};var Gt=Object(E.c)("Common")(Yt),zt=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(s)))).state={error:null,loading:!0,stores:[],locations:[]},n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=Object(me.a)(de.a.mark(function e(){var t,n,a,r,o;return de.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=window.config.oidc[0],n=t.authority,a=t.client_id,r="oidc.user:".concat(n,":").concat(a),Kt.setOidcStorageKey(r),e.next=5,Kt.loadDicomStores(this.props.dataset.name);case 5:if(!(o=e.sent).isError){e.next=9;break}return this.setState({error:o.message}),e.abrupt("return");case 9:this.setState({stores:o.data.dicomStores||[],loading:!1});case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.stores,n=e.loading,a=e.error,r=this.props.onSelect;return v.a.createElement(Gt,{stores:t,loading:n,error:a,onSelect:r})}}]),t}(h.Component),qt=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(s)))).state={search:""},n.renderTableRow=function(e){return v.a.createElement("tr",{key:e.name,className:n.state.highlightedItem===e.name?"noselect active":"noselect",onMouseEnter:function(){n.onHighlightItem(e.name)},onClick:function(){n.props.onSelect(e)}},v.a.createElement("td",null,e.name.split("/")[5]))},n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"onHighlightItem",value:function(e){this.setState({highlightedItem:e})}},{key:"render",value:function(){if(this.props.error)return v.a.createElement("p",null,this.props.error);var e=v.a.createElement(H.e,{name:"circle-notch",className:"loading-icon-spin loading-icon"});if(this.props.loading)return e;var t=v.a.createElement("tbody",{id:"DatasetList"},this.props.datasets.map(this.renderTableRow));return v.a.createElement("table",{id:"tblDatasetList",className:"gcp-table table noselect"},v.a.createElement("thead",null,v.a.createElement("tr",null,v.a.createElement("th",null,this.props.t("Dataset")))),this.props.datasets&&t)}}]),t}(h.Component);qt.defaultProps={loading:!0};var Jt=Object(E.c)("Common")(qt),Xt=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(s)))).state={error:null,loading:!0,datasets:[]},n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=Object(me.a)(de.a.mark(function e(){var t;return de.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Kt.setOidcStorageKey(this.props.oidcKey),e.next=3,Kt.loadDatasets(this.props.project.projectId,this.props.location.locationId);case 3:if(!(t=e.sent).isError){e.next=7;break}return this.setState({error:t.message}),e.abrupt("return");case 7:this.setState({datasets:t.data.datasets||[],loading:!1});case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.datasets,n=e.loading,a=e.error,r=this.props.onSelect;return v.a.createElement(Jt,{datasets:t,loading:n,error:a,onSelect:r})}}]),t}(h.Component),Qt=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(s)))).state={search:"",highlightedItem:null},n.renderTableRow=function(e){return v.a.createElement("tr",{key:e.projectId,className:n.state.highlightedItem===e.projectId?"noselect active":"noselect",onMouseEnter:function(){n.onHighlightItem(e.projectId)},onClick:function(){n.onHighlightItem(e.projectId),n.props.onSelect(e)}},v.a.createElement("td",null,e.name),v.a.createElement("td",null,e.projectId))},n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"onHighlightItem",value:function(e){this.setState({highlightedItem:e})}},{key:"render",value:function(){if(this.props.error)return v.a.createElement("p",null,this.props.error);var e=v.a.createElement(H.e,{name:"circle-notch",className:"loading-icon-spin loading-icon"});if(this.props.loading)return e;var t=v.a.createElement("tbody",{id:"ProjectList"},this.props.projects.map(this.renderTableRow));return v.a.createElement("table",{id:"tblProjectList",className:"gcp-table table noselect"},v.a.createElement("thead",null,v.a.createElement("tr",null,v.a.createElement("th",null,this.props.t("Project")),v.a.createElement("th",null,this.props.t("ID")))),this.props.projects&&t)}}]),t}(h.Component);Qt.defaultProps={loading:!0};var Zt=Object(E.c)("Common")(Qt),$t=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(s)))).state={error:null,loading:!0,projects:[]},n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=Object(me.a)(de.a.mark(function e(){var t;return de.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Kt.setOidcStorageKey(this.props.oidcKey),e.next=3,Kt.loadProjects();case 3:if(!(t=e.sent).isError){e.next=7;break}return this.setState({error:t.message}),e.abrupt("return");case 7:this.setState({projects:t.data.projects||[],loading:!1});case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.projects,n=e.loading,a=e.error,r=this.props.onSelect;return v.a.createElement(Zt,{projects:t,loading:n,error:a,onSelect:r})}}]),t}(h.Component),en=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(s)))).state={search:""},n.renderTableRow=function(e){return v.a.createElement("tr",{key:e.locationId,className:n.state.highlightedItem===e.locationId?"noselect active":"noselect",onMouseEnter:function(){n.onHighlightItem(e.locationId)},onClick:function(){n.props.onSelect(e)}},v.a.createElement("td",null,e.name.split("/")[3]))},n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"onHighlightItem",value:function(e){this.setState({highlightedItem:e})}},{key:"render",value:function(){if(this.props.error)return v.a.createElement("p",null,this.props.error);var e=v.a.createElement(H.e,{name:"circle-notch",className:"loading-icon-spin loading-icon"});if(this.props.loading)return e;var t=v.a.createElement("tbody",{id:"LocationList"},this.props.locations.map(this.renderTableRow));return v.a.createElement("table",{id:"tblLocationList",className:"gcp-table table noselect"},v.a.createElement("thead",null,v.a.createElement("tr",null,v.a.createElement("th",null,this.props.t("Location")))),this.props.locations&&t)}}]),t}(h.Component);en.defaultProps={loading:!0};var tn=Object(E.c)("Common")(en),nn=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(s)))).state={error:null,loading:!0,locations:[]},n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=Object(me.a)(de.a.mark(function e(){var t;return de.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Kt.setOidcStorageKey(this.props.oidcKey),e.next=3,Kt.loadLocations(this.props.project.projectId);case 3:if(!(t=e.sent).isError){e.next=7;break}return this.setState({error:t.message}),e.abrupt("return");case 7:this.setState({locations:t.data.locations||[],loading:!1});case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.locations,n=e.loading,a=e.error,r=this.props.onSelect;return v.a.createElement(tn,{locations:t,loading:n,error:a,onSelect:r})}}]),t}(h.Component),an=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(s)))).state={project:null,location:null,dataset:null,unloading:!1},n.onProjectSelect=function(e){n.setState({project:e})},n.onLocationSelect=function(e){n.setState({location:e})},n.onDatasetSelect=function(e){n.setState({dataset:e})},n.onProjectClick=function(){n.setState({dataset:null,location:null,project:null})},n.onLocationClick=function(){n.setState({dataset:null,location:null})},n.onDatasetClick=function(){n.setState({dataset:null})},n.onDicomStoreSelect=function(e){var t=e.name,a=t.split("/"),r={wadoUriRoot:Kt.urlBase+"/".concat(t,"/dicomWeb"),qidoRoot:Kt.urlBase+"/".concat(t,"/dicomWeb"),wadoRoot:Kt.urlBase+"/".concat(t,"/dicomWeb"),project:a[1],location:a[3],dataset:a[5],dicomStore:a[7]};n.props.setServers(r)},n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this.state,t=e.project,n=e.location,a=e.dataset,r=this.onProjectClick,o=this.onLocationClick,i=this.onDatasetClick,s=this.onProjectSelect,c=this.onLocationSelect,l=this.onDatasetSelect,u=this.onDicomStoreSelect,p=v.a.createElement("div",{className:"gcp-picker--path"},v.a.createElement("span",null,this.props.t("Select a Project")));return t&&(p=v.a.createElement("div",{className:"gcp-picker--path"},v.a.createElement("span",{onClick:r},t.name),t&&n&&v.a.createElement("span",{onClick:o}," ","-> ",n.name.split("/")[3]),t&&n&&a&&v.a.createElement("span",{onClick:i}," ","-> ",a.name.split("/")[5]))),v.a.createElement(v.a.Fragment,null,p,!t&&v.a.createElement($t,{oidcKey:this.props.oidcKey,onSelect:s}),t&&!n&&v.a.createElement(nn,{oidcKey:this.props.oidcKey,project:t,onSelect:c}),t&&n&&!a&&v.a.createElement(Xt,{oidcKey:this.props.oidcKey,project:t,location:n,onSelect:l}),t&&n&&a&&v.a.createElement(zt,{oidcKey:this.props.oidcKey,dataset:a,onSelect:u}))}}]),t}(h.Component),rn=Object(E.c)("Common")(an),on=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(s)))).handleEvent=function(e){var t=[{name:e.dicomStore,imageRendering:"wadors",thumbnailRendering:"wadors",qidoSupportsIncludeField:!1,type:"dicomWeb",qidoRoot:e.qidoRoot,wadoRoot:e.wadoRoot,wadoUriRoot:e.wadoUriRoot,active:!0}];n.props.setServers(t)},n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return v.a.createElement(Lt.a,{show:this.props.isOpen,onHide:this.props.onClose,"aria-labelledby":"ModalHeader",className:"modal fade themed in",backdrop:!1,size:"md",keyboard:!0},v.a.createElement(Lt.a.Header,{closeButton:!0},v.a.createElement(Lt.a.Title,null,this.props.t("Google Cloud Healthcare API"))),v.a.createElement(Lt.a.Body,null,v.a.createElement(rn,{setServers:this.handleEvent,oidcKey:this.props.oidcStorageKey,url:this.props.url})))}}]),t}(h.Component);on.defaultProps={isOpen:!1};var sn=Object(E.c)("Common")(on),cn=function(e){return!0===e.active},ln=Object(V.connect)(function(e){var t=e.servers.servers.find(cn),n=window.config.oidc[0],a=n.authority,r=n.client_id;return{oidcStorageKey:"oidc.user:".concat(a,":").concat(r),url:t&&t.qidoRoot}},function(e){return{setServers:function(t){e({type:"SET_SERVERS",servers:t})}}})(sn),un=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,s=new Array(r),l=0;l<r;l++)s[l]=arguments[l];return(n=Object(o.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(s)))).state={searchData:{},studies:[],error:null,modalComponentId:null},n.searchForStudies=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.defaultSearchData,a=n.props.server,r={patientId:e.patientId,patientName:e.patientName,accessionNumber:e.accessionNumber,studyDescription:e.studyDescription,modalitiesInStudy:e.modalities,studyDateFrom:e.studyDateFrom,studyDateTo:e.studyDateTo,limit:e.rowsPerPage,offset:e.currentPage*e.rowsPerPage};c.default.studies.searchStudies(a,r).then(function(t){t||(t=[]);var a=e.sortData,r=a.field,o=a.order,i=t.map(function(e){return _()(e.studyDate,"MMM DD, YYYY",!0).isValid()||(e.studyDate=_()(e.studyDate,"YYYYMMDD").format("MMM DD, YYYY")),e});i.sort(function(e,t){var n=e[r],a=t[r];return"studyDate"===r&&(n=_()(n).toISOString(),a=_()(a).toISOString()),"desc"===o?n<a?-1:n>a?1:0:n>a?-1:n<a?1:0}),n.setState({studies:i})}).catch(function(e){throw n.setState({error:!0}),new Error(e)})},n.onImport=function(){},n.openModal=function(e){n.setState({modalComponentId:e})},n.closeModal=function(){n.setState({modalComponentId:null})},n.onSelectItem=function(e){n.props.history.push("/viewer/".concat(e))},n.onSearch=function(e){n.searchForStudies(e)},n.closeModals=function(){n.setState({modalComponentId:null})},n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){!this.props.server&&window.config.enableGoogleCloudAdapter?this.setState({modalComponentId:"DicomStorePicker"}):this.searchForStudies(Object(g.a)({},t.defaultSearchData,this.props.filters||{}))}},{key:"componentDidUpdate",value:function(e){this.state.searchData||this.state.studies||this.searchForStudies(),this.props.server!==e.server&&this.setState({modalComponentId:null,searchData:null,studies:null})}},{key:"render",value:function(){var e=this;if(this.state.error)return v.a.createElement("div",null,"Error: ",JSON.stringify(this.state.error));if(null===this.state.studies&&!this.state.modalComponentId)return v.a.createElement("div",null,"Loading...");var n=null,a=null;window.config.enableGoogleCloudAdapter&&(a=v.a.createElement(v.a.Fragment,null,v.a.createElement(ln,{isOpen:"DicomStorePicker"===this.state.modalComponentId,onClose:this.closeModals}),v.a.createElement(_t,{isOpen:"DicomFilesUploader"===this.state.modalComponentId,onClose:this.closeModals})),n=v.a.createElement("div",{className:"form-inline btn-group pull-right",style:{padding:"20px"}},v.a.createElement("button",{className:"btn btn-primary",onClick:function(){return e.openModal("DicomStorePicker")}},this.props.t("Change DICOM Store")),v.a.createElement("button",{className:"btn btn-primary",onClick:function(){return e.openModal("DicomFilesUploader")}},this.props.t("Upload Studies"))));var r=v.a.createElement("div",{className:"paginationArea"},v.a.createElement(H.l,{studies:this.state.studies,studyListFunctionsEnabled:!1,onImport:this.onImport,onSelectItem:this.onSelectItem,pageSize:this.rowsPerPage,defaultSort:t.defaultSort,studyListDateFilterNumDays:t.studyListDateFilterNumDays,onSearch:this.onSearch},n,a));return v.a.createElement(v.a.Fragment,null,v.a.createElement(Se,{home:!0,user:this.props.user}),r)}}]),t}(h.Component);un.rowsPerPage=25,un.defaultSort={field:"patientName",order:"desc"},un.studyListDateFilterNumDays=25e3,un.defaultStudyDateFrom=_()().subtract(un.studyListDateFilterNumDays,"days").toDate(),un.defaultStudyDateTo=new Date,un.defaultSearchData={currentPage:0,rowsPerPage:un.rowsPerPage,studyDateFrom:un.defaultStudyDateFrom,studyDateTo:un.defaultStudyDateTo,sortData:un.defaultSort};var pn=Object(ie.f)(Object(E.c)("Common")(un)),dn=function(e){return!0===e.active},mn=Object(V.connect)(function(e){return{server:e.servers.servers.find(dn),user:e.oidc.user}},null)(pn);var fn=Object(ie.f)(function(e){var t=e.location,n=t?function(e){var t=e.search,n=ue.a.parse(t),a={};return Object.entries(n).forEach(function(e){var t,n=Object(xt.a)(e,2),r=n[0],o=n[1];a[(t=r,t[0].toLowerCase()+t.slice(1))]=o}),a}(t):void 0;return v.a.createElement(mn,{filters:n})}),hn=n(237),vn=n.n(hn),gn=c.metadata.OHIFStudyMetadata,bn=c.studies.retrieveStudiesMetadata,yn=c.utils.studyMetadataManager,En=c.utils.updateMetaDataManager,On=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(s)))).state={studies:null,error:null},n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=Object(me.a)(de.a.mark(function e(){var n,a,r;return de.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=vn.a.parse(this.props.location.search),e.next=4,t.parseQueryAndFetchStudies(n);case 4:a=e.sent,yn.purge(),r=a.map(function(e){var t=new gn(e,e.studyInstanceUid),n=Wn.modules.sopClassHandlerModule;return e.displaySets=e.displaySets||t.createDisplaySets(n),t.setDisplaySets(e.displaySets),En(e),yn.add(t),e}),this.setState({studies:r}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),this.setState({error:e.t0});case 13:case"end":return e.stop()}},e,this,[[0,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return this.state.error?v.a.createElement("div",null,"Error: ",JSON.stringify(this.state.error)):this.state.studies?v.a.createElement(ft,{studies:this.state.studies}):v.a.createElement("div",null,"Loading...")}}],[{key:"parseQueryAndFetchStudies",value:function(e){return new Promise(function(t,n){var a=e.url;a||n(new Error("No URL was specified. Use ?url=$yourURL"));var r=new XMLHttpRequest;r.addEventListener("error",function(e){c.log.warn("An error occurred while retrieving the JSON data"),n(e)}),r.addEventListener("load",function(){r.responseText||(c.log.warn("Response was undefined"),n(new Error("Response was undefined"))),c.log.info(JSON.stringify(r.responseText,null,2));var a=JSON.parse(r.responseText);if(a.servers&&e.studyInstanceUids){var o=a.servers.dicomWeb[0];o.type="dicomWeb";var i=e.studyInstanceUids.split(";");bn(o,i,[]).then(function(e){t(e)},function(e){n(e)})}else t(a.studies)}),c.log.info("Sending Request to: ".concat(a)),r.open("GET",a),r.setRequestHeader("Accept","application/json"),r.send()})}}]),t}(h.Component),Sn=function(e){function t(){return Object(a.a)(this,t),Object(o.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this;return v.a.createElement(b.CallbackComponent,{userManager:this.props.userManager,successCallback:function(){var t=sessionStorage.getItem("ohif-redirect-to");e.props.history.push(t)},errorCallback:function(e){throw new Error(e)}},v.a.createElement("div",null,"Redirecting..."))}}]),t}(h.Component),wn=Object(ie.f)(Sn);n(535);function kn(){return v.a.createElement("div",{className:"not-found"},v.a.createElement("div",null,v.a.createElement("h4",null,"Sorry, this page does not exist."),v.a.createElement("h5",null,v.a.createElement(ye.b,{to:"/"},"Go back to the Study List"))))}var jn=function(e){var t=e.progress,n=e.animationDuration;return v.a.createElement("div",{style:{background:"#29d",height:2,left:0,marginLeft:"".concat(100*(-1+t),"%"),position:"fixed",top:0,transition:"margin-left ".concat(n,"ms linear"),width:"100%",zIndex:1031}},v.a.createElement("div",{style:{boxShadow:"0 0 10px #29d, 0 0 5px #29d",display:"block",height:"100%",opacity:1,position:"absolute",right:0,transform:"rotate(3deg) translate(0px, -4px)",width:100}}))},Dn=function(e){var t=e.children,n=e.isFinished,a=e.animationDuration;return v.a.createElement("div",{style:{opacity:n?0:1,pointerEvents:"none",transition:"opacity ".concat(a,"ms linear")}},t)},Cn=(n(536),n(537),n(538),function(){return window.location.reload()}),In=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(s)))).state={isLoading:!1},n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.unlisten=this.props.history.listen(function(t,n){e.props.setContext&&e.props.setContext(window.location.pathname)})}},{key:"componentWillUnmount",value:function(){this.unlisten()}},{key:"render",value:function(){var e=this,t=this.props,n=t.user,a=t.userManager;if(a&&(!n||n.expired)){var r=this.props.location.pathname;return"/callback"!==r&&sessionStorage.setItem("ohif-redirect-to",r),v.a.createElement(ie.c,null,v.a.createElement(ie.a,{exact:!0,path:"/silent-refresh.html",onEnter:Cn}),v.a.createElement(ie.a,{exact:!0,path:"/logout-redirect.html",onEnter:Cn}),v.a.createElement(ie.a,{path:"/callback",render:function(){return v.a.createElement(wn,{userManager:a})}}),v.a.createElement(ie.a,{component:function(){return a.signinRedirect(),null}}))}var o=[{path:"/viewer",Component:On},{path:"/viewer/:studyInstanceUids",Component:It},{path:"/study/:studyInstanceUids/series/:seriesInstanceUids",Component:It},{path:"/IHEInvokeImageDisplay",Component:Ct}];(void 0===window.config.showStudyList||window.config.showStudyList)&&(o.push({path:"/studylist",Component:fn}),o.push({path:"/",Component:fn}));var i=this.props.location.pathname,s=!o.find(function(e){return Object(ie.e)(i,{path:e.path,exact:!0})});return v.a.createElement(v.a.Fragment,null,v.a.createElement(se.a,{isAnimating:this.state.isLoading},function(e){var t=e.isFinished,n=e.progress,a=e.animationDuration;return v.a.createElement(Dn,{isFinished:t,animationDuration:a},v.a.createElement(jn,{progress:n,animationDuration:a}))}),v.a.createElement(ie.a,{exact:!0,path:"/silent-refresh.html",onEnter:Cn}),v.a.createElement(ie.a,{exact:!0,path:"/logout-redirect.html",onEnter:Cn}),!s&&o.map(function(t){var n=t.path,a=t.Component;return v.a.createElement(ie.a,{key:n,exact:!0,path:n},function(t){var n=t.match;return v.a.createElement(ce.a,{in:null!==n,timeout:300,classNames:"fade",unmountOnExit:!0,onEnter:function(){e.setState({isLoading:!0})},onEntered:function(){e.setState({isLoading:!1})}},null===n?v.a.createElement(v.a.Fragment,null):v.a.createElement(a,{match:n}))})}),s&&v.a.createElement(kn,null))}}]),t}(h.Component),xn=Object(V.connect)(function(e){return{user:e.oidc.user}},null)(In),Tn=Object(H.n)(Object(ie.f)(xn)),Ln=n(238),Mn=n.n(Ln),Nn=n(132);var Pn=function(e){return{type:"RESET_LABELLING_AND_CONTEXT_MENU",state:e}},An=function(e,t){return{type:"SET_TOOL_CONTEXT_MENU_DATA",viewportIndex:e,toolContextMenuData:t}};function Un(e){var t=function(t){return function(){e.dispatch(An(t,{visible:!1}))}};return function(n){var a=n.detail,r=parseInt(a.element.dataset.viewportIndex,10);!function(t,n){e.dispatch(Pn()),e.dispatch(An(t,n))}(r,{eventData:a,isTouchEvent:!1,onClose:t(r)})}}function Rn(e){var t=function(t){return function(){e.dispatch(An(t,{visible:!1}))}};return function(n){var a=n.detail,r=parseInt(a.element.dataset.viewportIndex,10);!function(t,n){e.dispatch(Pn()),e.dispatch(An(t,n))}(r,{eventData:a,isTouchEvent:!0,onClose:t(r)})}}function Bn(e){return function(){e.dispatch(Pn())}}!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};window.cornerstoneTools=D.a,D.a.external.cornerstone=u.a,D.a.external.Hammer=S.a,D.a.external.cornerstoneMath=k.a,D.a.init(e);D.a.textStyle.setFont("16px ".concat("Roboto, OpenSans, HelveticaNeue-Light, Helvetica Neue Light, Helvetica Neue, Helvetica, Arial, Lucida Grande, sans-serif")),D.a.toolStyle.setToolWidth(2),D.a.toolColors.setToolColor("rgb(255, 255, 0)"),D.a.toolColors.setActiveColor("rgb(0, 255, 0)"),D.a.store.state.touchProximity=40}({globalToolSyncEnabled:!0});var Fn={getAppState:function(){return A.getState()},getActiveContexts:function(){return Fe(A.getState())}},Vn=new c.CommandsManager(Fn),Hn=new c.HotkeysManager(Vn),Wn=new c.ExtensionManager({commandsManager:Vn});!function(e){var t=function(e){var t=function(t){e.dispatch(function(e){return{type:"SET_LABELLING_FLOW_DATA",labellingFlowData:e}}(t))};return function(e,n,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o={visible:!0,eventData:n,measurementData:e,skipAddLabelButton:r.skipAddLabelButton,editLocation:r.editLocation,editDescription:r.editDescription,editResponse:r.editResponse,editDescriptionOnDialog:r.editDescriptionOnDialog,labellingDoneCallback:function(){t({visible:!1})},updateLabelling:function(t){var n=t.location,a=t.response,r=t.description;n&&(e.location=n),r&&(e.description=r),a&&(e.response=a),G(e)}};t(o)}}(e),n=[{name:"Pan",mouseButtonMasks:[1,4]},{name:"Zoom",mouseButtonMasks:[1,2]},{name:"Wwwc",mouseButtonMasks:[1]},{name:"Magnify",mouseButtonMasks:[1]},{name:"WwwcRegion",mouseButtonMasks:[1]},{name:"Bidirectional",props:{configuration:{getMeasurementLocationCallback:t}},mouseButtonMasks:[1]},{name:"Length",props:{configuration:{getMeasurementLocationCallback:t}},mouseButtonMasks:[1]},{name:"Angle",props:{configuration:{getMeasurementLocationCallback:t}},mouseButtonMasks:[1]},{name:"StackScroll",mouseButtonMasks:[1]},{name:"Brush",mouseButtonMasks:[1]},{name:"FreehandMouse",props:{configuration:{getMeasurementLocationCallback:t}},mouseButtonMasks:[1]},{name:"EllipticalRoi",props:{configuration:{getMeasurementLocationCallback:t}},mouseButtonMasks:[1]},{name:"CircleRoi",props:{configuration:{getMeasurementLocationCallback:t}},mouseButtonMasks:[1]},{name:"RectangleRoi",props:{configuration:{getMeasurementLocationCallback:t}},mouseButtonMasks:[1]},{name:"DragProbe",mouseButtonMasks:[1]},{name:"PanMultiTouch"},{name:"ZoomTouchPinch"},{name:"StackScrollMouseWheel"},{name:"StackScrollMultiTouch"}],a=Un(e),r=Rn(e),o=Bn(e),i=Bn(e),s=Bn(e),l=c.default.redux.actions.setExtensionData("cornerstone",{availableTools:n,onNewImage:o,onRightClick:a,onTouchPress:r,onTouchStart:s,onMouseClick:i});e.dispatch(l)}(A),Wn.registerExtensions([F,te,ne.a,Mn.a,oe.a,ae.a,re.a]),window.config.hotkeys&&Hn.setHotkeys(window.config.hotkeys,!0),window.store=A;var _n=function(e){function t(e){var n,r;if(Object(a.a)(this,t),(n=Object(o.a)(this,Object(i.a)(t).call(this,e))).props.oidc.length){var s=n.props.oidc[0];n.userManager=y(A,s)}return(r=n.props.servers)&&c.utils.addServers(r,A),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n="".concat(window.location.protocol,"//").concat(window.location.host).concat(e).concat(t);"/"!==n[n.length-1]&&(n+="/");var a={maxWebWorkers:Math.max(navigator.hardwareConcurrency-1,1),startWebWorkersOnDemand:!0,webWorkerPath:"".concat(n,"cornerstoneWADOImageLoaderWebWorker.min.js"),taskConfiguration:{decodeTask:{loadCodecsOnStartup:!0,initializeCodecsOnStartup:!1,codecsPath:"".concat(n,"cornerstoneWADOImageLoaderCodecs.min.js"),usePDFJS:!1,strict:!1}}};d.a.webWorkerManager.initialize(a)}(n.props.routerBasename,n.props.relativeWebWorkerScriptsPath),n}return Object(s.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this.userManager;return e?v.a.createElement(V.Provider,{store:A},v.a.createElement(E.a,{i18n:Nn.default},v.a.createElement(b.OidcProvider,{store:A,userManager:e},v.a.createElement(ye.a,{basename:this.props.routerBasename},v.a.createElement(be.Provider,{value:this.props.whiteLabelling},v.a.createElement(Tn,{userManager:e})))))):v.a.createElement(V.Provider,{store:A},v.a.createElement(E.a,{i18n:Nn.default},v.a.createElement(ye.a,{basename:this.props.routerBasename},v.a.createElement(be.Provider,{value:this.props.whiteLabelling},v.a.createElement(Tn,null)))))}}]),t}(h.Component);_n.defaultProps={whiteLabelling:{},oidc:[]};var Kn=_n,Yn=n(18),Gn=n.n(Yn);n.d(t,"App",function(){return Kn}),window.config=window.config||{};var zn=Object.assign({},{routerBasename:"/",relativeWebWorkerScriptsPath:""},window.config),qn=v.a.createElement(Kn,zn,null);Gn.a.render(qn,document.getElementById("root"))},55:function(e,t,n){}},[[244,1,2]]]);
//# sourceMappingURL=main.1fd74f99.chunk.js.map