{"version":3,"sources":["../node_modules/@ohif/i18n/dist/locales sync //.json$","config.js","version.js","utils/getDefaultToolbarButtons.js","utils/getUserManagerForOpenIdConnectClient.js","lib/updateTableWithNewMeasurementData.js","lib/getMeasurementLocationCallback.js","connectedComponents/ToolContextMenu.js","connectedComponents/ConnectedToolContextMenu.js","components/OHIFLogo/OHIFLogo.js","WhiteLabellingContext.js","components/Header/Header.js","connectedComponents/ConnectedHeader.js","connectedComponents/ConnectedMeasurementTable.js","lib/jumpToRowItem.js","connectedComponents/ConnectedStudyBrowser.js","connectedComponents/ConnectedLayoutManager.js","connectedComponents/ViewerMain.js","connectedComponents/ConnectedViewerMain.js","connectedComponents/FlexboxLayout.js","connectedComponents/ConnectedFlexboxLayout.js","store/layout/actions.js","connectedComponents/ConnectedLayoutButton.js","connectedComponents/PluginSwitch.js","connectedComponents/ConnectedPluginSwitch.js","connectedComponents/ToolbarRow.js","connectedComponents/ConnectedToolbarRow.js","components/SimpleDialog/SimpleDialog.js","lib/utils/bounding.js","components/Labelling/labellingPositionUtils.js","components/EditDescriptionDialog/EditDescriptionDialog.js","components/Labelling/LabellingTransition.js","components/Labelling/OHIFLabellingData.js","components/Labelling/LabellingFlow.js","components/Labelling/LabellingManager.js","connectedComponents/LabellingOverlay.js","connectedComponents/ConnectedLabellingOverlay.js","connectedComponents/Viewer.js","connectedComponents/ConnectedViewer.js","connectedComponents/ViewerRetrieveStudyData.js","routes/IHEInvokeImageDisplay.js","connectedComponents/ConnectedViewerRetrieveStudyData.js","routes/ViewerRouting.js","studylist/StudyListWithData.js","studylist/ConnectedStudyList.js","studylist/StudyListRouting.js","routes/StandaloneRouting.js","CallbackPage.js","OHIFStandaloneViewer.js","store/layout/reducers.js","store/index.js","appCommands/cornerstone.js","appCommands/viewer.js","appCommands/index.js","setupTools.js","App.js","utils/initWebWorkers.js","index.js"],"names":["map","./en/Buttons.json","./en/CineDialog.json","./en/Common.json","./en/Header.json","./en/MeasurementTable.json","./en/UK/Header.json","./en/US/Header.json","./en/UserPreferencesModal.json","./es/AR/Header.json","./es/Buttons.json","./es/CineDialog.json","./es/Common.json","./es/Header.json","./es/MX/Header.json","./es/MeasurementTable.json","./es/UserPreferencesModal.json","webpackContext","req","id","webpackContextResolve","__webpack_require__","e","Error","code","keys","Object","resolve","module","exports","window","info","version","homepage","concat","process","cornerstone","cornerstoneWADOImageLoader","external","dicomParser","OHIF","user","getAccessToken","state","store","getState","oidc","access_token","configure","beforeSend","xhr","headers","DICOMWeb","getAuthorizationHeader","Authorization","setRequestHeader","getDefaultToolbarButtons","command","type","text","icon","active","getUserManagerForOpenIdConnectClient","oidcSettings","settings","objectSpread","silent_redirect_uri","automaticSilentRenew","revokeAccessTokenOnSignout","filterProtocolClaims","loadUserInfo","userManager","createUserManager","loadUser","updateTableWithNewMeasurementData","_ref","toolType","measurementNumber","location","description","measurementApi","measurements","MeasurementApi","Instance","tools","filter","m","forEach","measurement","updateMeasurement","syncMeasurementsAndToolData","getEnabledElements","enabledElement","updateImage","element","getMeasurementLocationCallback","eventData","tool","options","doneCallback","cornerstoneTools","getToolForElement","configuration","toolTypes","defaultDropdownItems","actionType","action","nearbyToolData","removeToolState","_ref2","skipAddLabelButton","editLocation","_ref3","editDescriptionOnDialog","getDropdownItems","isTouchEvent","arguments","length","undefined","coords","nearbyTool","pointNearTool","toolData","getToolState","data","index","toolInterface","getNearbyToolData","currentPoints","canvas","dropdownItems","item","params","push","ToolContextMenu","props","_this","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","componentDidMount","mainElement","current","updateElementPosition","componentDidUpdate","_this$mainElement$cur","offsetParent","offsetTop","offsetHeight","offsetWidth","offsetLeft","offBoundPixels","top","y","style","left","x","React","createRef","_this2","_this$props","availableTools","dropdownComponents","react_default","a","createElement","key","className","onClick","event","onClose","position","ref","Component","defaultProps","visible","ConnectedToolContextMenu","connect","ownProps","ui","contextMenu","viewportIndex","toolContextMenuData","extensions","OHIFLogo","target","rel","href","react_viewerbase_dist_index_es","name","defaultContextValues","logoComponent","WhiteLabellingContext","createContext","Header","isUserPreferencesOpen","loadOptions","t","title","link","hotKeysData","hotkeysManager","hotkeyDefinitions","isOpen","setState","windowLevelData","home","studyLink","Link","to","children","pathname","list","align","withTranslation","withRouter","ConnectedHeader","userPreferencesModalOpen","setViewportSpecificData","redux","actions","getMeasurementText","measurementData","getDataForEachMeasurementNumber","measurementNumberList","timepoints","displayFunction","timepoint","eachData","displayText","timepointId","convertMeasurementsToTableData","toolCollections","toolGroups","getConfiguration","measurementTools","config","toolGroup","childTools","getAllTools","tableMeasurements","groupName","groupId","toolId","toolMeasurements","find","measurementTable","groupedMeasurements","reduce","b","groupedMeasurementsIndex","lesionNamingNumber","measurementId","_id","tableMeasurement","itemNumber","label","hasWarnings","warningTitle","isSplitLesion","warningList","group","tm","sort","m1","m2","convertTimepointsToTableData","date","moment","latestDate","format","ConnectedMeasurementTable","_state$timepointManag","timepointManager","measurementCollection","viewports","dispatch","dispatchRelabel","viewportsState","activeViewportIndex","enabledElements","log","error","clientX","clientY","assign","dispatchEditDescription","dispatchJumpToRowItem","timepointManagerState","invertViewportTimepointsOrder","childToolKey","numViewports","layout","numTimepoints","numViewportsToUpdate","Math","min","reverse","measurementsForToolGroup","measurementsToJumpTo","_loop","i","dataAtThisTimepoint","entry","getToolConfiguration","Array","isArray","viewportSpecificData","study","utils","studyMetadataManager","get","studyInstanceUid","displaySet","findDisplaySet","sopInstanceUid","images","image","getSOPInstanceUID","displaySetContainsSopInstance","frameIndex","jumpToRowItem","measurementToActive","propsFromState","propsFromDispatch","selectedMeasurementNumber","onItemClick","onRelabelClick","onEditDescriptionClick","onDeleteClick","MeasurementHandlers","onRemoved","detail","MeasurementTable","ConnectedStudyBrowser","stackLoadingProgressMap","loading","progress","studiesWithLoadingData","cloneDeep","studies","thumbnails","displaySetInstanceUid","stackId","stackProgressData","stackPercentComplete","percentComplete","StudyBrowser","ConnectedLayoutManager","defaultPlugin","viewportPluginIds","plugins","availablePlugins","plugin","PLUGIN_TYPES","VIEWPORT","component","LayoutManager","ViewerMain","getViewportData","viewportData","cachedViewportData","originalDisplaySet","displaySets","ds","some","v","setViewportData","dSet","getDisplaySets","connectedComponents_ConnectedLayoutManager","clearViewportSpecificData","ConnectedViewerMain","_state$viewports","FlexboxLayout","studiesForBrowser","getStudiesForBrowser","imageId","seriesDescription","seriesNumber","instanceNumber","numImageFrames","altImageText","getImageId","mainContentClassName","leftSidebarOpen","rightSidebarOpen","connectedComponents_ConnectedStudyBrowser","connectedComponents_ConnectedViewerMain","connectedComponents_ConnectedMeasurementTable","ConnectedFlexboxLayout","setLeftSidebarOpen","setRightSidebarOpen","setLayout","ConnectedLayoutButton","currentLayout","onChange","selectedCell","rows","row","columns","col","height","width","LayoutButton","PluginSwitch","buttons","setSingleLayoutData","originalArray","slice","layoutData","ConnectedPluginSwitch","console","warn","vtk","mode","sliceNormal","ToolbarRow","onLeftSidebarValueChanged","value","onRightSidebarValueChanged","pluginComp","leftSidebarToggle","bottomLabel","rightSidebarToggle","leftSidebarValue","rightSidebarValue","currentPluginId","pluginId","_OHIF$plugins","TOOLBAR","PluginComponent","padding","onValueChanged","connectedComponents_ConnectedLayoutButton","connectedComponents_ConnectedPluginSwitch","marginLeft","ConnectedToolbarRow","pluginInLayout","pluginInViewportData","SimpleDialog","rootClass","componentRef","componentStyle","headerTitle","onConfirm","bounding","elementRef","currentPosition","currentElement","maxHeight","buttonSize","EditDescriptionDialog","onCancel","onUpdate","handleChange","prevProps","dialogProps","maxLeft","innerWidth","maxTop","innerHeight","getDialogStyle","components_SimpleDialog_SimpleDialog","autoComplete","autoFocus","LabellingTransition","react_transition_group","in","displayComponent","appear","timeout","classNames","onExited","onTransitionExit","OHIFLabellingData","LabellingFlow","repositionComponent","labellingStateFragment","_this$state","locationLabel","items","currentItems","onSelected","selectTreeSelectCalback","selectTreeFirstTitle","onComponentChange","Fragment","fadeOutAndLeaveFast","descriptionInput","defaultValue","relabel","setDescriptionUpdateMode","descriptionCancel","descriptionSave","showLabelling","focus","editDescription","_cloneDeep$descriptio","updateLabelling","itemSelected","viewportTopPosition","nativeEvent","confirmationState","isTouchScreen","setTimeout","fadeOutAndLeave","fadeOutTimer","clearFadeOutTimer","clearTimeout","_props$measurementDat","_measurementData$hand","handles","start","end","client","clientStart","pixelToCanvas","clientEnd","canvasOffSetLeft","canvasOffSetTop","getAddLabelButtonStyle","initialItems","mainElementClassName","LabellingTransition_LabellingTransition","labellingDoneCallback","onMouseLeave","onMouseEnter","LabellingManager","document","addEventListener","onTouchStart","componentWillUnmount","removeEventListener","getRenderComponent","EditDescriptionDialog_EditDescriptionDialog_EditDescriptionDialog","descriptionDialogUpdate","editDescriptionDialog","LabellingFlow_LabellingFlow","treatMeasurementData","responseDialogUpdate","response","getComponentPosition","_eventData$event","LabellingOverlay","LabellingManager_LabellingManager","ConnectedLabellingOverlay","labelling","labellingFlowData","Viewer","retrieveMeasurements","patientId","timepointIds","Promise","storeMeasurements","retrieveTimepoints","earliestDate","Date","toISOString","studyDate","timepointType","studyInstanceUids","isLocked","storeTimepoints","timepointData","updateTimepoint","query","removeTimepoint","disassociateStudy","onTimepointsUpdated","onMeasurementsUpdated","setConfiguration","dataExchange","retrieve","TimepointApi","remove","update","disassociate","_OHIF$measurements","timepointApi","src_WhiteLabellingContext","Consumer","whiteLabelling","connectedComponents_ConnectedHeader","connectedComponents_ConnectedToolbarRow","connectedComponents_ConnectedFlexboxLayout","connectedComponents_ConnectedLabellingOverlay","setTimepoints","setMeasurements","ConnectedViewer","createDisplaySets","ViewerRetrieveStudyData","seriesInstanceUids","server","retrieveStudiesMetadata","then","updatedStudies","catch","JSON","stringify","connectedComponents_ConnectedViewer","IHEInvokeImageDisplay","match","requestType","displayStudyList","studyUID","split","uids","atob","connectedComponents_ViewerRetrieveStudyData","isActive","ConnectedViewerRetrieveStudyData","servers","ViewerRouting","studyUIDs","seriesUIDs","_match$params","connectedComponents_ConnectedViewerRetrieveStudyData","StudyListWithData","searchData","searchForStudies","currentPage","rowsPerPage","studyDateFrom","defaultStudyDateFrom","studyDateTo","defaultStudyDateTo","sortData","defaultSort","patientName","accessionNumber","studyDescription","modalitiesInStudy","modalities","limit","offset","searchStudies","_searchData$sortData","field","order","sortedStudies","isValid","fieldA","fieldB","onImport","onSelectItem","studyInstanceUID","history","onSearch","studyListFunctionsEnabled","pageSize","studyListDateFilterNumDays","subtract","toDate","ConnectedStudyList","StudyListRouting","studylist_ConnectedStudyList","StandaloneRouting","qs","parse","search","parseQueryAndFetchStudies","src_connectedComponents_Viewer","reject","url","oReq","XMLHttpRequest","responseText","dicomWeb","open","send","CallbackPage","redux_oidc","successCallback","sessionStorage","getItem","errorCallback","reload","OHIFStandaloneViewer","unlisten","listen","setContext","expired","setItem","Switch","Route","exact","path","onEnter","render","src_CallbackPage","signinRedirect","ConnectedOHIFStandaloneViewer","ViewerbaseDragDropContext","defaultState","activeContexts","shallowCopy","toConsumableArray","reducers","localStorage","layoutReducers","oidcReducer","combined","combineReducers","createStore","loadState","subscribe","saveState","preferences","setToolActive","rotateViewport","rotation","_getActiveViewportEnabledElement","viewport","getViewport","setViewport","flipViewportHorizontal","hflip","flipViewportVertical","vflip","scaleViewport","_ref4","direction","step","scale","fitToWindow","resetViewport","_ref5","reset","invertViewport","_ref6","invert","setCornerstoneToolActive","_ref7","toolName","updateViewportDisplaySet","_ref8","clearAnnotations","activeIndex","dom","definitions","rotateViewportCW","commandFn","storeContexts","rotateViewportCCW","scaleUpViewport","scaleDownViewport","fitViewportToWindow","nextViewportDisplaySet","previousViewportDisplaySet","setZoomTool","setViewportActive","updateActiveViewport","maxIndex","newIndex","incrementActiveViewport","decrementActiveViewport","CONTEXTS","viewer","appCommands","init","commandsManager","commandContext","viewerCommandDefinitions","commandName","commandDefinition","registerCommand","_registerViewerCommands","cornerstoneCommandDefinitions","_registerCornerstoneCommands","resetLabellingAndContextMenuAction","setToolContextMenuDataAction","getOnRightClickCallback","getOnCloseCallback","parseInt","dataset","setToolContextMenuData","getOnTouchPressCallback","getResetLabellingAndContextMenu","commandsManagerConfig","getAppState","getActiveContexts","CommandsManager","HotkeysManager","hotkeys","setHotkeys","toolLabellingFlowCallback","setLabellingFlowData","setLabellingFlowDataAction","editResponse","getToolLabellingFlowCallback","mouseButtonMasks","onRightClick","onTouchPress","onNewImage","onMouseClick","toolAction","setExtensionData","setupTools","connectedComponents_ConnectedToolContextMenu","ExtensionManager","registerExtensions","OHIFCornerstoneExtension","OHIFVTKExtension","OHIFDicomPDFExtension","OHIFDicomHtmlExtension","OHIFDicomMicroscopyExtension","App","defaultButtons","routerBasename","buttonsAction","setAvailableButtons","firstOpenIdClient","addServers","baseDirectory","webWorkScriptsPath","scriptsPath","protocol","host","maxWebWorkers","max","navigator","hardwareConcurrency","startWebWorkersOnDemand","webWorkerPath","taskConfiguration","decodeTask","loadCodecsOnStartup","initializeCodecsOnStartup","codecsPath","usePDFJS","strict","webWorkerManager","initialize","initWebWorkers","relativeWebWorkerScriptsPath","es","dist_es","i18n","BrowserRouter","basename","Provider","src_OHIFStandaloneViewer_0","d","__webpack_exports__","src_App","applicationProps","app","ReactDOM","getElementById"],"mappings":"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","file":"static/js/main.686793b9.chunk.js","sourcesContent":["var map = {\n\t\"./en/Buttons.json\": 129,\n\t\"./en/CineDialog.json\": 130,\n\t\"./en/Common.json\": 131,\n\t\"./en/Header.json\": 132,\n\t\"./en/MeasurementTable.json\": 133,\n\t\"./en/UK/Header.json\": 134,\n\t\"./en/US/Header.json\": 135,\n\t\"./en/UserPreferencesModal.json\": 136,\n\t\"./es/AR/Header.json\": 137,\n\t\"./es/Buttons.json\": 138,\n\t\"./es/CineDialog.json\": 139,\n\t\"./es/Common.json\": 140,\n\t\"./es/Header.json\": 141,\n\t\"./es/MX/Header.json\": 142,\n\t\"./es/MeasurementTable.json\": 143,\n\t\"./es/UserPreferencesModal.json\": 144\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) { // check for number or string\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn id;\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 128;","import dicomParser from 'dicom-parser';\nimport cornerstone from 'cornerstone-core';\nimport cornerstoneWADOImageLoader from 'cornerstone-wado-image-loader';\nimport OHIF from 'ohif-core';\nimport version from './version.js';\n\nwindow.info = {\n  version,\n  homepage: `${process.env.PUBLIC_URL}`,\n};\n\n// For debugging\nwindow.cornerstone = cornerstone;\nwindow.cornerstoneWADOImageLoader = cornerstoneWADOImageLoader;\n\ncornerstoneWADOImageLoader.external.cornerstone = cornerstone;\ncornerstoneWADOImageLoader.external.dicomParser = dicomParser;\n\nOHIF.user.getAccessToken = () => {\n  // TODO: Get the Redux store from somewhere else\n  const state = window.store.getState();\n  if (!state.oidc || !state.oidc.user) {\n    return;\n  }\n\n  return state.oidc.user.access_token;\n};\n\ncornerstoneWADOImageLoader.configure({\n  beforeSend: function(xhr) {\n    const headers = OHIF.DICOMWeb.getAuthorizationHeader();\n\n    if (headers.Authorization) {\n      xhr.setRequestHeader('Authorization', headers.Authorization);\n    }\n  },\n});\n","export default '0.0.21';\n","export default function() {\n  return [\n    {\n      command: 'StackScroll',\n      type: 'tool',\n      text: 'Stack Scroll',\n      icon: 'bars',\n      active: false,\n    },\n    {\n      command: 'Zoom',\n      type: 'tool',\n      text: 'Zoom',\n      icon: 'search-plus',\n      active: false,\n    },\n    {\n      command: 'Wwwc',\n      type: 'tool',\n      text: 'Levels',\n      icon: 'level',\n      active: true,\n    },\n    {\n      command: 'Pan',\n      type: 'tool',\n      text: 'Pan',\n      icon: 'arrows',\n      active: false,\n    },\n    {\n      command: 'Length',\n      type: 'tool',\n      text: 'Length',\n      icon: 'measure-temp',\n      active: false,\n    },\n    /*{\n        command: 'Annotate',\n        type: 'tool',\n        text: 'Annotate',\n        icon: `icon-tools-measure-non-target`,\n        active: false\n    },*/\n    {\n      command: 'Angle',\n      type: 'tool',\n      text: 'Angle',\n      icon: 'angle-left',\n      active: false,\n    },\n    {\n      command: 'reset',\n      type: 'command',\n      text: 'Reset',\n      icon: 'reset',\n      active: false,\n    },\n  ];\n}\n","// https://github.com/maxmantz/redux-oidc/blob/master/docs/API.md\nimport { loadUser, createUserManager } from 'redux-oidc';\n\n/**\n * Creates a userManager from oidcSettings;\n * loads the user into the provided redux store\n * LINK: https://github.com/IdentityModel/oidc-client-js/wiki#configuration\n *\n * @param {*} store\n * @param {Object} oidcSettings\n * @param {string} oidcSettings.authServerUrl,\n * @param {string} oidcSettings.clientId,\n * @param {string} oidcSettings.authRedirectUri,\n * @param {string} oidcSettings.postLogoutRedirectUri,\n * @param {string} oidcSettings.responseType,\n * @param {string} oidcSettings.extraQueryParams,\n */\nexport default function(store, oidcSettings) {\n  if (!store || !oidcSettings) {\n    return;\n  }\n\n  const settings = {\n    ...oidcSettings,\n    silent_redirect_uri: '/silent-refresh.html',\n    automaticSilentRenew: true,\n    revokeAccessTokenOnSignout: true,\n    filterProtocolClaims: true,\n    loadUserInfo: true,\n  };\n\n  const userManager = createUserManager(settings);\n\n  loadUser(store, userManager);\n\n  return userManager;\n}\n","import OHIF from 'ohif-core';\nimport cornerstone from 'cornerstone-core';\n\nexport default function updateTableWithNewMeasurementData({\n  toolType,\n  measurementNumber,\n  location,\n  description,\n}) {\n  // Update all measurements by measurement number\n  const measurementApi = OHIF.measurements.MeasurementApi.Instance;\n  const measurements = measurementApi.tools[toolType].filter(\n    m => m.measurementNumber === measurementNumber\n  );\n\n  measurements.forEach(measurement => {\n    measurement.location = location;\n    measurement.description = description;\n\n    measurementApi.updateMeasurement(measurement.toolType, measurement);\n  });\n\n  measurementApi.syncMeasurementsAndToolData();\n\n  // Update images in all active viewports\n  cornerstone.getEnabledElements().forEach(enabledElement => {\n    cornerstone.updateImage(enabledElement.element);\n  });\n}\n","import cornerstoneTools from 'cornerstone-tools';\nimport updateTableWithNewMeasurementData from './updateTableWithNewMeasurementData';\n\nexport default function getMeasurementLocationCallback(\n  eventData,\n  tool,\n  options\n) {\n  const { toolType } = tool;\n  const { element } = eventData;\n  const doneCallback = updateTableWithNewMeasurementData;\n\n  const ToolInstance = cornerstoneTools.getToolForElement(element, toolType);\n\n  ToolInstance.configuration.getMeasurementLocationCallback(\n    tool,\n    eventData,\n    doneCallback,\n    options\n  );\n}\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport cornerstone from 'cornerstone-core';\nimport cornerstoneTools from 'cornerstone-tools';\nimport getMeasurementLocationCallback from '../lib/getMeasurementLocationCallback';\n\nimport './ToolContextMenu.css';\n\nconst toolTypes = [\n  'Angle',\n  'Bidirectional',\n  'Length',\n  'FreehandMouse',\n  'EllipticalRoi',\n  'CircleRoi',\n  'RectangleRoi',\n];\n\nlet defaultDropdownItems = [\n  {\n    actionType: 'Delete',\n    action: ({ nearbyToolData, eventData }) => {\n      const element = eventData.element;\n\n      cornerstoneTools.removeToolState(\n        element,\n        nearbyToolData.toolType,\n        nearbyToolData.tool\n      );\n      cornerstone.updateImage(element);\n    },\n  },\n  {\n    actionType: 'setLabel',\n    action: ({ nearbyToolData, eventData }) => {\n      const { tool } = nearbyToolData;\n\n      const options = {\n        skipAddLabelButton: true,\n        editLocation: true,\n      };\n\n      getMeasurementLocationCallback(eventData, tool, options);\n    },\n  },\n  {\n    actionType: 'setDescription',\n    action: ({ nearbyToolData, eventData }) => {\n      const { tool } = nearbyToolData;\n\n      const options = {\n        editDescriptionOnDialog: true,\n      };\n\n      getMeasurementLocationCallback(eventData, tool, options);\n    },\n  },\n];\n\nfunction getNearbyToolData(element, coords, toolTypes) {\n  const nearbyTool = {};\n  let pointNearTool = false;\n\n  toolTypes.forEach(toolType => {\n    const toolData = cornerstoneTools.getToolState(element, toolType);\n    if (!toolData) {\n      return;\n    }\n\n    toolData.data.forEach(function(data, index) {\n      // TODO: Fix this, it's ugly\n      let toolInterface = cornerstoneTools.getToolForElement(element, toolType);\n      if (!toolInterface) {\n        toolInterface = cornerstoneTools.getToolForElement(\n          element,\n          `${toolType}Tool`\n        );\n      }\n\n      if (!toolInterface) {\n        throw new Error('Tool not found.');\n      }\n\n      if (toolInterface.pointNearTool(element, data, coords)) {\n        pointNearTool = true;\n        nearbyTool.tool = data;\n        nearbyTool.index = index;\n        nearbyTool.toolType = toolType;\n      }\n    });\n\n    if (pointNearTool) {\n      return false;\n    }\n  });\n\n  return pointNearTool ? nearbyTool : undefined;\n}\n\nfunction getDropdownItems(eventData, isTouchEvent = false, availableTools) {\n  const nearbyToolData = getNearbyToolData(\n    eventData.element,\n    eventData.currentPoints.canvas,\n    toolTypes,\n    availableTools\n  );\n\n  // Annotate tools for touch events already have a press handle to edit it, has a better UX for deleting it\n  if (\n    isTouchEvent &&\n    nearbyToolData &&\n    nearbyToolData.toolType === 'arrowAnnotate'\n  ) {\n    return;\n  }\n\n  let dropdownItems = [];\n  if (nearbyToolData) {\n    defaultDropdownItems.forEach(function(item) {\n      item.params = {\n        eventData,\n        nearbyToolData,\n      };\n\n      if (item.actionType === 'Delete') {\n        item.text = 'Delete measurement';\n      }\n\n      if (item.actionType === 'setLabel') {\n        item.text = 'Relabel';\n      }\n\n      if (item.actionType === 'setDescription') {\n        item.text = `${\n          nearbyToolData.tool.description ? 'Edit' : 'Add'\n        } Description`;\n      }\n\n      dropdownItems.push(item);\n    });\n  }\n\n  return dropdownItems;\n}\n\nclass ToolContextMenu extends Component {\n  static propTypes = {\n    isTouchEvent: PropTypes.bool.isRequired,\n    eventData: PropTypes.object,\n    onClose: PropTypes.func,\n    availableTools: PropTypes.array,\n    visible: PropTypes.bool.isRequired,\n  };\n\n  static defaultProps = {\n    visible: true,\n    isTouchEvent: false,\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.mainElement = React.createRef();\n  }\n\n  render() {\n    if (!this.props.eventData) {\n      return null;\n    }\n\n    const { isTouchEvent, eventData, availableTools } = this.props;\n    const dropdownItems = getDropdownItems(\n      eventData,\n      isTouchEvent,\n      availableTools\n    );\n\n    // Skip if there is no dropdown item\n    if (!dropdownItems.length) {\n      return '';\n    }\n\n    const dropdownComponents = dropdownItems.map(item => {\n      const itemOnClick = event => {\n        item.action(item.params);\n        if (this.props.onClose) {\n          this.props.onClose();\n        }\n      };\n\n      return (\n        <li key={item.actionType}>\n          <button className=\"form-action\" onClick={itemOnClick}>\n            <span key={item.actionType}>{item.text}</span>\n          </button>\n        </li>\n      );\n    });\n\n    const position = {\n      top: `${eventData.currentPoints.canvas.y}px`,\n      left: `${eventData.currentPoints.canvas.x}px`,\n    };\n\n    return (\n      <div className=\"ToolContextMenu\" style={position} ref={this.mainElement}>\n        <ul className=\"bounded\">{dropdownComponents}</ul>\n      </div>\n    );\n  }\n\n  componentDidMount = () => {\n    if (this.mainElement.current) {\n      this.updateElementPosition();\n    }\n  };\n\n  componentDidUpdate = () => {\n    if (this.mainElement.current) {\n      this.updateElementPosition();\n    }\n  };\n\n  updateElementPosition = () => {\n    const {\n      offsetParent,\n      offsetTop,\n      offsetHeight,\n      offsetWidth,\n      offsetLeft,\n    } = this.mainElement.current;\n\n    const { eventData } = this.props;\n\n    if (offsetTop + offsetHeight > offsetParent.offsetHeight) {\n      const offBoundPixels =\n        offsetTop + offsetHeight - offsetParent.offsetHeight;\n      const top = eventData.currentPoints.canvas.y - offBoundPixels;\n\n      this.mainElement.current.style.top = `${top > 0 ? top : 0}px`;\n    }\n\n    if (offsetLeft + offsetWidth > offsetParent.offsetWidth) {\n      const offBoundPixels =\n        offsetLeft + offsetWidth - offsetParent.offsetWidth;\n      const left = eventData.currentPoints.canvas.x - offBoundPixels;\n\n      this.mainElement.current.style.left = `${left > 0 ? left : 0}px`;\n    }\n  };\n}\n\nexport default ToolContextMenu;\n","import { connect } from 'react-redux';\nimport ToolContextMenu from './ToolContextMenu';\n\nconst mapStateToProps = (state, ownProps) => {\n  if (!state.ui || !state.ui.contextMenu) {\n    return {\n      visible: false,\n    };\n  }\n\n  const { viewportIndex } = ownProps;\n  const toolContextMenuData = state.ui.contextMenu[viewportIndex];\n  let availableTools;\n\n  if (\n    state.extensions &&\n    state.extensions.cornerstone &&\n    state.extensions.cornerstone.availableTools\n  ) {\n    availableTools = state.extensions.cornerstone.availableTools;\n  }\n\n  return {\n    ...toolContextMenuData,\n    availableTools,\n  };\n};\n\nconst ConnectedToolContextMenu = connect(\n  mapStateToProps,\n  null\n)(ToolContextMenu);\n\nexport default ConnectedToolContextMenu;\n","import './OHIFLogo.css';\n\nimport { Icon } from 'react-viewerbase';\nimport React from 'react';\n\nfunction OHIFLogo() {\n  return (\n    <a\n      target=\"_blank\"\n      rel=\"noopener noreferrer\"\n      className=\"header-brand\"\n      href=\"http://ohif.org\"\n    >\n      <Icon name=\"ohif-logo\" className=\"header-logo-image\" />\n      <div className=\"header-logo-text\">Open Health Imaging Foundation</div>\n    </a>\n  );\n}\n\nexport default OHIFLogo;\n","import OHIFLogo from './components/OHIFLogo/OHIFLogo.js';\nimport React from 'react';\n\nconst defaultContextValues = {\n  logoComponent: OHIFLogo(),\n};\n\nconst WhiteLabellingContext = React.createContext(defaultContextValues);\n\nexport default WhiteLabellingContext;\n","import './Header.css';\n\nimport { Link, withRouter } from 'react-router-dom';\nimport React, { Component } from 'react';\n\nimport { Dropdown } from 'react-viewerbase';\nimport { withTranslation } from 'react-i18next';\nimport './Header.css';\nimport OHIFLogo from '../OHIFLogo/OHIFLogo.js';\nimport PropTypes from 'prop-types';\n// import { UserPreferencesModal } from 'react-viewerbase';\nimport { hotkeysManager } from './../../App.js';\n\nclass Header extends Component {\n  static propTypes = {\n    home: PropTypes.bool.isRequired,\n    location: PropTypes.object.isRequired,\n    children: PropTypes.node,\n    t: PropTypes.func.isRequired,\n  };\n\n  static defaultProps = {\n    home: true,\n    children: OHIFLogo(),\n  };\n\n  // onSave: data => {\n  //   const contextName = window.store.getState().commandContext.context;\n  //   const preferences = cloneDeep(window.store.getState().preferences);\n  //   preferences[contextName] = data;\n  //   dispatch(setUserPreferences(preferences));\n  //   dispatch(setUserPreferencesModalOpen(false));\n  //   OHIF.hotkeysUtil.setHotkeys(data.hotKeysData);\n  // },\n  // onResetToDefaults: () => {\n  //   dispatch(setUserPreferences());\n  //   dispatch(setUserPreferencesModalOpen(false));\n  //   OHIF.hotkeysUtil.setHotkeys();\n  // },\n\n  constructor(props) {\n    super(props);\n    this.state = { isUserPreferencesOpen: false };\n\n    // const onClick = this.toggleUserPreferences.bind(this);\n\n    this.loadOptions();\n  }\n\n  loadOptions() {\n    const { t } = this.props;\n    this.options = [\n      // {\n      //   title: t('Preferences'),\n      //   icon: { name: 'user' },\n      //   onClick: onClick,\n      // },\n      {\n        title: t('About'),\n        icon: {\n          name: 'info',\n        },\n        link: 'http://ohif.org',\n      },\n    ];\n\n    this.hotKeysData = hotkeysManager.hotkeyDefinitions;\n  }\n\n  toggleUserPreferences() {\n    const isOpen = this.state.isUserPreferencesOpen;\n\n    this.setState({\n      isUserPreferencesOpen: !isOpen,\n    });\n  }\n\n  onUserPreferencesSave({ windowLevelData, hotKeysData }) {\n    // console.log(windowLevelData);\n    // console.log(hotKeysData);\n    // TODO: Update hotkeysManager\n    // TODO: reset `this.hotKeysData`\n  }\n\n  render() {\n    const { t } = this.props;\n    return (\n      <div className={`entry-header ${this.props.home ? 'header-big' : ''}`}>\n        <div className=\"header-left-box\">\n          {this.props.location && this.props.location.studyLink && (\n            <Link\n              to={this.props.location.studyLink}\n              className=\"header-btn header-viewerLink\"\n            >\n              {t('Back to Viewer')}\n            </Link>\n          )}\n\n          {this.props.children}\n\n          {!this.props.home && (\n            <Link\n              className=\"header-btn header-studyListLinkSection\"\n              to={{\n                pathname: '/',\n                state: { studyLink: this.props.location.pathname },\n              }}\n            >\n              {t('Study list')}\n            </Link>\n          )}\n        </div>\n\n        <div className=\"header-menu\">\n          <span className=\"research-use\">{t('INVESTIGATIONAL USE ONLY')}</span>\n          <Dropdown title={t('Options')} list={this.options} align=\"right\" />\n          {/* <ConnectedUserPreferencesModal /> */}\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default withTranslation('Header')(withRouter(Header));\n","import Header from '../components/Header/Header.js';\nimport { connect } from 'react-redux';\n\nconst mapStateToProps = state => {\n  return {\n    isOpen: state.ui.userPreferencesModalOpen,\n  };\n};\n\nconst ConnectedHeader = connect(mapStateToProps)(Header);\n\nexport default ConnectedHeader;\n","import { connect } from 'react-redux';\nimport { MeasurementTable } from 'react-viewerbase';\nimport OHIF from 'ohif-core';\nimport moment from 'moment';\nimport cornerstone from 'cornerstone-core';\nimport jumpToRowItem from '../lib/jumpToRowItem.js';\nimport getMeasurementLocationCallback from '../lib/getMeasurementLocationCallback';\n\nconst { setViewportSpecificData } = OHIF.redux.actions;\nconst { MeasurementApi } = OHIF.measurements;\n\nfunction groupBy(list, props) {\n  return list.reduce((a, b) => {\n    (a[b[props]] = a[b[props]] || []).push(b);\n    return a;\n  }, {});\n}\n\nfunction getAllTools() {\n  const config = OHIF.measurements.MeasurementApi.getConfiguration();\n  let tools = [];\n  config.measurementTools.forEach(\n    toolGroup => (tools = tools.concat(toolGroup.childTools))\n  );\n\n  return tools;\n}\n\nfunction getMeasurementText(measurementData) {\n  const { location, description } = measurementData;\n  let text = '...';\n  if (location) {\n    text = location;\n    if (description) {\n      text += `(${description})`;\n    }\n  }\n  return text;\n}\n\nfunction getDataForEachMeasurementNumber(\n  measurementNumberList,\n  timepoints,\n  displayFunction\n) {\n  const data = [];\n  // on each measurement number we should get each measurement data by available timepoint\n  measurementNumberList.forEach(measurement => {\n    timepoints.forEach(timepoint => {\n      const eachData = {\n        displayText: '...',\n      };\n      if (measurement.timepointId === timepoint.timepointId) {\n        eachData.displayText = displayFunction(measurement);\n      }\n      data.push(eachData);\n    });\n  });\n\n  return data;\n}\n\nfunction convertMeasurementsToTableData(toolCollections, timepoints) {\n  const config = OHIF.measurements.MeasurementApi.getConfiguration();\n  const toolGroups = config.measurementTools;\n  const tools = getAllTools();\n\n  const tableMeasurements = toolGroups.map(toolGroup => {\n    return {\n      groupName: toolGroup.name,\n      groupId: toolGroup.id,\n      measurements: [],\n    };\n  });\n\n  Object.keys(toolCollections).forEach(toolId => {\n    const toolMeasurements = toolCollections[toolId];\n    const tool = tools.find(tool => tool.id === toolId);\n    const { displayFunction } = tool.options.measurementTable;\n\n    // Group by measurementNumber so we can display then all in the same line\n    const groupedMeasurements = groupBy(toolMeasurements, 'measurementNumber');\n\n    Object.keys(groupedMeasurements).forEach(groupedMeasurementsIndex => {\n      const measurementNumberList =\n        groupedMeasurements[groupedMeasurementsIndex];\n      const measurementData = measurementNumberList[0];\n      const {\n        measurementNumber,\n        lesionNamingNumber,\n        toolType,\n      } = measurementData;\n      const measurementId = measurementData._id;\n\n      //check if all measurements with same measurementNumber will have same LABEL\n      const tableMeasurement = {\n        itemNumber: lesionNamingNumber,\n        label: getMeasurementText(measurementData),\n        measurementId,\n        measurementNumber,\n        lesionNamingNumber,\n        toolType,\n        hasWarnings: false, //TODO\n        warningTitle: '', //TODO\n        isSplitLesion: false, //TODO\n        warningList: [], //TODO\n        data: getDataForEachMeasurementNumber(\n          measurementNumberList,\n          timepoints,\n          displayFunction\n        ),\n      };\n\n      // find the group object for the tool\n      const toolGroupMeasurements = tableMeasurements.find(group => {\n        return group.groupId === tool.toolGroup;\n      });\n      // inject the new measurement for this measurementNumer\n      toolGroupMeasurements.measurements.push(tableMeasurement);\n    });\n  });\n\n  // Sort measurements by lesion naming number\n  tableMeasurements.forEach(tm => {\n    tm.measurements.sort((m1, m2) =>\n      m1.lesionNamingNumber > m2.lesionNamingNumber ? 1 : -1\n    );\n  });\n\n  return tableMeasurements;\n}\n\nfunction convertTimepointsToTableData(timepoints) {\n  if (!timepoints || !timepoints.length) {\n    return [];\n  }\n\n  return [\n    {\n      label: 'Study date:',\n      date: moment(timepoints[0].latestDate).format('DD-MMM-YY'),\n    },\n  ];\n}\n\nconst mapStateToProps = state => {\n  const { timepoints, measurements } = state.timepointManager;\n  return {\n    timepoints: convertTimepointsToTableData(timepoints),\n    measurementCollection: convertMeasurementsToTableData(\n      measurements,\n      timepoints\n    ),\n    timepointManager: state.timepointManager,\n    viewports: state.viewports,\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    dispatchRelabel: (event, measurementData, viewportsState) => {\n      const activeViewportIndex =\n        (viewportsState && viewportsState.activeViewportIndex) || 0;\n\n      const enabledElements = cornerstone.getEnabledElements();\n      if (!enabledElements || enabledElements.length <= activeViewportIndex) {\n        OHIF.log.error('Failed to find the enabled element');\n        return;\n      }\n\n      const { element } = enabledElements[activeViewportIndex];\n\n      const eventData = {\n        event: {\n          clientX: event.clientX,\n          clientY: event.clientY,\n        },\n        element,\n      };\n\n      const { toolType, measurementId } = measurementData;\n      const tool = MeasurementApi.Instance.tools[toolType].find(measurement => {\n        return measurement._id === measurementId;\n      });\n\n      const options = {\n        skipAddLabelButton: true,\n        editLocation: true,\n      };\n\n      // Clone the tool not to set empty location initially\n      const toolForLocation = Object.assign({}, tool, { location: null });\n      getMeasurementLocationCallback(eventData, toolForLocation, options);\n    },\n    dispatchEditDescription: (event, measurementData, viewportsState) => {\n      const activeViewportIndex =\n        (viewportsState && viewportsState.activeViewportIndex) || 0;\n\n      const enabledElements = cornerstone.getEnabledElements();\n      if (!enabledElements || enabledElements.length <= activeViewportIndex) {\n        OHIF.log.error('Failed to find the enabled element');\n        return;\n      }\n\n      const { element } = enabledElements[activeViewportIndex];\n\n      const eventData = {\n        event: {\n          clientX: event.clientX,\n          clientY: event.clientY,\n        },\n        element,\n      };\n\n      const { toolType, measurementId } = measurementData;\n      const tool = MeasurementApi.Instance.tools[toolType].find(measurement => {\n        return measurement._id === measurementId;\n      });\n\n      const options = {\n        editDescriptionOnDialog: true,\n      };\n\n      getMeasurementLocationCallback(eventData, tool, options);\n    },\n    dispatchJumpToRowItem: (\n      measurementData,\n      viewportsState,\n      timepointManagerState,\n      options\n    ) => {\n      const actionData = jumpToRowItem(\n        measurementData,\n        viewportsState,\n        timepointManagerState,\n        dispatch,\n        options\n      );\n\n      actionData.viewportSpecificData.forEach(viewportSpecificData => {\n        const { viewportIndex, displaySet } = viewportSpecificData;\n\n        dispatch(setViewportSpecificData(viewportIndex, displaySet));\n      });\n\n      const { toolType, measurementNumber } = measurementData;\n      const measurementApi = MeasurementApi.Instance;\n\n      Object.keys(measurementApi.tools).forEach(toolType => {\n        const measurements = measurementApi.tools[toolType];\n\n        measurements.forEach(measurement => {\n          measurement.active = false;\n        });\n      });\n\n      const measurementsToActive = measurementApi.tools[toolType].filter(\n        measurement => {\n          return measurement.measurementNumber === measurementNumber;\n        }\n      );\n\n      measurementsToActive.forEach(measurementToActive => {\n        measurementToActive.active = true;\n      });\n\n      measurementApi.syncMeasurementsAndToolData();\n\n      cornerstone.getEnabledElements().forEach(enabledElement => {\n        cornerstone.updateImage(enabledElement.element);\n      });\n\n      // Needs to update viewports.layout state to set layout\n      //const layout = actionData.layout;\n      //dispatch(setLayout(layout))\n\n      // Needs to update viewports.activeViewportIndex to the first updated viewport\n      //const viewportIndex = actionData.viewportIndex;\n      //dispatch(setViewportActive(viewportIndex));\n\n      // Needs to update timepointsManager.measurements state to set active measurementId\n      // TODO: Not yet implemented\n      //dispatch(setActiveMeasurement(measurementData.measurementId))\n\n      // (later): Needs to set some property on state.extensions.cornerstone to synchronize viewport scrolling\n    },\n  };\n};\n\nconst mergeProps = (propsFromState, propsFromDispatch, ownProps) => {\n  return {\n    timepoints: propsFromState.timepoints,\n    measurementCollection: propsFromState.measurementCollection,\n    selectedMeasurementNumber: ownProps.selectedMeasurementNumber,\n    ...propsFromDispatch,\n    onItemClick: (event, measurementData) => {\n      // TODO: Add timepointId to .data for measurementData?\n      // TODO: Tooltype should be on the level below? This should\n      // provide the entire row item?\n\n      const viewportsState = propsFromState.viewports;\n      const timepointManagerState = propsFromState.timepointManager;\n\n      // TODO: invertViewportTimepointsOrder should be stored in / read from user preferences\n      // TODO: childToolKey should come from the measurement table when it supports child tools\n      const options = {\n        invertViewportTimepointsOrder: false,\n        childToolKey: null,\n      };\n\n      propsFromDispatch.dispatchJumpToRowItem(\n        measurementData,\n        viewportsState,\n        timepointManagerState,\n        options\n      );\n    },\n    onRelabelClick: (event, measurementData) => {\n      const viewportsState = propsFromState.viewports;\n      propsFromDispatch.dispatchRelabel(event, measurementData, viewportsState);\n    },\n    onEditDescriptionClick: (event, measurementData) => {\n      const viewportsState = propsFromState.viewports;\n      propsFromDispatch.dispatchEditDescription(\n        event,\n        measurementData,\n        viewportsState\n      );\n    },\n    onDeleteClick: (event, measurementData) => {\n      const { MeasurementHandlers } = OHIF.measurements;\n\n      MeasurementHandlers.onRemoved({\n        detail: {\n          toolType: measurementData.toolType,\n          measurementData: {\n            _id: measurementData.measurementId,\n            lesionNamingNumber: measurementData.lesionNamingNumber,\n            measurementNumber: measurementData.measurementNumber,\n          },\n        },\n      });\n    },\n  };\n};\n\nconst ConnectedMeasurementTable = connect(\n  mapStateToProps,\n  mapDispatchToProps,\n  mergeProps\n)(MeasurementTable);\n\nexport default ConnectedMeasurementTable;\n","import { OHIF } from 'ohif-core';\n\n// TODO: Move this function to OHIF itself so we can use it on the OHIF measurment table (when it is finished)\n\n/**\n * Activates a set of measurements\n *\n * @param measurementData\n * @param viewportsState\n * @param timepointManagerState\n * @param options\n */\nexport default function jumpToRowItem(\n  measurementData,\n  viewportsState,\n  timepointManagerState,\n  options = { invertViewportTimepointsOrder: false, childToolKey: null }\n) {\n  const numViewports = viewportsState.layout.viewports.length;\n  const numTimepoints = timepointManagerState.timepoints.length;\n  const { measurements, timepoints } = timepointManagerState;\n  const numViewportsToUpdate = Math.min(numTimepoints, numViewports);\n  const { toolType, measurementNumber } = measurementData;\n\n  if (options.invertViewportTimepointsOrder) {\n    timepoints.reverse();\n  }\n\n  const measurementsForToolGroup = measurements[toolType];\n\n  // Retrieve the measurements data\n  const measurementsToJumpTo = [];\n  for (let i = 0; i < numViewportsToUpdate; i++) {\n    const { timepointId } = timepoints[i];\n\n    const dataAtThisTimepoint = measurementsForToolGroup.find(entry => {\n      return (\n        entry.timepointId === timepointId &&\n        entry.measurementNumber === measurementNumber\n      );\n    });\n\n    if (!dataAtThisTimepoint) {\n      measurementsToJumpTo.push(null);\n      continue;\n    }\n\n    let measurement = dataAtThisTimepoint;\n\n    const { tool } = OHIF.measurements.MeasurementApi.getToolConfiguration(\n      toolType\n    );\n    if (options.childToolKey) {\n      measurement = dataAtThisTimepoint[options.childToolKey];\n    } else if (Array.isArray(tool.childTools)) {\n      const key = tool.childTools.find(key => !!dataAtThisTimepoint[key]);\n      measurement = dataAtThisTimepoint[key];\n    }\n\n    measurementsToJumpTo.push(measurement);\n  }\n\n  // TODO: Add a single viewports state action which allows\n  // - viewportData to be set\n  // - layout to be set\n  // - activeViewport to be set\n\n  // Needs to update viewports.viewportData state to set image set data\n\n  const displaySetContainsSopInstance = (displaySet, sopInstanceUid) =>\n    displaySet.images.find(\n      image => image.getSOPInstanceUID() === sopInstanceUid\n    );\n\n  const viewportSpecificData = [];\n  measurementsToJumpTo.forEach((data, viewportIndex) => {\n    // Skip if there is no measurement to jump\n    if (!data) {\n      return;\n    }\n\n    const study = OHIF.utils.studyMetadataManager.get(data.studyInstanceUid);\n    if (!study) {\n      throw new Error('Study not found.');\n    }\n\n    const displaySet = study.findDisplaySet(displaySet => {\n      return displaySetContainsSopInstance(displaySet, data.sopInstanceUid);\n    });\n\n    if (!displaySet) {\n      throw new Error('Display set not found.');\n    }\n\n    displaySet.sopInstanceUid = data.sopInstanceUid;\n    if (data.frameIndex) {\n      displaySet.frameIndex = data.frameIndex;\n    }\n\n    viewportSpecificData.push({\n      viewportIndex,\n      displaySet,\n    });\n  });\n\n  return {\n    viewportSpecificData,\n    layout: [], // TODO: if we need to change layout, we should return this here\n  };\n}\n","import { connect } from 'react-redux';\nimport { StudyBrowser } from 'react-viewerbase';\nimport cloneDeep from 'lodash.clonedeep';\n\n// TODO\n// - Determine in which display set is active from Redux (activeViewportIndex and layout viewportData)\n// - Pass in errors and stack loading progress from Redux\nconst mapStateToProps = (state, ownProps) => {\n  // If we know that the stack loading progress details have changed,\n  // we can try to update the component state so that the thumbnail\n  // progress bar is updated\n  const stackLoadingProgressMap = state.loading.progress;\n  const studiesWithLoadingData = cloneDeep(ownProps.studies);\n\n  studiesWithLoadingData.forEach(study => {\n    study.thumbnails.forEach(data => {\n      const { displaySetInstanceUid } = data;\n      const stackId = `StackProgress:${displaySetInstanceUid}`;\n      const stackProgressData = stackLoadingProgressMap[stackId];\n\n      let stackPercentComplete = 0;\n      if (stackProgressData) {\n        stackPercentComplete = stackProgressData.percentComplete;\n      }\n\n      data.stackPercentComplete = stackPercentComplete;\n    });\n  });\n\n  return {\n    studies: studiesWithLoadingData,\n  };\n};\n\nconst ConnectedStudyBrowser = connect(\n  mapStateToProps,\n  null\n)(StudyBrowser);\n\nexport default ConnectedStudyBrowser;\n","import { connect } from 'react-redux';\nimport { LayoutManager } from 'react-viewerbase';\nimport OHIF from 'ohif-core';\n\nconst mapStateToProps = state => {\n  const viewportPluginIds = state.plugins.availablePlugins\n    .filter(plugin => plugin.type === OHIF.plugins.PLUGIN_TYPES.VIEWPORT)\n    .map(plugin => plugin.id);\n\n  const availablePlugins = {};\n  viewportPluginIds.forEach(id => {\n    const plugin = OHIF.plugins.availablePlugins.find(\n      plugin => plugin.id === id\n    );\n    if (plugin) {\n      availablePlugins[id] = plugin.component;\n    }\n  });\n\n  // TODO Use something like state.plugins.defaultPlugin[OHIF.plugins.PLUGIN_TYPES.VIEWPORT]\n  let defaultPlugin;\n  if (viewportPluginIds && viewportPluginIds.length) {\n    defaultPlugin = viewportPluginIds[0];\n  }\n\n  return {\n    layout: state.viewports.layout,\n    activeViewportIndex: state.viewports.activeViewportIndex,\n    availablePlugins,\n    defaultPlugin,\n  };\n};\n\nconst ConnectedLayoutManager = connect(\n  mapStateToProps,\n  null\n)(LayoutManager);\n\nexport default ConnectedLayoutManager;\n","import './ViewerMain.css';\n\nimport { Component } from 'react';\nimport ConnectedLayoutManager from './ConnectedLayoutManager.js';\n// import { OHIF } from 'ohif-core';\n//\nimport PropTypes from 'prop-types';\nimport React from 'react';\n\nclass ViewerMain extends Component {\n  static propTypes = {\n    activeViewportIndex: PropTypes.number.isRequired,\n    layout: PropTypes.object,\n    viewportSpecificData: PropTypes.object,\n    setViewportSpecificData: PropTypes.func.isRequired,\n    clearViewportSpecificData: PropTypes.func.isRequired,\n  };\n\n  constructor(props) {\n    super(props);\n\n    // Initialize hotkeys\n    // new OHIF.HotkeysUtil('viewer', {\n    //   setViewportSpecificData: props.setViewportSpecificData,\n    //   clearViewportSpecificData: props.clearViewportSpecificData,\n    //   setToolActive: props.setToolActive,\n    //   setActiveViewportSpecificData: props.setActiveViewportSpecificData,\n    // });\n    // hotkeys.init();\n\n    this.state = {\n      displaySets: [],\n    };\n\n    this.cachedViewportData = {};\n  }\n\n  getDisplaySets(studies) {\n    const displaySets = [];\n    studies.forEach(study => {\n      study.displaySets.forEach(dSet => {\n        if (!dSet.plugin) {\n          dSet.plugin = 'cornerstone';\n        }\n        displaySets.push(dSet);\n      });\n    });\n\n    return displaySets;\n  }\n\n  findDisplaySet(studies, studyInstanceUid, displaySetInstanceUid) {\n    const study = studies.find(study => {\n      return study.studyInstanceUid === studyInstanceUid;\n    });\n\n    if (!study) {\n      return;\n    }\n\n    return study.displaySets.find(displaySet => {\n      return displaySet.displaySetInstanceUid === displaySetInstanceUid;\n    });\n  }\n\n  componentDidMount() {\n    // Add beforeUnload event handler to check for unsaved changes\n    //window.addEventListener('beforeunload', unloadHandlers.beforeUnload);\n\n    // Get all the display sets for the viewer studies\n    const displaySets = this.getDisplaySets(this.props.studies);\n\n    this.setState({\n      displaySets,\n    });\n  }\n\n  getViewportData = () => {\n    const viewportData = [];\n    const { layout, viewportSpecificData } = this.props;\n\n    for (\n      let viewportIndex = 0;\n      viewportIndex < layout.viewports.length;\n      viewportIndex++\n    ) {\n      let displaySet = viewportSpecificData[viewportIndex];\n\n      // Use the cached display set in viewport if the new one is empty\n      if (displaySet && !displaySet.displaySetInstanceUid) {\n        displaySet = this.cachedViewportData[viewportIndex];\n      }\n\n      if (\n        displaySet &&\n        displaySet.studyInstanceUid &&\n        displaySet.displaySetInstanceUid\n      ) {\n        // Get missing fields from original display set\n        const originalDisplaySet = this.findDisplaySet(\n          this.props.studies,\n          displaySet.studyInstanceUid,\n          displaySet.displaySetInstanceUid\n        );\n        viewportData.push(Object.assign({}, originalDisplaySet, displaySet));\n      } else {\n        // If the viewport is empty, get one available in study\n        const { displaySets } = this.state;\n        displaySet = displaySets.find(\n          ds =>\n            !viewportData.some(\n              v => v.displaySetInstanceUid === ds.displaySetInstanceUid\n            )\n        );\n        viewportData.push(Object.assign({}, displaySet));\n      }\n    }\n\n    this.cachedViewportData = viewportData;\n\n    return viewportData;\n  };\n\n  setViewportData = ({ viewportIndex, item }) => {\n    const displaySet = this.findDisplaySet(\n      this.props.studies,\n      item.studyInstanceUid,\n      item.displaySetInstanceUid\n    );\n\n    this.props.setViewportSpecificData(viewportIndex, displaySet);\n  };\n\n  render() {\n    return (\n      <div className=\"ViewerMain\">\n        <ConnectedLayoutManager\n          studies={this.props.studies}\n          viewportData={this.getViewportData()}\n          setViewportData={this.setViewportData}\n        />\n      </div>\n    );\n  }\n\n  componentWillUnmount() {\n    // Clear the entire viewport specific data\n    const { viewportSpecificData } = this.props;\n    Object.keys(viewportSpecificData).forEach(viewportIndex => {\n      this.props.clearViewportSpecificData(viewportIndex);\n    });\n\n    // TODO: These don't have to be viewer specific?\n    // Could qualify for other routes?\n    // hotkeys.destroy();\n\n    // Remove beforeUnload event handler...\n    //window.removeEventListener('beforeunload', unloadHandlers.beforeUnload);\n    // Destroy the synchronizer used to update reference lines\n    //OHIF.viewer.updateImageSynchronizer.destroy();\n    // TODO: Instruct all plugins to clean up themselves\n    //\n    // Clear references to all stacks in the StackManager\n    //StackManager.clearStacks();\n    // @TypeSafeStudies\n    // Clears OHIF.viewer.Studies collection\n    //OHIF.viewer.Studies.removeAll();\n    // @TypeSafeStudies\n    // Clears OHIF.viewer.StudyMetadataList collection\n    //OHIF.viewer.StudyMetadataList.removeAll();\n  }\n}\n\nexport default ViewerMain;\n","import OHIF from 'ohif-core';\nimport ViewerMain from './ViewerMain';\nimport { connect } from 'react-redux';\n\nconst {\n  setViewportSpecificData,\n  clearViewportSpecificData,\n  // setToolActive,\n  // setActiveViewportSpecificData,\n} = OHIF.redux.actions;\n\nconst mapStateToProps = state => {\n  const { activeViewportIndex, layout, viewportSpecificData } = state.viewports;\n\n  return {\n    activeViewportIndex,\n    layout,\n    viewportSpecificData,\n    viewports: state.viewports,\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    setViewportSpecificData: (viewportIndex, data) => {\n      dispatch(setViewportSpecificData(viewportIndex, data));\n    },\n    clearViewportSpecificData: () => {\n      dispatch(clearViewportSpecificData());\n    },\n    // setToolActive: tool => {\n    //   dispatch(setToolActive(tool));\n    // },\n    // setActiveViewportSpecificData: viewport => {\n    //   dispatch(setActiveViewportSpecificData(viewport));\n    // },\n  };\n};\n\nconst ConnectedViewerMain = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(ViewerMain);\n\nexport default ConnectedViewerMain;\n","import './FlexboxLayout.css';\n\nimport React, { Component } from 'react';\n\nimport ConnectedMeasurementTable from './ConnectedMeasurementTable';\nimport ConnectedStudyBrowser from './ConnectedStudyBrowser.js';\nimport ConnectedViewerMain from './ConnectedViewerMain.js';\nimport PropTypes from 'prop-types';\n\nclass FlexboxLayout extends Component {\n  static propTypes = {\n    studies: PropTypes.array.isRequired,\n    leftSidebarOpen: PropTypes.bool.isRequired,\n    rightSidebarOpen: PropTypes.bool.isRequired,\n  };\n\n  state = {\n    studiesForBrowser: [],\n  };\n\n  componentDidMount() {\n    const studiesForBrowser = this.getStudiesForBrowser();\n\n    this.setState({\n      studiesForBrowser,\n    });\n  }\n\n  getStudiesForBrowser = () => {\n    const { studies } = this.props;\n\n    // TODO[react]:\n    // - Add sorting of display sets\n    // - Add useMiddleSeriesInstanceAsThumbnail\n    // - Add showStackLoadingProgressBar option\n    return studies.map(study => {\n      const { studyInstanceUid } = study;\n\n      const thumbnails = study.displaySets.map(displaySet => {\n        const {\n          displaySetInstanceUid,\n          seriesDescription,\n          seriesNumber,\n          instanceNumber,\n          numImageFrames,\n          // TODO: This is undefined\n          // modality,\n        } = displaySet;\n\n        let imageId;\n        let altImageText = ' '; // modality\n\n        if (displaySet.images && displaySet.images.length) {\n          imageId = displaySet.images[0].getImageId();\n        } else {\n          altImageText = 'SR';\n        }\n\n        return {\n          imageId,\n          altImageText,\n          displaySetInstanceUid,\n          seriesDescription,\n          seriesNumber,\n          instanceNumber,\n          numImageFrames,\n        };\n      });\n\n      return {\n        studyInstanceUid,\n        thumbnails,\n      };\n    });\n  };\n\n  render() {\n    let mainContentClassName = 'main-content';\n    if (this.props.leftSidebarOpen) {\n      mainContentClassName += ' sidebar-left-open';\n    }\n\n    if (this.props.rightSidebarOpen) {\n      mainContentClassName += ' sidebar-right-open';\n    }\n\n    // TODO[react]: Make ConnectedMeasurementTable extension with state.timepointManager\n    return (\n      <div className=\"FlexboxLayout\">\n        <div\n          className={\n            this.props.leftSidebarOpen\n              ? 'sidebar-menu sidebar-left sidebar-open'\n              : 'sidebar-menu sidebar-left'\n          }\n        >\n          <ConnectedStudyBrowser studies={this.state.studiesForBrowser} />\n        </div>\n        <div className={mainContentClassName}>\n          <ConnectedViewerMain studies={this.props.studies} />\n        </div>\n        <div\n          className={\n            this.props.rightSidebarOpen\n              ? 'sidebar-menu sidebar-right sidebar-open'\n              : 'sidebar-menu sidebar-right'\n          }\n        >\n          <ConnectedMeasurementTable />\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default FlexboxLayout;\n","import { connect } from 'react-redux';\nimport FlexboxLayout from './FlexboxLayout';\n\nconst mapStateToProps = state => {\n  return {\n    leftSidebarOpen: state.ui.leftSidebarOpen,\n    rightSidebarOpen: state.ui.rightSidebarOpen,\n  };\n};\n\nconst ConnectedFlexboxLayout = connect(\n  mapStateToProps,\n  null\n)(FlexboxLayout);\n\nexport default ConnectedFlexboxLayout;\n","export const addActiveContext = state => ({\n  type: 'ADD_ACTIVE_CONTEXT',\n  state,\n});\n\nexport const removeActiveContext = state => ({\n  type: 'REMOVE_ACTIVE_CONTEXT',\n  state,\n});\n\nexport const clearActiveContexts = state => ({\n  type: 'CLEAR_ACTIVE_CONTEXTS',\n  state,\n});\n\nexport const setLeftSidebarOpen = state => ({\n  type: 'SET_LEFT_SIDEBAR_OPEN',\n  state,\n});\n\nexport const setRightSidebarOpen = state => ({\n  type: 'SET_RIGHT_SIDEBAR_OPEN',\n  state,\n});\n\nconst actions = {\n  addActiveContext,\n  removeActiveContext,\n  clearActiveContexts,\n  //\n  setLeftSidebarOpen,\n  setRightSidebarOpen,\n};\n\nexport default actions;\n","import { connect } from 'react-redux';\nimport { LayoutButton } from 'react-viewerbase';\nimport OHIF from 'ohif-core';\n\nconst { setLayout } = OHIF.redux.actions;\n\nconst mapStateToProps = state => {\n  return {\n    currentLayout: state.viewports.layout,\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    // TODO: Change if layout switched becomes more complex\n    onChange: selectedCell => {\n      let viewports = [];\n      const rows = selectedCell.row + 1;\n      const columns = selectedCell.col + 1;\n      const numViewports = rows * columns;\n      for (let i = 0; i < numViewports; i++) {\n        viewports.push({\n          height: `${100 / rows}%`,\n          width: `${100 / columns}%`,\n        });\n      }\n      const layout = {\n        viewports,\n      };\n\n      dispatch(setLayout(layout));\n    },\n  };\n};\n\nconst ConnectedLayoutButton = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(LayoutButton);\n\nexport default ConnectedLayoutButton;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { ExpandableToolMenu } from 'react-viewerbase';\nimport './PluginSwitch.css';\n\nclass PluginSwitch extends Component {\n  static propTypes = {\n    buttons: PropTypes.array,\n  };\n\n  static defaultProps = {};\n\n  render() {\n    return (\n      <div className=\"PluginSwitch\">\n        <ExpandableToolMenu buttons={this.props.buttons} />\n      </div>\n    );\n  }\n}\n\nexport default PluginSwitch;\n","import { connect } from 'react-redux';\nimport PluginSwitch from './PluginSwitch.js';\nimport OHIF from 'ohif-core';\n\nconst { setLayout } = OHIF.redux.actions;\n\nconst mapStateToProps = state => {\n  const { activeViewportIndex, layout } = state.viewports;\n\n  return {\n    activeViewportIndex,\n    layout,\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    setLayout: data => {\n      dispatch(setLayout(data));\n    },\n  };\n};\n\nfunction setSingleLayoutData(originalArray, viewportIndex, data) {\n  const viewports = originalArray.slice();\n  const layoutData = Object.assign({}, viewports[viewportIndex], data);\n\n  viewports[viewportIndex] = layoutData;\n\n  return viewports;\n}\n\nconst mergeProps = (propsFromState, propsFromDispatch, ownProps) => {\n  const { activeViewportIndex, layout } = propsFromState;\n  const { setLayout } = propsFromDispatch;\n\n  // TODO: Do not display certain options if the current display set\n  // cannot be displayed using these view types\n  const buttons = [\n    {\n      text: 'Acquired',\n      type: 'command',\n      icon: 'bars',\n      active: false,\n      onClick: () => {\n        console.warn('Original Acquisition');\n\n        const layoutData = setSingleLayoutData(\n          layout.viewports,\n          activeViewportIndex,\n          { plugin: 'cornerstone' }\n        );\n\n        setLayout({ viewports: layoutData });\n      },\n    },\n    {\n      text: 'Axial',\n      icon: 'cube',\n      active: false,\n      onClick: () => {\n        console.warn('Axial');\n        const data = {\n          plugin: 'vtk',\n          vtk: {\n            mode: 'mpr',\n            sliceNormal: [0, 0, 1],\n          },\n        };\n\n        const layoutData = setSingleLayoutData(\n          layout.viewports,\n          activeViewportIndex,\n          data\n        );\n\n        setLayout({ viewports: layoutData });\n      },\n    },\n    {\n      text: 'Sagittal',\n      icon: 'cube',\n      active: false,\n      onClick: () => {\n        console.warn('Sagittal');\n        const data = {\n          plugin: 'vtk',\n          vtk: {\n            mode: 'mpr',\n            sliceNormal: [1, 0, 0],\n          },\n        };\n\n        const layoutData = setSingleLayoutData(\n          layout.viewports,\n          activeViewportIndex,\n          data\n        );\n\n        setLayout({ viewports: layoutData });\n      },\n    },\n    {\n      text: 'Coronal',\n      icon: 'cube',\n      active: false,\n      onClick: () => {\n        console.warn('Coronal');\n        const data = {\n          plugin: 'vtk',\n          vtk: {\n            mode: 'mpr',\n            sliceNormal: [0, 1, 0],\n          },\n        };\n\n        const layoutData = setSingleLayoutData(\n          layout.viewports,\n          activeViewportIndex,\n          data\n        );\n\n        setLayout({ viewports: layoutData });\n      },\n    },\n    /*{\n      text: '3D',\n      icon: `#cube`,\n      onClick: (click) => {\n        console.warn('3D Perspective');\n        const data = {\n          plugin: 'vtk',\n          vtk: {\n            mode: '3d',\n          }\n        };\n\n        const layoutData = setSingleLayoutData(layout.viewports, activeViewportIndex, data);\n\n        setLayout({ viewports: layoutData });\n      }\n    }*/\n  ];\n\n  return {\n    buttons,\n  };\n};\n\nconst ConnectedPluginSwitch = connect(\n  mapStateToProps,\n  mapDispatchToProps,\n  mergeProps\n)(PluginSwitch);\n\nexport default ConnectedPluginSwitch;\n","import './ToolbarRow.css';\n\nimport React, { Component } from 'react';\n\nimport ConnectedLayoutButton from './ConnectedLayoutButton';\nimport ConnectedPluginSwitch from './ConnectedPluginSwitch.js';\nimport OHIF from 'ohif-core';\nimport PropTypes from 'prop-types';\nimport { RoundedButtonGroup } from 'react-viewerbase';\n\nclass ToolbarRow extends Component {\n  static propTypes = {\n    leftSidebarOpen: PropTypes.bool.isRequired,\n    rightSidebarOpen: PropTypes.bool.isRequired,\n    setLeftSidebarOpen: PropTypes.func,\n    setRightSidebarOpen: PropTypes.func,\n    pluginId: PropTypes.string,\n  };\n\n  static defaultProps = {\n    leftSidebarOpen: false,\n    rightSidebarOpen: false,\n  };\n\n  onLeftSidebarValueChanged = value => {\n    this.props.setLeftSidebarOpen(!!value);\n  };\n\n  onRightSidebarValueChanged = value => {\n    this.props.setRightSidebarOpen(!!value);\n  };\n\n  render() {\n    const leftSidebarToggle = [\n      {\n        value: 'studies',\n        icon: 'th-large',\n        bottomLabel: 'Series',\n      },\n    ];\n\n    const rightSidebarToggle = [\n      {\n        value: 'measurements',\n        icon: 'list',\n        bottomLabel: 'Measurements',\n      },\n    ];\n\n    const leftSidebarValue = this.props.leftSidebarOpen\n      ? leftSidebarToggle[0].value\n      : null;\n\n    const rightSidebarValue = this.props.rightSidebarOpen\n      ? rightSidebarToggle[0].value\n      : null;\n\n    const currentPluginId = this.props.pluginId;\n\n    const { PLUGIN_TYPES, availablePlugins } = OHIF.plugins;\n    const plugin = availablePlugins.find(entry => {\n      return (\n        entry.type === PLUGIN_TYPES.TOOLBAR && entry.id === currentPluginId\n      );\n    });\n\n    let pluginComp;\n    if (plugin) {\n      const PluginComponent = plugin.component;\n\n      pluginComp = <PluginComponent />;\n    }\n\n    return (\n      <div className=\"ToolbarRow\">\n        <div className=\"pull-left m-t-1 p-y-1\" style={{ padding: '10px' }}>\n          <RoundedButtonGroup\n            options={leftSidebarToggle}\n            value={leftSidebarValue}\n            onValueChanged={this.onLeftSidebarValueChanged}\n          />\n        </div>\n        {pluginComp}\n        <ConnectedLayoutButton />\n        <ConnectedPluginSwitch />\n        <div className=\"pull-right m-t-1 rm-x-1\" style={{ marginLeft: 'auto' }}>\n          <RoundedButtonGroup\n            options={rightSidebarToggle}\n            value={rightSidebarValue}\n            onValueChanged={this.onRightSidebarValueChanged}\n          />\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default ToolbarRow;\n","import {\n  setLeftSidebarOpen,\n  setRightSidebarOpen,\n} from './../store/layout/actions.js';\n\nimport ToolbarRow from './ToolbarRow';\nimport { connect } from 'react-redux';\n\nconst defaultPlugin = 'cornerstone';\n\nconst mapStateToProps = state => {\n  const { layout, viewportSpecificData, activeViewportIndex } = state.viewports;\n  const pluginInLayout =\n    layout.viewports[activeViewportIndex] &&\n    layout.viewports[activeViewportIndex].plugin;\n  const pluginInViewportData =\n    viewportSpecificData[activeViewportIndex] &&\n    viewportSpecificData[activeViewportIndex].plugin;\n  const pluginInActiveViewport =\n    pluginInLayout || pluginInViewportData || defaultPlugin;\n  //     const extensionData = state.extensions[pluginInActiveViewport];\n\n  return {\n    pluginId: pluginInActiveViewport,\n    leftSidebarOpen: state.ui.leftSidebarOpen,\n    rightSidebarOpen: state.ui.rightSidebarOpen,\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    setLeftSidebarOpen: state => {\n      dispatch(setLeftSidebarOpen(state));\n    },\n    setRightSidebarOpen: state => {\n      dispatch(setRightSidebarOpen(state));\n    },\n  };\n};\n\nconst ConnectedToolbarRow = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(ToolbarRow);\n\nexport default ConnectedToolbarRow;\n","import { Component } from 'react';\nimport React from 'react';\nimport PropTypes from 'prop-types';\n\nimport './SimpleDialog.css';\n\nclass SimpleDialog extends Component {\n  static defaultProps = {\n    componentStyle: {},\n    rootClass: '',\n  };\n\n  render() {\n    return (\n      <div\n        className={`simpleDialog ${this.props.rootClass}`}\n        ref={this.props.componentRef}\n        style={this.props.componentStyle}\n      >\n        <form>\n          <div className=\"header\">\n            <span className=\"closeBtn\" onClick={this.props.onClose}>\n              <span className=\"closeIcon\">x</span>\n            </span>\n            <h4 className=\"title\">{this.props.headerTitle}</h4>\n          </div>\n          <div className=\"content\">{this.props.children}</div>\n          <div className=\"footer\">\n            <button\n              type=\"button\"\n              className=\"btn btn-cancel\"\n              onClick={this.props.onClose}\n            >\n              Cancel\n            </button>\n            <button\n              type=\"button\"\n              className=\"btn btn-confirm\"\n              onClick={this.props.onConfirm}\n            >\n              Confirm\n            </button>\n          </div>\n        </form>\n      </div>\n    );\n  }\n}\n\nSimpleDialog.propTypes = {\n  headerTitle: PropTypes.string.isRequired,\n  onClose: PropTypes.func.isRequired,\n  onConfirm: PropTypes.func.isRequired,\n};\n\nexport default SimpleDialog;\n","export default function bounding(elementRef, currentPosition = {}) {\n  if (!elementRef.current) {\n    return;\n  }\n\n  const currentElement = elementRef.current;\n  const {\n    offsetParent,\n    offsetTop,\n    offsetHeight,\n    offsetLeft,\n    offsetWidth,\n  } = currentElement;\n  let top = currentPosition.top || offsetTop;\n  let left = currentPosition.left || offsetLeft;\n\n  if (!offsetParent) {\n    return;\n  }\n\n  let maxHeight = `${offsetParent.offsetHeight}px`;\n\n  if (offsetHeight + top > offsetParent.offsetHeight) {\n    top = top - (offsetHeight + top - offsetParent.offsetHeight);\n    if (top < 0) {\n      top = 0;\n    }\n  }\n\n  if (left + offsetWidth > offsetParent.offsetWidth) {\n    left = offsetParent.offsetWidth - offsetWidth;\n    if (left < 0) {\n      left = 0;\n    }\n  }\n\n  if (maxHeight && currentElement.style.maxHeight !== maxHeight) {\n    currentElement.style.maxHeight = maxHeight;\n  }\n  if (currentElement.style.top !== `${top}px`) {\n    currentElement.style.top = `${top}px`;\n  }\n  if (currentElement.style.left !== `${left}px`) {\n    currentElement.style.left = `${left}px`;\n  }\n}\n","import cornerstone from 'cornerstone-core';\n\nconst buttonSize = {\n  width: 96,\n  height: 28,\n};\n\nexport function getAddLabelButtonStyle(measurementData, eventData) {\n  const { start, end } = measurementData.handles;\n  const { client } = eventData.currentPoints;\n  const clientStart = cornerstone.pixelToCanvas(eventData.element, start);\n  const clientEnd = cornerstone.pixelToCanvas(eventData.element, end);\n  const canvasOffSetLeft = client.x - clientStart.x;\n  const canvasOffSetTop = client.y - clientStart.y;\n  const position = {\n    left: clientEnd.x + canvasOffSetLeft,\n    top: clientEnd.y + canvasOffSetTop,\n  };\n\n  if (start.y > end.y) {\n    position.top -= buttonSize.height;\n  }\n  if (start.x > end.x) {\n    position.left -= buttonSize.width;\n  }\n\n  return position;\n}\n\nexport function getDialogStyle(componentStyle) {\n  const style = Object.assign({}, componentStyle);\n  const dialogProps = {\n    width: 320,\n    height: 230,\n  };\n\n  // Get max values to avoid position out of the screen\n  const maxLeft = window.innerWidth - dialogProps.width;\n  const maxTop = window.innerHeight - dialogProps.height;\n\n  // Positioning the dialog with its center on the click event\n  style.left -= dialogProps.width / 2;\n  style.top -= dialogProps.height / 2;\n\n  if (style.left > maxLeft) {\n    style.left = maxLeft;\n  }\n  if (style.top > maxTop) {\n    style.top = maxTop;\n  }\n\n  return style;\n}\n","import { Component } from 'react';\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport SimpleDialog from '../SimpleDialog/SimpleDialog.js';\n\nimport bounding from '../../lib/utils/bounding.js';\nimport { getDialogStyle } from './../Labelling/labellingPositionUtils.js';\n\nimport './EditDescriptionDialog.css';\n\nexport default class EditDescriptionDialog extends Component {\n  static defaultProps = {\n    componentRef: React.createRef(),\n    componentStyle: {},\n  };\n\n  static propTypes = {\n    measurementData: PropTypes.object.isRequired,\n    onCancel: PropTypes.func.isRequired,\n    componentRef: PropTypes.object,\n    componentStyle: PropTypes.object,\n    onUpdate: PropTypes.func.isRequired,\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      description: props.measurementData.description || '',\n    };\n\n    this.mainElement = React.createRef();\n  }\n\n  componentDidMount = () => {\n    bounding(this.mainElement);\n  };\n\n  componentDidUpdate(prevProps) {\n    if (this.props.description !== prevProps.description) {\n      this.setState({\n        description: this.props.description,\n      });\n    }\n  }\n\n  render() {\n    const style = getDialogStyle(this.props.componentStyle);\n\n    return (\n      <SimpleDialog\n        headerTitle=\"Edit Description\"\n        onClose={this.onClose}\n        onConfirm={this.onConfirm}\n        rootClass=\"editDescriptionDialog\"\n        componentRef={this.mainElement}\n        componentStyle={style}\n      >\n        <input\n          value={this.state.description}\n          className=\"simpleDialogInput\"\n          id=\"description\"\n          autoComplete=\"off\"\n          autoFocus\n          onChange={this.handleChange}\n        />\n      </SimpleDialog>\n    );\n  }\n\n  onClose = () => {\n    this.props.onCancel();\n  };\n\n  onConfirm = () => {\n    this.props.onUpdate(this.state.description);\n  };\n\n  handleChange = event => {\n    this.setState({ description: event.target.value });\n  };\n}\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { CSSTransition } from 'react-transition-group';\n\nimport './LabellingTransition.css';\n\n// If these variables changes, CSS must be updated\nconst transitionDuration = 500;\nconst transitionClassName = 'labelling';\nconst transitionOnAppear = true;\n\nexport default class LabellingTransition extends Component {\n  static propTypes = {\n    children: PropTypes.node.isRequired,\n    displayComponent: PropTypes.bool.isRequired,\n    onTransitionExit: PropTypes.func.isRequired,\n  };\n  render() {\n    return (\n      <CSSTransition\n        in={this.props.displayComponent}\n        appear={transitionOnAppear}\n        timeout={transitionDuration}\n        classNames={transitionClassName}\n        onExited={this.props.onTransitionExit}\n      >\n        {this.props.children}\n      </CSSTransition>\n    );\n  }\n}\n","const items = [\n  'Abdomen/Chest Wall',\n  'Adrenal',\n  'Bladder',\n  'Bone',\n  'Brain',\n  'Breast',\n  'Colon',\n  'Esophagus',\n  'Extremities',\n  'Gallbladder',\n  'Kidney',\n  'Liver',\n  'Lung',\n  'Lymph Node',\n  'Mediastinum/Hilum',\n  'Muscle',\n  'Neck',\n  'Other Soft Tissue',\n  'Ovary',\n  'Pancreas',\n  'Pelvis',\n  'Peritoneum/Omentum',\n  'Prostate',\n  'Retroperitoneum',\n  'Small Bowel',\n  'Spleen',\n  'Stomach',\n  'Subcutaneous',\n];\n\nconst OHIFLabellingData = items.map(item => {\n  return {\n    label: item,\n    value: item,\n  };\n});\n\nexport default OHIFLabellingData;\n","import { Icon, SelectTree } from 'react-viewerbase';\nimport React, { Component } from 'react';\n\nimport LabellingTransition from './LabellingTransition.js';\nimport OHIFLabellingData from './OHIFLabellingData.js';\nimport PropTypes from 'prop-types';\nimport bounding from '../../lib/utils/bounding.js';\nimport cloneDeep from 'lodash.clonedeep';\nimport { getAddLabelButtonStyle } from './labellingPositionUtils.js';\n\nexport default class LabellingFlow extends Component {\n  static propTypes = {\n    eventData: PropTypes.object.isRequired,\n    measurementData: PropTypes.object.isRequired,\n\n    labellingDoneCallback: PropTypes.func.isRequired,\n    updateLabelling: PropTypes.func.isRequired,\n\n    skipAddLabelButton: PropTypes.bool,\n    editLocation: PropTypes.bool,\n    editDescription: PropTypes.bool,\n  };\n\n  constructor(props) {\n    super(props);\n\n    const { location, locationLabel, description } = props.measurementData;\n\n    let style = props.componentStyle;\n    if (!props.skipAddLabelButton) {\n      style = getAddLabelButtonStyle(props.measurementData, props.eventData);\n    }\n\n    this.state = {\n      location,\n      locationLabel,\n      description,\n      skipAddLabelButton: props.skipAddLabelButton,\n      editDescription: props.editDescription,\n      editLocation: props.editLocation,\n      componentStyle: style,\n      confirmationState: false,\n      displayComponent: true,\n    };\n\n    this.mainElement = React.createRef();\n    this.descriptionInput = React.createRef();\n\n    this.initialItems = OHIFLabellingData;\n    this.currentItems = cloneDeep(this.initialItems);\n  }\n\n  componentDidUpdate = () => {\n    this.repositionComponent();\n  };\n\n  render() {\n    let mainElementClassName = 'labellingComponent';\n    if (this.state.editDescription) {\n      mainElementClassName += ' editDescription';\n    }\n\n    const style = Object.assign({}, this.state.componentStyle);\n    if (this.state.skipAddLabelButton) {\n      style.left -= 160;\n    }\n\n    return (\n      <LabellingTransition\n        displayComponent={this.state.displayComponent}\n        onTransitionExit={this.props.labellingDoneCallback}\n      >\n        <div\n          className={mainElementClassName}\n          style={style}\n          ref={this.mainElement}\n          onMouseLeave={this.fadeOutAndLeave}\n          onMouseEnter={this.clearFadeOutTimer}\n        >\n          {this.labellingStateFragment()}\n        </div>\n      </LabellingTransition>\n    );\n  }\n\n  labellingStateFragment = () => {\n    const {\n      skipAddLabelButton,\n      editLocation,\n      description,\n      locationLabel,\n    } = this.state;\n\n    if (!skipAddLabelButton) {\n      return (\n        <>\n          <button\n            type=\"button\"\n            className=\"addLabelButton\"\n            onClick={this.showLabelling}\n          >\n            {this.state.location ? 'Edit' : 'Add'} Label\n          </button>\n        </>\n      );\n    } else {\n      if (editLocation) {\n        return (\n          <SelectTree\n            items={this.currentItems}\n            columns={1}\n            onSelected={this.selectTreeSelectCalback}\n            selectTreeFirstTitle=\"Assign Label\"\n            onComponentChange={this.repositionComponent}\n          />\n        );\n      } else {\n        return (\n          <>\n            <div\n              className=\"checkIconWrapper\"\n              onClick={this.fadeOutAndLeaveFast}\n            >\n              <Icon name=\"check\" className=\"checkIcon\" />\n            </div>\n            <div className=\"locationDescriptionWrapper\">\n              <div className=\"location\">{locationLabel}</div>\n              <div className=\"description\">\n                <input\n                  id=\"descriptionInput\"\n                  ref={this.descriptionInput}\n                  defaultValue={description || ''}\n                  autoComplete=\"off\"\n                />\n              </div>\n            </div>\n            <div className=\"commonButtons\">\n              <button\n                type=\"button\"\n                className=\"commonButton left\"\n                onClick={this.relabel}\n              >\n                Relabel\n              </button>\n              <button\n                type=\"button\"\n                className=\"commonButton right\"\n                onClick={this.setDescriptionUpdateMode}\n              >\n                {description ? 'Edit ' : 'Add '}\n                Description\n              </button>\n            </div>\n            <div className=\"editDescriptionButtons\">\n              <button\n                type=\"button\"\n                className=\"commonButton left\"\n                onClick={this.descriptionCancel}\n              >\n                Cancel\n              </button>\n              <button\n                type=\"button\"\n                className=\"commonButton right\"\n                onClick={this.descriptionSave}\n              >\n                Save\n              </button>\n            </div>\n          </>\n        );\n      }\n    }\n  };\n\n  relabel = () => {\n    this.setState({\n      editLocation: true,\n    });\n  };\n\n  setDescriptionUpdateMode = () => {\n    this.descriptionInput.current.focus();\n\n    this.setState({\n      editDescription: true,\n    });\n  };\n\n  descriptionCancel = () => {\n    const { description = '' } = cloneDeep(this.state);\n    this.descriptionInput.current.value = description;\n\n    this.setState({\n      editDescription: false,\n    });\n  };\n\n  descriptionSave = () => {\n    const description = this.descriptionInput.current.value;\n    this.props.updateLabelling({ description });\n\n    this.setState({\n      description,\n      editDescription: false,\n    });\n  };\n\n  selectTreeSelectCalback = (event, itemSelected) => {\n    const location = itemSelected.value;\n    this.props.updateLabelling({ location });\n\n    const viewportTopPosition = this.mainElement.current.offsetParent.offsetTop;\n    const componentStyle = {\n      top: event.nativeEvent.y - viewportTopPosition - 25,\n      left: this.state.componentStyle.left,\n    };\n\n    this.setState({\n      editLocation: false,\n      confirmationState: true,\n      location: itemSelected.value,\n      locationLabel: itemSelected.label,\n      componentStyle,\n    });\n\n    if (this.isTouchScreen) {\n      this.setTimeout = setTimeout(() => {\n        this.setState({\n          displayComponent: false,\n        });\n      }, 2000);\n    }\n  };\n\n  showLabelling = () => {\n    this.setState({\n      skipAddLabelButton: true,\n      editLocation: false,\n    });\n  };\n\n  fadeOutAndLeave = () => {\n    // Wait for 1 sec to dismiss the labelling component\n    this.fadeOutTimer = setTimeout(() => {\n      this.setState({\n        displayComponent: false,\n      });\n    }, 1000);\n  };\n\n  fadeOutAndLeaveFast = () => {\n    this.setState({\n      displayComponent: false,\n    });\n  };\n\n  clearFadeOutTimer = () => {\n    if (!this.fadeOutTimer) {\n      return;\n    }\n\n    clearTimeout(this.fadeOutTimer);\n  };\n\n  repositionComponent = () => {\n    // SetTimeout for the css animation to end.\n    setTimeout(() => {\n      bounding(this.mainElement);\n    }, 200);\n  };\n}\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nimport cloneDeep from 'lodash.clonedeep';\n\nimport EditDescriptionDialog from './../EditDescriptionDialog/EditDescriptionDialog.js';\nimport LabellingFlow from './LabellingFlow.js';\n\nimport './LabellingManager.css';\n\nexport default class LabellingManager extends Component {\n  static propTypes = {\n    eventData: PropTypes.object.isRequired,\n    measurementData: PropTypes.object.isRequired,\n\n    labellingDoneCallback: PropTypes.func.isRequired,\n    updateLabelling: PropTypes.func.isRequired,\n\n    skipAddLabelButton: PropTypes.bool,\n    editLocation: PropTypes.bool,\n    editDescription: PropTypes.bool,\n    editDescriptionOnDialog: PropTypes.bool,\n  };\n\n  static defaultProps = {\n    skipAddLabelButton: false,\n    editLocation: false,\n    editDescription: false,\n    editDescriptionOnDialog: false,\n  };\n\n  constructor(props) {\n    super(props);\n\n    const measurementData = cloneDeep(props.measurementData);\n    this.treatMeasurementData(measurementData);\n\n    let editLocation = props.editLocation;\n    if (!props.editDescription && !props.editLocation) {\n      editLocation = true;\n    }\n\n    this.state = {\n      componentStyle: getComponentPosition(props.eventData),\n      skipAddLabelButton: props.skipAddLabelButton,\n      editLocation: editLocation,\n      editDescription: props.editDescription,\n      editDescriptionOnDialog: props.editDescriptionOnDialog,\n      measurementData: measurementData,\n    };\n  }\n\n  componentDidMount = () => {\n    document.addEventListener('touchstart', this.onTouchStart);\n  };\n\n  componentWillUnmount = () => {\n    document.removeEventListener('touchstart', this.onTouchStart);\n  };\n\n  render() {\n    return this.getRenderComponent();\n  }\n\n  getRenderComponent = () => {\n    const {\n      editLocation,\n      editDescription,\n      editDescriptionOnDialog,\n      measurementData,\n    } = this.state;\n\n    if (editDescriptionOnDialog) {\n      return (\n        <EditDescriptionDialog\n          onCancel={this.props.labellingDoneCallback}\n          onUpdate={this.descriptionDialogUpdate}\n          componentRef={this.editDescriptionDialog}\n          componentStyle={this.state.componentStyle}\n          measurementData={measurementData}\n        />\n      );\n    }\n\n    if (editLocation || editDescription) {\n      return (\n        <LabellingFlow\n          {...this.props}\n          componentStyle={this.state.componentStyle}\n        />\n      );\n    }\n  };\n\n  treatMeasurementData = measurementData => {\n    const { editDescription, editLocation } = this.props;\n\n    if (editDescription) {\n      measurementData.description = undefined;\n    }\n    if (editLocation) {\n      measurementData.location = undefined;\n    }\n  };\n\n  responseDialogUpdate = response => {\n    this.props.updateLabelling({\n      response,\n    });\n    this.props.labellingDoneCallback();\n  };\n\n  descriptionDialogUpdate = description => {\n    this.props.updateLabelling({\n      description,\n    });\n    this.props.labellingDoneCallback();\n  };\n}\n\nfunction getComponentPosition(eventData) {\n  const {\n    event: { clientX: left, clientY: top },\n  } = eventData;\n\n  return {\n    left,\n    top,\n  };\n}\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport LabellingManager from '../components/Labelling/LabellingManager';\n\nclass LabellingOverlay extends Component {\n  static propTypes = {\n    visible: PropTypes.bool.isRequired,\n  };\n\n  static defaultProps = {\n    visible: false,\n  };\n\n  render() {\n    if (!this.props.visible) {\n      return null;\n    }\n\n    return <LabellingManager {...this.props} />;\n  }\n}\n\nexport default LabellingOverlay;\n","import { connect } from 'react-redux';\nimport LabellingOverlay from './LabellingOverlay';\n\nconst mapStateToProps = state => {\n  if (!state.ui || !state.ui.labelling) {\n    return {\n      visible: false,\n    };\n  }\n\n  const labellingFlowData = state.ui.labelling;\n\n  return {\n    visible: false,\n    ...labellingFlowData,\n  };\n};\n\nconst ConnectedLabellingOverlay = connect(\n  mapStateToProps,\n  null\n)(LabellingOverlay);\n\nexport default ConnectedLabellingOverlay;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n//import OHIF from 'ohif-core';\n//import { CineDialog } from 'react-viewerbase';\n\nimport OHIF from 'ohif-core';\nimport moment from 'moment';\nimport WhiteLabellingContext from '../WhiteLabellingContext.js';\nimport ConnectedHeader from './ConnectedHeader.js';\nimport ConnectedFlexboxLayout from './ConnectedFlexboxLayout.js';\nimport ConnectedToolbarRow from './ConnectedToolbarRow.js';\nimport ConnectedLabellingOverlay from './ConnectedLabellingOverlay';\nimport './Viewer.css';\n/**\n * Inits OHIF Hanging Protocol's onReady.\n * It waits for OHIF Hanging Protocol to be ready to instantiate the ProtocolEngine\n * Hanging Protocol will use OHIF LayoutManager to render viewports properly\n */\n/*const initHangingProtocol = () => {\n    // When Hanging Protocol is ready\n    HP.ProtocolStore.onReady(() => {\n\n        // Gets all StudyMetadata objects: necessary for Hanging Protocol to access study metadata\n        const studyMetadataList = OHIF.viewer.StudyMetadataList.all();\n\n        // Instantiate StudyMetadataSource: necessary for Hanging Protocol to get study metadata\n        const studyMetadataSource = new OHIF.studies.classes.OHIFStudyMetadataSource();\n\n        // Get prior studies map\n        const studyPriorsMap = OHIF.studylist.functions.getStudyPriorsMap(studyMetadataList);\n\n        // Creates Protocol Engine object with required arguments\n        const ProtocolEngine = new HP.ProtocolEngine(layoutManager, studyMetadataList, studyPriorsMap, studyMetadataSource);\n\n        // Sets up Hanging Protocol engine\n        HP.setEngine(ProtocolEngine);\n    });\n};*/\n\n/*const viewportUtils = OHIF.viewerbase.viewportUtils;\n\nOHIF.viewer.functionList = {\n    toggleCineDialog: viewportUtils.toggleCineDialog,\n    toggleCinePlay: viewportUtils.toggleCinePlay,\n    clearTools: viewportUtils.clearTools,\n    resetViewport: viewportUtils.resetViewport,\n    invert: viewportUtils.invert\n};*/\n\nclass Viewer extends Component {\n  static propTypes = {\n    studies: PropTypes.array,\n    studyInstanceUids: PropTypes.array,\n    onTimepointsUpdated: PropTypes.func,\n    onMeasurementsUpdated: PropTypes.func,\n  };\n\n  constructor(props) {\n    super(props);\n    OHIF.measurements.MeasurementApi.setConfiguration({\n      dataExchange: {\n        retrieve: this.retrieveMeasurements,\n        store: this.storeMeasurements,\n      },\n    });\n\n    OHIF.measurements.TimepointApi.setConfiguration({\n      dataExchange: {\n        retrieve: this.retrieveTimepoints,\n        store: this.storeTimepoints,\n        remove: this.removeTimepoint,\n        update: this.updateTimepoint,\n        disassociate: this.disassociateStudy,\n      },\n    });\n  }\n\n  retrieveMeasurements = (patientId, timepointIds) => {\n    OHIF.log.info('retrieveMeasurements');\n    // TODO: Retrieve the measurements from the latest available SR\n    return Promise.resolve();\n  };\n\n  storeMeasurements = (measurementData, timepointIds) => {\n    OHIF.log.info('storeMeasurements');\n    // TODO: Store the measurements into a new SR sent to the active server\n    return Promise.resolve();\n  };\n\n  retrieveTimepoints = filter => {\n    OHIF.log.info('retrieveTimepoints');\n\n    // Get the earliest and latest study date\n    let earliestDate = new Date().toISOString();\n    let latestDate = new Date().toISOString();\n    if (this.props.studies) {\n      latestDate = new Date('1000-01-01').toISOString();\n      this.props.studies.forEach(study => {\n        const studyDate = moment(study.studyDate, 'YYYYMMDD').toISOString();\n        if (studyDate < earliestDate) {\n          earliestDate = studyDate;\n        }\n        if (studyDate > latestDate) {\n          latestDate = studyDate;\n        }\n      });\n    }\n\n    // Return a generic timepoint\n    return Promise.resolve([\n      {\n        timepointType: 'baseline',\n        timepointId: 'TimepointId',\n        studyInstanceUids: this.props.studyInstanceUids,\n        patientId: filter.patientId,\n        earliestDate,\n        latestDate,\n        isLocked: false,\n      },\n    ]);\n  };\n\n  storeTimepoints = timepointData => {\n    OHIF.log.info('storeTimepoints');\n    return Promise.resolve();\n  };\n\n  updateTimepoint = (timepointData, query) => {\n    OHIF.log.info('updateTimepoint');\n    return Promise.resolve();\n  };\n\n  removeTimepoint = timepointId => {\n    OHIF.log.info('removeTimepoint');\n    return Promise.resolve();\n  };\n\n  disassociateStudy = (timepointIds, studyInstanceUid) => {\n    OHIF.log.info('disassociateStudy');\n    return Promise.resolve();\n  };\n\n  onTimepointsUpdated = timepoints => {\n    if (this.props.onTimepointsUpdated) {\n      this.props.onTimepointsUpdated(timepoints);\n    }\n  };\n\n  onMeasurementsUpdated = measurements => {\n    if (this.props.onMeasurementsUpdated) {\n      this.props.onMeasurementsUpdated(measurements);\n    }\n  };\n\n  componentDidMount() {\n    const { studies } = this.props;\n    const { TimepointApi, MeasurementApi } = OHIF.measurements;\n    const currentTimepointId = 'TimepointId';\n\n    const timepointApi = new TimepointApi(currentTimepointId, {\n      onTimepointsUpdated: this.onTimepointsUpdated,\n    });\n\n    const measurementApi = new MeasurementApi(timepointApi, {\n      onMeasurementsUpdated: this.onMeasurementsUpdated,\n    });\n\n    const patientId = studies[0] && studies[0].patientId;\n    timepointApi.retrieveTimepoints({ patientId });\n    measurementApi.retrieveMeasurements(patientId, [currentTimepointId]);\n  }\n\n  render() {\n    return (\n      <>\n        <WhiteLabellingContext.Consumer>\n          {whiteLabelling => (\n            <ConnectedHeader home={false}>\n              {whiteLabelling.logoComponent}\n            </ConnectedHeader>\n          )}\n        </WhiteLabellingContext.Consumer>\n        <div id=\"viewer\" className=\"Viewer\">\n          <ConnectedToolbarRow />\n          {/*<ConnectedStudyLoadingMonitor studies={this.props.studies} />*/}\n          {/*<StudyPrefetcher studies={this.props.studies} />*/}\n          <ConnectedFlexboxLayout studies={this.props.studies} />\n          <ConnectedLabellingOverlay />\n        </div>\n      </>\n    );\n  }\n}\n\nexport default Viewer;\n","import { connect } from 'react-redux';\nimport Viewer from './Viewer.js';\nimport OHIF from 'ohif-core';\n\nconst { setTimepoints, setMeasurements } = OHIF.redux.actions;\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    onTimepointsUpdated: timepoints => {\n      dispatch(setTimepoints(timepoints));\n    },\n    onMeasurementsUpdated: measurements => {\n      dispatch(setMeasurements(measurements));\n    },\n  };\n};\n\nconst ConnectedViewer = connect(\n  null,\n  mapDispatchToProps\n)(Viewer);\n\nexport default ConnectedViewer;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport OHIF from 'ohif-core';\nimport ConnectedViewer from './ConnectedViewer.js';\n\nconst { createDisplaySets } = OHIF.utils;\n\nclass ViewerRetrieveStudyData extends Component {\n  static propTypes = {\n    studyInstanceUids: PropTypes.array.isRequired,\n    seriesInstanceUids: PropTypes.array,\n    server: PropTypes.object,\n  };\n\n  state = {\n    studies: null,\n    error: null,\n  };\n\n  componentDidMount() {\n    // TODO: Avoid using timepoints here\n    //const params = { studyInstanceUids, seriesInstanceUids, timepointId, timepointsFilter={} };\n    const { studyInstanceUids, seriesInstanceUids, server } = this.props;\n    const promise = OHIF.studies.retrieveStudiesMetadata(\n      server,\n      studyInstanceUids,\n      seriesInstanceUids\n    );\n\n    // Render the viewer when the data is ready\n    promise\n      .then(studies => {\n        const updatedStudies = createDisplaySets(studies);\n\n        this.setState({\n          studies: updatedStudies,\n        });\n      })\n      .catch(error => {\n        this.setState({\n          error: true,\n        });\n\n        throw new Error(error);\n      });\n  }\n\n  render() {\n    if (this.state.error) {\n      return <div>Error: {JSON.stringify(this.state.error)}</div>;\n    } else if (!this.state.studies) {\n      return <div>Loading...</div>;\n    }\n\n    return (\n      <ConnectedViewer\n        studies={this.state.studies}\n        studyInstanceUids={this.props.studyInstanceUids}\n      />\n    );\n  }\n}\n\nexport default ViewerRetrieveStudyData;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport ViewerRetrieveStudyData from '../connectedComponents/ViewerRetrieveStudyData.js';\n\nfunction IHEInvokeImageDisplay({ match }) {\n  const requestType = match.params.query.requestType;\n  let studyInstanceUids;\n  //let patientUids;\n  let displayStudyList = false;\n\n  if (requestType === 'STUDY') {\n    studyInstanceUids = match.params.query.studyUID.split(';');\n  } else if (requestType === 'STUDYBASE64') {\n    const uids = this.params.query.studyUID;\n    const decodedData = window.atob(uids);\n    studyInstanceUids = decodedData.split(';');\n  } else if (requestType === 'PATIENT') {\n    //patientUidspatientUids = this.params.query.patientID.split(';');\n    displayStudyList = true;\n  } else {\n    displayStudyList = true;\n  }\n\n  if (displayStudyList) {\n    return ''; //<StudyList patientUids={patientUids}/>);\n  }\n\n  return <ViewerRetrieveStudyData studyInstanceUids={studyInstanceUids} />;\n}\n\nIHEInvokeImageDisplay.propTypes = {\n  match: PropTypes.shape({\n    params: PropTypes.shape({\n      query: PropTypes.shape({\n        requestType: PropTypes.string.isRequired,\n        studyUID: PropTypes.string,\n        patientID: PropTypes.string,\n      }),\n    }),\n  }),\n};\n\nexport default IHEInvokeImageDisplay;\n","import { connect } from 'react-redux';\nimport ViewerRetrieveStudyData from './ViewerRetrieveStudyData.js';\n\nconst isActive = a => a.active === true;\n\nconst mapStateToProps = state => {\n  const activeServer = state.servers.servers.find(isActive);\n\n  return {\n    server: activeServer,\n  };\n};\n\nconst ConnectedViewerRetrieveStudyData = connect(\n  mapStateToProps,\n  null\n)(ViewerRetrieveStudyData);\n\nexport default ConnectedViewerRetrieveStudyData;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport ConnectedViewerRetrieveStudyData from '../connectedComponents/ConnectedViewerRetrieveStudyData';\n\nfunction ViewerRouting({ match }) {\n  const { studyInstanceUids, seriesInstanceUids } = match.params;\n\n  let studyUIDs;\n  let seriesUIDs;\n\n  if (studyInstanceUids && !seriesInstanceUids) {\n    studyUIDs = studyInstanceUids.split(';');\n  } else if (studyInstanceUids && seriesInstanceUids) {\n    studyUIDs = [match.params.studyInstanceUid];\n    seriesUIDs = match.params.seriesInstanceUids.split(';');\n  }\n\n  return (\n    <ConnectedViewerRetrieveStudyData\n      studyInstanceUids={studyUIDs}\n      seriesInstanceUids={seriesUIDs}\n    />\n  );\n}\n\nViewerRouting.propTypes = {\n  match: PropTypes.shape({\n    params: PropTypes.shape({\n      studyInstanceUids: PropTypes.string.isRequired,\n      seriesInstanceUids: PropTypes.string,\n    }),\n  }),\n};\n\nexport default ViewerRouting;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport OHIF from 'ohif-core';\nimport { withRouter } from 'react-router-dom';\nimport { StudyList } from 'react-viewerbase';\nimport ConnectedHeader from '../connectedComponents/ConnectedHeader.js';\nimport moment from 'moment';\n\nclass StudyListWithData extends Component {\n  state = {\n    searchData: {},\n    studies: null,\n    error: null,\n  };\n\n  static propTypes = {\n    patientId: PropTypes.string,\n    server: PropTypes.object,\n    user: PropTypes.object,\n    history: PropTypes.object,\n  };\n\n  static rowsPerPage = 25;\n  static defaultSort = { field: 'patientName', order: 'desc' };\n\n  static studyListDateFilterNumDays = 25000; // TODO: put this in the settings\n  static defaultStudyDateFrom = moment()\n    .subtract(StudyListWithData.studyListDateFilterNumDays, 'days')\n    .toDate();\n  static defaultStudyDateTo = new Date();\n\n  componentDidMount() {\n    // TODO: Avoid using timepoints here\n    //const params = { studyInstanceUids, seriesInstanceUids, timepointId, timepointsFilter={} };\n\n    this.searchForStudies();\n  }\n\n  searchForStudies = (\n    searchData = {\n      currentPage: 0,\n      rowsPerPage: StudyListWithData.rowsPerPage,\n      studyDateFrom: StudyListWithData.defaultStudyDateFrom,\n      studyDateTo: StudyListWithData.defaultStudyDateTo,\n      sortData: StudyListWithData.defaultSort,\n    }\n  ) => {\n    const { server } = this.props;\n    const filter = {\n      patientId: searchData.patientId,\n      patientName: searchData.patientName,\n      accessionNumber: searchData.accessionNumber,\n      studyDescription: searchData.studyDescription,\n      modalitiesInStudy: searchData.modalities,\n      studyDateFrom: searchData.studyDateFrom,\n      studyDateTo: searchData.studyDateTo,\n      limit: searchData.rowsPerPage,\n      offset: searchData.currentPage * searchData.rowsPerPage,\n    };\n\n    // TODO: add sorting\n    const promise = OHIF.studies.searchStudies(server, filter);\n\n    // Render the viewer when the data is ready\n    promise\n      .then(studies => {\n        if (!studies) {\n          studies = [];\n        }\n\n        const { field, order } = searchData.sortData;\n        let sortedStudies = studies.map(study => {\n          if (!moment(study.studyDate, 'MMM DD, YYYY', true).isValid()) {\n            study.studyDate = moment(study.studyDate, 'YYYYMMDD').format(\n              'MMM DD, YYYY'\n            );\n          }\n          return study;\n        });\n\n        sortedStudies.sort(function(a, b) {\n          let fieldA = a[field];\n          let fieldB = b[field];\n          if (field === 'studyDate') {\n            fieldA = moment(fieldA).toISOString();\n            fieldB = moment(fieldB).toISOString();\n          }\n          if (order === 'desc') {\n            if (fieldA < fieldB) {\n              return -1;\n            }\n            if (fieldA > fieldB) {\n              return 1;\n            }\n            return 0;\n          } else {\n            if (fieldA > fieldB) {\n              return -1;\n            }\n            if (fieldA < fieldB) {\n              return 1;\n            }\n            return 0;\n          }\n        });\n\n        this.setState({\n          studies: sortedStudies,\n        });\n      })\n      .catch(error => {\n        this.setState({\n          error: true,\n        });\n\n        throw new Error(error);\n      });\n  };\n\n  onImport = () => {\n    //console.log('onImport');\n  };\n\n  onSelectItem = studyInstanceUID => {\n    this.props.history.push(`/viewer/${studyInstanceUID}`);\n  };\n\n  onSearch = searchData => {\n    this.searchForStudies(searchData);\n  };\n\n  render() {\n    if (this.state.error) {\n      return <div>Error: {JSON.stringify(this.state.error)}</div>;\n    } else if (this.state.studies === null) {\n      return <div>Loading...</div>;\n    }\n\n    return (\n      <>\n        <ConnectedHeader home={true} user={this.props.user} />\n        <StudyList\n          studies={this.state.studies}\n          studyListFunctionsEnabled={false}\n          onImport={this.onImport}\n          onSelectItem={this.onSelectItem}\n          pageSize={this.rowsPerPage}\n          defaultSort={StudyListWithData.defaultSort}\n          studyListDateFilterNumDays={\n            StudyListWithData.studyListDateFilterNumDays\n          }\n          onSearch={this.onSearch}\n        />\n      </>\n    );\n  }\n}\n\nexport default withRouter(StudyListWithData);\n","import { connect } from 'react-redux';\n\nimport StudyListWithData from './StudyListWithData.js';\n\nconst isActive = a => a.active === true;\n\nconst mapStateToProps = state => {\n  const activeServer = state.servers.servers.find(isActive);\n\n  return {\n    server: activeServer,\n    user: state.oidc.user,\n  };\n};\n\nconst ConnectedStudyList = connect(\n  mapStateToProps,\n  null\n)(StudyListWithData);\n\nexport default ConnectedStudyList;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport ConnectedStudyList from './ConnectedStudyList';\n\n// TODO: Move to react-viewerbase\n\nfunction StudyListRouting({ match }) {\n  // TODO: Figure out which filters we want to pass in via a URL\n  //const { patientId } = match.params;\n\n  return <ConnectedStudyList />;\n}\n\nStudyListRouting.propTypes = {\n  match: PropTypes.shape({\n    params: PropTypes.shape({\n      patientIds: PropTypes.string,\n    }),\n  }),\n};\n\nexport default StudyListRouting;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport qs from 'querystring';\nimport Viewer from '../connectedComponents/Viewer';\nimport OHIF from 'ohif-core';\n\nconst { createDisplaySets } = OHIF.utils;\n\nclass StandaloneRouting extends Component {\n  state = {\n    studies: null,\n    error: null,\n  };\n\n  static propTypes = {\n    location: PropTypes.object,\n    store: PropTypes.object,\n  };\n\n  static parseQueryAndFetchStudies(query) {\n    return new Promise((resolve, reject) => {\n      const url = query.url;\n\n      if (!url) {\n        reject(new Error('No URL was specified. Use ?url=$yourURL'));\n      }\n\n      // Define a request to the server to retrieve the study data\n      // as JSON, given a URL that was in the Route\n      const oReq = new XMLHttpRequest();\n\n      // Add event listeners for request failure\n      oReq.addEventListener('error', error => {\n        OHIF.log.warn('An error occurred while retrieving the JSON data');\n        reject(error);\n      });\n\n      // When the JSON has been returned, parse it into a JavaScript Object\n      // and render the OHIF Viewer with this data\n      oReq.addEventListener('load', () => {\n        // Parse the response content\n        // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseText\n        if (!oReq.responseText) {\n          OHIF.log.warn('Response was undefined');\n          reject(new Error('Response was undefined'));\n        }\n\n        OHIF.log.info(JSON.stringify(oReq.responseText, null, 2));\n\n        const data = JSON.parse(oReq.responseText);\n        if (data.servers && query.studyInstanceUids) {\n          const server = data.servers.dicomWeb[0];\n          server.type = 'dicomWeb';\n\n          const studyInstanceUids = query.studyInstanceUids.split(';');\n          const seriesInstanceUids = [];\n\n          OHIF.studies\n            .retrieveStudiesMetadata(\n              server,\n              studyInstanceUids,\n              seriesInstanceUids\n            )\n            .then(\n              studies => {\n                resolve(studies);\n              },\n              error => {\n                reject(error);\n              }\n            );\n        } else {\n          resolve(data.studies);\n        }\n      });\n\n      // Open the Request to the server for the JSON data\n      // In this case we have a server-side route called /api/\n      // which responds to GET requests with the study data\n      OHIF.log.info(`Sending Request to: ${url}`);\n      oReq.open('GET', url);\n      oReq.setRequestHeader('Accept', 'application/json');\n\n      // Fire the request to the server\n      oReq.send();\n    });\n  }\n\n  componentDidMount() {\n    const query = qs.parse(this.props.location.search);\n    StandaloneRouting.parseQueryAndFetchStudies(query).then(\n      studies => {\n        const updatedStudies = createDisplaySets(studies);\n\n        this.setState({ studies: updatedStudies });\n      },\n      error => {\n        this.setState({ error });\n      }\n    );\n  }\n\n  render() {\n    if (this.state.error) {\n      return <div>Error: {JSON.stringify(this.state.error)}</div>;\n    } else if (!this.state.studies) {\n      return <div>Loading...</div>;\n    }\n\n    return <Viewer studies={this.state.studies} />;\n  }\n}\n\nexport default StandaloneRouting;\n","import React, { Component } from 'react';\nimport { withRouter } from 'react-router-dom';\nimport PropTypes from 'prop-types';\nimport { CallbackComponent } from 'redux-oidc';\n\nclass CallbackPage extends Component {\n  static propTypes = {\n    userManager: PropTypes.object.isRequired,\n    history: PropTypes.object.isRequired,\n  };\n\n  render() {\n    return (\n      <CallbackComponent\n        userManager={this.props.userManager}\n        successCallback={() => {\n          const pathname = sessionStorage.getItem('ohif-redirect-to');\n\n          this.props.history.push(pathname);\n        }}\n        errorCallback={error => {\n          //this.props.history.push(\"/\");\n          throw new Error(error);\n        }}\n      >\n        <div>Redirecting...</div>\n      </CallbackComponent>\n    );\n  }\n}\n\nexport default withRouter(CallbackPage);\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n// import asyncComponent from './components/AsyncComponent.js'\nimport IHEInvokeImageDisplay from './routes/IHEInvokeImageDisplay.js';\nimport ViewerRouting from './routes/ViewerRouting.js';\nimport StudyListRouting from './studylist/StudyListRouting.js';\nimport StandaloneRouting from './routes/StandaloneRouting.js';\nimport CallbackPage from './CallbackPage.js';\nimport { withRouter } from 'react-router';\nimport { Route, Switch } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport { ViewerbaseDragDropContext } from 'react-viewerbase';\n\nimport './OHIFStandaloneViewer.css';\nimport './variables.css';\nimport './theme-tide.css';\n\n// Dynamic Import Routes (CodeSplitting)\n// const IHEInvokeImageDisplay = asyncComponent(() =>\n//   import('./routes/IHEInvokeImageDisplay.js')\n// )\n// const ViewerRouting = asyncComponent(() => import('./routes/ViewerRouting.js'))\n// const StudyListRouting = asyncComponent(() =>\n//   import('./studylist/StudyListRouting.js')\n// )\n// const StandaloneRouting = asyncComponent(() =>\n//   import('./routes/StandaloneRouting.js')\n// )\n// const CallbackPage = asyncComponent(() => import('./CallbackPage.js'))\n//\n\nconst reload = () => window.location.reload();\n\nclass OHIFStandaloneViewer extends Component {\n  static propTypes = {\n    history: PropTypes.object.isRequired,\n    user: PropTypes.object,\n  };\n\n  componentDidMount() {\n    this.unlisten = this.props.history.listen((location, action) => {\n      if (this.props.setContext) {\n        this.props.setContext(window.location.pathname);\n      }\n    });\n  }\n\n  componentWillUnmount() {\n    this.unlisten();\n  }\n\n  render() {\n    const { user, userManager } = this.props;\n\n    const userNotLoggedIn = userManager && (!user || user.expired);\n    if (userNotLoggedIn) {\n      const pathname = this.props.location.pathname;\n\n      if (pathname !== '/callback') {\n        sessionStorage.setItem('ohif-redirect-to', pathname);\n      }\n\n      return (\n        <Switch>\n          <Route exact path=\"/silent-refresh.html\" onEnter={reload} />\n          <Route exact path=\"/logout-redirect.html\" onEnter={reload} />\n          <Route\n            path=\"/callback\"\n            render={() => <CallbackPage userManager={userManager} />}\n          />\n          <Route\n            component={() => {\n              userManager.signinRedirect();\n\n              return null;\n            }}\n          />\n        </Switch>\n      );\n    }\n\n    return (\n      <Switch>\n        <Route exact path=\"/silent-refresh.html\" onEnter={reload} />\n        <Route exact path=\"/logout-redirect.html\" onEnter={reload} />\n        <Route exact path=\"/studylist\" component={StudyListRouting} />\n        <Route exact path=\"/\" component={StudyListRouting} />\n        <Route exact path=\"/viewer\" component={StandaloneRouting} />\n        <Route path=\"/viewer/:studyInstanceUids\" component={ViewerRouting} />\n        <Route\n          path=\"/study/:studyInstanceUid/series/:seriesInstanceUids\"\n          component={ViewerRouting}\n        />\n        <Route\n          path=\"/IHEInvokeImageDisplay\"\n          component={IHEInvokeImageDisplay}\n        />\n        <Route render={() => <div> Sorry, this page does not exist. </div>} />\n      </Switch>\n    );\n  }\n}\n\nconst mapStateToProps = state => {\n  return {\n    user: state.oidc.user,\n  };\n};\n\nconst ConnectedOHIFStandaloneViewer = connect(\n  mapStateToProps,\n  null\n)(OHIFStandaloneViewer);\n\nexport default ViewerbaseDragDropContext(\n  withRouter(ConnectedOHIFStandaloneViewer)\n);\n","const defaultState = {\n  leftSidebarOpen: true,\n  rightSidebarOpen: false,\n  labelling: {},\n  contextMenu: {},\n  activeContexts: [],\n};\n\nconst ui = (state = defaultState, action) => {\n  switch (action.type) {\n    // ~ ACTIVE CONTEXTS\n    // https://redux.js.org/recipes/structuring-reducers/immutable-update-patterns#inserting-and-removing-items-in-arrays\n    case 'ADD_ACTIVE_CONTEXT': {\n      const shallowCopy = Object.assign({}, state);\n      shallowCopy.activeContexts = [...shallowCopy.activeContexts, action.item];\n      return shallowCopy;\n    }\n    case 'REMOVE_ACTIVE_CONTEXT': {\n      const shallowCopy = Object.assign({}, state);\n      shallowCopy.activeContexts = shallowCopy.activeContexts.filter(\n        item => item !== action.item\n      );\n      return shallowCopy;\n    }\n    case 'CLEAR_ACTIVE_CONTEXTS':\n      return Object.assign({}, state, { activeContexts: [] });\n    // ~ SIDEBAR\n    case 'SET_LEFT_SIDEBAR_OPEN':\n      return Object.assign({}, state, { leftSidebarOpen: action.state });\n    case 'SET_RIGHT_SIDEBAR_OPEN':\n      return Object.assign({}, state, { rightSidebarOpen: action.state });\n    case 'SET_LABELLING_FLOW_DATA': {\n      const labelling = Object.assign({}, action.labellingFlowData);\n\n      return Object.assign({}, state, { labelling });\n    }\n    case 'SET_TOOL_CONTEXT_MENU_DATA': {\n      const contextMenu = Object.assign({}, state.contextMenu);\n\n      contextMenu[action.viewportIndex] = Object.assign(\n        {},\n        action.toolContextMenuData\n      );\n\n      return Object.assign({}, state, { contextMenu });\n    }\n    case 'RESET_LABELLING_AND_CONTEXT_MENU':\n      return Object.assign({}, state, {\n        labelling: defaultState.labelling,\n        contextMenu: defaultState.contextMenu,\n      });\n    default:\n      return state;\n  }\n};\n\nexport default ui;\n","import { combineReducers, createStore } from 'redux';\n\nimport layoutReducers from './layout/reducers.js';\nimport { reducer as oidcReducer } from 'redux-oidc';\nimport { redux } from 'ohif-core';\n\n// Combine our ohif-core, ui, and oidc reducers\n// Set init data, using values found in localStorage\nconst { reducers, localStorage } = redux;\n\nreducers.ui = layoutReducers;\nreducers.oidc = oidcReducer;\n\nconst combined = combineReducers(reducers);\nconst store = createStore(combined, localStorage.loadState());\n\n// When the store's preferences change,\n// Update our cached preferences in localStorage\nstore.subscribe(() => {\n  localStorage.saveState({\n    preferences: store.getState().preferences,\n  });\n});\n\nexport default store;\n","import cornerstone from 'cornerstone-core';\nimport { redux } from 'ohif-core';\nimport store from './../store/';\n\nconst { setToolActive } = redux.actions;\n\nconst actions = {\n  rotateViewport: ({ viewports, rotation }) => {\n    const enabledElement = _getActiveViewportEnabledElement(\n      viewports.viewportSpecificData,\n      viewports.activeViewportIndex\n    );\n\n    if (enabledElement) {\n      let viewport = cornerstone.getViewport(enabledElement);\n      viewport.rotation += rotation;\n      cornerstone.setViewport(enabledElement, viewport);\n    }\n  },\n  flipViewportHorizontal: ({ viewports }) => {\n    const enabledElement = _getActiveViewportEnabledElement(\n      viewports.viewportSpecificData,\n      viewports.activeViewportIndex\n    );\n\n    if (enabledElement) {\n      let viewport = cornerstone.getViewport(enabledElement);\n      viewport.hflip = !viewport.hflip;\n      cornerstone.setViewport(enabledElement, viewport);\n    }\n  },\n  flipViewportVertical: ({ viewports }) => {\n    const enabledElement = _getActiveViewportEnabledElement(\n      viewports.viewportSpecificData,\n      viewports.activeViewportIndex\n    );\n\n    if (enabledElement) {\n      let viewport = cornerstone.getViewport(enabledElement);\n      viewport.vflip = !viewport.vflip;\n      cornerstone.setViewport(enabledElement, viewport);\n    }\n  },\n  scaleViewport: ({ viewports, direction }) => {\n    const enabledElement = _getActiveViewportEnabledElement(\n      viewports.viewportSpecificData,\n      viewports.activeViewportIndex\n    );\n    const step = direction * 0.15;\n\n    if (enabledElement) {\n      if (step) {\n        let viewport = cornerstone.getViewport(enabledElement);\n        viewport.scale += step;\n        cornerstone.setViewport(enabledElement, viewport);\n      } else {\n        cornerstone.fitToWindow(enabledElement);\n      }\n    }\n  },\n  resetViewport: ({ viewports }) => {\n    const enabledElement = _getActiveViewportEnabledElement(\n      viewports.viewportSpecificData,\n      viewports.activeViewportIndex\n    );\n\n    if (enabledElement) {\n      cornerstone.reset(enabledElement);\n    }\n  },\n  invertViewport: ({ viewports }) => {\n    const enabledElement = _getActiveViewportEnabledElement(\n      viewports.viewportSpecificData,\n      viewports.activeViewportIndex\n    );\n\n    if (enabledElement) {\n      let viewport = cornerstone.getViewport(enabledElement);\n      viewport.invert = !viewport.invert;\n      cornerstone.setViewport(enabledElement, viewport);\n    }\n  },\n  // This has a weird hard dependency on the tools that are available as toolbar\n  // buttons. You can see this in `ohif-core/src/redux/reducers/tools.js`\n  // the `toolName` needs to equal the button's `command` property.\n  // NOTE: It would be nice if `hotkeys` could set this, instead of creating a command per tool\n  setCornerstoneToolActive: ({ toolName }) => {\n    store.dispatch(setToolActive(toolName));\n  },\n  updateViewportDisplaySet: ({ direction }) => {\n    // TODO\n    console.warn('updateDisplaySet: ', direction);\n  },\n  clearAnnotations: () => {\n    console.warn('clearAnnotations: not yet implemented');\n    // const toolState =\n    //   cornerstoneTools.globalImageIdSpecificToolStateManager.toolState;\n    // if (!toolState) return;\n    // Object.keys(toolState).forEach(imageId => {\n    //   if (!cornerstoneImageId || cornerstoneImageId === imageId)\n    //     delete toolState[imageId];\n    // });\n  },\n};\n\nconst definitions = {\n  rotateViewportCW: {\n    commandFn: actions.rotateViewport,\n    storeContexts: ['viewports'],\n    options: { rotation: 90 },\n  },\n  rotateViewportCCW: {\n    commandFn: actions.rotateViewport,\n    storeContexts: ['viewports'],\n    options: { rotation: -90 },\n  },\n  invertViewport: {\n    commandFn: actions.invertViewport,\n    storeContexts: ['viewports'],\n    options: {},\n  },\n  flipViewportVertical: {\n    commandFn: actions.flipViewportVertical,\n    storeContexts: ['viewports'],\n    options: {},\n  },\n  flipViewportHorizontal: {\n    commandFn: actions.flipViewportHorizontal,\n    storeContexts: ['viewports'],\n    options: {},\n  },\n  scaleUpViewport: {\n    keys: '',\n    commandFn: actions.scaleViewport,\n    storeContexts: ['viewports'],\n    options: { direction: 1 },\n  },\n  scaleDownViewport: {\n    keys: '',\n    commandFn: actions.scaleViewport,\n    storeContexts: ['viewports'],\n    options: { direction: -1 },\n  },\n  fitViewportToWindow: {\n    commandFn: actions.scaleViewport,\n    storeContexts: ['viewports'],\n    options: { direction: 0 },\n  },\n  resetViewport: {\n    commandFn: actions.resetViewport,\n    storeContexts: ['viewports'],\n    options: {},\n  },\n  // TODO: Clear Annotations\n  // TODO: Next/Previous image\n  // TODO: First/Last image\n  // Next/Previous series/DisplaySet\n  nextViewportDisplaySet: {\n    commandFn: actions.updateViewportDisplaySet,\n    storeContexts: [],\n    options: { direction: 1 },\n  },\n  previousViewportDisplaySet: {\n    commandFn: actions.updateViewportDisplaySet,\n    storeContexts: [],\n    options: { direction: -1 },\n  },\n  // TOOLS\n  setZoomTool: {\n    commandFn: actions.setCornerstoneToolActive,\n    storeContexts: [],\n    options: { toolName: 'Zoom' },\n  },\n};\n\n/**\n * Grabs `dom` reference for the enabledElement of\n * the active viewport\n */\nfunction _getActiveViewportEnabledElement(viewports, activeIndex) {\n  const activeViewport = viewports[activeIndex] || {};\n  return activeViewport.dom;\n}\n\nexport default definitions;\n","import { redux } from 'ohif-core';\nimport store from './../store';\nconst { setViewportActive } = redux.actions;\n\nconst actions = {\n  updateViewportDisplaySet: ({ direction }) => {\n    // TODO\n    console.warn('updateDisplaySet: ', direction);\n  },\n  updateActiveViewport: ({ viewports, direction }) => {\n    const { viewportSpecificData, activeViewportIndex } = viewports;\n    const maxIndex = Object.keys(viewportSpecificData).length - 1;\n\n    let newIndex = activeViewportIndex + direction;\n    newIndex = newIndex > maxIndex ? 0 : newIndex;\n    newIndex = newIndex < 0 ? maxIndex : newIndex;\n\n    store.dispatch(setViewportActive(newIndex));\n  },\n};\n\nconst definitions = {\n  // Next/Previous active viewport\n  incrementActiveViewport: {\n    commandFn: actions.updateActiveViewport,\n    storeContexts: ['viewports'],\n    options: { direction: 1 },\n  },\n  decrementActiveViewport: {\n    commandFn: actions.updateActiveViewport,\n    storeContexts: ['viewports'],\n    options: { direction: -1 },\n  },\n};\n\nexport default definitions;\n","import cornerstoneCommandDefinitions from './cornerstone.js';\nimport viewerCommandDefinitions from './viewer.js';\n\nconst CONTEXTS = {\n  viewer: 'VIEWER',\n  cornerstone: 'VIEWER::CORNERSTONE',\n};\n\n/**\n * Register all commands.\n * TODO: Extensions should self-register their commands\n */\nfunction init(commandsManager) {\n  _registerViewerCommands(commandsManager);\n  _registerCornerstoneCommands(commandsManager);\n}\n\n/**\n * Register all Viewer commands\n *\n * @private\n */\nfunction _registerViewerCommands(commandsManager) {\n  const commandContext = CONTEXTS.viewer;\n\n  commandsManager.createContext(commandContext);\n  Object.keys(viewerCommandDefinitions).forEach(commandName => {\n    const commandDefinition = viewerCommandDefinitions[commandName];\n\n    commandsManager.registerCommand(\n      commandContext,\n      commandName,\n      commandDefinition\n    );\n  });\n}\n\n/**\n * Register all Cornerstone commands\n *\n * @private\n */\nfunction _registerCornerstoneCommands(commandsManager) {\n  const commandContext = CONTEXTS.cornerstone;\n\n  commandsManager.createContext(commandContext);\n  Object.keys(cornerstoneCommandDefinitions).forEach(commandName => {\n    const commandDefinition = cornerstoneCommandDefinitions[commandName];\n\n    commandsManager.registerCommand(\n      commandContext,\n      commandName,\n      commandDefinition\n    );\n  });\n}\n\nexport default {\n  init,\n};\n","import OHIF from 'ohif-core';\nimport updateTableWithNewMeasurementData from './lib/updateTableWithNewMeasurementData';\n\nfunction getToolLabellingFlowCallback(store) {\n  const setLabellingFlowDataAction = labellingFlowData => ({\n    type: 'SET_LABELLING_FLOW_DATA',\n    labellingFlowData,\n  });\n\n  const setLabellingFlowData = labellingFlowData => {\n    store.dispatch(setLabellingFlowDataAction(labellingFlowData));\n  };\n\n  return function toolLabellingFlowCallback(\n    measurementData,\n    eventData,\n    doneCallback,\n    options = {}\n  ) {\n    const updateLabelling = ({ location, response, description }) => {\n      // Update the measurement data with the labelling parameters\n\n      if (location) {\n        measurementData.location = location;\n      }\n      if (description) {\n        measurementData.description = description;\n      }\n      if (response) {\n        measurementData.response = response;\n      }\n\n      updateTableWithNewMeasurementData(measurementData);\n    };\n\n    const labellingDoneCallback = () => {\n      setLabellingFlowData({ visible: false });\n    };\n\n    const labellingFlowData = {\n      visible: true,\n      eventData,\n      measurementData,\n      skipAddLabelButton: options.skipAddLabelButton,\n      editLocation: options.editLocation,\n      editDescription: options.editDescription,\n      editResponse: options.editResponse,\n      editDescriptionOnDialog: options.editDescriptionOnDialog,\n      labellingDoneCallback,\n      updateLabelling,\n    };\n\n    setLabellingFlowData(labellingFlowData);\n  };\n}\n\nconst resetLabellingAndContextMenuAction = state => ({\n  type: 'RESET_LABELLING_AND_CONTEXT_MENU',\n  state,\n});\n\nconst setToolContextMenuDataAction = (viewportIndex, toolContextMenuData) => ({\n  type: 'SET_TOOL_CONTEXT_MENU_DATA',\n  viewportIndex,\n  toolContextMenuData,\n});\n\nfunction getOnRightClickCallback(store) {\n  const setToolContextMenuData = (viewportIndex, toolContextMenuData) => {\n    store.dispatch(resetLabellingAndContextMenuAction());\n    store.dispatch(\n      setToolContextMenuDataAction(viewportIndex, toolContextMenuData)\n    );\n  };\n\n  const getOnCloseCallback = viewportIndex => {\n    return function onClose() {\n      const toolContextMenuData = {\n        visible: false,\n      };\n\n      store.dispatch(\n        setToolContextMenuDataAction(viewportIndex, toolContextMenuData)\n      );\n    };\n  };\n\n  return function onRightClick(event) {\n    const eventData = event.detail;\n    const viewportIndex = parseInt(eventData.element.dataset.viewportIndex, 10);\n\n    const toolContextMenuData = {\n      eventData,\n      isTouchEvent: false,\n      onClose: getOnCloseCallback(viewportIndex),\n    };\n\n    setToolContextMenuData(viewportIndex, toolContextMenuData);\n  };\n}\n\nfunction getOnTouchPressCallback(store) {\n  const setToolContextMenuData = (viewportIndex, toolContextMenuData) => {\n    store.dispatch(resetLabellingAndContextMenuAction());\n    store.dispatch(\n      setToolContextMenuDataAction(viewportIndex, toolContextMenuData)\n    );\n  };\n\n  const getOnCloseCallback = viewportIndex => {\n    return function onClose() {\n      const toolContextMenuData = {\n        visible: false,\n      };\n\n      store.dispatch(\n        setToolContextMenuDataAction(viewportIndex, toolContextMenuData)\n      );\n    };\n  };\n\n  return function onTouchPress(event) {\n    const eventData = event.detail;\n    const viewportIndex = parseInt(eventData.element.dataset.viewportIndex, 10);\n\n    const toolContextMenuData = {\n      eventData,\n      isTouchEvent: true,\n      onClose: getOnCloseCallback(viewportIndex),\n    };\n\n    setToolContextMenuData(viewportIndex, toolContextMenuData);\n  };\n}\n\nfunction getResetLabellingAndContextMenu(store) {\n  return function resetLabellingAndContextMenu() {\n    store.dispatch(resetLabellingAndContextMenuAction());\n  };\n}\n\nexport default function setupTools(store) {\n  const toolLabellingFlowCallback = getToolLabellingFlowCallback(store);\n  const availableTools = [\n    { name: 'Pan', mouseButtonMasks: [1, 4] },\n    { name: 'Zoom', mouseButtonMasks: [1, 2] },\n    { name: 'Wwwc', mouseButtonMasks: [1] },\n    {\n      name: 'Bidirectional',\n      configuration: {\n        configuration: {\n          getMeasurementLocationCallback: toolLabellingFlowCallback,\n        },\n      },\n      mouseButtonMasks: [1],\n    },\n    {\n      name: 'Length',\n      configuration: {\n        configuration: {\n          getMeasurementLocationCallback: toolLabellingFlowCallback,\n        },\n      },\n      mouseButtonMasks: [1],\n    },\n    {\n      name: 'Angle',\n      configuration: {\n        configuration: {\n          getMeasurementLocationCallback: toolLabellingFlowCallback,\n        },\n      },\n      mouseButtonMasks: [1],\n    },\n    { name: 'StackScroll', mouseButtonMasks: [1] },\n    { name: 'Brush', mouseButtonMasks: [1] },\n    {\n      name: 'FreehandMouse',\n      configuration: {\n        configuration: {\n          getMeasurementLocationCallback: toolLabellingFlowCallback,\n        },\n      },\n      mouseButtonMasks: [1],\n    },\n    {\n      name: 'EllipticalRoi',\n      configuration: {\n        configuration: {\n          getMeasurementLocationCallback: toolLabellingFlowCallback,\n        },\n      },\n      mouseButtonMasks: [1],\n    },\n    {\n      name: 'CircleRoi',\n      configuration: {\n        configuration: {\n          getMeasurementLocationCallback: toolLabellingFlowCallback,\n        },\n      },\n      mouseButtonMasks: [1],\n    },\n    {\n      name: 'RectangleRoi',\n      configuration: {\n        configuration: {\n          getMeasurementLocationCallback: toolLabellingFlowCallback,\n        },\n      },\n      mouseButtonMasks: [1],\n    },\n    { name: 'PanMultiTouch' },\n    { name: 'ZoomTouchPinch' },\n    { name: 'StackScrollMouseWheel' },\n    { name: 'StackScrollMultiTouch' },\n  ];\n\n  const onRightClick = getOnRightClickCallback(store);\n  const onTouchPress = getOnTouchPressCallback(store);\n  const onNewImage = getResetLabellingAndContextMenu(store);\n  const onMouseClick = getResetLabellingAndContextMenu(store);\n  const onTouchStart = getResetLabellingAndContextMenu(store);\n  const toolAction = OHIF.redux.actions.setExtensionData('cornerstone', {\n    availableTools,\n    onNewImage,\n    onRightClick,\n    onTouchPress,\n    onTouchStart,\n    onMouseClick,\n  });\n\n  store.dispatch(toolAction);\n}\n","import './config';\n\nimport {\n  CommandsManager,\n  HotkeysManager,\n  extensions,\n  redux,\n  utils,\n} from 'ohif-core';\nimport React, { Component } from 'react';\nimport {\n  getDefaultToolbarButtons,\n  getUserManagerForOpenIdConnectClient,\n  initWebWorkers,\n} from './utils/index.js';\n\nimport ConnectedToolContextMenu from './connectedComponents/ConnectedToolContextMenu';\nimport OHIFCornerstoneExtension from '@ohif/extension-cornerstone';\nimport OHIFDicomHtmlExtension from 'ohif-dicom-html-extension';\nimport OHIFDicomMicroscopyExtension from '@ohif/extension-dicom-microscopy';\nimport OHIFDicomPDFExtension from 'ohif-dicom-pdf-extension';\nimport OHIFStandaloneViewer from './OHIFStandaloneViewer';\nimport OHIFVTKExtension from '@ohif/extension-vtk';\nimport { OidcProvider } from 'redux-oidc';\nimport PropTypes from 'prop-types';\nimport { Provider } from 'react-redux';\nimport { BrowserRouter as Router } from 'react-router-dom';\nimport WhiteLabellingContext from './WhiteLabellingContext';\nimport appCommands from './appCommands';\nimport setupTools from './setupTools';\nimport i18n from '@ohif/i18n';\nimport { I18nextProvider } from 'react-i18next';\nimport store from './store';\n\n// ~~~~ APP SETUP\nconst commandsManagerConfig = {\n  getAppState: () => store.getState(),\n  getActiveContexts: () => store.getState().ui.activeContexts,\n};\n\nconst commandsManager = new CommandsManager(commandsManagerConfig);\nconst hotkeysManager = new HotkeysManager(commandsManager);\n\n// TODO: Should be done in extensions w/ commandsModule\n// ~~ ADD COMMANDS\nappCommands.init(commandsManager);\nif (window.config.hotkeys) {\n  hotkeysManager.setHotkeys(window.config.hotkeys, true);\n}\n\n// Force active contexts for now. These should be set in Viewer/ActiveViewer\nstore.dispatch({\n  type: 'ADD_ACTIVE_CONTEXT',\n  item: 'VIEWER',\n});\nstore.dispatch({\n  type: 'ADD_ACTIVE_CONTEXT',\n  item: 'VIEWER::CORNERSTONE',\n});\n\n// ~~~~ END APP SETUP\n\nsetupTools(store);\n\nconst children = {\n  viewport: [<ConnectedToolContextMenu key=\"tool-context\" />],\n};\n\n/** TODO: extensions should be passed in as prop as soon as we have the extensions as separate packages and then registered by ExtensionsManager */\nextensions.ExtensionManager.registerExtensions(store, [\n  new OHIFCornerstoneExtension({ children }),\n  new OHIFVTKExtension(),\n  new OHIFDicomPDFExtension(),\n  new OHIFDicomHtmlExtension(),\n  new OHIFDicomMicroscopyExtension(),\n]);\n\n// TODO[react] Use a provider when the whole tree is React\nwindow.store = store;\n\nfunction handleServers(servers) {\n  if (servers) {\n    utils.addServers(servers, store);\n  }\n}\n\nclass App extends Component {\n  static propTypes = {\n    routerBasename: PropTypes.string.isRequired,\n    relativeWebWorkerScriptsPath: PropTypes.string.isRequired,\n    servers: PropTypes.object.isRequired,\n    oidc: PropTypes.array,\n    whiteLabelling: PropTypes.object,\n  };\n\n  static defaultProps = {\n    whiteLabelling: {},\n    oidc: [],\n  };\n\n  constructor(props) {\n    super(props);\n\n    //\n    const defaultButtons = getDefaultToolbarButtons(this.props.routerBasename);\n    const buttonsAction = redux.actions.setAvailableButtons(defaultButtons);\n\n    store.dispatch(buttonsAction);\n\n    if (this.props.oidc.length) {\n      const firstOpenIdClient = this.props.oidc[0];\n\n      this.userManager = getUserManagerForOpenIdConnectClient(\n        store,\n        firstOpenIdClient\n      );\n    }\n    handleServers(this.props.servers);\n    initWebWorkers(\n      this.props.routerBasename,\n      this.props.relativeWebWorkerScriptsPath\n    );\n  }\n\n  render() {\n    const userManager = this.userManager;\n\n    if (userManager) {\n      return (\n        <Provider store={store}>\n          <I18nextProvider i18n={i18n}>\n            <OidcProvider store={store} userManager={userManager}>\n              <Router basename={this.props.routerBasename}>\n                <WhiteLabellingContext.Provider\n                  value={this.props.whiteLabelling}\n                >\n                  <OHIFStandaloneViewer userManager={userManager} />\n                </WhiteLabellingContext.Provider>\n              </Router>\n            </OidcProvider>\n          </I18nextProvider>\n        </Provider>\n      );\n    }\n\n    return (\n      <Provider store={store}>\n        <I18nextProvider i18n={i18n}>\n          <Router basename={this.props.routerBasename}>\n            <WhiteLabellingContext.Provider value={this.props.whiteLabelling}>\n              <OHIFStandaloneViewer />\n            </WhiteLabellingContext.Provider>\n          </Router>\n        </I18nextProvider>\n      </Provider>\n    );\n  }\n}\n\nexport default App;\n\nexport { commandsManager, hotkeysManager };\n","import cornerstoneWADOImageLoader from 'cornerstone-wado-image-loader';\n\n/**\n *\n * @param {String} baseDirectory\n * @param {String} webWorkScriptsPath\n */\nexport default function initWebWorkers(\n  baseDirectory = '/',\n  webWorkScriptsPath = ''\n) {\n  let scriptsPath = `${window.location.protocol}//${\n    window.location.host\n  }${baseDirectory}${webWorkScriptsPath}`;\n\n  // Ensure the last character is a slash\n  if (scriptsPath[scriptsPath.length - 1] !== '/') {\n    scriptsPath += '/';\n  }\n\n  const config = {\n    maxWebWorkers: Math.max(navigator.hardwareConcurrency - 1, 1),\n    startWebWorkersOnDemand: true,\n    webWorkerPath: `${scriptsPath}cornerstoneWADOImageLoaderWebWorker.min.js`,\n    taskConfiguration: {\n      decodeTask: {\n        loadCodecsOnStartup: true,\n        initializeCodecsOnStartup: false,\n        codecsPath: `${scriptsPath}cornerstoneWADOImageLoaderCodecs.min.js`,\n        usePDFJS: false,\n        strict: false,\n      },\n    },\n  };\n\n  cornerstoneWADOImageLoader.webWorkerManager.initialize(config);\n}\n","/**\n * Entry point for development and production PWA builds.\n * Packaged (NPM) builds go through `index_publish.js`\n */\nimport App from './App.js';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\n\nexport { App };\n\nwindow.config = window.config || {};\nconst applicationDefaults = {\n  routerBasename: '/',\n  relativeWebWorkerScriptsPath: '',\n};\nconst applicationProps = Object.assign({}, applicationDefaults, window.config);\nconst app = React.createElement(App, applicationProps, null);\n\nReactDOM.render(app, document.getElementById('root'));\n\n/*\nExample config with OIDC\n*/\n// Uncomment the next two blocks, comment out the config without OIDC\n// Try going to:\n// http://localhost:5000/viewer/1.2.276.0.7230010.3.1.2.0.94237.1537373823.634387 //PDF\n// http://localhost:5000/viewer/1.3.6.1.4.1.25403.345050719074.3824.20170126082328.1\n// http://ohif-viewer-react.s3-website-us-east-1.amazonaws.com/viewer/1.3.6.1.4.1.25403.345050719074.3824.20170126082328.1\n/*props.servers = {\n  dicomWeb: [\n    {\n      name: 'DCM4CHEE',\n      wadoUriRoot:\n        'https://cancer.crowds-cure.org/dcm4chee-arc/aets/DCM4CHEE/wado',\n      qidoRoot: 'https://cancer.crowds-cure.org/dcm4chee-arc/aets/DCM4CHEE/rs',\n      wadoRoot: 'https://cancer.crowds-cure.org/dcm4chee-arc/aets/DCM4CHEE/rs',\n      qidoSupportsIncludeField: true,\n      imageRendering: 'wadors',\n      thumbnailRendering: 'wadors',\n      requestOptions: {\n        requestFromBrowser: true\n      }\n    }\n  ]\n};\n\nprops.oidc = [\n  {\n    authServerUrl: 'https://cancer.crowds-cure.org/auth/realms/dcm4che',\n    authRedirectUri: rootUrl + '/callback',\n    postLogoutRedirectUri: rootUrl + '/logout-redirect.html',\n    clientId: 'crowds-cure-cancer',\n    responseType: 'id_token token',\n    scope: 'email profile openid',\n    revokeAccessTokenOnSignout: true,\n    extraQueryParams: {\n      kc_idp_hint: 'crowds-cure-cancer-auth0-oidc',\n      client_id: 'crowds-cure-cancer'\n    }\n  }\n];*/\n\n/* props.servers = {\n  dicomWeb: [\n    {\n      name: 'DCM4CHEE',\n      wadoUriRoot:\n        'https://k8s-testing.ohif.org/dcm4chee-arc/aets/DCM4CHEE/wado',\n      qidoRoot: 'https://k8s-testing.ohif.org/dcm4chee-arc/aets/DCM4CHEE/rs',\n      wadoRoot: 'https://k8s-testing.ohif.org/dcm4chee-arc/aets/DCM4CHEE/rs',\n      qidoSupportsIncludeField: true,\n      imageRendering: 'wadors',\n      thumbnailRendering: 'wadors',\n      requestOptions: {\n        requestFromBrowser: true\n      }\n    }\n  ]\n};\n\nprops.oidc = [\n  {\n    authServerUrl: 'https://k8s-testing.ohif.org/auth/realms/dcm4che',\n    authRedirectUri: rootUrl + '/callback',\n    postLogoutRedirectUri: rootUrl + '/logout-redirect.html',\n    clientId: 'ohif-viewer',\n    responseType: 'id_token token',\n    scope: 'email profile openid',\n    revokeAccessTokenOnSignout: true\n  }\n]; */\n\n/*props.servers = {\n  \"dicomWeb\": [\n    {\n      \"name\": \"DCM4CHEE\",\n      \"wadoUriRoot\": \"http://localhost:8080/dcm4chee-arc/aets/DCM4CHEE/wado\",\n      \"qidoRoot\": \"http://localhost:8080/dcm4chee-arc/aets/DCM4CHEE/rs\",\n      \"wadoRoot\": \"http://localhost:8080/dcm4chee-arc/aets/DCM4CHEE/rs\",\n      \"qidoSupportsIncludeField\": true,\n      \"imageRendering\": \"wadors\",\n      \"thumbnailRendering\": \"wadors\",\n      \"requestOptions\": {\n        \"requestFromBrowser\": true,\n        \"auth\": \"admin:admin\"\n      }\n    }\n  ]\n};*/\n\n/*\nUI settings\nPlugins\n    - Custom tools / buttons\n    - Custom Sidebar module thing\n    - Custom Viewports\n    - Custom Sop Class Interpreters\n*/\n\n/*\"PUBLIC_SETTINGS\": {\n    \"ui\": {\n      \"studyListFunctionsEnabled\": true,\n      \"leftSidebarOpen\": false,\n      \"displaySetNavigationLoopOverSeries\": false,\n      \"displaySetNavigationMultipleViewports\": true,\n      \"autoPositionMeasurementsTextCallOuts\": \"TRLB\"\n    },\n    \"prefetch\": {\n      \"order\": \"topdown\",\n      \"displaySetCount\": 1\n    }\n */\n"],"sourceRoot":""}