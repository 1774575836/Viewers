{"version":3,"sources":["config.js","version.js","redux/ui.js","components/OHIFLogo/OHIFLogo.js","WhiteLabellingContext.js","redux/actions.js","connectedComponents/ConnectedUserPreferencesModal.js","components/Header/Header.js","connectedComponents/ConnectedHeader.js","connectedComponents/ConnectedStudyBrowser.js","connectedComponents/ConnectedLayoutManager.js","connectedComponents/ViewerMain.js","connectedComponents/ConnectedViewerMain.js","lib/updateTableWithNewMeasurementData.js","lib/getMeasurementLocationCallback.js","connectedComponents/ConnectedMeasurementTable.js","lib/jumpToRowItem.js","connectedComponents/FlexboxLayout.js","connectedComponents/ConnectedFlexboxLayout.js","connectedComponents/ConnectedLayoutButton.js","connectedComponents/PluginSwitch.js","connectedComponents/ConnectedPluginSwitch.js","connectedComponents/ToolbarRow.js","connectedComponents/ConnectedToolbarRow.js","components/SimpleDialog/SimpleDialog.js","lib/utils/bounding.js","components/Labelling/labellingPositionUtils.js","components/EditDescriptionDialog/EditDescriptionDialog.js","components/Labelling/LabellingTransition.js","components/Labelling/OHIFLabellingData.js","components/Labelling/LabellingFlow.js","components/Labelling/LabellingManager.js","connectedComponents/LabellingOverlay.js","connectedComponents/ConnectedLabellingOverlay.js","connectedComponents/Viewer.js","connectedComponents/ConnectedViewer.js","connectedComponents/ViewerRetrieveStudyData.js","routes/IHEInvokeImageDisplay.js","connectedComponents/ConnectedViewerRetrieveStudyData.js","routes/ViewerRouting.js","studylist/StudyListWithData.js","studylist/ConnectedStudyList.js","studylist/StudyListRouting.js","routes/StandaloneRouting.js","CallbackPage.js","OHIFStandaloneViewer.js","utils/getDefaultToolbarButtons.js","utils/getUserManagerForOpenIdConnectClient.js","utils/initWebWorkers.js","setupTools.js","connectedComponents/ToolContextMenu.js","connectedComponents/ConnectedToolContextMenu.js","App.js","index.js"],"names":["window","info","version","homepage","concat","process","cornerstone","cornerstoneWADOImageLoader","external","dicomParser","OHIF","user","getAccessToken","state","store","getState","oidc","access_token","configure","beforeSend","xhr","headers","DICOMWeb","getAuthorizationHeader","Authorization","setRequestHeader","defaultState","leftSidebarOpen","rightSidebarOpen","userPreferencesModalOpen","labelling","contextMenu","ui","arguments","length","undefined","action","type","Object","assign","labellingFlowData","viewportIndex","toolContextMenuData","Icons","config","routerBasename","replace","OHIFLogo","react_default","a","createElement","target","rel","className","href","xlinkHref","defaultContextValues","logoComponent","WhiteLabellingContext","React","createContext","setLeftSidebarOpen","setRightSidebarOpen","setUserPreferencesModalOpen","setUserPreferences","redux","actions","ConnectedUserPreferencesModal","connect","contextName","commandContext","context","isOpen","windowLevelData","preferences","hotKeysData","dispatch","onCancel","onSave","data","cloneDeep","hotkeysUtil","setHotkeys","onResetToDefaults","UserPreferencesModal","Header","props","_this","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","userPreferencesOpen","options","title","icon","onClick","openUserPreferencesModal","link","home","location","studyLink","Link","to","children","pathname","dist_index_es","list","align","connectedComponents_ConnectedUserPreferencesModal","Component","defaultProps","withRouter","ConnectedHeader","ConnectedStudyBrowser","ownProps","stackLoadingProgressMap","loading","progress","studiesWithLoadingData","studies","forEach","study","thumbnails","displaySetInstanceUid","stackId","stackProgressData","stackPercentComplete","percentComplete","StudyBrowser","ConnectedLayoutManager","defaultPlugin","viewportPluginIds","plugins","availablePlugins","filter","plugin","PLUGIN_TYPES","VIEWPORT","map","id","find","component","layout","viewports","activeViewportIndex","LayoutManager","ViewerMain","getViewportData","viewportData","_this$props","viewportSpecificData","displaySet","displaySets","ds","some","v","push","setViewportData","_ref","item","findDisplaySet","studyInstanceUid","setViewportSpecificData","setup","dSet","getDisplaySets","setState","connectedComponents_ConnectedLayoutManager","_this2","keys","clearViewportSpecificData","ConnectedViewerMain","_state$viewports","updateTableWithNewMeasurementData","toolType","measurementNumber","description","measurementApi","measurements","MeasurementApi","Instance","tools","m","measurement","updateMeasurement","syncMeasurementsAndToolData","getEnabledElements","enabledElement","updateImage","element","getMeasurementLocationCallback","eventData","tool","doneCallback","cornerstoneTools","getToolForElement","configuration","getMeasurementText","measurementData","text","getDataForEachMeasurementNumber","measurementNumberList","timepoints","displayFunction","timepoint","eachData","displayText","timepointId","convertMeasurementsToTableData","toolCollections","toolGroups","getConfiguration","measurementTools","toolGroup","childTools","getAllTools","tableMeasurements","groupName","name","groupId","toolId","toolMeasurements","measurementTable","groupedMeasurements","reduce","b","groupedMeasurementsIndex","lesionNamingNumber","measurementId","_id","tableMeasurement","itemNumber","label","hasWarnings","warningTitle","isSplitLesion","warningList","group","tm","sort","m1","m2","convertTimepointsToTableData","date","moment","latestDate","format","ConnectedMeasurementTable","_state$timepointManag","timepointManager","measurementCollection","dispatchRelabel","event","viewportsState","enabledElements","log","error","clientX","clientY","skipAddLabelButton","editLocation","dispatchEditDescription","editDescriptionOnDialog","dispatchJumpToRowItem","timepointManagerState","invertViewportTimepointsOrder","childToolKey","numViewports","numTimepoints","numViewportsToUpdate","Math","min","reverse","measurementsForToolGroup","measurementsToJumpTo","_loop","i","dataAtThisTimepoint","entry","getToolConfiguration","Array","isArray","key","utils","studyMetadataManager","get","Error","sopInstanceUid","images","image","getSOPInstanceUID","displaySetContainsSopInstance","frameIndex","jumpToRowItem","active","measurementToActive","propsFromState","propsFromDispatch","objectSpread","selectedMeasurementNumber","onItemClick","onRelabelClick","onEditDescriptionClick","onDeleteClick","MeasurementHandlers","onRemoved","detail","MeasurementTable","FlexboxLayout","studiesForBrowser","getStudiesForBrowser","imageId","seriesDescription","seriesNumber","instanceNumber","numImageFrames","getImageId","mainContentClassName","connectedComponents_ConnectedStudyBrowser","connectedComponents_ConnectedViewerMain","connectedComponents_ConnectedMeasurementTable","ConnectedFlexboxLayout","setLayout","ConnectedLayoutButton","currentLayout","onChange","selectedCell","rows","row","columns","col","height","width","LayoutButton","PluginSwitch","buttons","setSingleLayoutData","originalArray","slice","layoutData","ConnectedPluginSwitch","iconClasses","click","console","warn","svgUrl","svgClasses","vtk","mode","sliceNormal","ToolbarRow","onLeftSidebarValueChanged","value","onRightSidebarValueChanged","pluginComp","leftSidebarToggle","svgLink","svgWidth","svgHeight","bottomLabel","rightSidebarToggle","leftSidebarValue","rightSidebarValue","currentPluginId","pluginId","_OHIF$plugins","TOOLBAR","PluginComponent","style","padding","onValueChanged","connectedComponents_ConnectedLayoutButton","connectedComponents_ConnectedPluginSwitch","marginLeft","ConnectedToolbarRow","pluginInLayout","pluginInViewportData","SimpleDialog","rootClass","ref","componentRef","componentStyle","onClose","headerTitle","onConfirm","bounding","elementRef","currentPosition","current","currentElement","offsetParent","offsetTop","offsetHeight","offsetLeft","offsetWidth","top","left","maxHeight","buttonSize","EditDescriptionDialog","componentDidMount","mainElement","onUpdate","handleChange","createRef","prevProps","dialogProps","maxLeft","innerWidth","maxTop","innerHeight","getDialogStyle","components_SimpleDialog_SimpleDialog","autoComplete","autoFocus","LabellingTransition","react_transition_group","in","displayComponent","appear","timeout","classNames","onExited","onTransitionExit","OHIFLabellingData","LabellingFlow","componentDidUpdate","repositionComponent","labellingStateFragment","_this$state","locationLabel","items","currentItems","onSelected","selectTreeSelectCalback","selectTreeFirstTitle","onComponentChange","Fragment","fadeOutAndLeaveFast","descriptionInput","defaultValue","relabel","setDescriptionUpdateMode","descriptionCancel","descriptionSave","showLabelling","focus","editDescription","_cloneDeep$descriptio","updateLabelling","itemSelected","viewportTopPosition","nativeEvent","y","confirmationState","isTouchScreen","setTimeout","fadeOutAndLeave","fadeOutTimer","clearFadeOutTimer","clearTimeout","_props$measurementDat","_measurementData$hand","handles","start","end","client","currentPoints","clientStart","pixelToCanvas","clientEnd","canvasOffSetLeft","x","canvasOffSetTop","position","getAddLabelButtonStyle","initialItems","mainElementClassName","LabellingTransition_LabellingTransition","labellingDoneCallback","onMouseLeave","onMouseEnter","LabellingManager","document","addEventListener","onTouchStart","componentWillUnmount","removeEventListener","getRenderComponent","EditDescriptionDialog_EditDescriptionDialog_EditDescriptionDialog","descriptionDialogUpdate","editDescriptionDialog","LabellingFlow_LabellingFlow","treatMeasurementData","responseDialogUpdate","response","getComponentPosition","_eventData$event","LabellingOverlay","visible","LabellingManager_LabellingManager","ConnectedLabellingOverlay","Viewer","retrieveMeasurements","patientId","timepointIds","Promise","resolve","storeMeasurements","retrieveTimepoints","earliestDate","Date","toISOString","studyDate","timepointType","studyInstanceUids","isLocked","storeTimepoints","timepointData","updateTimepoint","query","removeTimepoint","disassociateStudy","onTimepointsUpdated","onMeasurementsUpdated","setConfiguration","dataExchange","retrieve","TimepointApi","remove","update","disassociate","_OHIF$measurements","timepointApi","src_WhiteLabellingContext","Consumer","whiteLabelling","connectedComponents_ConnectedHeader","connectedComponents_ConnectedToolbarRow","connectedComponents_ConnectedFlexboxLayout","connectedComponents_ConnectedLabellingOverlay","setTimepoints","setMeasurements","ConnectedViewer","createDisplaySets","ViewerRetrieveStudyData","seriesInstanceUids","server","retrieveStudiesMetadata","then","updatedStudies","catch","JSON","stringify","connectedComponents_ConnectedViewer","IHEInvokeImageDisplay","match","requestType","params","displayStudyList","studyUID","split","uids","atob","connectedComponents_ViewerRetrieveStudyData","isActive","ConnectedViewerRetrieveStudyData","servers","ViewerRouting","studyUIDs","seriesUIDs","_match$params","connectedComponents_ConnectedViewerRetrieveStudyData","StudyListWithData","searchData","searchForStudies","currentPage","rowsPerPage","studyDateFrom","defaultStudyDateFrom","studyDateTo","defaultStudyDateTo","sortData","defaultSort","patientName","accessionNumber","studyDescription","modalitiesInStudy","modalities","limit","offset","searchStudies","_searchData$sortData","field","order","sortedStudies","onImport","onSelectItem","studyInstanceUID","history","onSearch","studyListFunctionsEnabled","pageSize","studyListDateFilterNumDays","subtract","toDate","ConnectedStudyList","StudyListRouting","studylist_ConnectedStudyList","StandaloneRouting","qs","parse","search","parseQueryAndFetchStudies","src_connectedComponents_Viewer","reject","url","oReq","XMLHttpRequest","responseText","dicomWeb","open","send","CallbackPage","redux_oidc","userManager","successCallback","sessionStorage","getItem","errorCallback","reload","OHIFStandaloneViewer","unlisten","listen","setContext","expired","setItem","Switch","Route","exact","path","onEnter","render","src_CallbackPage","signinRedirect","ConnectedOHIFStandaloneViewer","ViewerbaseDragDropContext","getDefaultToolbarButtons","baseDirectory","sanitizedBaseDirectory","relativePathToIcons","command","getUserManagerForOpenIdConnectClient","oidcSettings","settings","silent_redirect_uri","automaticSilentRenew","revokeAccessTokenOnSignout","filterProtocolClaims","loadUserInfo","createUserManager","loadUser","initWebWorkers","webWorkScriptsPath","scriptsPath","protocol","host","maxWebWorkers","max","navigator","hardwareConcurrency","startWebWorkersOnDemand","webWorkerPath","taskConfiguration","decodeTask","loadCodecsOnStartup","initializeCodecsOnStartup","codecsPath","usePDFJS","strict","webWorkerManager","initialize","resetLabellingAndContextMenuAction","setToolContextMenuDataAction","getOnRightClickCallback","getOnCloseCallback","parseInt","dataset","setToolContextMenuData","isTouchEvent","getOnTouchPressCallback","getResetLabellingAndContextMenu","toolTypes","defaultDropdownItems","actionType","nearbyToolData","removeToolState","_ref2","_ref3","getDropdownItems","coords","nearbyTool","pointNearTool","toolData","getToolState","index","toolInterface","getNearbyToolData","canvas","dropdownItems","ToolContextMenu","updateElementPosition","_this$mainElement$cur","offBoundPixels","availableTools","dropdownComponents","ConnectedToolContextMenu","extensions","ExtensionManager","reducers","localStorage","oidcReducer","combined","combineReducers","createStore","loadState","subscribe","saveState","toolLabellingFlowCallback","setLabellingFlowData","setLabellingFlowDataAction","editResponse","getToolLabellingFlowCallback","mouseButtonMasks","onRightClick","onTouchPress","onNewImage","onMouseClick","toolAction","setExtensionData","setupTools","viewport","connectedComponents_ConnectedToolContextMenu","OHIFCornerstoneExtension","OHIFVTKExtension","OHIFDicomPDFExtension","OHIFDicomHtmlExtension","OHIFDicomMicroscopyExtension","registerExtensions","App","defaultButtons","buttonsAction","setAvailableButtons","firstOpenIdClient","addServers","relativeWebWorkerScriptsPath","es","BrowserRouter","basename","Provider","src_OHIFStandaloneViewer_0","__webpack_require__","d","__webpack_exports__","src_App","applicationProps","app","ReactDOM","getElementById"],"mappings":"0OAMAA,OAAOC,KAAO,CACZC,QCPa,SDQbC,SAAQ,GAAAC,OAAKC,UAIfL,OAAOM,YAAcA,IACrBN,OAAOO,2BAA6BA,IAEpCA,IAA2BC,SAASF,YAAcA,IAClDC,IAA2BC,SAASC,YAAcA,IAElDC,IAAKC,KAAKC,eAAiB,WAEzB,IAAMC,EAAQb,OAAOc,MAAMC,WAC3B,GAAKF,EAAMG,MAASH,EAAMG,KAAKL,KAI/B,OAAOE,EAAMG,KAAKL,KAAKM,cAGzBV,IAA2BW,UAAU,CACnCC,WAAY,SAASC,GACnB,IAAMC,EAAUX,IAAKY,SAASC,yBAE1BF,EAAQG,eACVJ,EAAIK,iBAAiB,gBAAiBJ,EAAQG,kBEjCpD,IAAME,EAAe,CACnBC,iBAAiB,EACjBC,kBAAkB,EAClBC,0BAA0B,EAC1BC,UAAW,GACXC,YAAa,IAoCAC,EAjCJ,WAAkC,IAAjCnB,EAAiCoB,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAzBP,EAAcU,EAAWH,UAAAC,OAAA,EAAAD,UAAA,QAAAE,EAC3C,OAAQC,EAAOC,MACb,IAAK,wBACH,OAAOC,OAAOC,OAAO,GAAI1B,EAAO,CAAEc,gBAAiBS,EAAOvB,QAC5D,IAAK,yBACH,OAAOyB,OAAOC,OAAO,GAAI1B,EAAO,CAAEe,iBAAkBQ,EAAOvB,QAC7D,IAAK,kCACH,OAAOyB,OAAOC,OAAO,GAAI1B,EAAO,CAC9BgB,yBAA0BO,EAAOvB,QAErC,IAAK,0BACH,IAAMiB,EAAYQ,OAAOC,OAAO,GAAIH,EAAOI,mBAE3C,OAAOF,OAAOC,OAAO,GAAI1B,EAAO,CAAEiB,cACpC,IAAK,6BACH,IAAMC,EAAcO,OAAOC,OAAO,GAAI1B,EAAMkB,aAO5C,OALAA,EAAYK,EAAOK,eAAiBH,OAAOC,OACzC,GACAH,EAAOM,qBAGFJ,OAAOC,OAAO,GAAI1B,EAAO,CAAEkB,gBACpC,IAAK,mCACH,OAAOO,OAAOC,OAAO,GAAI1B,EAAO,CAC9BiB,UAAWJ,EAAaI,UACxBC,YAAaL,EAAaK,cAE9B,QACE,OAAOlB,qBClCP8B,SAAQ,GAAAvC,OAAGJ,OAAO4C,OAAOC,eAAjB,cAA4CC,QAAQ,KAAM,MAkBzDC,MAhBf,WACE,OACEC,EAAAC,EAAAC,cAAA,KACEC,OAAO,SACPC,IAAI,sBACJC,UAAU,eACVC,KAAK,mBAELN,EAAAC,EAAAC,cAAA,OAAKG,UAAU,qBACbL,EAAAC,EAAAC,cAAA,OAAKK,UAAS,GAAAnD,OAAKuC,EAAL,sBAEhBK,EAAAC,EAAAC,cAAA,OAAKG,UAAU,oBAAf,oCCbAG,EAAuB,CAC3BC,cAAeV,KAKFW,EAFeC,IAAMC,cAAcJ,6BCPrCK,SAAqB,SAAAhD,GAAK,MAAK,CAC1CwB,KAAM,wBACNxB,WAGWiD,EAAsB,SAAAjD,GAAK,MAAK,CAC3CwB,KAAM,yBACNxB,UAGWkD,EAA8B,SAAAlD,GAAK,MAAK,CACnDwB,KAAM,kCACNxB,2BCNMmD,EAAuBtD,IAAKuD,MAAMC,QAAlCF,mBAyCOG,EALuBC,YAlCd,SAAAvD,GACtB,IAAMwD,EAAcrE,OAAOc,MAAMC,WAAWuD,eAAeC,QAC3D,MAAO,CACLC,OAAQ3D,EAAMmB,GAAGH,yBACjB4C,gBAAiB5D,EAAM6D,YAAYL,GAC/BxD,EAAM6D,YAAYL,GAAaI,gBAC/B,GACJE,YAAa9D,EAAM6D,YAAYL,GAC3BxD,EAAM6D,YAAYL,GAAaM,YAC/B,KAImB,SAAAC,GACzB,MAAO,CACLC,SAAU,WACRD,EAASb,GAA4B,KAEvCe,OAAQ,SAAAC,GACN,IAAMV,EAAcrE,OAAOc,MAAMC,WAAWuD,eAAeC,QACrDG,EAAcM,IAAUhF,OAAOc,MAAMC,WAAW2D,aACtDA,EAAYL,GAAeU,EAC3BH,EAASZ,EAAmBU,IAC5BE,EAASb,GAA4B,IACrCrD,IAAKuE,YAAYC,WAAWH,EAAKJ,cAEnCQ,kBAAmB,WACjBP,EAASZ,KACTY,EAASb,GAA4B,IACrCrD,IAAKuE,YAAYC,gBAKed,CAGpCgB,KCrCIC,cAaJ,SAAAA,EAAYC,GAAO,IAAAC,EAAA,OAAAjD,OAAAkD,EAAA,EAAAlD,CAAAmD,KAAAJ,IACjBE,EAAAjD,OAAAoD,EAAA,EAAApD,CAAAmD,KAAAnD,OAAAqD,EAAA,EAAArD,CAAA+C,GAAAO,KAAAH,KAAMH,KAEDzE,MAAQ,CACXgF,qBAAqB,GAGvBN,EAAKO,QAAU,CACb,CACEC,MAAO,eACPC,KAAM,aACNC,QAASV,EAAKD,MAAMY,0BAEtB,CACEH,MAAO,QACPC,KAAM,aACNG,KAAM,oBAhBOZ,wEAsBjB,OACEvC,EAAAC,EAAAC,cAAA,OAAKG,UAAS,gBAAAjD,OAAkBqF,KAAKH,MAAMc,KAAO,aAAe,KAC/DpD,EAAAC,EAAAC,cAAA,OAAKG,UAAU,mBACZoC,KAAKH,MAAMe,UAAYZ,KAAKH,MAAMe,SAASC,WAC1CtD,EAAAC,EAAAC,cAACqD,EAAA,EAAD,CACEC,GAAIf,KAAKH,MAAMe,SAASC,UACxBjD,UAAU,gCAFZ,kBAQDoC,KAAKH,MAAMmB,UAEVhB,KAAKH,MAAMc,MACXpD,EAAAC,EAAAC,cAACqD,EAAA,EAAD,CACElD,UAAU,yCACVmD,GAAI,CACFE,SAAU,IACV7F,MAAO,CAAEyF,UAAWb,KAAKH,MAAMe,SAASK,YAJ5C,eAYJ1D,EAAAC,EAAAC,cAAA,OAAKG,UAAU,eACbL,EAAAC,EAAAC,cAAA,QAAMG,UAAU,gBAAhB,4BACAL,EAAAC,EAAAC,cAACyD,EAAA,EAAD,CAAUZ,MAAM,UAAUa,KAAMnB,KAAKK,QAASe,MAAM,UACpD7D,EAAAC,EAAAC,cAAC4D,EAAD,eAjEWC,aAAf1B,EAQG2B,aAAe,CACpBZ,MAAM,EACNK,SAAU1D,KA8DCkE,kBAAW5B,GCzDX6B,EALS9C,YAdA,SAAAvD,GACtB,MAAO,CACL2D,OAAQ3D,EAAMmB,GAAGH,2BAIM,SAAA+C,GACzB,MAAO,CACLsB,yBAA0B,WACxBtB,EAASb,GAA4B,OAKnBK,CAGtBiB,GCkBa8B,EALe/C,YA3BN,SAACvD,EAAOuG,GAI5B,IAAMC,EAA0BxG,EAAMyG,QAAQC,SACxCC,EAAyBxC,IAAUoC,EAASK,SAiBlD,OAfAD,EAAuBE,QAAQ,SAAAC,GAC3BA,EAAMC,WAAWF,QAAQ,SAAA3C,GAAQ,IACrB8C,EAA0B9C,EAA1B8C,sBACFC,EAAO,iBAAA1H,OAAoByH,GAC3BE,EAAoBV,EAAwBS,GAE9CE,EAAuB,EACvBD,IACAC,EAAuBD,EAAkBE,iBAG7ClD,EAAKiD,qBAAuBA,MAI7B,CACHP,QAASD,IAMb,KAF0BpD,CAG5B8D,KCCaC,EALgB/D,YA7BP,SAAAvD,GACtB,IAeIuH,EAfEC,EAAoBxH,EAAMyH,QAAQC,iBACrCC,OAAO,SAAAC,GAAM,OAAIA,EAAOpG,OAAS3B,IAAK4H,QAAQI,aAAaC,WAC3DC,IAAI,SAAAH,GAAM,OAAIA,EAAOI,KAElBN,EAAmB,GAgBzB,OAfAF,EAAkBX,QAAQ,SAAAmB,GACxB,IAAMJ,EAAS/H,IAAK4H,QAAQC,iBAAiBO,KAC3C,SAAAL,GAAM,OAAIA,EAAOI,KAAOA,IAEtBJ,IACFF,EAAiBM,GAAMJ,EAAOM,aAM9BV,GAAqBA,EAAkBnG,SACzCkG,EAAgBC,EAAkB,IAG7B,CACLW,OAAQnI,EAAMoI,UAAUD,OACxBE,oBAAqBrI,EAAMoI,UAAUC,oBACrCX,mBACAH,kBAMF,KAF6BhE,CAG7B+E,KC4FaC,qBAlHb,SAAAA,EAAY9D,GAAO,IAAAC,EAAA,OAAAjD,OAAAkD,EAAA,EAAAlD,CAAAmD,KAAA2D,IACjB7D,EAAAjD,OAAAoD,EAAA,EAAApD,CAAAmD,KAAAnD,OAAAqD,EAAA,EAAArD,CAAA8G,GAAAxD,KAAAH,KAAMH,KAgDR+D,gBAAkB,WAIhB,IAHA,IAAMC,EAAe,GADCC,EAEmBhE,EAAKD,MAAtC0D,EAFcO,EAEdP,OAAQQ,EAFMD,EAENC,qBAEP/G,EAAgB,EAAGA,EAAgBuG,EAAOC,UAAU/G,OAAQO,IAAiB,CACpF,IAAIgH,EAAaD,EAAqB/G,GAGtC,IAAKgH,IAAeA,EAAW5B,sBAE7B4B,EADwBlE,EAAK1E,MAArB6I,YACiBZ,KAAK,SAAAa,GAAE,OAAKL,EAAaM,KAAK,SAAAC,GAAC,OAAIA,EAAEhC,wBAA0B8B,EAAG9B,0BAG7FyB,EAAaQ,KAAKL,GAGpB,OAAOH,GAjEU/D,EAoEnBwE,gBAAkB,SAAAC,GAA6B,IAA1BvH,EAA0BuH,EAA1BvH,cAAewH,EAAWD,EAAXC,KAC5BR,EAAalE,EAAK2E,eACtB3E,EAAKD,MAAMmC,QACXwC,EAAKE,iBACLF,EAAKpC,uBAGPtC,EAAKD,MAAM8E,wBAAwB3H,EAAegH,IAzElD/I,IAAKuE,YAAYoF,MAAM,UAEvB9E,EAAK1E,MAAQ,CACX6I,YAAa,IALEnE,8EASJkC,GACb,IAAMiC,EAAc,GAUpB,OATAjC,EAAQC,QAAQ,SAAAC,GACdA,EAAM+B,YAAYhC,QAAQ,SAAA4C,GACnBA,EAAK7B,SACR6B,EAAK7B,OAAS,eAEhBiB,EAAYI,KAAKQ,OAIdZ,yCAGMjC,EAAS0C,EAAkBtC,GACxC,IAAMF,EAAQF,EAAQqB,KAAK,SAAAnB,GACzB,OAAOA,EAAMwC,mBAAqBA,IAGpC,GAAKxC,EAIL,OAAOA,EAAM+B,YAAYZ,KAAK,SAAAW,GAC5B,OAAOA,EAAW5B,wBAA0BA,gDAS9C,IAAM6B,EAAcjE,KAAK8E,eAAe9E,KAAKH,MAAMmC,SAEnDhC,KAAK+E,SAAS,CACZd,iDAkCF,OACE1G,EAAAC,EAAAC,cAAA,OAAKG,UAAU,cACbL,EAAAC,EAAAC,cAACuH,EAAD,CACEhD,QAAShC,KAAKH,MAAMmC,QACpB6B,aAAc7D,KAAK4D,kBACnBU,gBAAiBtE,KAAKsE,kEAMP,IAAAW,EAAAjF,KAEb+D,EAAyB/D,KAAKH,MAA9BkE,qBACRlH,OAAOqI,KAAKnB,GAAsB9B,QAAQ,SAACjF,GACzCiI,EAAKpF,MAAMsF,0BAA0BnI,YArGlBsE,gBCHsCrG,IAAKuD,MAAMC,QAAlEkG,4BAAyBQ,8BA4BlBC,EALazG,YArBJ,SAAAvD,GAAS,IAAAiK,EACiCjK,EAAMoI,UAEpE,MAAO,CACHC,oBAJyB4B,EACrB5B,oBAIJF,OALyB8B,EACA9B,OAKzBQ,qBANyBsB,EACQtB,uBASd,SAAA5E,GACvB,MAAO,CACHwF,wBAAyB,SAAC3H,EAAesC,GACrCH,EAASwF,EAAwB3H,EAAesC,KAEpD6F,0BAA2B,WACvBhG,EAASgG,QAKOxG,CAG1BgF,+BC3Ba,SAAS2B,EAATf,GAKZ,IAJDgB,EAIChB,EAJDgB,SACAC,EAGCjB,EAHDiB,kBACA5E,EAEC2D,EAFD3D,SACA6E,EACClB,EADDkB,YAGMC,EAAiBzK,IAAK0K,aAAaC,eAAeC,SACnCH,EAAeI,MAAMP,GAAUxC,OAClD,SAAAgD,GAAC,OAAIA,EAAEP,oBAAsBA,IAGlBvD,QAAQ,SAAA+D,GACnBA,EAAYpF,SAAWA,EACvBoF,EAAYP,YAAcA,EAE1BC,EAAeO,kBAAkBD,EAAYT,SAAUS,KAGzDN,EAAeQ,8BAGfrL,IAAYsL,qBAAqBlE,QAAQ,SAAAmE,GACvCvL,IAAYwL,YAAYD,EAAeE,WCvB5B,SAASC,EACtBC,EACAC,EACApG,GACA,IACQkF,EAAakB,EAAblB,SACAe,EAAYE,EAAZF,QACFI,EAAepB,EAEAqB,IAAiBC,kBAAkBN,EAASf,GAEpDsB,cAAcN,+BACzBE,EACAD,EACAE,EACArG,OCVIsE,EAA4B1J,IAAKuD,MAAMC,QAAvCkG,wBACAiB,GAAmB3K,IAAK0K,aAAxBC,eAmBR,SAASkB,GAAmBC,GAAiB,IACnCnG,EAA0BmG,EAA1BnG,SAAU6E,EAAgBsB,EAAhBtB,YACduB,EAAO,MAOX,OANIpG,IACFoG,EAAOpG,EACH6E,IACFuB,GAAI,IAAArM,OAAQ8K,EAAR,OAGDuB,EAGT,SAASC,GACPC,EACAC,EACAC,GAEA,IAAM9H,EAAO,GAcb,OAZA4H,EAAsBjF,QAAQ,SAAA+D,GAC5BmB,EAAWlF,QAAQ,SAAAoF,GACjB,IAAMC,EAAW,CACfC,YAAa,OAEXvB,EAAYwB,cAAgBH,EAAUG,cACxCF,EAASC,YAAcH,EAAgBpB,IAEzC1G,EAAK+E,KAAKiD,OAIPhI,EAGT,SAASmI,GAA+BC,EAAiBP,GACvD,IACMQ,EADS1M,IAAK0K,aAAaC,eAAegC,mBACtBC,iBACpB/B,EA/CR,WACE,IAAM3I,EAASlC,IAAK0K,aAAaC,eAAegC,mBAC5C9B,EAAQ,GAKZ,OAJA3I,EAAO0K,iBAAiB5F,QACtB,SAAA6F,GAAS,OAAKhC,EAAQA,EAAMnL,OAAOmN,EAAUC,cAGxCjC,EAwCOkC,GAERC,EAAoBN,EAAWxE,IAAI,SAAA2E,GACvC,MAAO,CACLI,UAAWJ,EAAUK,KACrBC,QAASN,EAAU1E,GACnBuC,aAAc,MA0DlB,OAtDA9I,OAAOqI,KAAKwC,GAAiBzF,QAAQ,SAAAoG,GACnC,IAjEmBxI,EAiEbyI,EAAmBZ,EAAgBW,GACnC5B,EAAOX,EAAMzC,KAAK,SAAAoD,GAAI,OAAIA,EAAKrD,KAAOiF,IACpCjB,EAAoBX,EAAKpG,QAAQkI,iBAAjCnB,gBAGFoB,GAtEa3I,EAsEmC,oBAAlByI,EArE1BG,OAAO,SAACjL,EAAGkL,GAErB,OADElL,EAAEkL,EAAE7I,IAAUrC,EAAEkL,EAAE7I,KAAW,IAAIwE,KAAKqE,GACjClL,GACN,KAoEDX,OAAOqI,KAAKsD,GAAqBvG,QAAQ,SAAA0G,GACvC,IAAMzB,EACJsB,EAAoBG,GAChB5B,EAAkBG,EAAsB,GAE5C1B,EAGEuB,EAHFvB,kBACAoD,EAEE7B,EAFF6B,mBACArD,EACEwB,EADFxB,SAEIsD,EAAgB9B,EAAgB+B,IAGhCC,EAAmB,CACvBC,WAAYJ,EACZK,MAAOnC,GAAmBC,GAC1B8B,gBACArD,oBACAoD,qBACArD,WACA2D,aAAa,EACbC,aAAc,GACdC,eAAe,EACfC,YAAa,GACb/J,KAAM2H,GACJC,EACAC,EACAC,IAK0Ba,EAAkB5E,KAAK,SAAAiG,GACnD,OAAOA,EAAMlB,UAAY3B,EAAKqB,YAGVnC,aAAatB,KAAK0E,OAK5Cd,EAAkBhG,QAAQ,SAAAsH,GACxBA,EAAG5D,aAAa6D,KAAK,SAACC,EAAIC,GAAL,OACnBD,EAAGb,mBAAqBc,EAAGd,mBAAqB,GAAK,MAIlDX,EAGT,SAAS0B,GAA6BxC,GACpC,OAAKA,GAAeA,EAAW1K,OAIxB,CACL,CACEwM,MAAO,cACPW,KAAMC,IAAO1C,EAAW,GAAG2C,YAAYC,OAAO,eANzC,GAWX,IA+MeC,GANmBrL,YAzMV,SAAAvD,GAAS,IAAA6O,EACM7O,EAAM8O,iBAAnC/C,EADuB8C,EACvB9C,WAAYxB,EADWsE,EACXtE,aACpB,MAAO,CACLwB,WAAYwC,GAA6BxC,GACzCgD,sBAAuB1C,GACrB9B,EACAwB,GAEF+C,iBAAkB9O,EAAM8O,iBACxB1G,UAAWpI,EAAMoI,YAIM,SAAArE,GACzB,MAAO,CACLiL,gBAAiB,SAACC,EAAOtD,EAAiBuD,GACxC,IAAM7G,EACH6G,GAAkBA,EAAe7G,qBAAwB,EAEtD8G,EAAkB1P,IAAYsL,qBACpC,IAAKoE,GAAmBA,EAAgB9N,QAAUgH,EAChDxI,IAAKuP,IAAIC,MAAM,0CADjB,CAL2D,IAUnDnE,EAAYiE,EAAgB9G,GAA5B6C,QAEFE,EAAY,CAChB6D,MAAO,CACLK,QAASL,EAAMK,QACfC,QAASN,EAAMM,SAEjBrE,WAGMf,EAA4BwB,EAA5BxB,SAAUsD,EAAkB9B,EAAlB8B,cACZpC,EAAOb,GAAeC,SAASC,MAAMP,GAAUlC,KAAK,SAAA2C,GACxD,OAAOA,EAAY8C,MAAQD,IAU7BtC,EAA+BC,EADP3J,OAAOC,OAAO,GAAI2J,EAAM,CAAE7F,SAAU,OAN5C,CACdgK,oBAAoB,EACpBC,cAAc,MAOlBC,wBAAyB,SAACT,EAAOtD,EAAiBuD,GAChD,IAAM7G,EACH6G,GAAkBA,EAAe7G,qBAAwB,EAEtD8G,EAAkB1P,IAAYsL,qBACpC,IAAKoE,GAAmBA,EAAgB9N,QAAUgH,EAChDxI,IAAKuP,IAAIC,MAAM,0CADjB,CALmE,IAU3DnE,EAAYiE,EAAgB9G,GAA5B6C,QAEFE,EAAY,CAChB6D,MAAO,CACLK,QAASL,EAAMK,QACfC,QAASN,EAAMM,SAEjBrE,WAGMf,EAA4BwB,EAA5BxB,SAAUsD,EAAkB9B,EAAlB8B,cASlBtC,EAA+BC,EARlBZ,GAAeC,SAASC,MAAMP,GAAUlC,KAAK,SAAA2C,GACxD,OAAOA,EAAY8C,MAAQD,IAGb,CACdkC,yBAAyB,MAK7BC,sBAAuB,SACrBjE,EACAuD,EACAW,EACA5K,ICzNS,SACb0G,EACAuD,EACAW,GAEA,IADA5K,EACA7D,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GADU,CAAE0O,+BAA+B,EAAOC,aAAc,MAE1DC,EAAed,EAAe/G,OAAOC,UAAU/G,OAC/C4O,EAAgBJ,EAAsB9D,WAAW1K,OAC/CkJ,EAA6BsF,EAA7BtF,aAAcwB,EAAe8D,EAAf9D,WAChBmE,EAAuBC,KAAKC,IAAIH,EAAeD,GAC7C7F,EAAgCwB,EAAhCxB,SAAUC,EAAsBuB,EAAtBvB,kBAEdnF,EAAQ6K,+BACV/D,EAAWsE,UAOb,IAJA,IAAMC,EAA2B/F,EAAaJ,GAGxCoG,EAAuB,GAd7BC,EAAA,SAeSC,GAfT,IAgBUrE,EAAgBL,EAAW0E,GAA3BrE,YAEFsE,EAAsBJ,EAAyBrI,KAAK,SAAA0I,GACxD,OACEA,EAAMvE,cAAgBA,GACtBuE,EAAMvG,oBAAsBA,IAIhC,IAAKsG,EAEH,OADAH,EAAqBtH,KAAK,MAC1B,WAGF,IAAI2B,EAAc8F,EAEVrF,EAASxL,IAAK0K,aAAaC,eAAeoG,qBAChDzG,GADMkB,KAGR,GAAIpG,EAAQ8K,aACVnF,EAAc8F,EAAoBzL,EAAQ8K,mBACrC,GAAIc,MAAMC,QAAQzF,EAAKsB,YAAa,CACzC,IAAMoE,EAAM1F,EAAKsB,WAAW1E,KAAK,SAAA8I,GAAG,QAAML,EAAoBK,KAC9DnG,EAAc8F,EAAoBK,GAGpCR,EAAqBtH,KAAK2B,IA3BnB6F,EAAI,EAAGA,EAAIP,EAAsBO,IAAKD,EAAtCC,GAqCT,IAKM9H,EAAuB,GA+B7B,OA9BA4H,EAAqB1J,QAAQ,SAAC3C,EAAMtC,GAElC,GAAKsC,EAAL,CAIA,IAAM4C,EAAQjH,IAAKmR,MAAMC,qBAAqBC,IAAIhN,EAAKoF,kBACvD,IAAKxC,EACH,MAAM,IAAIqK,MAAM,oBAGlB,IAAMvI,EAAa9B,EAAMuC,eAAe,SAAAT,GACtC,OAlBkC,SAACA,EAAYwI,GAAb,OACpCxI,EAAWyI,OAAOpJ,KAChB,SAAAqJ,GAAK,OAAIA,EAAMC,sBAAwBH,IAgBhCI,CAA8B5I,EAAY1E,EAAKkN,kBAGxD,IAAKxI,EACH,MAAM,IAAIuI,MAAM,0BAGlBvI,EAAWwI,eAAiBlN,EAAKkN,eAC7BlN,EAAKuN,aACP7I,EAAW6I,WAAavN,EAAKuN,YAG/B9I,EAAqBM,KAAK,CACxBrH,gBACAgH,kBAIG,CACLD,uBACAR,OAAQ,KD4HauJ,CACjB/F,EACAuD,EACAW,EACA9L,EACAkB,GAGS0D,qBAAqB9B,QAAQ,SAAA8B,GAAwB,IACtD/G,EAA8B+G,EAA9B/G,cAAegH,EAAeD,EAAfC,WAEvB7E,EAASwF,EAAwB3H,EAAegH,MAZ/C,IAeKuB,EAAgCwB,EAAhCxB,SAAUC,EAAsBuB,EAAtBvB,kBACZE,EAAiBE,GAAeC,SAEtChJ,OAAOqI,KAAKQ,EAAeI,OAAO7D,QAAQ,SAAAsD,GACnBG,EAAeI,MAAMP,GAE7BtD,QAAQ,SAAA+D,GACnBA,EAAY+G,QAAS,MAIIrH,EAAeI,MAAMP,GAAUxC,OAC1D,SAAAiD,GACE,OAAOA,EAAYR,oBAAsBA,IAIxBvD,QAAQ,SAAA+K,GAC3BA,EAAoBD,QAAS,IAG/BrH,EAAeQ,8BAEfrL,IAAYsL,qBAAqBlE,QAAQ,SAAAmE,GACvCvL,IAAYwL,YAAYD,EAAeE,cAoB5B,SAAC2G,EAAgBC,EAAmBvL,GACrD,OAAO9E,OAAAsQ,EAAA,EAAAtQ,CAAA,CACLsK,WAAY8F,EAAe9F,WAC3BgD,sBAAuB8C,EAAe9C,sBACtCiD,0BAA2BzL,EAASyL,2BACjCF,EAJL,CAKEG,YAAa,SAAChD,EAAOtD,GAKnB,IAAMuD,EAAiB2C,EAAezJ,UAChCyH,EAAwBgC,EAAe/C,iBAS7CgD,EAAkBlC,sBAChBjE,EACAuD,EACAW,EARc,CACdC,+BAA+B,EAC/BC,aAAc,QAUlBmC,eAAgB,SAACjD,EAAOtD,GACtB,IAAMuD,EAAiB2C,EAAezJ,UACtC0J,EAAkB9C,gBAAgBC,EAAOtD,EAAiBuD,IAE5DiD,uBAAwB,SAAClD,EAAOtD,GAC9B,IAAMuD,EAAiB2C,EAAezJ,UACtC0J,EAAkBpC,wBAChBT,EACAtD,EACAuD,IAGJkD,cAAe,SAACnD,EAAOtD,GACW9L,IAAK0K,aAA7B8H,oBAEYC,UAAU,CAC5BC,OAAQ,CACNpI,SAAUwB,EAAgBxB,SAC1BwB,gBAAiB,CACf+B,IAAK/B,EAAgB8B,cACrBD,mBAAoB7B,EAAgB6B,mBACpCpD,kBAAmBuB,EAAgBvB,0BAQb7G,CAIhCiP,KEnPaC,qNA7FbzS,MAAQ,CACN0S,kBAAmB,MAWrBC,qBAAuB,WAOrB,OANoBjO,EAAKD,MAAjBmC,QAMOmB,IAAI,SAAAjB,GA4BjB,MAAO,CACLwC,iBA5B2BxC,EAArBwC,iBA6BNvC,WA3BiBD,EAAM+B,YAAYd,IAAI,SAAAa,GAAc,IASjDgK,EAPF5L,EAKE4B,EALF5B,sBACA6L,EAIEjK,EAJFiK,kBACAC,EAGElK,EAHFkK,aACAC,EAEEnK,EAFFmK,eACAC,EACEpK,EADFoK,eASF,OAJIpK,EAAWyI,QAAUzI,EAAWyI,OAAOhQ,SACzCuR,EAAUhK,EAAWyI,OAAO,GAAG4B,cAG1B,CACLL,UACA5L,wBACA6L,oBACAC,eACAC,iBACAC,2GAtCN,IAAMN,EAAoB9N,KAAK+N,uBAE/B/N,KAAK+E,SAAS,CACZ+I,uDA+CF,IAAIQ,EAAuB,eAU3B,OATItO,KAAKH,MAAM3D,kBACboS,GAAwB,sBAGtBtO,KAAKH,MAAM1D,mBACbmS,GAAwB,uBAKxB/Q,EAAAC,EAAAC,cAAA,OAAKG,UAAU,iBACbL,EAAAC,EAAAC,cAAA,OACEG,UACEoC,KAAKH,MAAM3D,gBACP,yCACA,6BAGNqB,EAAAC,EAAAC,cAAC8Q,EAAD,CAAuBvM,QAAShC,KAAK5E,MAAM0S,qBAE7CvQ,EAAAC,EAAAC,cAAA,OAAKG,UAAW0Q,GACd/Q,EAAAC,EAAAC,cAAC+Q,EAAD,CAAqBxM,QAAShC,KAAKH,MAAMmC,WAE3CzE,EAAAC,EAAAC,cAAA,OACEG,UACEoC,KAAKH,MAAM1D,iBACP,0CACA,8BAGNoB,EAAAC,EAAAC,cAACgR,GAAD,eA7FkBnN,cCQboN,GALgB/P,YAPP,SAAAvD,GACpB,MAAO,CACHc,gBAAiBd,EAAMmB,GAAGL,gBAC1BC,iBAAkBf,EAAMmB,GAAGJ,mBAM/B,KAF2BwC,CAG7BkP,ICTMc,GAAc1T,IAAKuD,MAAMC,QAAzBkQ,UAoCOC,GALejQ,YA7BN,SAAAvD,GACpB,MAAO,CACHyT,cAAezT,EAAMoI,UAAUD,SAIZ,SAAApE,GACvB,MAAO,CAEH2P,SAAU,SAAAC,GAKN,IAJA,IAAIvL,EAAY,GACVwL,EAAOD,EAAaE,IAAM,EAC1BC,EAAUH,EAAaI,IAAM,EAC7B/D,EAAe4D,EAAOE,EACnBrD,EAAI,EAAGA,EAAIT,EAAcS,IAC9BrI,EAAUa,KAAK,CACX+K,OAAM,GAAAzU,OAAK,IAAMqU,EAAX,KACNK,MAAK,GAAA1U,OAAK,IAAMuU,EAAX,OAOb/P,EAASwP,GAJM,CACXnL,kBAQc7E,CAG5B2Q,KCjCIC,2LAQF,OACEhS,EAAAC,EAAAC,cAAA,OAAKG,UAAU,gBACbL,EAAAC,EAAAC,cAACyD,EAAA,EAAD,CAAoBsO,QAASxP,KAAKH,MAAM2P,kBAVrBlO,cAArBiO,GAKGhO,aAAe,GAWTgO,UCjBPZ,GAAc1T,IAAKuD,MAAMC,QAAzBkQ,UAmBR,SAASc,GAAoBC,EAAe1S,EAAesC,GACzD,IAAMkE,EAAYkM,EAAcC,QAC1BC,EAAa/S,OAAOC,OAAO,GAAI0G,EAAUxG,GAAgBsC,GAI/D,OAFAkE,EAAUxG,GAAiB4S,EAEpBpM,EAGT,IA8HeqM,GANelR,YAlJN,SAAAvD,GAAS,IAAAiK,EACSjK,EAAMoI,UAE9C,MAAO,CACLC,oBAJ6B4B,EACvB5B,oBAINF,OAL6B8B,EACF9B,SAQJ,SAAApE,GACzB,MAAO,CACLwP,UAAW,SAAArP,GACTH,EAASwP,GAAUrP,OAcN,SAAC2N,EAAgBC,EAAmBvL,GAAa,IAC1D8B,EAAgCwJ,EAAhCxJ,oBAAqBF,EAAW0J,EAAX1J,OACrBoL,EAAczB,EAAdyB,UAIFzR,EAAQ,GAAAvC,OAAGJ,OAAO4C,OAAOC,eAAjB,cAA4CC,QAAQ,KAAM,KA6GxE,MAAO,CACLmS,QA7Gc,CACd,CACExI,KAAM,WACNpK,KAAM,UACNkT,YAAa,aACb/C,QAAQ,EACRvM,QAAS,SAAAuP,GACPC,QAAQC,KAAK,wBAEb,IAAML,EAAaH,GACjBlM,EAAOC,UACPC,EACA,CAAET,OAAQ,gBAGZ2L,EAAU,CAAEnL,UAAWoM,MAG3B,CACE5I,KAAM,QACNkJ,OAAM,GAAAvV,OAAKuC,EAAL,SACNiT,WAAY,kBACZpD,QAAQ,EACRvM,QAAS,SAAAuP,GACPC,QAAQC,KAAK,SACb,IAQML,EAAaH,GACjBlM,EAAOC,UACPC,EAVW,CACXT,OAAQ,MACRoN,IAAK,CACHC,KAAM,MACNC,YAAa,CAAC,EAAG,EAAG,MAUxB3B,EAAU,CAAEnL,UAAWoM,MAG3B,CACE5I,KAAM,WACNkJ,OAAM,GAAAvV,OAAKuC,EAAL,SACN6P,QAAQ,EACRvM,QAAS,SAAAuP,GACPC,QAAQC,KAAK,YACb,IAQML,EAAaH,GACjBlM,EAAOC,UACPC,EAVW,CACXT,OAAQ,MACRoN,IAAK,CACHC,KAAM,MACNC,YAAa,CAAC,EAAG,EAAG,MAUxB3B,EAAU,CAAEnL,UAAWoM,MAG3B,CACE5I,KAAM,UACNkJ,OAAM,GAAAvV,OAAKuC,EAAL,SACNiT,WAAY,kCACZpD,QAAQ,EACRvM,QAAS,SAAAuP,GACPC,QAAQC,KAAK,WACb,IAQML,EAAaH,GACjBlM,EAAOC,UACPC,EAVW,CACXT,OAAQ,MACRoN,IAAK,CACHC,KAAM,MACNC,YAAa,CAAC,EAAG,EAAG,MAUxB3B,EAAU,CAAEnL,UAAWoM,SA2BDjR,CAI5B4Q,ICpJIrS,UAAQ,GAAAvC,OAAGJ,OAAO4C,OAAOC,eAAjB,cAA4CC,QAAQ,KAAM,MAElEkT,8MAcJC,0BAA4B,SAAAC,GAC1B3Q,EAAKD,MAAMzB,qBAAqBqS,MAGlCC,2BAA6B,SAAAD,GAC3B3Q,EAAKD,MAAMxB,sBAAsBoS,4EAIjC,IAmCIE,EAnCEC,EAAoB,CACxB,CACEH,MAAO,UACPI,QAAO,GAAAlW,OAAKuC,GAAL,iBACP4T,SAAU,GACVC,UAAW,GACXC,YAAa,WAIXC,EAAqB,CACzB,CACER,MAAO,eACPI,QAAO,GAAAlW,OAAKuC,GAAL,8BACP4T,SAAU,GACVC,UAAW,GACXC,YAAa,iBAIXE,EAAmBlR,KAAKH,MAAM3D,gBAChC0U,EAAkB,GAAGH,MACrB,KAEEU,EAAoBnR,KAAKH,MAAM1D,iBACjC8U,EAAmB,GAAGR,MACtB,KAEEW,EAAkBpR,KAAKH,MAAMwR,SA7B5BC,EA+BoCrW,IAAK4H,QAAxCI,EA/BDqO,EA+BCrO,aACFD,EAhCCsO,EA+BexO,iBACUO,KAAK,SAAA0I,GACnC,OAAOA,EAAMnP,OAASqG,EAAasO,SAAWxF,EAAM3I,KAAOgO,IAI7D,GAAIpO,EAAQ,CACV,IAAMwO,EAAkBxO,EAAOM,UAE/BqN,EAAapT,EAAAC,EAAAC,cAAC+T,EAAD,MAGf,OACEjU,EAAAC,EAAAC,cAAA,OAAKG,UAAU,cACbL,EAAAC,EAAAC,cAAA,OAAKG,UAAU,wBAAwB6T,MAAO,CAAEC,QAAS,SACvDnU,EAAAC,EAAAC,cAACyD,EAAA,EAAD,CACEb,QAASuQ,EACTH,MAAOS,EACPS,eAAgB3R,KAAKwQ,6BAGxBG,EACDpT,EAAAC,EAAAC,cAACmU,GAAD,MACArU,EAAAC,EAAAC,cAACoU,GAAD,MACAtU,EAAAC,EAAAC,cAAA,OAAKG,UAAU,0BAA0B6T,MAAO,CAAEK,WAAY,SAC5DvU,EAAAC,EAAAC,cAACyD,EAAA,EAAD,CACEb,QAAS4Q,EACTR,MAAOU,EACPQ,eAAgB3R,KAAK0Q,sCAjFRpP,aAAnBiP,GASGhP,aAAe,CACpBrF,iBAAiB,EACjBC,kBAAkB,GA8EPoU,UC9DAwB,GALapT,YA1BJ,SAAAvD,GAAS,IAAAiK,EACiCjK,EAAMoI,UAA5DD,EADqB8B,EACrB9B,OAAQQ,EADasB,EACbtB,qBAAsBN,EADT4B,EACS5B,oBAChCuO,EAAiBzO,EAAOC,UAAUC,IAAwBF,EAAOC,UAAUC,GAAqBT,OAChGiP,EAAuBlO,EAAqBN,IAAwBM,EAAqBN,GAAqBT,OAIpH,MAAO,CACHqO,SAJ2BW,GAAkBC,GAN/B,cAWd/V,gBAAiBd,EAAMmB,GAAGL,gBAC1BC,iBAAkBf,EAAMmB,GAAGJ,mBAKR,SAAAgD,GACvB,MAAO,CACHf,mBAAoB,SAAAhD,GAChB+D,EAASf,EAAmBhD,KAEhCiD,oBAAqB,SAAAjD,GACjB+D,EAASd,EAAoBjD,OAKbuD,CAG1B4R,IC7BI2B,2LAOF,OACE3U,EAAAC,EAAAC,cAAA,OACEG,UAAS,gBAAAjD,OAAkBqF,KAAKH,MAAMsS,WACtCC,IAAKpS,KAAKH,MAAMwS,aAChBZ,MAAOzR,KAAKH,MAAMyS,gBAElB/U,EAAAC,EAAAC,cAAA,YACEF,EAAAC,EAAAC,cAAA,OAAKG,UAAU,UACbL,EAAAC,EAAAC,cAAA,QAAMG,UAAU,WAAW4C,QAASR,KAAKH,MAAM0S,SAC7ChV,EAAAC,EAAAC,cAAA,QAAMG,UAAU,aAAhB,MAEFL,EAAAC,EAAAC,cAAA,MAAIG,UAAU,SAASoC,KAAKH,MAAM2S,cAEpCjV,EAAAC,EAAAC,cAAA,OAAKG,UAAU,WAAWoC,KAAKH,MAAMmB,UACrCzD,EAAAC,EAAAC,cAAA,OAAKG,UAAU,UACbL,EAAAC,EAAAC,cAAA,UACEb,KAAK,SACLgB,UAAU,iBACV4C,QAASR,KAAKH,MAAM0S,SAHtB,UAOAhV,EAAAC,EAAAC,cAAA,UACEb,KAAK,SACLgB,UAAU,kBACV4C,QAASR,KAAKH,MAAM4S,WAHtB,qBA7BenR,cAArB4Q,GACG3Q,aAAe,CACpB+Q,eAAgB,GAChBH,UAAW,IA8CAD,UCvDA,SAASQ,GAASC,GAAkC,IAAtBC,EAAsBpW,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAJ,GAC7D,GAAKmW,EAAWE,QAAhB,CAIA,IAAMC,EAAiBH,EAAWE,QAEhCE,EAKED,EALFC,aACAC,EAIEF,EAJFE,UACAC,EAGEH,EAHFG,aACAC,EAEEJ,EAFFI,WACAC,EACEL,EADFK,YAEEC,EAAMR,EAAgBQ,KAAOJ,EAC7BK,EAAOT,EAAgBS,MAAQH,EAEnC,GAAKH,EAAL,CAIA,IAAIO,EAAS,GAAA3Y,OAAMoY,EAAaE,aAAnB,MAETA,EAAeG,EAAML,EAAaE,eACpCG,GAAaH,EAAeG,EAAML,EAAaE,cACrC,IACRG,EAAM,GAINC,EAAOF,EAAcJ,EAAaI,cACpCE,EAAON,EAAaI,YAAcA,GACvB,IACTE,EAAO,GAIPC,GAAaR,EAAerB,MAAM6B,YAAcA,IAClDR,EAAerB,MAAM6B,UAAYA,GAE/BR,EAAerB,MAAM2B,MAArB,GAAAzY,OAAgCyY,EAAhC,QACFN,EAAerB,MAAM2B,IAArB,GAAAzY,OAA8ByY,EAA9B,OAEEN,EAAerB,MAAM4B,OAArB,GAAA1Y,OAAiC0Y,EAAjC,QACFP,EAAerB,MAAM4B,KAArB,GAAA1Y,OAA+B0Y,EAA/B,SCzCJ,IAAME,GAAa,CACjBlE,MAAO,GACPD,OAAQ,cCMWoE,eAcnB,SAAAA,EAAY3T,GAAO,IAAAC,EAAA,OAAAjD,OAAAkD,EAAA,EAAAlD,CAAAmD,KAAAwT,IACjB1T,EAAAjD,OAAAoD,EAAA,EAAApD,CAAAmD,KAAAnD,OAAAqD,EAAA,EAAArD,CAAA2W,GAAArT,KAAAH,KAAMH,KASR4T,kBAAoB,WAClBf,GAAS5S,EAAK4T,cAXG5T,EA8CnByS,QAAU,WACRzS,EAAKD,MAAMT,YA/CMU,EAkDnB2S,UAAY,WACV3S,EAAKD,MAAM8T,SAAS7T,EAAK1E,MAAMqK,cAnDd3F,EAsDnB8T,aAAe,SAAAvJ,GACbvK,EAAKiF,SAAS,CAAEU,YAAa4E,EAAM3M,OAAO+S,SApD1C3Q,EAAK1E,MAAQ,CACXqK,YAAa5F,EAAMkH,gBAAgBtB,aAAe,IAGpD3F,EAAK4T,YAAcxV,IAAM2V,YAPR/T,kFAcAgU,GACb9T,KAAKH,MAAM4F,cAAgBqO,EAAUrO,aACvCzF,KAAK+E,SAAS,CACZU,YAAazF,KAAKH,MAAM4F,+CAM5B,IAAMgM,EDlBH,SAAwBa,GAC7B,IAAMb,EAAQ5U,OAAOC,OAAO,GAAIwV,GAC1ByB,EACG,IADHA,EAEI,IAIJC,EAAUzZ,OAAO0Z,WAAaF,EAC9BG,EAAS3Z,OAAO4Z,YAAcJ,EAapC,OAVAtC,EAAM4B,MAAQU,EAAoB,EAClCtC,EAAM2B,KAAOW,EAAqB,EAE9BtC,EAAM4B,KAAOW,IACfvC,EAAM4B,KAAOW,GAEXvC,EAAM2B,IAAMc,IACdzC,EAAM2B,IAAMc,GAGPzC,ECJS2C,CAAepU,KAAKH,MAAMyS,gBAExC,OACE/U,EAAAC,EAAAC,cAAC4W,GAAD,CACE7B,YAAY,mBACZD,QAASvS,KAAKuS,QACdE,UAAWzS,KAAKyS,UAChBN,UAAU,wBACVE,aAAcrS,KAAK0T,YACnBpB,eAAgBb,GAEhBlU,EAAAC,EAAAC,cAAA,SACEgT,MAAOzQ,KAAK5E,MAAMqK,YAClB7H,UAAU,oBACVwF,GAAG,cACHkR,aAAa,MACbC,WAAS,EACTzF,SAAU9O,KAAK4T,uBAtD0BtS,aAA9BkS,GACZjS,aAAe,CACpB8Q,aAAcnU,IAAM2V,YACpBvB,eAAgB,iBCFCkC,2LAOjB,OACEjX,EAAAC,EAAAC,cAACgX,GAAA,cAAD,CACEC,GAAI1U,KAAKH,MAAM8U,iBACfC,QAZmB,EAanBC,QAfmB,IAgBnBC,WAfoB,YAgBpBC,SAAU/U,KAAKH,MAAMmV,kBAEpBhV,KAAKH,MAAMmB,iBAf6BM,cC2BlC2T,GAtCD,CACZ,qBACA,UACA,UACA,OACA,QACA,SACA,QACA,YACA,cACA,cACA,SACA,QACA,OACA,aACA,oBACA,SACA,OACA,oBACA,QACA,WACA,SACA,qBACA,WACA,kBACA,cACA,SACA,UACA,gBAG8B9R,IAAI,SAAAqB,GAClC,MAAO,CACLyE,MAAOzE,EACPiM,MAAOjM,KCtBU0Q,eAanB,SAAAA,EAAYrV,GAAO,IAAAC,EAAAjD,OAAAkD,EAAA,EAAAlD,CAAAmD,KAAAkV,IACjBpV,EAAAjD,OAAAoD,EAAA,EAAApD,CAAAmD,KAAAnD,OAAAqD,EAAA,EAAArD,CAAAqY,GAAA/U,KAAAH,KAAMH,KA4BRsV,mBAAqB,WACnBrV,EAAKsV,uBA9BYtV,EA8DnBuV,uBAAyB,WAAM,IAAAC,EAMzBxV,EAAK1E,MAJPwP,EAF2B0K,EAE3B1K,mBACAC,EAH2ByK,EAG3BzK,aACApF,EAJ2B6P,EAI3B7P,YACA8P,EAL2BD,EAK3BC,cAGIrY,EAAQ,GAAAvC,OAAGJ,OAAO4C,OAAOC,eAAjB,cAA4CC,QAAQ,KAAM,KAExE,OAAKuN,EAaCC,EAEAtN,EAAAC,EAAAC,cAACyD,EAAA,EAAD,CACEsU,MAAO1V,EAAK2V,aACZvG,QAAS,EACTwG,WAAY5V,EAAK6V,wBACjBC,qBAAqB,eACrBC,kBAAmB/V,EAAKsV,sBAK1B7X,EAAAC,EAAAC,cAAAF,EAAAC,EAAAsY,SAAA,KACEvY,EAAAC,EAAAC,cAAA,OACEG,UAAU,mBACV4C,QAASV,EAAKiW,qBAEdxY,EAAAC,EAAAC,cAAA,OAAKG,UAAU,aACbL,EAAAC,EAAAC,cAAA,OAAKK,UAAS,GAAAnD,OAAKuC,EAAL,oBAGlBK,EAAAC,EAAAC,cAAA,OAAKG,UAAU,8BACbL,EAAAC,EAAAC,cAAA,OAAKG,UAAU,YAAY2X,GAC3BhY,EAAAC,EAAAC,cAAA,OAAKG,UAAU,eACbL,EAAAC,EAAAC,cAAA,SACE2F,GAAG,mBACHgP,IAAKtS,EAAKkW,iBACVC,aAAcxQ,GAAe,GAC7B6O,aAAa,UAInB/W,EAAAC,EAAAC,cAAA,OAAKG,UAAU,iBACbL,EAAAC,EAAAC,cAAA,UACEb,KAAK,SACLgB,UAAU,oBACV4C,QAASV,EAAKoW,SAHhB,WAOA3Y,EAAAC,EAAAC,cAAA,UACEb,KAAK,SACLgB,UAAU,qBACV4C,QAASV,EAAKqW,0BAEb1Q,EAAc,QAAU,OAL3B,gBASFlI,EAAAC,EAAAC,cAAA,OAAKG,UAAU,0BACbL,EAAAC,EAAAC,cAAA,UACEb,KAAK,SACLgB,UAAU,oBACV4C,QAASV,EAAKsW,mBAHhB,UAOA7Y,EAAAC,EAAAC,cAAA,UACEb,KAAK,SACLgB,UAAU,qBACV4C,QAASV,EAAKuW,iBAHhB,UApEN9Y,EAAAC,EAAAC,cAAAF,EAAAC,EAAAsY,SAAA,KACEvY,EAAAC,EAAAC,cAAA,UACEb,KAAK,SACLgB,UAAU,iBACV4C,QAASV,EAAKwW,eAEbxW,EAAK1E,MAAMwF,SAAW,OAAS,MALlC,YA3EWd,EA4JnBoW,QAAU,WACRpW,EAAKiF,SAAS,CACZ8F,cAAc,KA9JC/K,EAkKnBqW,yBAA2B,WACzBrW,EAAKkW,iBAAiBnD,QAAQ0D,QAE9BzW,EAAKiF,SAAS,CACZyR,iBAAiB,KAtKF1W,EA0KnBsW,kBAAoB,WAAM,IAAAK,EACKlX,IAAUO,EAAK1E,OAApCqK,mBADgB,IAAAgR,EACF,GADEA,EAExB3W,EAAKkW,iBAAiBnD,QAAQpC,MAAQhL,EAEtC3F,EAAKiF,SAAS,CACZyR,iBAAiB,KA/KF1W,EAmLnBuW,gBAAkB,WAChB,IAAM5Q,EAAc3F,EAAKkW,iBAAiBnD,QAAQpC,MAClD3Q,EAAKD,MAAM6W,gBAAgB,CAAEjR,gBAE7B3F,EAAKiF,SAAS,CACZU,cACA+Q,iBAAiB,KAzLF1W,EA6LnB6V,wBAA0B,SAACtL,EAAOsM,GAChC,IAAM/V,EAAW+V,EAAalG,MAC9B3Q,EAAKD,MAAM6W,gBAAgB,CAAE9V,aAE7B,IAAMgW,EAAsB9W,EAAK4T,YAAYb,QAAQE,aAAaC,UAC5DV,EAAiB,CACrBc,IAAK/I,EAAMwM,YAAYC,EAAIF,EAAsB,GACjDvD,KAAMvT,EAAK1E,MAAMkX,eAAee,MAGlCvT,EAAKiF,SAAS,CACZ8F,cAAc,EACdkM,mBAAmB,EACnBnW,SAAU+V,EAAalG,MACvB8E,cAAeoB,EAAa1N,MAC5BqJ,mBAGExS,EAAKkX,gBACPlX,EAAKmX,WAAaA,WAAW,WAC3BnX,EAAKiF,SAAS,CACZ4P,kBAAkB,KAEnB,OApNY7U,EAwNnBwW,cAAgB,WACdxW,EAAKiF,SAAS,CACZ6F,oBAAoB,EACpBC,cAAc,KA3NC/K,EA+NnBoX,gBAAkB,WAEhBpX,EAAKqX,aAAeF,WAAW,WAC7BnX,EAAKiF,SAAS,CACZ4P,kBAAkB,KAEnB,MArOc7U,EAwOnBiW,oBAAsB,WACpBjW,EAAKiF,SAAS,CACZ4P,kBAAkB,KA1OH7U,EA8OnBsX,kBAAoB,WACbtX,EAAKqX,cAIVE,aAAavX,EAAKqX,eAnPDrX,EAsPnBsV,oBAAsB,WAEpB6B,WAAW,WACTvE,GAAS5S,EAAK4T,cACb,MA1Pc,IAAA4D,EAGgCzX,EAAMkH,gBAA/CnG,EAHS0W,EAGT1W,SAAU2U,EAHD+B,EAGC/B,cAAe9P,EAHhB6R,EAGgB7R,YAE7BgM,EAAQ5R,EAAMyS,eALD,OAMZzS,EAAM+K,qBACT6G,EJzBC,SAAgC1K,EAAiBP,GAAW,IAAA+Q,EAC1CxQ,EAAgByQ,QAA/BC,EADyDF,EACzDE,MAAOC,EADkDH,EAClDG,IACPC,EAAWnR,EAAUoR,cAArBD,OACFE,EAAchd,IAAYid,cAActR,EAAUF,QAASmR,GAC3DM,EAAYld,IAAYid,cAActR,EAAUF,QAASoR,GACzDM,EAAmBL,EAAOM,EAAIJ,EAAYI,EAC1CC,EAAkBP,EAAOb,EAAIe,EAAYf,EACzCqB,EAAW,CACf9E,KAAM0E,EAAUE,EAAID,EACpB5E,IAAK2E,EAAUjB,EAAIoB,GAUrB,OAPIT,EAAMX,EAAIY,EAAIZ,IAChBqB,EAAS/E,KAAOG,GAAWnE,QAEzBqI,EAAMQ,EAAIP,EAAIO,IAChBE,EAAS9E,MAAQE,GAAWlE,OAGvB8I,EIMKC,CAAuBvY,EAAMkH,gBAAiBlH,EAAM2G,YAG9D1G,EAAK1E,MAAQ,CACXwF,WACA2U,gBACA9P,cACAmF,mBAAoB/K,EAAM+K,mBAC1B4L,gBAAiB3W,EAAM2W,gBACvB3L,aAAchL,EAAMgL,aACpByH,eAAgBb,EAChBsF,mBAAmB,EACnBpC,kBAAkB,GAGpB7U,EAAK4T,YAAcxV,IAAM2V,YACzB/T,EAAKkW,iBAAmB9X,IAAM2V,YAE9B/T,EAAKuY,aAAepD,GACpBnV,EAAK2V,aAAelW,IAAUO,EAAKuY,cA1BlBvY,wEAkCjB,IAAIwY,EAAuB,qBACvBtY,KAAK5E,MAAMob,kBACb8B,GAAwB,oBAG1B,IAAM7G,EAAQ5U,OAAOC,OAAO,GAAIkD,KAAK5E,MAAMkX,gBAK3C,OAJItS,KAAK5E,MAAMwP,qBACb6G,EAAM4B,MAAQ,KAId9V,EAAAC,EAAAC,cAAC8a,GAAD,CACE5D,iBAAkB3U,KAAK5E,MAAMuZ,iBAC7BK,iBAAkBhV,KAAKH,MAAM2Y,uBAE7Bjb,EAAAC,EAAAC,cAAA,OACEG,UAAW0a,EACX7G,MAAOA,EACPW,IAAKpS,KAAK0T,YACV+E,aAAczY,KAAKkX,gBACnBwB,aAAc1Y,KAAKoX,mBAElBpX,KAAKqV,kCArE2B/T,aCFtBqX,sBAqBnB,SAAAA,EAAY9Y,GAAO,IAAAC,EAAAjD,OAAAkD,EAAA,EAAAlD,CAAAmD,KAAA2Y,IACjB7Y,EAAAjD,OAAAoD,EAAA,EAAApD,CAAAmD,KAAAnD,OAAAqD,EAAA,EAAArD,CAAA8b,GAAAxY,KAAAH,KAAMH,KAoBR4T,kBAAoB,WAClBmF,SAASC,iBAAiB,aAAc/Y,EAAKgZ,eAtB5BhZ,EAyBnBiZ,qBAAuB,WACrBH,SAASI,oBAAoB,aAAclZ,EAAKgZ,eA1B/BhZ,EAiCnBmZ,mBAAqB,WAAM,IAAA3D,EAMrBxV,EAAK1E,MAJPyP,EAFuByK,EAEvBzK,aACA2L,EAHuBlB,EAGvBkB,gBACAzL,EAJuBuK,EAIvBvK,wBACAhE,EALuBuO,EAKvBvO,gBAGF,OAAIgE,EAEAxN,EAAAC,EAAAC,cAACyb,GAAD,CACE9Z,SAAUU,EAAKD,MAAM2Y,sBACrB7E,SAAU7T,EAAKqZ,wBACf9G,aAAcvS,EAAKsZ,sBACnB9G,eAAgBxS,EAAK1E,MAAMkX,eAC3BvL,gBAAiBA,IAKnB8D,GAAgB2L,EAEhBjZ,EAAAC,EAAAC,cAAC4b,GAADxc,OAAAC,OAAA,GACMgD,EAAKD,MADX,CAEEyS,eAAgBxS,EAAK1E,MAAMkX,uBAJjC,GArDiBxS,EA+DnBwZ,qBAAuB,SAAAvS,GAAmB,IAAAjD,EACEhE,EAAKD,MAAvC2W,EADgC1S,EAChC0S,gBAAiB3L,EADe/G,EACf+G,aAErB2L,IACFzP,EAAgBtB,iBAAc/I,GAE5BmO,IACF9D,EAAgBnG,cAAWlE,IAtEZoD,EA0EnByZ,qBAAuB,SAAAC,GACrB1Z,EAAKD,MAAM6W,gBAAgB,CACzB8C,aAEF1Z,EAAKD,MAAM2Y,yBA9EM1Y,EAiFnBqZ,wBAA0B,SAAA1T,GACxB3F,EAAKD,MAAM6W,gBAAgB,CACzBjR,gBAEF3F,EAAKD,MAAM2Y,yBAlFX,IAAMzR,EAAkBxH,IAAUM,EAAMkH,iBACxCjH,EAAKwZ,qBAAqBvS,GAE1B,IAAI8D,EAAehL,EAAMgL,aANR,OAOZhL,EAAM2W,iBAAoB3W,EAAMgL,eACnCA,GAAe,GAGjB/K,EAAK1E,MAAQ,CACXkX,eAAgBmH,GAAqB5Z,EAAM2G,WAC3CoE,mBAAoB/K,EAAM+K,mBAC1BC,aAAcA,EACd2L,gBAAiB3W,EAAM2W,gBACvBzL,wBAAyBlL,EAAMkL,wBAC/BhE,gBAAiBA,GAjBFjH,wEA8BjB,OAAOE,KAAKiZ,4BAnD8B3X,cA8G9C,SAASmY,GAAqBjT,GAAW,IAAAkT,EAGnClT,EADF6D,MAGF,MAAO,CACLgJ,KANqCqG,EAE5BhP,QAKT0I,IAPqCsG,EAEb/O,SAhHPgO,GAcZpX,aAAe,CACpBqJ,oBAAoB,EACpBC,cAAc,EACd2L,iBAAiB,EACjBzL,yBAAyB,OCxBvB4O,oLAUF,OAAK3Z,KAAKH,MAAM+Z,QAITrc,EAAAC,EAAAC,cAACoc,GAAqB7Z,KAAKH,OAHzB,YAXkByB,aAAzBqY,GAKGpY,aAAe,CACpBqY,SAAS,GAYED,UCCAG,GALmBnb,YAfV,SAAAvD,GACtB,IAAKA,EAAMmB,KAAOnB,EAAMmB,GAAGF,UACzB,MAAO,CACLud,SAAS,GAIb,IAAM7c,EAAoB3B,EAAMmB,GAAGF,UAEnC,OAAOQ,OAAAsQ,EAAA,EAAAtQ,CAAA,CACL+c,SAAS,GACN7c,IAML,KAFgC4B,CAGhCgb,IC6KaI,sBAzIb,SAAAA,EAAYla,GAAO,IAAAC,EAAA,OAAAjD,OAAAkD,EAAA,EAAAlD,CAAAmD,KAAA+Z,IACjBja,EAAAjD,OAAAoD,EAAA,EAAApD,CAAAmD,KAAAnD,OAAAqD,EAAA,EAAArD,CAAAkd,GAAA5Z,KAAAH,KAAMH,KAmBRma,qBAAuB,SAACC,EAAWC,GAGjC,OAFAjf,IAAKuP,IAAIhQ,KAAK,wBAEP2f,QAAQC,WAvBEta,EA0BnBua,kBAAoB,SAACtT,EAAiBmT,GAGpC,OAFAjf,IAAKuP,IAAIhQ,KAAK,qBAEP2f,QAAQC,WA7BEta,EAgCnBwa,mBAAqB,SAAAvX,GACnB9H,IAAKuP,IAAIhQ,KAAK,sBAGd,IAAI+f,GAAe,IAAIC,MAAOC,cAC1B3Q,GAAa,IAAI0Q,MAAOC,cAe5B,OAdI3a,EAAKD,MAAMmC,UACb8H,EAAa,IAAI0Q,KAAK,cAAcC,cACpC3a,EAAKD,MAAMmC,QAAQC,QAAQ,SAAAC,GACzB,IAAMwY,EAAY7Q,IAAO3H,EAAMwY,UAAW,YAAYD,cAClDC,EAAYH,IACdA,EAAeG,GAEbA,EAAY5Q,IACdA,EAAa4Q,MAMZP,QAAQC,QAAQ,CACrB,CACEO,cAAe,WACfnT,YAAa,cACboT,kBAAmB9a,EAAKD,MAAM+a,kBAC9BX,UAAWlX,EAAOkX,UAClBM,eACAzQ,aACA+Q,UAAU,MA5DG/a,EAiEnBgb,gBAAkB,SAAAC,GAEhB,OADA9f,IAAKuP,IAAIhQ,KAAK,mBACP2f,QAAQC,WAnEEta,EAsEnBkb,gBAAkB,SAACD,EAAeE,GAEhC,OADAhgB,IAAKuP,IAAIhQ,KAAK,mBACP2f,QAAQC,WAxEEta,EA2EnBob,gBAAkB,SAAA1T,GAEhB,OADAvM,IAAKuP,IAAIhQ,KAAK,mBACP2f,QAAQC,WA7EEta,EAgFnBqb,kBAAoB,SAACjB,EAAcxV,GAEjC,OADAzJ,IAAKuP,IAAIhQ,KAAK,qBACP2f,QAAQC,WAlFEta,EAqFnBsb,oBAAsB,SAAAjU,GAChBrH,EAAKD,MAAMub,qBACbtb,EAAKD,MAAMub,oBAAoBjU,IAvFhBrH,EA2FnBub,sBAAwB,SAAA1V,GAClB7F,EAAKD,MAAMwb,uBACbvb,EAAKD,MAAMwb,sBAAsB1V,IA3FnC1K,IAAK0K,aAAaC,eAAe0V,iBAAiB,CAChDC,aAAc,CACZC,SAAU1b,EAAKka,qBACf3e,MAAOyE,EAAKua,qBAIhBpf,IAAK0K,aAAa8V,aAAaH,iBAAiB,CAC9CC,aAAc,CACZC,SAAU1b,EAAKwa,mBACfjf,MAAOyE,EAAKgb,gBACZY,OAAQ5b,EAAKob,gBACbS,OAAQ7b,EAAKkb,gBACbY,aAAc9b,EAAKqb,qBAfNrb,mFAiGC,IACVkC,EAAYhC,KAAKH,MAAjBmC,QADU6Z,EAEuB5gB,IAAK0K,aAAtC8V,EAFUI,EAEVJ,aAAc7V,EAFJiW,EAEIjW,eAGhBkW,EAAe,IAAIL,EAFE,cAE+B,CACxDL,oBAAqBpb,KAAKob,sBAGtB1V,EAAiB,IAAIE,EAAekW,EAAc,CACtDT,sBAAuBrb,KAAKqb,wBAGxBpB,EAAYjY,EAAQ,IAAMA,EAAQ,GAAGiY,UAC3C6B,EAAaxB,mBAAmB,CAAEL,cAClCvU,EAAesU,qBAAqBC,EAAW,CAZpB,iDAgB3B,OACE1c,EAAAC,EAAAC,cAAAF,EAAAC,EAAAsY,SAAA,KACEvY,EAAAC,EAAAC,cAACse,EAAsBC,SAAvB,KACG,SAAAC,GAAc,OACb1e,EAAAC,EAAAC,cAACye,EAAD,CAAiBvb,MAAM,GACpBsb,EAAeje,iBAItBT,EAAAC,EAAAC,cAAA,OAAK2F,GAAG,SAASxF,UAAU,UACzBL,EAAAC,EAAAC,cAAC0e,GAAD,MAGA5e,EAAAC,EAAAC,cAAC2e,GAAD,CAAwBpa,QAAShC,KAAKH,MAAMmC,UAC5CzE,EAAAC,EAAAC,cAAC4e,GAAD,eA1IW/a,iBC7CsBrG,IAAKuD,MAAMC,QAA9C6d,oBAAeC,sBAkBRC,GALS7d,YACtB,KAZyB,SAAAQ,GACzB,MAAO,CACLic,oBAAqB,SAAAjU,GACnBhI,EAASmd,GAAcnV,KAEzBkU,sBAAuB,SAAA1V,GACrBxG,EAASod,GAAgB5W,OAKPhH,CAGtBob,ICfM0C,GAAsBxhB,IAAKmR,MAA3BqQ,kBA0DOC,8MAjDbthB,MAAQ,CACN4G,QAAS,KACTyI,MAAO,yFAGW,IAAAxF,EAAAjF,KAAA8D,EAGwC9D,KAAKH,MAAvD+a,EAHU9W,EAGV8W,kBAAmB+B,EAHT7Y,EAGS6Y,mBAAoBC,EAH7B9Y,EAG6B8Y,OAC/B3hB,IAAK+G,QAAQ6a,wBAC3BD,EACAhC,EACA+B,GAKCG,KAAK,SAAA9a,GACJ,IAAM+a,EAAiBN,GAAkBza,GAEzCiD,EAAKF,SAAS,CACZ/C,QAAS+a,MAGZC,MAAM,SAAAvS,GAKL,MAJAxF,EAAKF,SAAS,CACZ0F,OAAO,IAGH,IAAI8B,MAAM9B,sCAKpB,OAAIzK,KAAK5E,MAAMqP,MACNlN,EAAAC,EAAAC,cAAA,qBAAawf,KAAKC,UAAUld,KAAK5E,MAAMqP,QACpCzK,KAAK5E,MAAM4G,QAKrBzE,EAAAC,EAAAC,cAAC0f,GAAD,CACEnb,QAAShC,KAAK5E,MAAM4G,QACpB4Y,kBAAmB5a,KAAKH,MAAM+a,oBANzBrd,EAAAC,EAAAC,cAAA,gCA5CyB6D,aCqCvB8b,OAxCf,SAAA7Y,GAA0C,IAElCqW,EAFyByC,EAAS9Y,EAAT8Y,MACvBC,EAAcD,EAAME,OAAOtC,MAAMqC,YAGnCE,GAAmB,EAEvB,GAAoB,UAAhBF,EACA1C,EAAoByC,EAAME,OAAOtC,MAAMwC,SAASC,MAAM,UACnD,GAAoB,gBAAhBJ,EAA+B,CACtC,IAAMK,EAAO3d,KAAKud,OAAOtC,MAAMwC,SAE/B7C,EADoBrgB,OAAOqjB,KAAKD,GACAD,MAAM,UAGtCF,GAAmB,EAKvB,OAAIA,EACQ,GAIRjgB,EAAAC,EAAAC,cAACogB,GAAD,CAAyBjD,kBAAmBA,KCzB9CkD,GAAW,SAACtgB,GAAD,OAAoB,IAAbA,EAAEuP,QAeXgR,GAL0Bpf,YARjB,SAAAvD,GAGpB,MAAO,CACHwhB,OAHiBxhB,EAAM4iB,QAAQA,QAAQ3a,KAAKya,MAShD,KAFqCnf,CAGvC+d,ICeauB,OA3Bf,SAAA1Z,GAAkC,IAG1B2Z,EACAC,EAJiBd,EAAS9Y,EAAT8Y,MAASe,EACoBf,EAAME,OAAhD3C,EADsBwD,EACtBxD,kBAAmB+B,EADGyB,EACHzB,mBAY3B,OAPI/B,IAAsB+B,EACtBuB,EAAYtD,EAAkB8C,MAAM,KAC7B9C,GAAqB+B,IAC5BuB,EAAY,CAACb,EAAME,OAAO7Y,kBAC1ByZ,EAAad,EAAME,OAAOZ,mBAAmBe,MAAM,MAInDngB,EAAAC,EAAAC,cAAC4gB,GAAD,CAAkCzD,kBAAmBsD,EAAWvB,mBAAoBwB,KCVtFG,8MACJljB,MAAQ,CACNmjB,WAAY,GACZvc,QAAS,KACTyI,MAAO,QA0BT+T,iBAAmB,WAQd,IAPHD,EAOG/hB,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAPU,CACXiiB,YAAa,EACbC,YAAaJ,EAAkBI,YAC/BC,cAAeL,EAAkBM,qBACjCC,YAAaP,EAAkBQ,mBAC/BC,SAAUT,EAAkBU,aAGtBpC,EAAW9c,EAAKD,MAAhB+c,OACF7Z,EAAS,CACbkX,UAAWsE,EAAWtE,UACtBgF,YAAaV,EAAWU,YACxBC,gBAAiBX,EAAWW,gBAC5BC,iBAAkBZ,EAAWY,iBAC7BC,kBAAmBb,EAAWc,WAC9BV,cAAeJ,EAAWI,cAC1BE,YAAaN,EAAWM,YACxBS,MAAOf,EAAWG,YAClBa,OAAQhB,EAAWE,YAAcF,EAAWG,aAI9BzjB,IAAK+G,QAAQwd,cAAc5C,EAAQ7Z,GAIhD+Z,KAAK,SAAA9a,GACCA,IACHA,EAAU,IAFG,IAAAyd,EAKUlB,EAAWQ,SAA5BW,EALOD,EAKPC,MAAOC,EALAF,EAKAE,MACTC,EAAgB5d,EACnBwH,KAAK,SAAShM,EAAGkL,GAChB,MAAc,SAAViX,EACEniB,EAAEkiB,GAAShX,EAAEgX,IACP,EAENliB,EAAEkiB,GAAShX,EAAEgX,GACR,EAEF,EAEHliB,EAAEkiB,GAAShX,EAAEgX,IACP,EAENliB,EAAEkiB,GAAShX,EAAEgX,GACR,EAEF,IAGVvc,IAAI,SAAAjB,GAIH,OAHAA,EAAMwY,UAAY7Q,IAAO3H,EAAMwY,UAAW,YAAY3Q,OACpD,gBAEK7H,IAGXpC,EAAKiF,SAAS,CACZ/C,QAAS4d,MAGZ5C,MAAM,SAAAvS,GAKL,MAJA3K,EAAKiF,SAAS,CACZ0F,OAAO,IAGH,IAAI8B,MAAM9B,QAItBoV,SAAW,eAIXC,aAAe,SAAAC,GACbjgB,EAAKD,MAAMmgB,QAAQ3b,KAAnB,WAAA1J,OAAmColB,OAGrCE,SAAW,SAAA1B,GACTze,EAAK0e,iBAAiBD,uFArFtBve,KAAKwe,oDAyFL,OAAIxe,KAAK5E,MAAMqP,MACNlN,EAAAC,EAAAC,cAAA,qBAAawf,KAAKC,UAAUld,KAAK5E,MAAMqP,QACd,OAAvBzK,KAAK5E,MAAM4G,QACbzE,EAAAC,EAAAC,cAAA,yBAIPF,EAAAC,EAAAC,cAAAF,EAAAC,EAAAsY,SAAA,KACEvY,EAAAC,EAAAC,cAACye,EAAD,CAAiBvb,MAAM,EAAMzF,KAAM8E,KAAKH,MAAM3E,OAC9CqC,EAAAC,EAAAC,cAACyD,EAAA,EAAD,CACEc,QAAShC,KAAK5E,MAAM4G,QACpBke,2BAA2B,EAC3BL,SAAU7f,KAAK6f,SACfC,aAAc9f,KAAK8f,aACnBK,SAAUngB,KAAK0e,YACfM,YAAaV,EAAkBU,YAC/BoB,2BACE9B,EAAkB8B,2BAEpBH,SAAUjgB,KAAKigB,mBAvIO3e,aAA1Bgd,GAcGI,YAAc,GAdjBJ,GAeGU,YAAc,CAAEU,MAAO,cAAeC,MAAO,QAfhDrB,GAiBG8B,2BAA6B,KAjBhC9B,GAkBGM,qBAAuB/U,MAC3BwW,SAAS/B,GAAkB8B,2BAA4B,QACvDE,SApBChC,GAqBGQ,mBAAqB,IAAItE,KAyHnBhZ,mBAAW8c,IClJpBR,GAAW,SAACtgB,GAAD,OAAoB,IAAbA,EAAEuP,QAgBXwT,GALY5hB,YATH,SAAAvD,GAGpB,MAAO,CACHwhB,OAHiBxhB,EAAM4iB,QAAQA,QAAQ3a,KAAKya,IAI5C5iB,KAAME,EAAMG,KAAKL,OAMrB,KAFuByD,CAGzB2f,ICKakC,OAjBf,SAAAjc,GAII,OAJiCA,EAAT8Y,MAKpB9f,EAAAC,EAAAC,cAACgjB,GAAD,2BCLAhE,GAAsBxhB,IAAKmR,MAA3BqQ,kBA2GOiE,8MAxGbtlB,MAAQ,CACN4G,QAAS,KACTyI,MAAO,yFA6EW,IAAAxF,EAAAjF,KACZib,EAAQ0F,KAAGC,MAAM5gB,KAAKH,MAAMe,SAASigB,QAC3CH,EAAkBI,0BAA0B7F,GAAO6B,KACjD,SAAA9a,GACE,IAAM+a,EAAiBN,GAAkBza,GAEzCiD,EAAKF,SAAS,CAAE/C,QAAS+a,KAE3B,SAAAtS,GACExF,EAAKF,SAAS,CAAE0F,6CAMpB,OAAIzK,KAAK5E,MAAMqP,MACNlN,EAAAC,EAAAC,cAAA,qBAAawf,KAAKC,UAAUld,KAAK5E,MAAMqP,QACpCzK,KAAK5E,MAAM4G,QAIhBzE,EAAAC,EAAAC,cAACsjB,GAAD,CAAQ/e,QAAShC,KAAK5E,MAAM4G,UAH1BzE,EAAAC,EAAAC,cAAA,6EAvFsBwd,GAC/B,OAAO,IAAId,QAAQ,SAACC,EAAS4G,GAC3B,IAAMC,EAAMhG,EAAMgG,IAEbA,GACHD,EAAO,IAAIzU,MAAM,4CAKnB,IAAM2U,EAAO,IAAIC,eAGjBD,EAAKrI,iBAAiB,QAAS,SAAApO,GAC7BxP,IAAKuP,IAAIyF,KAAK,oDACd+Q,EAAOvW,KAKTyW,EAAKrI,iBAAiB,OAAQ,WAGvBqI,EAAKE,eACRnmB,IAAKuP,IAAIyF,KAAK,0BACd+Q,EAAO,IAAIzU,MAAM,4BAGnBtR,IAAKuP,IAAIhQ,KAAKyiB,KAAKC,UAAUgE,EAAKE,aAAc,KAAM,IAEtD,IAAM9hB,EAAO2d,KAAK2D,MAAMM,EAAKE,cAC7B,GAAI9hB,EAAK0e,SAAW/C,EAAML,kBAAmB,CAC3C,IAAMgC,EAAStd,EAAK0e,QAAQqD,SAAS,GACrCzE,EAAOhgB,KAAO,WAEd,IAAMge,EAAoBK,EAAML,kBAAkB8C,MAAM,KAGxDziB,IAAK+G,QACF6a,wBACCD,EACAhC,EALuB,IAQxBkC,KACC,SAAA9a,GACEoY,EAAQpY,IAEV,SAAAyI,GACEuW,EAAOvW,UAIb2P,EAAQ9a,EAAK0C,WAOjB/G,IAAKuP,IAAIhQ,KAAT,uBAAAG,OAAqCsmB,IACrCC,EAAKI,KAAK,MAAOL,GACjBC,EAAKllB,iBAAiB,SAAU,oBAGhCklB,EAAKK,gBA5EqBjgB,sBCH1BkgB,oLAMK,IAAA1hB,EAAAE,KACP,OACEzC,EAAAC,EAAAC,cAACgkB,GAAA,kBAAD,CACEC,YAAa1hB,KAAKH,MAAM6hB,YACxBC,gBAAiB,WACf,IAAM1gB,EAAW2gB,eAAeC,QAAQ,oBAExC/hB,EAAKD,MAAMmgB,QAAQ3b,KAAKpD,IAE1B6gB,cAAe,SAAArX,GAEb,MAAM,IAAI8B,MAAM9B,KAGlBlN,EAAAC,EAAAC,cAAA,qCApBmB6D,aA0BZE,eAAWggB,iCCApBO,sBAAS,kBAAMxnB,OAAOqG,SAASmhB,WAE/BC,+LAMgB,IAAAliB,EAAAE,KAClBA,KAAKiiB,SAAWjiB,KAAKH,MAAMmgB,QAAQkC,OAAO,SAACthB,EAAUjE,GAC/CmD,EAAKD,MAAMsiB,YACbriB,EAAKD,MAAMsiB,WAAW5nB,OAAOqG,SAASK,2DAM1CjB,KAAKiiB,4CAGE,IAAAne,EACuB9D,KAAKH,MAA3B3E,EADD4I,EACC5I,KAAMwmB,EADP5d,EACO4d,YAGd,GADwBA,KAAiBxmB,GAAQA,EAAKknB,SACjC,CACnB,IAAMnhB,EAAWjB,KAAKH,MAAMe,SAASK,SAMrC,MAJiB,cAAbA,GACF2gB,eAAeS,QAAQ,mBAAoBphB,GAI3C1D,EAAAC,EAAAC,cAAC6kB,GAAA,EAAD,KACE/kB,EAAAC,EAAAC,cAAC8kB,GAAA,EAAD,CAAOC,OAAK,EAACC,KAAK,uBAAuBC,QAASX,KAClDxkB,EAAAC,EAAAC,cAAC8kB,GAAA,EAAD,CAAOC,OAAK,EAACC,KAAK,wBAAwBC,QAASX,KACnDxkB,EAAAC,EAAAC,cAAC8kB,GAAA,EAAD,CACEE,KAAK,YACLE,OAAQ,kBAAMplB,EAAAC,EAAAC,cAACmlB,GAAD,CAAclB,YAAaA,OAE3CnkB,EAAAC,EAAAC,cAAC8kB,GAAA,EAAD,CACEjf,UAAW,WAGT,OAFAoe,EAAYmB,iBAEL,SAOjB,OACEtlB,EAAAC,EAAAC,cAAC6kB,GAAA,EAAD,KACE/kB,EAAAC,EAAAC,cAAC8kB,GAAA,EAAD,CAAOC,OAAK,EAACC,KAAK,uBAAuBC,QAASX,KAClDxkB,EAAAC,EAAAC,cAAC8kB,GAAA,EAAD,CAAOC,OAAK,EAACC,KAAK,wBAAwBC,QAASX,KACnDxkB,EAAAC,EAAAC,cAAC8kB,GAAA,EAAD,CAAOC,OAAK,EAACC,KAAK,aAAanf,UAAWkd,KAC1CjjB,EAAAC,EAAAC,cAAC8kB,GAAA,EAAD,CAAOC,OAAK,EAACC,KAAK,IAAInf,UAAWkd,KACjCjjB,EAAAC,EAAAC,cAAC8kB,GAAA,EAAD,CAAOC,OAAK,EAACC,KAAK,UAAUnf,UAAWod,KACvCnjB,EAAAC,EAAAC,cAAC8kB,GAAA,EAAD,CAAOE,KAAK,6BAA6Bnf,UAAW2a,KACpD1gB,EAAAC,EAAAC,cAAC8kB,GAAA,EAAD,CACEE,KAAK,sDACLnf,UAAW2a,KAEb1gB,EAAAC,EAAAC,cAAC8kB,GAAA,EAAD,CACEE,KAAK,yBACLnf,UAAW8Z,KAEb7f,EAAAC,EAAAC,cAAC8kB,GAAA,EAAD,CAAOI,OAAQ,kBAAMplB,EAAAC,EAAAC,cAAA,4DAhEM6D,aA4E7BwhB,GAAgCnkB,YANd,SAAAvD,GACtB,MAAO,CACLF,KAAME,EAAMG,KAAKL,OAMnB,KAFoCyD,CAGpCqjB,IAEae,eACbvhB,aAAWshB,kDC/GEE,GAAA,WAA8B,IAArBC,EAAqBzmB,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAL,IAEhC0mB,EACwC,MAA5CD,EAAcA,EAAcxmB,OAAS,GACjCwmB,EADJ,GAAAtoB,OAEOsoB,EAFP,KAGIE,EAAsB,GAAAxoB,OAAGuoB,GAAHvoB,OALN,aAKkD0C,QACtE,KACA,KAGF,MAAO,CACL,CACE+lB,QAAS,cACTxmB,KAAM,OACNoK,KAAM,eACNkJ,OAAM,GAAAvV,OAAKwoB,EAAL,4BACNpW,QAAQ,GAEV,CACEqW,QAAS,OACTxmB,KAAM,OACNoK,KAAM,OACNkJ,OAAM,GAAAvV,OAAKwoB,EAAL,oBACNpW,QAAQ,GAEV,CACEqW,QAAS,OACTxmB,KAAM,OACNoK,KAAM,SACNkJ,OAAM,GAAAvV,OAAKwoB,EAAL,sBACNpW,QAAQ,GAEV,CACEqW,QAAS,MACTxmB,KAAM,OACNoK,KAAM,MACNkJ,OAAM,GAAAvV,OAAKwoB,EAAL,mBACNpW,QAAQ,GAEV,CACEqW,QAAS,SACTxmB,KAAM,OACNoK,KAAM,SACNkJ,OAAM,GAAAvV,OAAKwoB,EAAL,4BACNpW,QAAQ,GASV,CACEqW,QAAS,QACTxmB,KAAM,OACNoK,KAAM,QACN8I,YAAa,mBACb/C,QAAQ,GAEV,CACEqW,QAAS,gBACTxmB,KAAM,OACNoK,KAAM,gBACNkJ,OAAM,GAAAvV,OAAKwoB,EAAL,8BACNpW,QAAQ,GAEV,CACEqW,QAAS,QACTxmB,KAAM,OACNoK,KAAM,QACN8I,YAAa,eACb/C,QAAQ,GAEV,CACEqW,QAAS,gBACTxmB,KAAM,OACNoK,KAAM,WACN8I,YAAa,aACb/C,QAAQ,GAEV,CACEqW,QAAS,gBACTxmB,KAAM,OACNoK,KAAM,gBACN8I,YAAa,gBACb/C,QAAQ,GAEV,CACEqW,QAAS,YACTxmB,KAAM,OACNoK,KAAM,YACN8I,YAAa,oBACb/C,QAAQ,GAEV,CACEqW,QAAS,eACTxmB,KAAM,OACNoK,KAAM,eACN8I,YAAa,gBACb/C,QAAQ,GAEV,CACEqW,QAAS,QACTxmB,KAAM,UACNoK,KAAM,QACNkJ,OAAM,GAAAvV,OAAKwoB,EAAL,qBACNpW,QAAQ,KC/FCsW,GAAA,SAAShoB,EAAOioB,GAC7B,GAAKjoB,GAAUioB,EAAf,CAIA,IAAMC,EAAQ1mB,OAAAsQ,EAAA,EAAAtQ,CAAA,GACTymB,EADS,CAEZE,oBAAqB,uBACrBC,sBAAsB,EACtBC,4BAA4B,EAC5BC,sBAAsB,EACtBC,cAAc,IAGVlC,EAAcmC,6BAAkBN,GAItC,OAFAO,oBAASzoB,EAAOqmB,GAETA,IC5BMqC,GAAA,SAASd,EAAee,GACrC,IAAMC,EAAW,GAAAtpB,OAAMJ,OAAOqG,SAASsjB,SAAtB,MAAAvpB,OACfJ,OAAOqG,SAASujB,MADDxpB,OAEdsoB,EAFc,KAAAtoB,OAEGqpB,GACd7mB,EAAS,CACbinB,cAAe7Y,KAAK8Y,IAAIC,UAAUC,oBAAsB,EAAG,GAC3DC,yBAAyB,EACzBC,cAAa,GAAA9pB,OAAKspB,EAAL,+CACbS,kBAAmB,CACjBC,WAAY,CACVC,qBAAqB,EACrBC,2BAA2B,EAC3BC,WAAU,GAAAnqB,OAAKspB,EAAL,4CACVc,UAAU,EACVC,QAAQ,KAKdlqB,IAA2BmqB,iBAAiBC,WAAW/nB,IC8BzD,IAAMgoB,GAAqC,SAAA/pB,GAAK,MAAK,CACnDwB,KAAM,mCACNxB,UAGIgqB,GAA+B,SAACpoB,EAAeC,GAAhB,MAAyC,CAC5EL,KAAM,6BACNI,gBACAC,wBAGF,SAASooB,GAAwBhqB,GAC/B,IAOMiqB,EAAqB,SAAAtoB,GACzB,OAAO,WAKL3B,EAAM8D,SACJimB,GAA6BpoB,EALH,CAC1B4c,SAAS,OASf,OAAO,SAAsBvP,GAC3B,IAAM7D,EAAY6D,EAAMsD,OAClB3Q,EAAgBuoB,SAAS/e,EAAUF,QAAQkf,QAAQxoB,cAAe,KArB3C,SAACA,EAAeC,GAC7C5B,EAAM8D,SAASgmB,MACf9pB,EAAM8D,SACJimB,GAA6BpoB,EAAeC,IA0B9CwoB,CAAuBzoB,EANK,CAC1BwJ,YACAkf,cAAc,EACdnT,QAAS+S,EAAmBtoB,MAOlC,SAAS2oB,GAAwBtqB,GAC/B,IAOMiqB,EAAqB,SAAAtoB,GACzB,OAAO,WAKL3B,EAAM8D,SACJimB,GAA6BpoB,EALH,CAC1B4c,SAAS,OASf,OAAO,SAAsBvP,GAC3B,IAAM7D,EAAY6D,EAAMsD,OAClB3Q,EAAgBuoB,SAAS/e,EAAUF,QAAQkf,QAAQxoB,cAAe,KArB3C,SAACA,EAAeC,GAC7C5B,EAAM8D,SAASgmB,MACf9pB,EAAM8D,SACJimB,GAA6BpoB,EAAeC,IA0B9CwoB,CAAuBzoB,EANK,CAC1BwJ,YACAkf,cAAc,EACdnT,QAAS+S,EAAmBtoB,MAOlC,SAAS4oB,GAAgCvqB,GACvC,OAAO,WACLA,EAAM8D,SAASgmB,iBCjIbU,GAAY,CAChB,QACA,gBACA,SACA,gBACA,gBACA,YACA,gBAGEC,GAAuB,CACzB,CACEC,WAAY,SACZppB,OAAQ,SAAA4H,GAAmC,IAAhCyhB,EAAgCzhB,EAAhCyhB,eACH1f,EADmC/B,EAAhBiC,UACCF,QAE1BK,IAAiBsf,gBACf3f,EACA0f,EAAezgB,SACfygB,EAAevf,MAEjB5L,IAAYwL,YAAYC,KAG5B,CACEyf,WAAY,WACZppB,OAAQ,SAAAupB,GAAmC,IAAhCF,EAAgCE,EAAhCF,eAQTzf,EARyC2f,EAAhB1f,UACRwf,EAATvf,KAEQ,CACdmE,oBAAoB,EACpBC,cAAc,MAMpB,CACEkb,WAAY,iBACZppB,OAAQ,SAAAwpB,GAAmC,IAAhCH,EAAgCG,EAAhCH,eAOTzf,EAPyC4f,EAAhB3f,UACRwf,EAATvf,KAEQ,CACdsE,yBAAyB,OAgDjC,SAASqb,GAAiB5f,GAAiD,IAAtCkf,EAAsClpB,UAAAC,OAAA,QAAAC,IAAAF,UAAA,IAAAA,UAAA,GACnEwpB,GADmExpB,UAAAC,OAAA,GAAAD,UAAA,GAxC3E,SAA2B8J,EAAS+f,EAAQR,GAC1C,IAAMS,EAAa,GACfC,GAAgB,EAmCpB,OAjCAV,EAAU5jB,QAAQ,SAAAsD,GAChB,IAAMihB,EAAW7f,IAAiB8f,aAAangB,EAASf,GACxD,GAAKihB,EA0BL,OAtBAA,EAASlnB,KAAK2C,QAAQ,SAAS3C,EAAMonB,GAEnC,IAAIC,EAAgBhgB,IAAiBC,kBAAkBN,EAASf,GAQhE,GAPKohB,IACHA,EAAgBhgB,IAAiBC,kBAC/BN,EADc,GAAA3L,OAEX4K,EAFW,WAMbohB,EACH,MAAM,IAAIpa,MAAM,mBAGdoa,EAAcJ,cAAcjgB,EAAShH,EAAM+mB,KAC7CE,GAAgB,EAChBD,EAAW7f,KAAOnH,EAClBgnB,EAAWI,MAAQA,EACnBJ,EAAW/gB,SAAWA,MAItBghB,QAAJ,IAKKA,EAAgBD,OAAa5pB,EAIbkqB,CACrBpgB,EAAUF,QACVE,EAAUoR,cAAciP,OACxBhB,KAKF,IACEH,IACAM,GAC4B,kBAA5BA,EAAezgB,SAHjB,CAQA,IAAIuhB,EAAgB,GA0BpB,OAzBId,GACFF,GAAqB7jB,QAAQ,SAASuC,GACpCA,EAAK+Y,OAAS,CACZ/W,YACAwf,kBAGsB,WAApBxhB,EAAKuhB,aACPvhB,EAAKwC,KAAO,sBAGU,aAApBxC,EAAKuhB,aACPvhB,EAAKwC,KAAO,WAGU,mBAApBxC,EAAKuhB,aACPvhB,EAAKwC,KAAL,GAAArM,OACEqrB,EAAevf,KAAKhB,YAAc,OAAS,MAD7C,iBAKFqhB,EAAcziB,KAAKG,KAIhBsiB,OAGHC,eAcJ,SAAAA,EAAYlnB,GAAO,IAAAC,EAAA,OAAAjD,OAAAkD,EAAA,EAAAlD,CAAAmD,KAAA+mB,IACjBjnB,EAAAjD,OAAAoD,EAAA,EAAApD,CAAAmD,KAAAnD,OAAAqD,EAAA,EAAArD,CAAAkqB,GAAA5mB,KAAAH,KAAMH,KAmDR4T,kBAAoB,WACd3T,EAAK4T,YAAYb,SACnB/S,EAAKknB,yBAtDUlnB,EA0DnBqV,mBAAqB,WACfrV,EAAK4T,YAAYb,SACnB/S,EAAKknB,yBA5DUlnB,EAgEnBknB,sBAAwB,WAAM,IAAAC,EAOxBnnB,EAAK4T,YAAYb,QALnBE,EAF0BkU,EAE1BlU,aACAC,EAH0BiU,EAG1BjU,UACAC,EAJ0BgU,EAI1BhU,aACAE,EAL0B8T,EAK1B9T,YACAD,EAN0B+T,EAM1B/T,WAGM1M,EAAc1G,EAAKD,MAAnB2G,UAER,GAAIwM,EAAYC,EAAeF,EAAaE,aAAc,CACxD,IAAMiU,EACJlU,EAAYC,EAAeF,EAAaE,aACpCG,EAAM5M,EAAUoR,cAAciP,OAAO/P,EAAIoQ,EAE/CpnB,EAAK4T,YAAYb,QAAQpB,MAAM2B,IAA/B,GAAAzY,OAAwCyY,EAAM,EAAIA,EAAM,EAAxD,MAGF,GAAIF,EAAaC,EAAcJ,EAAaI,YAAa,CACvD,IAAM+T,EAAiBhU,EAAaC,EAAcJ,EAAaI,YACzDE,EAAO7M,EAAUoR,cAAciP,OAAO5O,EAAIiP,EAEhDpnB,EAAK4T,YAAYb,QAAQpB,MAAM4B,KAA/B,GAAA1Y,OAAyC0Y,EAAO,EAAIA,EAAO,EAA3D,QApFFvT,EAAK4T,YAAcxV,IAAM2V,YAHR/T,wEAMV,IAAAmF,EAAAjF,KACP,IAAKA,KAAKH,MAAM2G,UACd,OAAO,KAFF,IAAA1C,EAK6C9D,KAAKH,MAAjD6lB,EALD5hB,EAKC4hB,aAAclf,EALf1C,EAKe0C,UAChBsgB,EAAgBV,GACpB5f,EACAkf,EARK5hB,EAK0BqjB,gBAQjC,IAAKL,EAAcrqB,OACjB,MAAO,GAGT,IAAM2qB,EAAqBN,EAAc3jB,IAAI,SAAAqB,GAQ3C,OACEjH,EAAAC,EAAAC,cAAA,MAAI0O,IAAK3H,EAAKuhB,YACZxoB,EAAAC,EAAAC,cAAA,UAAQG,UAAU,cAAc4C,QAThB,SAAA6J,GAClB7F,EAAK7H,OAAO6H,EAAK+Y,QACbtY,EAAKpF,MAAM0S,SACbtN,EAAKpF,MAAM0S,YAOThV,EAAAC,EAAAC,cAAA,QAAM0O,IAAK3H,EAAKuhB,YAAavhB,EAAKwC,UAMpCmR,EAAW,CACf/E,IAAG,GAAAzY,OAAK6L,EAAUoR,cAAciP,OAAO/P,EAApC,MACHzD,KAAI,GAAA1Y,OAAK6L,EAAUoR,cAAciP,OAAO5O,EAApC,OAGN,OACE1a,EAAAC,EAAAC,cAAA,OAAKG,UAAU,kBAAkB6T,MAAO0G,EAAU/F,IAAKpS,KAAK0T,aAC1DnW,EAAAC,EAAAC,cAAA,MAAIG,UAAU,WAAWwpB,WA7DH9lB,aAAxBylB,GASGxlB,aAAe,CACpBqY,SAAS,EACT8L,cAAc,GA+FHqB,UC1NAM,GALkB1oB,YAzBT,SAACvD,EAAOuG,GAC9B,IAAKvG,EAAMmB,KAAOnB,EAAMmB,GAAGD,YACzB,MAAO,CACLsd,SAAS,GAH8B,IASvCuN,EAFInqB,EAAkB2E,EAAlB3E,cACFC,EAAsB7B,EAAMmB,GAAGD,YAAYU,GAWjD,OAPE5B,EAAMksB,YACNlsB,EAAMksB,WAAWzsB,aACjBO,EAAMksB,WAAWzsB,YAAYssB,iBAE7BA,EAAiB/rB,EAAMksB,WAAWzsB,YAAYssB,gBAGzCtqB,OAAAsQ,EAAA,EAAAtQ,CAAA,GACFI,EADL,CAEEkqB,oBAMF,KAF+BxoB,CAG/BooB,ICPMQ,GAAqBtsB,IAAKqsB,WAA1BC,oBAC2BtsB,IAAKuD,MAAhCgpB,eAAUC,mBAElBD,GAASjrB,GAAKA,EACdirB,GAASjsB,KAAOmsB,WAEhB,IAAMC,GAAWC,YAAgBJ,IAC3BnsB,GAAQwsB,YAAYF,GAAUF,GAAaK,aAEjDzsB,GAAM0sB,UAAU,WACdN,GAAaO,UAAU,CACrB/oB,YAAa5D,GAAMC,WAAW2D,gBH0GnB,SAAoB5D,GACjC,IAAM4sB,EA3IR,SAAsC5sB,GACpC,IAKM6sB,EAAuB,SAAAnrB,GAC3B1B,EAAM8D,SAN2B,SAAApC,GAAiB,MAAK,CACvDH,KAAM,0BACNG,qBAIeorB,CAA2BprB,KAG5C,OAAO,SACLgK,EACAP,EACAE,GAEA,IADArG,EACA7D,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GADU,GAsBJO,EAAoB,CACxB6c,SAAS,EACTpT,YACAO,kBACA6D,mBAAoBvK,EAAQuK,mBAC5BC,aAAcxK,EAAQwK,aACtB2L,gBAAiBnW,EAAQmW,gBACzB4R,aAAc/nB,EAAQ+nB,aACtBrd,wBAAyB1K,EAAQ0K,wBACjCyN,sBAb4B,WAC5B0P,EAAqB,CAAEtO,SAAS,KAahClD,gBA9BsB,SAAAnS,GAAyC,IAAtC3D,EAAsC2D,EAAtC3D,SAAU4Y,EAA4BjV,EAA5BiV,SAAU/T,EAAkBlB,EAAlBkB,YAGzC7E,IACFmG,EAAgBnG,SAAWA,GAEzB6E,IACFsB,EAAgBtB,YAAcA,GAE5B+T,IACFzS,EAAgByS,SAAWA,GAG7BlU,EAAkCyB,KAoBpCmhB,EAAqBnrB,IA0FWsrB,CAA6BhtB,GACzD8rB,EAAiB,CACrB,CAAEhf,KAAM,MAAOmgB,iBAAkB,CAAC,EAAG,IACrC,CAAEngB,KAAM,OAAQmgB,iBAAkB,CAAC,EAAG,IACtC,CAAEngB,KAAM,OAAQmgB,iBAAkB,CAAC,IACnC,CACEngB,KAAM,gBACNtB,cAAe,CACbA,cAAe,CACbN,+BAAgC0hB,IAGpCK,iBAAkB,CAAC,IAErB,CACEngB,KAAM,SACNtB,cAAe,CACbA,cAAe,CACbN,+BAAgC0hB,IAGpCK,iBAAkB,CAAC,IAErB,CACEngB,KAAM,QACNtB,cAAe,CACbA,cAAe,CACbN,+BAAgC0hB,IAGpCK,iBAAkB,CAAC,IAErB,CAAEngB,KAAM,cAAemgB,iBAAkB,CAAC,IAC1C,CAAEngB,KAAM,QAASmgB,iBAAkB,CAAC,IACpC,CACEngB,KAAM,gBACNtB,cAAe,CACbA,cAAe,CACbN,+BAAgC0hB,IAGpCK,iBAAkB,CAAC,IAErB,CACEngB,KAAM,gBACNtB,cAAe,CACbA,cAAe,CACbN,+BAAgC0hB,IAGpCK,iBAAkB,CAAC,IAErB,CACEngB,KAAM,YACNtB,cAAe,CACbA,cAAe,CACbN,+BAAgC0hB,IAGpCK,iBAAkB,CAAC,IAErB,CACEngB,KAAM,eACNtB,cAAe,CACbA,cAAe,CACbN,+BAAgC0hB,IAGpCK,iBAAkB,CAAC,IAErB,CAAEngB,KAAM,iBACR,CAAEA,KAAM,kBACR,CAAEA,KAAM,yBACR,CAAEA,KAAM,0BAGJogB,EAAelD,GAAwBhqB,GACvCmtB,EAAe7C,GAAwBtqB,GACvCotB,EAAa7C,GAAgCvqB,GAC7CqtB,EAAe9C,GAAgCvqB,GAC/Cyd,EAAe8M,GAAgCvqB,GAC/CstB,EAAa1tB,IAAKuD,MAAMC,QAAQmqB,iBAAiB,cAAe,CACpEzB,iBACAsB,aACAF,eACAC,eACA1P,eACA4P,iBAGFrtB,EAAM8D,SAASwpB,GGjMjBE,CAAWxtB,IAEX,IAAM2F,GAAW,CACf8nB,SAAU,CAACvrB,EAAAC,EAAAC,cAACsrB,GAAD,QAIPzB,GAAa,CACjB,IAAI0B,KAAyB,CAAEhoB,cAC/B,IAAIioB,KACJ,IAAIC,KACJ,IAAIC,KACJ,IAAIC,MAEN7B,GAAiB8B,mBAAmBhuB,GAAOisB,IAG3C/sB,OAAOc,MAAQA,OAQTiuB,eAcJ,SAAAA,EAAYzpB,GAAO,IAAAC,EAAAjD,OAAAkD,EAAA,EAAAlD,CAAAmD,KAAAspB,GACjBxpB,EAAAjD,OAAAoD,EAAA,EAAApD,CAAAmD,KAAAnD,OAAAqD,EAAA,EAAArD,CAAAysB,GAAAnpB,KAAAH,KAAMH,IAGN,IAxBmBme,EAwBbuL,EAAiBvG,GAAyBljB,EAAKD,MAAMzC,gBACrDosB,EAAgBvuB,IAAKuD,MAAMC,QAAQgrB,oBAAoBF,GAI7D,GAFAluB,GAAM8D,SAASqqB,GAEX1pB,EAAKD,MAAMtE,KAAKkB,OAAQ,CAC1B,IAAMitB,EAAoB5pB,EAAKD,MAAMtE,KAAK,GAE1CuE,EAAK4hB,YAAc2B,GACjBhoB,GACAquB,GAda,OApBE1L,EAqCLle,EAAKD,MAAMme,UAnCzB/iB,IAAKmR,MAAMud,WAAW3L,EAAS3iB,IAoC/B0oB,GACEjkB,EAAKD,MAAMzC,eACX0C,EAAKD,MAAM+pB,8BApBI9pB,wEAyBjB,IAAM4hB,EAAc1hB,KAAK0hB,YAEzB,OAAIA,EAEAnkB,EAAAC,EAAAC,cAACosB,EAAA,EAAD,CAAUxuB,MAAOA,IACfkC,EAAAC,EAAAC,cAACgkB,GAAA,aAAD,CAAcpmB,MAAOA,GAAOqmB,YAAaA,GACvCnkB,EAAAC,EAAAC,cAACqsB,EAAA,EAAD,CAAQC,SAAU/pB,KAAKH,MAAMzC,gBAC3BG,EAAAC,EAAAC,cAACse,EAAsBiO,SAAvB,CAAgCvZ,MAAOzQ,KAAKH,MAAMoc,gBAChD1e,EAAAC,EAAAC,cAACwsB,GAAD,CAAsBvI,YAAaA,QAS7CnkB,EAAAC,EAAAC,cAACosB,EAAA,EAAD,CAAUxuB,MAAOA,IACfkC,EAAAC,EAAAC,cAACqsB,EAAA,EAAD,CAAQC,SAAU/pB,KAAKH,MAAMzC,gBAC3BG,EAAAC,EAAAC,cAACse,EAAsBiO,SAAvB,CAAgCvZ,MAAOzQ,KAAKH,MAAMoc,gBAChD1e,EAAAC,EAAAC,cAACwsB,GAAD,gBA3DM3oB,aAAZgoB,GASG/nB,aAAe,CACpB0a,eAAgB,GAChB1gB,KAAM,IAwDK+tB,8BCnIfY,EAAAC,EAAAC,EAAA,wBAAAC,KAUA9vB,OAAO4C,OAAS5C,OAAO4C,QAAU,GACjC,IAIMmtB,GAAmBztB,OAAOC,OAAO,GAJX,CAC1BM,eAAgB,IAChBwsB,6BAA8B,IAEgCrvB,OAAO4C,QACjEotB,GAAMrsB,IAAMT,cAAc6rB,GAAKgB,GAAkB,MAEvDE,KAAS7H,OAAO4H,GAAK3R,SAAS6R,eAAe","file":"static/js/main.7c8522e4.chunk.js","sourcesContent":["import dicomParser from 'dicom-parser'\nimport cornerstone from 'cornerstone-core'\nimport cornerstoneWADOImageLoader from 'cornerstone-wado-image-loader'\nimport OHIF from 'ohif-core'\nimport version from './version.js'\n\nwindow.info = {\n  version,\n  homepage: `${process.env.PUBLIC_URL}`,\n}\n\n// For debugging\nwindow.cornerstone = cornerstone\nwindow.cornerstoneWADOImageLoader = cornerstoneWADOImageLoader\n\ncornerstoneWADOImageLoader.external.cornerstone = cornerstone\ncornerstoneWADOImageLoader.external.dicomParser = dicomParser\n\nOHIF.user.getAccessToken = () => {\n  // TODO: Get the Redux store from somewhere else\n  const state = window.store.getState()\n  if (!state.oidc || !state.oidc.user) {\n    return\n  }\n\n  return state.oidc.user.access_token\n}\n\ncornerstoneWADOImageLoader.configure({\n  beforeSend: function(xhr) {\n    const headers = OHIF.DICOMWeb.getAuthorizationHeader()\n\n    if (headers.Authorization) {\n      xhr.setRequestHeader('Authorization', headers.Authorization)\n    }\n  },\n})\n","export default '0.0.20';\n","const defaultState = {\n  leftSidebarOpen: true,\n  rightSidebarOpen: false,\n  userPreferencesModalOpen: false,\n  labelling: {},\n  contextMenu: {},\n}\n\nconst ui = (state = defaultState, action) => {\n  switch (action.type) {\n    case 'SET_LEFT_SIDEBAR_OPEN':\n      return Object.assign({}, state, { leftSidebarOpen: action.state })\n    case 'SET_RIGHT_SIDEBAR_OPEN':\n      return Object.assign({}, state, { rightSidebarOpen: action.state })\n    case 'SET_USER_PREFERENCES_MODAL_OPEN':\n      return Object.assign({}, state, {\n        userPreferencesModalOpen: action.state,\n      })\n    case 'SET_LABELLING_FLOW_DATA':\n      const labelling = Object.assign({}, action.labellingFlowData)\n\n      return Object.assign({}, state, { labelling })\n    case 'SET_TOOL_CONTEXT_MENU_DATA':\n      const contextMenu = Object.assign({}, state.contextMenu)\n\n      contextMenu[action.viewportIndex] = Object.assign(\n        {},\n        action.toolContextMenuData\n      )\n\n      return Object.assign({}, state, { contextMenu })\n    case 'RESET_LABELLING_AND_CONTEXT_MENU':\n      return Object.assign({}, state, {\n        labelling: defaultState.labelling,\n        contextMenu: defaultState.contextMenu,\n      })\n    default:\n      return state\n  }\n}\n\nexport default ui\n","import React from 'react'\nimport './OHIFLogo.css'\n\nconst Icons = `${window.config.routerBasename}/icons.svg`.replace('//', '/')\n\nfunction OHIFLogo() {\n  return (\n    <a\n      target=\"_blank\"\n      rel=\"noopener noreferrer\"\n      className=\"header-brand\"\n      href=\"http://ohif.org\"\n    >\n      <svg className=\"header-logo-image\">\n        <use xlinkHref={`${Icons}#icon-ohif-logo`} />\n      </svg>\n      <div className=\"header-logo-text\">Open Health Imaging Foundation</div>\n    </a>\n  )\n}\n\nexport default OHIFLogo\n","import OHIFLogo from './components/OHIFLogo/OHIFLogo.js';\nimport React from 'react';\n\nconst defaultContextValues = {\n  logoComponent: OHIFLogo()\n};\n\nconst WhiteLabellingContext = React.createContext(defaultContextValues);\n\nexport default WhiteLabellingContext;\n","export const setLeftSidebarOpen = state => ({\n  type: 'SET_LEFT_SIDEBAR_OPEN',\n  state\n});\n\nexport const setRightSidebarOpen = state => ({\n  type: 'SET_RIGHT_SIDEBAR_OPEN',\n  state\n});\n\nexport const setUserPreferencesModalOpen = state => ({\n  type: 'SET_USER_PREFERENCES_MODAL_OPEN',\n  state\n});\n\nconst actions = {\n  setLeftSidebarOpen,\n  setRightSidebarOpen,\n  setUserPreferencesModalOpen,\n};\n\nexport default actions;\n","import { connect } from 'react-redux';\nimport { UserPreferencesModal } from 'react-viewerbase';\nimport OHIF from 'ohif-core';\nimport { setUserPreferencesModalOpen } from '../redux/actions.js';\nimport cloneDeep from 'lodash.clonedeep';\n\nconst { setUserPreferences } = OHIF.redux.actions;\n\nconst mapStateToProps = state => {\n  const contextName = window.store.getState().commandContext.context;\n  return {\n    isOpen: state.ui.userPreferencesModalOpen,\n    windowLevelData: state.preferences[contextName]\n      ? state.preferences[contextName].windowLevelData\n      : {},\n    hotKeysData: state.preferences[contextName]\n      ? state.preferences[contextName].hotKeysData\n      : {}\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    onCancel: () => {\n      dispatch(setUserPreferencesModalOpen(false));\n    },\n    onSave: data => {\n      const contextName = window.store.getState().commandContext.context;\n      const preferences = cloneDeep(window.store.getState().preferences);\n      preferences[contextName] = data;\n      dispatch(setUserPreferences(preferences));\n      dispatch(setUserPreferencesModalOpen(false));\n      OHIF.hotkeysUtil.setHotkeys(data.hotKeysData);\n    },\n    onResetToDefaults: () => {\n      dispatch(setUserPreferences());\n      dispatch(setUserPreferencesModalOpen(false));\n      OHIF.hotkeysUtil.setHotkeys();\n    }\n  };\n};\n\nconst ConnectedUserPreferencesModal = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(UserPreferencesModal);\n\nexport default ConnectedUserPreferencesModal;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { Link, withRouter } from 'react-router-dom';\nimport { Dropdown } from 'react-viewerbase';\nimport './Header.css';\nimport OHIFLogo from '../OHIFLogo/OHIFLogo.js';\nimport ConnectedUserPreferencesModal from '../../connectedComponents/ConnectedUserPreferencesModal.js';\n\nclass Header extends Component {\n  static propTypes = {\n    home: PropTypes.bool.isRequired,\n    location: PropTypes.object.isRequired,\n    openUserPreferencesModal: PropTypes.func,\n    children: PropTypes.node\n  };\n\n  static defaultProps = {\n    home: true,\n    children: OHIFLogo()\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      userPreferencesOpen: false\n    };\n\n    this.options = [\n      {\n        title: 'Preferences ',\n        icon: 'fa fa-user',\n        onClick: this.props.openUserPreferencesModal\n      },\n      {\n        title: 'About',\n        icon: 'fa fa-info',\n        link: 'http://ohif.org'\n      }\n    ];\n  }\n\n  render() {\n    return (\n      <div className={`entry-header ${this.props.home ? 'header-big' : ''}`}>\n        <div className=\"header-left-box\">\n          {this.props.location && this.props.location.studyLink && (\n            <Link\n              to={this.props.location.studyLink}\n              className=\"header-btn header-viewerLink\"\n            >\n              Back to Viewer\n            </Link>\n          )}\n\n          {this.props.children}\n\n          {!this.props.home && (\n            <Link\n              className=\"header-btn header-studyListLinkSection\"\n              to={{\n                pathname: '/',\n                state: { studyLink: this.props.location.pathname }\n              }}\n            >\n              Study list\n            </Link>\n          )}\n        </div>\n\n        <div className=\"header-menu\">\n          <span className=\"research-use\">INVESTIGATIONAL USE ONLY</span>\n          <Dropdown title=\"Options\" list={this.options} align=\"right\" />\n          <ConnectedUserPreferencesModal />\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default withRouter(Header);\n","import { connect } from 'react-redux';\nimport Header from '../components/Header/Header.js';\nimport { setUserPreferencesModalOpen } from '../redux/actions.js';\n\nconst mapStateToProps = state => {\n  return {\n    isOpen: state.ui.userPreferencesModalOpen\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    openUserPreferencesModal: () => {\n      dispatch(setUserPreferencesModalOpen(true));\n    }\n  };\n};\n\nconst ConnectedHeader = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Header);\n\nexport default ConnectedHeader;\n","import { connect } from 'react-redux';\nimport { StudyBrowser } from 'react-viewerbase';\nimport cloneDeep from 'lodash.clonedeep';\n\n// TODO\n// - Determine in which display set is active from Redux (activeViewportIndex and layout viewportData)\n// - Pass in errors and stack loading progress from Redux\nconst mapStateToProps = (state, ownProps) => {\n    // If we know that the stack loading progress details have changed,\n    // we can try to update the component state so that the thumbnail\n    // progress bar is updated\n    const stackLoadingProgressMap = state.loading.progress;\n    const studiesWithLoadingData = cloneDeep(ownProps.studies);\n\n    studiesWithLoadingData.forEach(study => {\n        study.thumbnails.forEach(data => {\n            const { displaySetInstanceUid } = data\n            const stackId = `StackProgress:${displaySetInstanceUid}`;\n            const stackProgressData = stackLoadingProgressMap[stackId];\n\n            let stackPercentComplete = 0;\n            if (stackProgressData) {\n                stackPercentComplete = stackProgressData.percentComplete;\n            }\n\n            data.stackPercentComplete = stackPercentComplete;\n        })\n    });\n\n    return {\n        studies: studiesWithLoadingData\n    };\n};\n\nconst ConnectedStudyBrowser = connect(\n    mapStateToProps,\n    null\n)(StudyBrowser);\n\nexport default ConnectedStudyBrowser;\n","import { connect } from 'react-redux';\nimport { LayoutManager } from 'react-viewerbase';\nimport OHIF from 'ohif-core';\n\nconst mapStateToProps = state => {\n  const viewportPluginIds = state.plugins.availablePlugins\n    .filter(plugin => plugin.type === OHIF.plugins.PLUGIN_TYPES.VIEWPORT)\n    .map(plugin => plugin.id);\n\n  const availablePlugins = {};\n  viewportPluginIds.forEach(id => {\n    const plugin = OHIF.plugins.availablePlugins.find(\n      plugin => plugin.id === id\n    );\n    if (plugin) {\n      availablePlugins[id] = plugin.component;\n    }\n  });\n\n  // TODO Use something like state.plugins.defaultPlugin[OHIF.plugins.PLUGIN_TYPES.VIEWPORT]\n  let defaultPlugin;\n  if (viewportPluginIds && viewportPluginIds.length) {\n    defaultPlugin = viewportPluginIds[0];\n  }\n\n  return {\n    layout: state.viewports.layout,\n    activeViewportIndex: state.viewports.activeViewportIndex,\n    availablePlugins,\n    defaultPlugin\n  };\n};\n\nconst ConnectedLayoutManager = connect(\n  mapStateToProps,\n  null\n)(LayoutManager);\n\nexport default ConnectedLayoutManager;\n","import { Component } from 'react';\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { OHIF } from 'ohif-core';\nimport ConnectedLayoutManager from './ConnectedLayoutManager.js';\nimport './ViewerMain.css';\n\nclass ViewerMain extends Component {\n  static propTypes = {\n    studies: PropTypes.array.isRequired,\n    setViewportSpecificData: PropTypes.func.isRequired,\n    clearViewportSpecificData: PropTypes.func.isRequired\n  };\n\n  constructor(props) {\n    super(props);\n    OHIF.hotkeysUtil.setup('viewer');\n\n    this.state = {\n      displaySets: []\n    }\n  }\n\n  getDisplaySets(studies) {\n    const displaySets = [];\n    studies.forEach(study => {\n      study.displaySets.forEach(dSet => {\n        if (!dSet.plugin) {\n          dSet.plugin = 'cornerstone';\n        }\n        displaySets.push(dSet);\n      });\n    });\n\n    return displaySets;\n  }\n\n  findDisplaySet(studies, studyInstanceUid, displaySetInstanceUid) {\n    const study = studies.find(study => {\n      return study.studyInstanceUid === studyInstanceUid;\n    });\n\n    if (!study) {\n      return;\n    }\n\n    return study.displaySets.find(displaySet => {\n      return displaySet.displaySetInstanceUid === displaySetInstanceUid;\n    });\n  }\n\n  componentDidMount() {\n    // Add beforeUnload event handler to check for unsaved changes\n    //window.addEventListener('beforeunload', unloadHandlers.beforeUnload);\n\n    // Get all the display sets for the viewer studies\n    const displaySets = this.getDisplaySets(this.props.studies);\n\n    this.setState({\n      displaySets\n    });\n  }\n\n  getViewportData = () => {\n    const viewportData = [];\n    const { layout, viewportSpecificData } = this.props;\n\n    for (let viewportIndex = 0; viewportIndex < layout.viewports.length; viewportIndex++) {\n      let displaySet = viewportSpecificData[viewportIndex];\n\n      // If the viewport is empty, get one available in study\n      if (!displaySet || !displaySet.displaySetInstanceUid) {\n        const { displaySets } = this.state;\n        displaySet = displaySets.find(ds => !viewportData.some(v => v.displaySetInstanceUid === ds.displaySetInstanceUid));\n      }\n\n      viewportData.push(displaySet);\n    }\n\n    return viewportData;\n  };\n\n  setViewportData = ({ viewportIndex, item }) => {\n    const displaySet = this.findDisplaySet(\n      this.props.studies,\n      item.studyInstanceUid,\n      item.displaySetInstanceUid\n    );\n\n    this.props.setViewportSpecificData(viewportIndex, displaySet);\n  };\n\n  render() {\n    return (\n      <div className=\"ViewerMain\">\n        <ConnectedLayoutManager\n          studies={this.props.studies}\n          viewportData={this.getViewportData()}\n          setViewportData={this.setViewportData}\n        />\n      </div>\n    );\n  }\n\n  componentWillUnmount() {\n    // Clear the entire viewport specific data\n    const { viewportSpecificData } = this.props;\n    Object.keys(viewportSpecificData).forEach((viewportIndex) => {\n      this.props.clearViewportSpecificData(viewportIndex);\n    });\n\n    // Remove beforeUnload event handler...\n    //window.removeEventListener('beforeunload', unloadHandlers.beforeUnload);\n    // Destroy the synchronizer used to update reference lines\n    //OHIF.viewer.updateImageSynchronizer.destroy();\n    // TODO: Instruct all plugins to clean up themselves\n    //\n    // Clear references to all stacks in the StackManager\n    //StackManager.clearStacks();\n    // @TypeSafeStudies\n    // Clears OHIF.viewer.Studies collection\n    //OHIF.viewer.Studies.removeAll();\n    // @TypeSafeStudies\n    // Clears OHIF.viewer.StudyMetadataList collection\n    //OHIF.viewer.StudyMetadataList.removeAll();\n  }\n}\n\nexport default ViewerMain;\n","import { connect } from 'react-redux';\nimport ViewerMain from './ViewerMain';\nimport OHIF from 'ohif-core';\n\nconst { setViewportSpecificData, clearViewportSpecificData } = OHIF.redux.actions;\n\nconst mapStateToProps = state => {\n    const { activeViewportIndex, layout, viewportSpecificData } = state.viewports;\n\n    return {\n        activeViewportIndex,\n        layout,\n        viewportSpecificData\n    }\n};\n\nconst mapDispatchToProps = dispatch => {\n    return {\n        setViewportSpecificData: (viewportIndex, data) => {\n            dispatch(setViewportSpecificData(viewportIndex, data));\n        },\n        clearViewportSpecificData: () => {\n            dispatch(clearViewportSpecificData());\n        }\n    };\n};\n\nconst ConnectedViewerMain = connect(\n    mapStateToProps,\n    mapDispatchToProps\n)(ViewerMain);\n\nexport default ConnectedViewerMain;\n","import OHIF from 'ohif-core'\nimport cornerstone from 'cornerstone-core'\n\nexport default function updateTableWithNewMeasurementData({\n  toolType,\n  measurementNumber,\n  location,\n  description,\n}) {\n  // Update all measurements by measurement number\n  const measurementApi = OHIF.measurements.MeasurementApi.Instance\n  const measurements = measurementApi.tools[toolType].filter(\n    m => m.measurementNumber === measurementNumber\n  )\n\n  measurements.forEach(measurement => {\n    measurement.location = location\n    measurement.description = description\n\n    measurementApi.updateMeasurement(measurement.toolType, measurement)\n  })\n\n  measurementApi.syncMeasurementsAndToolData()\n\n  // Update images in all active viewports\n  cornerstone.getEnabledElements().forEach(enabledElement => {\n    cornerstone.updateImage(enabledElement.element)\n  })\n}\n","import cornerstoneTools from 'cornerstone-tools'\nimport updateTableWithNewMeasurementData from './updateTableWithNewMeasurementData'\n\nexport default function getMeasurementLocationCallback(\n  eventData,\n  tool,\n  options\n) {\n  const { toolType } = tool\n  const { element } = eventData\n  const doneCallback = updateTableWithNewMeasurementData\n\n  const ToolInstance = cornerstoneTools.getToolForElement(element, toolType)\n\n  ToolInstance.configuration.getMeasurementLocationCallback(\n    tool,\n    eventData,\n    doneCallback,\n    options\n  )\n}\n","import { connect } from 'react-redux'\nimport { MeasurementTable } from 'react-viewerbase'\nimport OHIF from 'ohif-core'\nimport moment from 'moment'\nimport cornerstone from 'cornerstone-core'\nimport jumpToRowItem from '../lib/jumpToRowItem.js'\nimport getMeasurementLocationCallback from '../lib/getMeasurementLocationCallback'\n\nconst { setViewportSpecificData } = OHIF.redux.actions\nconst { MeasurementApi } = OHIF.measurements\n\nfunction groupBy(list, props) {\n  return list.reduce((a, b) => {\n    ;(a[b[props]] = a[b[props]] || []).push(b)\n    return a\n  }, {})\n}\n\nfunction getAllTools() {\n  const config = OHIF.measurements.MeasurementApi.getConfiguration()\n  let tools = []\n  config.measurementTools.forEach(\n    toolGroup => (tools = tools.concat(toolGroup.childTools))\n  )\n\n  return tools\n}\n\nfunction getMeasurementText(measurementData) {\n  const { location, description } = measurementData\n  let text = '...'\n  if (location) {\n    text = location\n    if (description) {\n      text += `(${description})`\n    }\n  }\n  return text\n}\n\nfunction getDataForEachMeasurementNumber(\n  measurementNumberList,\n  timepoints,\n  displayFunction\n) {\n  const data = []\n  // on each measurement number we should get each measurement data by available timepoint\n  measurementNumberList.forEach(measurement => {\n    timepoints.forEach(timepoint => {\n      const eachData = {\n        displayText: '...',\n      }\n      if (measurement.timepointId === timepoint.timepointId) {\n        eachData.displayText = displayFunction(measurement)\n      }\n      data.push(eachData)\n    })\n  })\n\n  return data\n}\n\nfunction convertMeasurementsToTableData(toolCollections, timepoints) {\n  const config = OHIF.measurements.MeasurementApi.getConfiguration()\n  const toolGroups = config.measurementTools\n  const tools = getAllTools()\n\n  const tableMeasurements = toolGroups.map(toolGroup => {\n    return {\n      groupName: toolGroup.name,\n      groupId: toolGroup.id,\n      measurements: [],\n    }\n  })\n\n  Object.keys(toolCollections).forEach(toolId => {\n    const toolMeasurements = toolCollections[toolId]\n    const tool = tools.find(tool => tool.id === toolId)\n    const { displayFunction } = tool.options.measurementTable\n\n    // Group by measurementNumber so we can display then all in the same line\n    const groupedMeasurements = groupBy(toolMeasurements, 'measurementNumber')\n\n    Object.keys(groupedMeasurements).forEach(groupedMeasurementsIndex => {\n      const measurementNumberList =\n        groupedMeasurements[groupedMeasurementsIndex]\n      const measurementData = measurementNumberList[0]\n      const {\n        measurementNumber,\n        lesionNamingNumber,\n        toolType,\n      } = measurementData\n      const measurementId = measurementData._id\n\n      //check if all measurements with same measurementNumber will have same LABEL\n      const tableMeasurement = {\n        itemNumber: lesionNamingNumber,\n        label: getMeasurementText(measurementData),\n        measurementId,\n        measurementNumber,\n        lesionNamingNumber,\n        toolType,\n        hasWarnings: false, //TODO\n        warningTitle: '', //TODO\n        isSplitLesion: false, //TODO\n        warningList: [], //TODO\n        data: getDataForEachMeasurementNumber(\n          measurementNumberList,\n          timepoints,\n          displayFunction\n        ),\n      }\n\n      // find the group object for the tool\n      const toolGroupMeasurements = tableMeasurements.find(group => {\n        return group.groupId === tool.toolGroup\n      })\n      // inject the new measurement for this measurementNumer\n      toolGroupMeasurements.measurements.push(tableMeasurement)\n    })\n  })\n\n  // Sort measurements by lesion naming number\n  tableMeasurements.forEach(tm => {\n    tm.measurements.sort((m1, m2) =>\n      m1.lesionNamingNumber > m2.lesionNamingNumber ? 1 : -1\n    )\n  })\n\n  return tableMeasurements\n}\n\nfunction convertTimepointsToTableData(timepoints) {\n  if (!timepoints || !timepoints.length) {\n    return []\n  }\n\n  return [\n    {\n      label: 'Study date:',\n      date: moment(timepoints[0].latestDate).format('DD-MMM-YY'),\n    },\n  ]\n}\n\nconst mapStateToProps = state => {\n  const { timepoints, measurements } = state.timepointManager\n  return {\n    timepoints: convertTimepointsToTableData(timepoints),\n    measurementCollection: convertMeasurementsToTableData(\n      measurements,\n      timepoints\n    ),\n    timepointManager: state.timepointManager,\n    viewports: state.viewports,\n  }\n}\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    dispatchRelabel: (event, measurementData, viewportsState) => {\n      const activeViewportIndex =\n        (viewportsState && viewportsState.activeViewportIndex) || 0\n\n      const enabledElements = cornerstone.getEnabledElements()\n      if (!enabledElements || enabledElements.length <= activeViewportIndex) {\n        OHIF.log.error('Failed to find the enabled element')\n        return\n      }\n\n      const { element } = enabledElements[activeViewportIndex]\n\n      const eventData = {\n        event: {\n          clientX: event.clientX,\n          clientY: event.clientY,\n        },\n        element,\n      }\n\n      const { toolType, measurementId } = measurementData\n      const tool = MeasurementApi.Instance.tools[toolType].find(measurement => {\n        return measurement._id === measurementId\n      })\n\n      const options = {\n        skipAddLabelButton: true,\n        editLocation: true,\n      }\n\n      // Clone the tool not to set empty location initially\n      const toolForLocation = Object.assign({}, tool, { location: null })\n      getMeasurementLocationCallback(eventData, toolForLocation, options)\n    },\n    dispatchEditDescription: (event, measurementData, viewportsState) => {\n      const activeViewportIndex =\n        (viewportsState && viewportsState.activeViewportIndex) || 0\n\n      const enabledElements = cornerstone.getEnabledElements()\n      if (!enabledElements || enabledElements.length <= activeViewportIndex) {\n        OHIF.log.error('Failed to find the enabled element')\n        return\n      }\n\n      const { element } = enabledElements[activeViewportIndex]\n\n      const eventData = {\n        event: {\n          clientX: event.clientX,\n          clientY: event.clientY,\n        },\n        element,\n      }\n\n      const { toolType, measurementId } = measurementData\n      const tool = MeasurementApi.Instance.tools[toolType].find(measurement => {\n        return measurement._id === measurementId\n      })\n\n      const options = {\n        editDescriptionOnDialog: true,\n      }\n\n      getMeasurementLocationCallback(eventData, tool, options)\n    },\n    dispatchJumpToRowItem: (\n      measurementData,\n      viewportsState,\n      timepointManagerState,\n      options\n    ) => {\n      const actionData = jumpToRowItem(\n        measurementData,\n        viewportsState,\n        timepointManagerState,\n        dispatch,\n        options\n      )\n\n      actionData.viewportSpecificData.forEach(viewportSpecificData => {\n        const { viewportIndex, displaySet } = viewportSpecificData\n\n        dispatch(setViewportSpecificData(viewportIndex, displaySet))\n      })\n\n      const { toolType, measurementNumber } = measurementData\n      const measurementApi = MeasurementApi.Instance\n\n      Object.keys(measurementApi.tools).forEach(toolType => {\n        const measurements = measurementApi.tools[toolType]\n\n        measurements.forEach(measurement => {\n          measurement.active = false\n        })\n      })\n\n      const measurementsToActive = measurementApi.tools[toolType].filter(\n        measurement => {\n          return measurement.measurementNumber === measurementNumber\n        }\n      )\n\n      measurementsToActive.forEach(measurementToActive => {\n        measurementToActive.active = true\n      })\n\n      measurementApi.syncMeasurementsAndToolData()\n\n      cornerstone.getEnabledElements().forEach(enabledElement => {\n        cornerstone.updateImage(enabledElement.element)\n      })\n\n      // Needs to update viewports.layout state to set layout\n      //const layout = actionData.layout;\n      //dispatch(setLayout(layout))\n\n      // Needs to update viewports.activeViewportIndex to the first updated viewport\n      //const viewportIndex = actionData.viewportIndex;\n      //dispatch(setViewportActive(viewportIndex));\n\n      // Needs to update timepointsManager.measurements state to set active measurementId\n      // TODO: Not yet implemented\n      //dispatch(setActiveMeasurement(measurementData.measurementId))\n\n      // (later): Needs to set some property on state.extensions.cornerstone to synchronize viewport scrolling\n    },\n  }\n}\n\nconst mergeProps = (propsFromState, propsFromDispatch, ownProps) => {\n  return {\n    timepoints: propsFromState.timepoints,\n    measurementCollection: propsFromState.measurementCollection,\n    selectedMeasurementNumber: ownProps.selectedMeasurementNumber,\n    ...propsFromDispatch,\n    onItemClick: (event, measurementData) => {\n      // TODO: Add timepointId to .data for measurementData?\n      // TODO: Tooltype should be on the level below? This should\n      // provide the entire row item?\n\n      const viewportsState = propsFromState.viewports\n      const timepointManagerState = propsFromState.timepointManager\n\n      // TODO: invertViewportTimepointsOrder should be stored in / read from user preferences\n      // TODO: childToolKey should come from the measurement table when it supports child tools\n      const options = {\n        invertViewportTimepointsOrder: false,\n        childToolKey: null,\n      }\n\n      propsFromDispatch.dispatchJumpToRowItem(\n        measurementData,\n        viewportsState,\n        timepointManagerState,\n        options\n      )\n    },\n    onRelabelClick: (event, measurementData) => {\n      const viewportsState = propsFromState.viewports\n      propsFromDispatch.dispatchRelabel(event, measurementData, viewportsState)\n    },\n    onEditDescriptionClick: (event, measurementData) => {\n      const viewportsState = propsFromState.viewports\n      propsFromDispatch.dispatchEditDescription(\n        event,\n        measurementData,\n        viewportsState\n      )\n    },\n    onDeleteClick: (event, measurementData) => {\n      const { MeasurementHandlers } = OHIF.measurements\n\n      MeasurementHandlers.onRemoved({\n        detail: {\n          toolType: measurementData.toolType,\n          measurementData: {\n            _id: measurementData.measurementId,\n            lesionNamingNumber: measurementData.lesionNamingNumber,\n            measurementNumber: measurementData.measurementNumber,\n          },\n        },\n      })\n    },\n  }\n}\n\nconst ConnectedMeasurementTable = connect(\n  mapStateToProps,\n  mapDispatchToProps,\n  mergeProps\n)(MeasurementTable)\n\nexport default ConnectedMeasurementTable\n","import { OHIF } from 'ohif-core'\n\n// TODO: Move this function to OHIF itself so we can use it on the OHIF measurment table (when it is finished)\n\n/**\n * Activates a set of measurements\n *\n * @param measurementData\n * @param viewportsState\n * @param timepointManagerState\n * @param options\n */\nexport default function jumpToRowItem(\n  measurementData,\n  viewportsState,\n  timepointManagerState,\n  options = { invertViewportTimepointsOrder: false, childToolKey: null }\n) {\n  const numViewports = viewportsState.layout.viewports.length\n  const numTimepoints = timepointManagerState.timepoints.length\n  const { measurements, timepoints } = timepointManagerState\n  const numViewportsToUpdate = Math.min(numTimepoints, numViewports)\n  const { toolType, measurementNumber } = measurementData\n\n  if (options.invertViewportTimepointsOrder) {\n    timepoints.reverse()\n  }\n\n  const measurementsForToolGroup = measurements[toolType]\n\n  // Retrieve the measurements data\n  const measurementsToJumpTo = []\n  for (let i = 0; i < numViewportsToUpdate; i++) {\n    const { timepointId } = timepoints[i]\n\n    const dataAtThisTimepoint = measurementsForToolGroup.find(entry => {\n      return (\n        entry.timepointId === timepointId &&\n        entry.measurementNumber === measurementNumber\n      )\n    })\n\n    if (!dataAtThisTimepoint) {\n      measurementsToJumpTo.push(null)\n      continue\n    }\n\n    let measurement = dataAtThisTimepoint\n\n    const { tool } = OHIF.measurements.MeasurementApi.getToolConfiguration(\n      toolType\n    )\n    if (options.childToolKey) {\n      measurement = dataAtThisTimepoint[options.childToolKey]\n    } else if (Array.isArray(tool.childTools)) {\n      const key = tool.childTools.find(key => !!dataAtThisTimepoint[key])\n      measurement = dataAtThisTimepoint[key]\n    }\n\n    measurementsToJumpTo.push(measurement)\n  }\n\n  // TODO: Add a single viewports state action which allows\n  // - viewportData to be set\n  // - layout to be set\n  // - activeViewport to be set\n\n  // Needs to update viewports.viewportData state to set image set data\n\n  const displaySetContainsSopInstance = (displaySet, sopInstanceUid) =>\n    displaySet.images.find(\n      image => image.getSOPInstanceUID() === sopInstanceUid\n    )\n\n  const viewportSpecificData = []\n  measurementsToJumpTo.forEach((data, viewportIndex) => {\n    // Skip if there is no measurement to jump\n    if (!data) {\n      return\n    }\n\n    const study = OHIF.utils.studyMetadataManager.get(data.studyInstanceUid)\n    if (!study) {\n      throw new Error('Study not found.')\n    }\n\n    const displaySet = study.findDisplaySet(displaySet => {\n      return displaySetContainsSopInstance(displaySet, data.sopInstanceUid)\n    })\n\n    if (!displaySet) {\n      throw new Error('Display set not found.')\n    }\n\n    displaySet.sopInstanceUid = data.sopInstanceUid\n    if (data.frameIndex) {\n      displaySet.frameIndex = data.frameIndex\n    }\n\n    viewportSpecificData.push({\n      viewportIndex,\n      displaySet,\n    })\n  })\n\n  return {\n    viewportSpecificData,\n    layout: [], // TODO: if we need to change layout, we should return this here\n  }\n}\n","import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport ConnectedStudyBrowser from './ConnectedStudyBrowser.js'\nimport ConnectedViewerMain from './ConnectedViewerMain.js'\nimport ConnectedMeasurementTable from './ConnectedMeasurementTable'\nimport './FlexboxLayout.css'\n\nclass FlexboxLayout extends Component {\n  static propTypes = {\n    studies: PropTypes.array.isRequired,\n    leftSidebarOpen: PropTypes.bool.isRequired,\n    rightSidebarOpen: PropTypes.bool.isRequired,\n  }\n\n  state = {\n    studiesForBrowser: [],\n  }\n\n  componentDidMount() {\n    const studiesForBrowser = this.getStudiesForBrowser()\n\n    this.setState({\n      studiesForBrowser,\n    })\n  }\n\n  getStudiesForBrowser = () => {\n    const { studies } = this.props\n\n    // TODO[react]:\n    // - Add sorting of display sets\n    // - Add useMiddleSeriesInstanceAsThumbnail\n    // - Add showStackLoadingProgressBar option\n    return studies.map(study => {\n      const { studyInstanceUid } = study\n\n      const thumbnails = study.displaySets.map(displaySet => {\n        const {\n          displaySetInstanceUid,\n          seriesDescription,\n          seriesNumber,\n          instanceNumber,\n          numImageFrames,\n        } = displaySet\n\n        let imageId\n\n        if (displaySet.images && displaySet.images.length) {\n          imageId = displaySet.images[0].getImageId()\n        }\n\n        return {\n          imageId,\n          displaySetInstanceUid,\n          seriesDescription,\n          seriesNumber,\n          instanceNumber,\n          numImageFrames,\n        }\n      })\n\n      return {\n        studyInstanceUid,\n        thumbnails,\n      }\n    })\n  }\n\n  render() {\n    let mainContentClassName = 'main-content'\n    if (this.props.leftSidebarOpen) {\n      mainContentClassName += ' sidebar-left-open'\n    }\n\n    if (this.props.rightSidebarOpen) {\n      mainContentClassName += ' sidebar-right-open'\n    }\n\n    // TODO[react]: Make ConnectedMeasurementTable extension with state.timepointManager\n    return (\n      <div className=\"FlexboxLayout\">\n        <div\n          className={\n            this.props.leftSidebarOpen\n              ? 'sidebar-menu sidebar-left sidebar-open'\n              : 'sidebar-menu sidebar-left'\n          }\n        >\n          <ConnectedStudyBrowser studies={this.state.studiesForBrowser} />\n        </div>\n        <div className={mainContentClassName}>\n          <ConnectedViewerMain studies={this.props.studies} />\n        </div>\n        <div\n          className={\n            this.props.rightSidebarOpen\n              ? 'sidebar-menu sidebar-right sidebar-open'\n              : 'sidebar-menu sidebar-right'\n          }\n        >\n          <ConnectedMeasurementTable />\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default FlexboxLayout\n","import { connect } from 'react-redux';\nimport FlexboxLayout from './FlexboxLayout';\n\nconst mapStateToProps = state => {\n    return {\n        leftSidebarOpen: state.ui.leftSidebarOpen,\n        rightSidebarOpen: state.ui.rightSidebarOpen,\n    };\n};\n\nconst ConnectedFlexboxLayout = connect(\n    mapStateToProps,\n    null\n)(FlexboxLayout);\n\nexport default ConnectedFlexboxLayout;\n","import { connect } from 'react-redux';\nimport { LayoutButton } from 'react-viewerbase';\nimport OHIF from 'ohif-core'\n\nconst { setLayout } = OHIF.redux.actions;\n\nconst mapStateToProps = state => {\n    return {\n        currentLayout: state.viewports.layout,\n    };\n};\n\nconst mapDispatchToProps = dispatch => {\n    return {\n        // TODO: Change if layout switched becomes more complex\n        onChange: selectedCell => {\n            let viewports = [];\n            const rows = selectedCell.row + 1;\n            const columns = selectedCell.col + 1;\n            const numViewports = rows * columns;\n            for (let i = 0; i < numViewports; i++) {\n                viewports.push({\n                    height: `${100 / rows}%`,\n                    width: `${100 / columns}%`\n                });\n            }\n            const layout = {\n                viewports\n            };\n\n            dispatch(setLayout(layout))\n        }\n    };\n};\n\nconst ConnectedLayoutButton = connect(\n    mapStateToProps,\n    mapDispatchToProps\n)(LayoutButton);\n\nexport default ConnectedLayoutButton;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { ExpandableToolMenu } from 'react-viewerbase';\nimport './PluginSwitch.css';\n\nclass PluginSwitch extends Component {\n  static propTypes = {\n    buttons: PropTypes.array\n  };\n\n  static defaultProps = {};\n\n  render() {\n    return (\n      <div className=\"PluginSwitch\">\n        <ExpandableToolMenu buttons={this.props.buttons} />\n      </div>\n    );\n  }\n}\n\nexport default PluginSwitch;\n","import { connect } from 'react-redux'\nimport PluginSwitch from './PluginSwitch.js'\nimport OHIF from 'ohif-core'\n\nconst { setLayout } = OHIF.redux.actions\n\nconst mapStateToProps = state => {\n  const { activeViewportIndex, layout } = state.viewports\n\n  return {\n    activeViewportIndex,\n    layout,\n  }\n}\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    setLayout: data => {\n      dispatch(setLayout(data))\n    },\n  }\n}\n\nfunction setSingleLayoutData(originalArray, viewportIndex, data) {\n  const viewports = originalArray.slice()\n  const layoutData = Object.assign({}, viewports[viewportIndex], data)\n\n  viewports[viewportIndex] = layoutData\n\n  return viewports\n}\n\nconst mergeProps = (propsFromState, propsFromDispatch, ownProps) => {\n  const { activeViewportIndex, layout } = propsFromState\n  const { setLayout } = propsFromDispatch\n\n  // TODO: Do not display certain options if the current display set\n  // cannot be displayed using these view types\n  const Icons = `${window.config.routerBasename}/icons.svg`.replace('//', '/')\n  const buttons = [\n    {\n      text: 'Acquired',\n      type: 'command',\n      iconClasses: 'fa fa-bars',\n      active: false,\n      onClick: click => {\n        console.warn('Original Acquisition')\n\n        const layoutData = setSingleLayoutData(\n          layout.viewports,\n          activeViewportIndex,\n          { plugin: 'cornerstone' }\n        )\n\n        setLayout({ viewports: layoutData })\n      },\n    },\n    {\n      text: 'Axial',\n      svgUrl: `${Icons}#cube`,\n      svgClasses: 'icon-rotate-120',\n      active: false,\n      onClick: click => {\n        console.warn('Axial')\n        const data = {\n          plugin: 'vtk',\n          vtk: {\n            mode: 'mpr',\n            sliceNormal: [0, 0, 1],\n          },\n        }\n\n        const layoutData = setSingleLayoutData(\n          layout.viewports,\n          activeViewportIndex,\n          data\n        )\n\n        setLayout({ viewports: layoutData })\n      },\n    },\n    {\n      text: 'Sagittal',\n      svgUrl: `${Icons}#cube`,\n      active: false,\n      onClick: click => {\n        console.warn('Sagittal')\n        const data = {\n          plugin: 'vtk',\n          vtk: {\n            mode: 'mpr',\n            sliceNormal: [1, 0, 0],\n          },\n        }\n\n        const layoutData = setSingleLayoutData(\n          layout.viewports,\n          activeViewportIndex,\n          data\n        )\n\n        setLayout({ viewports: layoutData })\n      },\n    },\n    {\n      text: 'Coronal',\n      svgUrl: `${Icons}#cube`,\n      svgClasses: 'fa-rotate-90 fa-flip-horizontal',\n      active: false,\n      onClick: click => {\n        console.warn('Coronal')\n        const data = {\n          plugin: 'vtk',\n          vtk: {\n            mode: 'mpr',\n            sliceNormal: [0, 1, 0],\n          },\n        }\n\n        const layoutData = setSingleLayoutData(\n          layout.viewports,\n          activeViewportIndex,\n          data\n        )\n\n        setLayout({ viewports: layoutData })\n      },\n    },\n    /*{\n      text: '3D',\n      svgUrl: `${Icons}#cube`,\n      onClick: (click) => {\n        console.warn('3D Perspective');\n        const data = {\n          plugin: 'vtk',\n          vtk: {\n            mode: '3d',\n          }\n        };\n\n        const layoutData = setSingleLayoutData(layout.viewports, activeViewportIndex, data);\n\n        setLayout({ viewports: layoutData });\n      }\n    }*/\n  ]\n\n  return {\n    buttons,\n  }\n}\n\nconst ConnectedPluginSwitch = connect(\n  mapStateToProps,\n  mapDispatchToProps,\n  mergeProps\n)(PluginSwitch)\n\nexport default ConnectedPluginSwitch\n","import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport OHIF from 'ohif-core'\nimport { RoundedButtonGroup } from 'react-viewerbase'\nimport ConnectedLayoutButton from './ConnectedLayoutButton'\nimport ConnectedPluginSwitch from './ConnectedPluginSwitch.js'\nimport './ToolbarRow.css'\n\nconst Icons = `${window.config.routerBasename}/icons.svg`.replace('//', '/')\n\nclass ToolbarRow extends Component {\n  static propTypes = {\n    leftSidebarOpen: PropTypes.bool.isRequired,\n    rightSidebarOpen: PropTypes.bool.isRequired,\n    setLeftSidebarOpen: PropTypes.func,\n    setRightSidebarOpen: PropTypes.func,\n    pluginId: PropTypes.string,\n  }\n\n  static defaultProps = {\n    leftSidebarOpen: false,\n    rightSidebarOpen: false,\n  }\n\n  onLeftSidebarValueChanged = value => {\n    this.props.setLeftSidebarOpen(!!value)\n  }\n\n  onRightSidebarValueChanged = value => {\n    this.props.setRightSidebarOpen(!!value)\n  }\n\n  render() {\n    const leftSidebarToggle = [\n      {\n        value: 'studies',\n        svgLink: `${Icons}#icon-studies`,\n        svgWidth: 15,\n        svgHeight: 13,\n        bottomLabel: 'Series',\n      },\n    ]\n\n    const rightSidebarToggle = [\n      {\n        value: 'measurements',\n        svgLink: `${Icons}#icon-measurements-lesions`,\n        svgWidth: 15,\n        svgHeight: 13,\n        bottomLabel: 'Measurements',\n      },\n    ]\n\n    const leftSidebarValue = this.props.leftSidebarOpen\n      ? leftSidebarToggle[0].value\n      : null\n\n    const rightSidebarValue = this.props.rightSidebarOpen\n      ? rightSidebarToggle[0].value\n      : null\n\n    const currentPluginId = this.props.pluginId\n\n    const { PLUGIN_TYPES, availablePlugins } = OHIF.plugins\n    const plugin = availablePlugins.find(entry => {\n      return entry.type === PLUGIN_TYPES.TOOLBAR && entry.id === currentPluginId\n    })\n\n    let pluginComp\n    if (plugin) {\n      const PluginComponent = plugin.component\n\n      pluginComp = <PluginComponent />\n    }\n\n    return (\n      <div className=\"ToolbarRow\">\n        <div className=\"pull-left m-t-1 p-y-1\" style={{ padding: '10px' }}>\n          <RoundedButtonGroup\n            options={leftSidebarToggle}\n            value={leftSidebarValue}\n            onValueChanged={this.onLeftSidebarValueChanged}\n          />\n        </div>\n        {pluginComp}\n        <ConnectedLayoutButton />\n        <ConnectedPluginSwitch />\n        <div className=\"pull-right m-t-1 rm-x-1\" style={{ marginLeft: 'auto' }}>\n          <RoundedButtonGroup\n            options={rightSidebarToggle}\n            value={rightSidebarValue}\n            onValueChanged={this.onRightSidebarValueChanged}\n          />\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default ToolbarRow\n","import { connect } from 'react-redux';\nimport ToolbarRow from './ToolbarRow';\nimport { setLeftSidebarOpen, setRightSidebarOpen } from '../redux/actions.js';\n\nconst defaultPlugin = 'cornerstone';\n\nconst mapStateToProps = state => {\n    const { layout, viewportSpecificData, activeViewportIndex } = state.viewports;\n    const pluginInLayout = layout.viewports[activeViewportIndex] && layout.viewports[activeViewportIndex].plugin;\n    const pluginInViewportData = viewportSpecificData[activeViewportIndex] && viewportSpecificData[activeViewportIndex].plugin;\n    const pluginInActiveViewport = pluginInLayout || pluginInViewportData || defaultPlugin;\n    //     const extensionData = state.extensions[pluginInActiveViewport];\n\n    return {\n        pluginId: pluginInActiveViewport,\n        leftSidebarOpen: state.ui.leftSidebarOpen,\n        rightSidebarOpen: state.ui.rightSidebarOpen\n    };\n};\n\n\nconst mapDispatchToProps = dispatch => {\n    return {\n        setLeftSidebarOpen: state => {\n            dispatch(setLeftSidebarOpen(state))\n        },\n        setRightSidebarOpen: state => {\n            dispatch(setRightSidebarOpen(state))\n        }\n    };\n};\n\nconst ConnectedToolbarRow = connect(\n    mapStateToProps,\n    mapDispatchToProps\n)(ToolbarRow);\n\nexport default ConnectedToolbarRow;\n","import { Component } from 'react'\nimport React from 'react'\nimport PropTypes from 'prop-types'\n\nimport './SimpleDialog.css'\n\nclass SimpleDialog extends Component {\n  static defaultProps = {\n    componentStyle: {},\n    rootClass: '',\n  }\n\n  render() {\n    return (\n      <div\n        className={`simpleDialog ${this.props.rootClass}`}\n        ref={this.props.componentRef}\n        style={this.props.componentStyle}\n      >\n        <form>\n          <div className=\"header\">\n            <span className=\"closeBtn\" onClick={this.props.onClose}>\n              <span className=\"closeIcon\">x</span>\n            </span>\n            <h4 className=\"title\">{this.props.headerTitle}</h4>\n          </div>\n          <div className=\"content\">{this.props.children}</div>\n          <div className=\"footer\">\n            <button\n              type=\"button\"\n              className=\"btn btn-cancel\"\n              onClick={this.props.onClose}\n            >\n              Cancel\n            </button>\n            <button\n              type=\"button\"\n              className=\"btn btn-confirm\"\n              onClick={this.props.onConfirm}\n            >\n              Confirm\n            </button>\n          </div>\n        </form>\n      </div>\n    )\n  }\n}\n\nSimpleDialog.propTypes = {\n  headerTitle: PropTypes.string.isRequired,\n  onClose: PropTypes.func.isRequired,\n  onConfirm: PropTypes.func.isRequired,\n}\n\nexport default SimpleDialog\n","export default function bounding(elementRef, currentPosition = {}) {\n  if (!elementRef.current) {\n    return\n  }\n\n  const currentElement = elementRef.current\n  const {\n    offsetParent,\n    offsetTop,\n    offsetHeight,\n    offsetLeft,\n    offsetWidth,\n  } = currentElement\n  let top = currentPosition.top || offsetTop\n  let left = currentPosition.left || offsetLeft\n\n  if (!offsetParent) {\n    return\n  }\n\n  let maxHeight = `${offsetParent.offsetHeight}px`\n\n  if (offsetHeight + top > offsetParent.offsetHeight) {\n    top = top - (offsetHeight + top - offsetParent.offsetHeight)\n    if (top < 0) {\n      top = 0\n    }\n  }\n\n  if (left + offsetWidth > offsetParent.offsetWidth) {\n    left = offsetParent.offsetWidth - offsetWidth\n    if (left < 0) {\n      left = 0\n    }\n  }\n\n  if (maxHeight && currentElement.style.maxHeight !== maxHeight) {\n    currentElement.style.maxHeight = maxHeight\n  }\n  if (currentElement.style.top !== `${top}px`) {\n    currentElement.style.top = `${top}px`\n  }\n  if (currentElement.style.left !== `${left}px`) {\n    currentElement.style.left = `${left}px`\n  }\n}\n","import cornerstone from 'cornerstone-core'\n\nconst buttonSize = {\n  width: 96,\n  height: 28,\n}\n\nexport function getAddLabelButtonStyle(measurementData, eventData) {\n  const { start, end } = measurementData.handles\n  const { client } = eventData.currentPoints\n  const clientStart = cornerstone.pixelToCanvas(eventData.element, start)\n  const clientEnd = cornerstone.pixelToCanvas(eventData.element, end)\n  const canvasOffSetLeft = client.x - clientStart.x\n  const canvasOffSetTop = client.y - clientStart.y\n  const position = {\n    left: clientEnd.x + canvasOffSetLeft,\n    top: clientEnd.y + canvasOffSetTop,\n  }\n\n  if (start.y > end.y) {\n    position.top -= buttonSize.height\n  }\n  if (start.x > end.x) {\n    position.left -= buttonSize.width\n  }\n\n  return position\n}\n\nexport function getDialogStyle(componentStyle) {\n  const style = Object.assign({}, componentStyle)\n  const dialogProps = {\n    width: 320,\n    height: 230,\n  }\n\n  // Get max values to avoid position out of the screen\n  const maxLeft = window.innerWidth - dialogProps.width\n  const maxTop = window.innerHeight - dialogProps.height\n\n  // Positioning the dialog with its center on the click event\n  style.left -= dialogProps.width / 2\n  style.top -= dialogProps.height / 2\n\n  if (style.left > maxLeft) {\n    style.left = maxLeft\n  }\n  if (style.top > maxTop) {\n    style.top = maxTop\n  }\n\n  return style\n}\n","import { Component } from 'react'\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport SimpleDialog from '../SimpleDialog/SimpleDialog.js'\n\nimport bounding from '../../lib/utils/bounding.js'\nimport { getDialogStyle } from './../Labelling/labellingPositionUtils.js'\n\nimport './EditDescriptionDialog.css'\n\nexport default class EditDescriptionDialog extends Component {\n  static defaultProps = {\n    componentRef: React.createRef(),\n    componentStyle: {},\n  }\n\n  static propTypes = {\n    measurementData: PropTypes.object.isRequired,\n    onCancel: PropTypes.func.isRequired,\n    componentRef: PropTypes.object,\n    componentStyle: PropTypes.object,\n    onUpdate: PropTypes.func.isRequired,\n  }\n\n  constructor(props) {\n    super(props)\n\n    this.state = {\n      description: props.measurementData.description || '',\n    }\n\n    this.mainElement = React.createRef()\n  }\n\n  componentDidMount = () => {\n    bounding(this.mainElement)\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.description !== prevProps.description) {\n      this.setState({\n        description: this.props.description,\n      })\n    }\n  }\n\n  render() {\n    const style = getDialogStyle(this.props.componentStyle)\n\n    return (\n      <SimpleDialog\n        headerTitle=\"Edit Description\"\n        onClose={this.onClose}\n        onConfirm={this.onConfirm}\n        rootClass=\"editDescriptionDialog\"\n        componentRef={this.mainElement}\n        componentStyle={style}\n      >\n        <input\n          value={this.state.description}\n          className=\"simpleDialogInput\"\n          id=\"description\"\n          autoComplete=\"off\"\n          autoFocus\n          onChange={this.handleChange}\n        />\n      </SimpleDialog>\n    )\n  }\n\n  onClose = () => {\n    this.props.onCancel()\n  }\n\n  onConfirm = () => {\n    this.props.onUpdate(this.state.description)\n  }\n\n  handleChange = event => {\n    this.setState({ description: event.target.value })\n  }\n}\n","import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport { CSSTransition } from 'react-transition-group'\n\nimport './LabellingTransition.css'\n\n// If these variables changes, CSS must be updated\nconst transitionDuration = 500\nconst transitionClassName = 'labelling'\nconst transitionOnAppear = true\n\nexport default class LabellingTransition extends Component {\n  static propTypes = {\n    children: PropTypes.node.isRequired,\n    displayComponent: PropTypes.bool.isRequired,\n    onTransitionExit: PropTypes.func.isRequired,\n  }\n  render() {\n    return (\n      <CSSTransition\n        in={this.props.displayComponent}\n        appear={transitionOnAppear}\n        timeout={transitionDuration}\n        classNames={transitionClassName}\n        onExited={this.props.onTransitionExit}\n      >\n        {this.props.children}\n      </CSSTransition>\n    )\n  }\n}\n","const items = [\n  'Abdomen/Chest Wall',\n  'Adrenal',\n  'Bladder',\n  'Bone',\n  'Brain',\n  'Breast',\n  'Colon',\n  'Esophagus',\n  'Extremities',\n  'Gallbladder',\n  'Kidney',\n  'Liver',\n  'Lung',\n  'Lymph Node',\n  'Mediastinum/Hilum',\n  'Muscle',\n  'Neck',\n  'Other Soft Tissue',\n  'Ovary',\n  'Pancreas',\n  'Pelvis',\n  'Peritoneum/Omentum',\n  'Prostate',\n  'Retroperitoneum',\n  'Small Bowel',\n  'Spleen',\n  'Stomach',\n  'Subcutaneous',\n]\n\nconst OHIFLabellingData = items.map(item => {\n  return {\n    label: item,\n    value: item,\n  }\n})\n\nexport default OHIFLabellingData\n","import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\n\nimport cloneDeep from 'lodash.clonedeep'\nimport bounding from '../../lib/utils/bounding.js'\n\nimport LabellingTransition from './LabellingTransition.js'\nimport { SelectTree } from 'react-viewerbase'\nimport { getAddLabelButtonStyle } from './labellingPositionUtils.js'\n\nimport OHIFLabellingData from './OHIFLabellingData.js'\n\nexport default class LabellingFlow extends Component {\n  static propTypes = {\n    eventData: PropTypes.object.isRequired,\n    measurementData: PropTypes.object.isRequired,\n\n    labellingDoneCallback: PropTypes.func.isRequired,\n    updateLabelling: PropTypes.func.isRequired,\n\n    skipAddLabelButton: PropTypes.bool,\n    editLocation: PropTypes.bool,\n    editDescription: PropTypes.bool,\n  }\n\n  constructor(props) {\n    super(props)\n\n    const { location, locationLabel, description } = props.measurementData\n\n    let style = props.componentStyle\n    if (!props.skipAddLabelButton) {\n      style = getAddLabelButtonStyle(props.measurementData, props.eventData)\n    }\n\n    this.state = {\n      location,\n      locationLabel,\n      description,\n      skipAddLabelButton: props.skipAddLabelButton,\n      editDescription: props.editDescription,\n      editLocation: props.editLocation,\n      componentStyle: style,\n      confirmationState: false,\n      displayComponent: true,\n    }\n\n    this.mainElement = React.createRef()\n    this.descriptionInput = React.createRef()\n\n    this.initialItems = OHIFLabellingData\n    this.currentItems = cloneDeep(this.initialItems)\n  }\n\n  componentDidUpdate = () => {\n    this.repositionComponent()\n  }\n\n  render() {\n    let mainElementClassName = 'labellingComponent'\n    if (this.state.editDescription) {\n      mainElementClassName += ' editDescription'\n    }\n\n    const style = Object.assign({}, this.state.componentStyle)\n    if (this.state.skipAddLabelButton) {\n      style.left -= 160\n    }\n\n    return (\n      <LabellingTransition\n        displayComponent={this.state.displayComponent}\n        onTransitionExit={this.props.labellingDoneCallback}\n      >\n        <div\n          className={mainElementClassName}\n          style={style}\n          ref={this.mainElement}\n          onMouseLeave={this.fadeOutAndLeave}\n          onMouseEnter={this.clearFadeOutTimer}\n        >\n          {this.labellingStateFragment()}\n        </div>\n      </LabellingTransition>\n    )\n  }\n\n  labellingStateFragment = () => {\n    const {\n      skipAddLabelButton,\n      editLocation,\n      description,\n      locationLabel,\n    } = this.state\n\n    const Icons = `${window.config.routerBasename}/icons.svg`.replace('//', '/')\n\n    if (!skipAddLabelButton) {\n      return (\n        <>\n          <button\n            type=\"button\"\n            className=\"addLabelButton\"\n            onClick={this.showLabelling}\n          >\n            {this.state.location ? 'Edit' : 'Add'} Label\n          </button>\n        </>\n      )\n    } else {\n      if (editLocation) {\n        return (\n          <SelectTree\n            items={this.currentItems}\n            columns={1}\n            onSelected={this.selectTreeSelectCalback}\n            selectTreeFirstTitle=\"Assign Label\"\n            onComponentChange={this.repositionComponent}\n          />\n        )\n      } else {\n        return (\n          <>\n            <div\n              className=\"checkIconWrapper\"\n              onClick={this.fadeOutAndLeaveFast}\n            >\n              <svg className=\"checkIcon\">\n                <use xlinkHref={`${Icons}#check-solid`} />\n              </svg>\n            </div>\n            <div className=\"locationDescriptionWrapper\">\n              <div className=\"location\">{locationLabel}</div>\n              <div className=\"description\">\n                <input\n                  id=\"descriptionInput\"\n                  ref={this.descriptionInput}\n                  defaultValue={description || ''}\n                  autoComplete=\"off\"\n                />\n              </div>\n            </div>\n            <div className=\"commonButtons\">\n              <button\n                type=\"button\"\n                className=\"commonButton left\"\n                onClick={this.relabel}\n              >\n                Relabel\n              </button>\n              <button\n                type=\"button\"\n                className=\"commonButton right\"\n                onClick={this.setDescriptionUpdateMode}\n              >\n                {description ? 'Edit ' : 'Add '}\n                Description\n              </button>\n            </div>\n            <div className=\"editDescriptionButtons\">\n              <button\n                type=\"button\"\n                className=\"commonButton left\"\n                onClick={this.descriptionCancel}\n              >\n                Cancel\n              </button>\n              <button\n                type=\"button\"\n                className=\"commonButton right\"\n                onClick={this.descriptionSave}\n              >\n                Save\n              </button>\n            </div>\n          </>\n        )\n      }\n    }\n  }\n\n  relabel = () => {\n    this.setState({\n      editLocation: true,\n    })\n  }\n\n  setDescriptionUpdateMode = () => {\n    this.descriptionInput.current.focus()\n\n    this.setState({\n      editDescription: true,\n    })\n  }\n\n  descriptionCancel = () => {\n    const { description = '' } = cloneDeep(this.state)\n    this.descriptionInput.current.value = description\n\n    this.setState({\n      editDescription: false,\n    })\n  }\n\n  descriptionSave = () => {\n    const description = this.descriptionInput.current.value\n    this.props.updateLabelling({ description })\n\n    this.setState({\n      description,\n      editDescription: false,\n    })\n  }\n\n  selectTreeSelectCalback = (event, itemSelected) => {\n    const location = itemSelected.value\n    this.props.updateLabelling({ location })\n\n    const viewportTopPosition = this.mainElement.current.offsetParent.offsetTop\n    const componentStyle = {\n      top: event.nativeEvent.y - viewportTopPosition - 25,\n      left: this.state.componentStyle.left,\n    }\n\n    this.setState({\n      editLocation: false,\n      confirmationState: true,\n      location: itemSelected.value,\n      locationLabel: itemSelected.label,\n      componentStyle,\n    })\n\n    if (this.isTouchScreen) {\n      this.setTimeout = setTimeout(() => {\n        this.setState({\n          displayComponent: false,\n        })\n      }, 2000)\n    }\n  }\n\n  showLabelling = () => {\n    this.setState({\n      skipAddLabelButton: true,\n      editLocation: false,\n    })\n  }\n\n  fadeOutAndLeave = () => {\n    // Wait for 1 sec to dismiss the labelling component\n    this.fadeOutTimer = setTimeout(() => {\n      this.setState({\n        displayComponent: false,\n      })\n    }, 1000)\n  }\n\n  fadeOutAndLeaveFast = () => {\n    this.setState({\n      displayComponent: false,\n    })\n  }\n\n  clearFadeOutTimer = () => {\n    if (!this.fadeOutTimer) {\n      return\n    }\n\n    clearTimeout(this.fadeOutTimer)\n  }\n\n  repositionComponent = () => {\n    // SetTimeout for the css animation to end.\n    setTimeout(() => {\n      bounding(this.mainElement)\n    }, 200)\n  }\n}\n","import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\n\nimport cloneDeep from 'lodash.clonedeep'\n\nimport EditDescriptionDialog from './../EditDescriptionDialog/EditDescriptionDialog.js'\nimport LabellingFlow from './LabellingFlow.js'\n\nimport './LabellingManager.css'\n\nexport default class LabellingManager extends Component {\n  static propTypes = {\n    eventData: PropTypes.object.isRequired,\n    measurementData: PropTypes.object.isRequired,\n\n    labellingDoneCallback: PropTypes.func.isRequired,\n    updateLabelling: PropTypes.func.isRequired,\n\n    skipAddLabelButton: PropTypes.bool,\n    editLocation: PropTypes.bool,\n    editDescription: PropTypes.bool,\n    editDescriptionOnDialog: PropTypes.bool,\n  }\n\n  static defaultProps = {\n    skipAddLabelButton: false,\n    editLocation: false,\n    editDescription: false,\n    editDescriptionOnDialog: false,\n  }\n\n  constructor(props) {\n    super(props)\n\n    const measurementData = cloneDeep(props.measurementData)\n    this.treatMeasurementData(measurementData)\n\n    let editLocation = props.editLocation\n    if (!props.editDescription && !props.editLocation) {\n      editLocation = true\n    }\n\n    this.state = {\n      componentStyle: getComponentPosition(props.eventData),\n      skipAddLabelButton: props.skipAddLabelButton,\n      editLocation: editLocation,\n      editDescription: props.editDescription,\n      editDescriptionOnDialog: props.editDescriptionOnDialog,\n      measurementData: measurementData,\n    }\n  }\n\n  componentDidMount = () => {\n    document.addEventListener('touchstart', this.onTouchStart)\n  }\n\n  componentWillUnmount = () => {\n    document.removeEventListener('touchstart', this.onTouchStart)\n  }\n\n  render() {\n    return this.getRenderComponent()\n  }\n\n  getRenderComponent = () => {\n    const {\n      editLocation,\n      editDescription,\n      editDescriptionOnDialog,\n      measurementData,\n    } = this.state\n\n    if (editDescriptionOnDialog) {\n      return (\n        <EditDescriptionDialog\n          onCancel={this.props.labellingDoneCallback}\n          onUpdate={this.descriptionDialogUpdate}\n          componentRef={this.editDescriptionDialog}\n          componentStyle={this.state.componentStyle}\n          measurementData={measurementData}\n        />\n      )\n    }\n\n    if (editLocation || editDescription) {\n      return (\n        <LabellingFlow\n          {...this.props}\n          componentStyle={this.state.componentStyle}\n        />\n      )\n    }\n  }\n\n  treatMeasurementData = measurementData => {\n    const { editDescription, editLocation } = this.props\n\n    if (editDescription) {\n      measurementData.description = undefined\n    }\n    if (editLocation) {\n      measurementData.location = undefined\n    }\n  }\n\n  responseDialogUpdate = response => {\n    this.props.updateLabelling({\n      response,\n    })\n    this.props.labellingDoneCallback()\n  }\n\n  descriptionDialogUpdate = description => {\n    this.props.updateLabelling({\n      description,\n    })\n    this.props.labellingDoneCallback()\n  }\n}\n\nfunction getComponentPosition(eventData) {\n  const {\n    event: { clientX: left, clientY: top },\n  } = eventData\n\n  return {\n    left,\n    top,\n  }\n}\n","import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport LabellingManager from '../components/Labelling/LabellingManager'\n\nclass LabellingOverlay extends Component {\n  static propTypes = {\n    visible: PropTypes.bool.isRequired,\n  }\n\n  static defaultProps = {\n    visible: false,\n  }\n\n  render() {\n    if (!this.props.visible) {\n      return null\n    }\n\n    return <LabellingManager {...this.props} />\n  }\n}\n\nexport default LabellingOverlay\n","import { connect } from 'react-redux'\nimport LabellingOverlay from './LabellingOverlay'\n\nconst mapStateToProps = state => {\n  if (!state.ui || !state.ui.labelling) {\n    return {\n      visible: false,\n    }\n  }\n\n  const labellingFlowData = state.ui.labelling\n\n  return {\n    visible: false,\n    ...labellingFlowData,\n  }\n}\n\nconst ConnectedLabellingOverlay = connect(\n  mapStateToProps,\n  null\n)(LabellingOverlay)\n\nexport default ConnectedLabellingOverlay\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n//import OHIF from 'ohif-core';\n//import { CineDialog } from 'react-viewerbase';\n\nimport OHIF from 'ohif-core';\nimport moment from 'moment';\nimport WhiteLabellingContext from '../WhiteLabellingContext.js';\nimport ConnectedHeader from './ConnectedHeader.js';\nimport ConnectedFlexboxLayout from './ConnectedFlexboxLayout.js';\nimport ConnectedToolbarRow from './ConnectedToolbarRow.js';\nimport ConnectedLabellingOverlay from './ConnectedLabellingOverlay';\nimport './Viewer.css';\n/**\n * Inits OHIF Hanging Protocol's onReady.\n * It waits for OHIF Hanging Protocol to be ready to instantiate the ProtocolEngine\n * Hanging Protocol will use OHIF LayoutManager to render viewports properly\n */\n/*const initHangingProtocol = () => {\n    // When Hanging Protocol is ready\n    HP.ProtocolStore.onReady(() => {\n\n        // Gets all StudyMetadata objects: necessary for Hanging Protocol to access study metadata\n        const studyMetadataList = OHIF.viewer.StudyMetadataList.all();\n\n        // Instantiate StudyMetadataSource: necessary for Hanging Protocol to get study metadata\n        const studyMetadataSource = new OHIF.studies.classes.OHIFStudyMetadataSource();\n\n        // Get prior studies map\n        const studyPriorsMap = OHIF.studylist.functions.getStudyPriorsMap(studyMetadataList);\n\n        // Creates Protocol Engine object with required arguments\n        const ProtocolEngine = new HP.ProtocolEngine(layoutManager, studyMetadataList, studyPriorsMap, studyMetadataSource);\n\n        // Sets up Hanging Protocol engine\n        HP.setEngine(ProtocolEngine);\n    });\n};*/\n\n/*const viewportUtils = OHIF.viewerbase.viewportUtils;\n\nOHIF.viewer.functionList = {\n    toggleCineDialog: viewportUtils.toggleCineDialog,\n    toggleCinePlay: viewportUtils.toggleCinePlay,\n    clearTools: viewportUtils.clearTools,\n    resetViewport: viewportUtils.resetViewport,\n    invert: viewportUtils.invert\n};*/\n\nclass Viewer extends Component {\n  static propTypes = {\n    studies: PropTypes.array,\n    studyInstanceUids: PropTypes.array,\n    onTimepointsUpdated: PropTypes.func,\n    onMeasurementsUpdated: PropTypes.func\n  };\n\n  constructor(props) {\n    super(props);\n    OHIF.measurements.MeasurementApi.setConfiguration({\n      dataExchange: {\n        retrieve: this.retrieveMeasurements,\n        store: this.storeMeasurements\n      }\n    });\n\n    OHIF.measurements.TimepointApi.setConfiguration({\n      dataExchange: {\n        retrieve: this.retrieveTimepoints,\n        store: this.storeTimepoints,\n        remove: this.removeTimepoint,\n        update: this.updateTimepoint,\n        disassociate: this.disassociateStudy\n      }\n    });\n  }\n\n  retrieveMeasurements = (patientId, timepointIds) => {\n    OHIF.log.info('retrieveMeasurements');\n    // TODO: Retrieve the measurements from the latest available SR\n    return Promise.resolve();\n  };\n\n  storeMeasurements = (measurementData, timepointIds) => {\n    OHIF.log.info('storeMeasurements');\n    // TODO: Store the measurements into a new SR sent to the active server\n    return Promise.resolve();\n  };\n\n  retrieveTimepoints = filter => {\n    OHIF.log.info('retrieveTimepoints');\n\n    // Get the earliest and latest study date\n    let earliestDate = new Date().toISOString();\n    let latestDate = new Date().toISOString();\n    if (this.props.studies) {\n      latestDate = new Date('1000-01-01').toISOString();\n      this.props.studies.forEach(study => {\n        const studyDate = moment(study.studyDate, 'YYYYMMDD').toISOString();\n        if (studyDate < earliestDate) {\n          earliestDate = studyDate;\n        }\n        if (studyDate > latestDate) {\n          latestDate = studyDate;\n        }\n      });\n    }\n\n    // Return a generic timepoint\n    return Promise.resolve([\n      {\n        timepointType: 'baseline',\n        timepointId: 'TimepointId',\n        studyInstanceUids: this.props.studyInstanceUids,\n        patientId: filter.patientId,\n        earliestDate,\n        latestDate,\n        isLocked: false\n      }\n    ]);\n  };\n\n  storeTimepoints = timepointData => {\n    OHIF.log.info('storeTimepoints');\n    return Promise.resolve();\n  };\n\n  updateTimepoint = (timepointData, query) => {\n    OHIF.log.info('updateTimepoint');\n    return Promise.resolve();\n  };\n\n  removeTimepoint = timepointId => {\n    OHIF.log.info('removeTimepoint');\n    return Promise.resolve();\n  };\n\n  disassociateStudy = (timepointIds, studyInstanceUid) => {\n    OHIF.log.info('disassociateStudy');\n    return Promise.resolve();\n  };\n\n  onTimepointsUpdated = timepoints => {\n    if (this.props.onTimepointsUpdated) {\n      this.props.onTimepointsUpdated(timepoints);\n    }\n  };\n\n  onMeasurementsUpdated = measurements => {\n    if (this.props.onMeasurementsUpdated) {\n      this.props.onMeasurementsUpdated(measurements);\n    }\n  };\n\n  componentDidMount() {\n    const { studies } = this.props;\n    const { TimepointApi, MeasurementApi } = OHIF.measurements;\n    const currentTimepointId = 'TimepointId';\n\n    const timepointApi = new TimepointApi(currentTimepointId, {\n      onTimepointsUpdated: this.onTimepointsUpdated\n    });\n\n    const measurementApi = new MeasurementApi(timepointApi, {\n      onMeasurementsUpdated: this.onMeasurementsUpdated\n    });\n\n    const patientId = studies[0] && studies[0].patientId;\n    timepointApi.retrieveTimepoints({ patientId });\n    measurementApi.retrieveMeasurements(patientId, [currentTimepointId]);\n  }\n\n  render() {\n    return (\n      <>\n        <WhiteLabellingContext.Consumer>\n          {whiteLabelling => (\n            <ConnectedHeader home={false}>\n              {whiteLabelling.logoComponent}\n            </ConnectedHeader>\n          )}\n        </WhiteLabellingContext.Consumer>\n        <div id=\"viewer\" className=\"Viewer\">\n          <ConnectedToolbarRow />\n          {/*<ConnectedStudyLoadingMonitor studies={this.props.studies} />*/}\n          {/*<StudyPrefetcher studies={this.props.studies} />*/}\n          <ConnectedFlexboxLayout studies={this.props.studies} />\n          <ConnectedLabellingOverlay />\n        </div>\n      </>\n    );\n  }\n}\n\nexport default Viewer;\n","import { connect } from 'react-redux';\nimport Viewer from './Viewer.js';\nimport OHIF from 'ohif-core';\n\nconst { setTimepoints, setMeasurements } = OHIF.redux.actions;\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    onTimepointsUpdated: timepoints => {\n      dispatch(setTimepoints(timepoints));\n    },\n    onMeasurementsUpdated: measurements => {\n      dispatch(setMeasurements(measurements));\n    }\n  };\n};\n\nconst ConnectedViewer = connect(\n  null,\n  mapDispatchToProps\n)(Viewer);\n\nexport default ConnectedViewer;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport OHIF from 'ohif-core';\nimport ConnectedViewer from './ConnectedViewer.js';\n\nconst { createDisplaySets } = OHIF.utils;\n\nclass ViewerRetrieveStudyData extends Component {\n  static propTypes = {\n    studyInstanceUids: PropTypes.array.isRequired,\n    seriesInstanceUids: PropTypes.array,\n    server: PropTypes.object\n  };\n\n  state = {\n    studies: null,\n    error: null\n  };\n\n  componentDidMount() {\n    // TODO: Avoid using timepoints here\n    //const params = { studyInstanceUids, seriesInstanceUids, timepointId, timepointsFilter={} };\n    const { studyInstanceUids, seriesInstanceUids, server } = this.props;\n    const promise = OHIF.studies.retrieveStudiesMetadata(\n      server,\n      studyInstanceUids,\n      seriesInstanceUids\n    );\n\n    // Render the viewer when the data is ready\n    promise\n      .then(studies => {\n        const updatedStudies = createDisplaySets(studies);\n\n        this.setState({\n          studies: updatedStudies\n        });\n      })\n      .catch(error => {\n        this.setState({\n          error: true\n        });\n\n        throw new Error(error);\n      });\n  }\n\n  render() {\n    if (this.state.error) {\n      return <div>Error: {JSON.stringify(this.state.error)}</div>;\n    } else if (!this.state.studies) {\n      return <div>Loading...</div>;\n    }\n\n    return (\n      <ConnectedViewer\n        studies={this.state.studies}\n        studyInstanceUids={this.props.studyInstanceUids}\n      />\n    );\n  }\n}\n\nexport default ViewerRetrieveStudyData;\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport ViewerRetrieveStudyData from \"../connectedComponents/ViewerRetrieveStudyData.js\";\n\nfunction IHEInvokeImageDisplay({ match }) {\n    const requestType = match.params.query.requestType;\n    let studyInstanceUids;\n    //let patientUids;\n    let displayStudyList = false;\n\n    if (requestType === \"STUDY\") {\n        studyInstanceUids = match.params.query.studyUID.split(';');\n    } else if (requestType === \"STUDYBASE64\") {\n        const uids = this.params.query.studyUID;\n        const decodedData = window.atob(uids);\n        studyInstanceUids = decodedData.split(';');\n    } else if (requestType === \"PATIENT\") {\n        //patientUidspatientUids = this.params.query.patientID.split(';');\n        displayStudyList = true\n    } else {\n        displayStudyList = true\n    }\n\n    if (displayStudyList) {\n        return ('')//<StudyList patientUids={patientUids}/>);\n    }\n\n    return (\n        <ViewerRetrieveStudyData studyInstanceUids={studyInstanceUids}/>\n    );\n}\n\nIHEInvokeImageDisplay.propTypes = {\n    match: PropTypes.shape({\n        params: PropTypes.shape({\n            query: PropTypes.shape({\n                requestType: PropTypes.string.isRequired,\n                studyUID: PropTypes.string,\n                patientID: PropTypes.string\n            })\n        })\n    })\n};\n\nexport default IHEInvokeImageDisplay;\n","import { connect } from 'react-redux';\nimport ViewerRetrieveStudyData from './ViewerRetrieveStudyData.js';\n\nconst isActive = (a) => a.active === true;\n\nconst mapStateToProps = state => {\n    const activeServer = state.servers.servers.find(isActive);\n\n    return {\n        server: activeServer,\n    };\n};\n\nconst ConnectedViewerRetrieveStudyData = connect(\n    mapStateToProps,\n    null\n)(ViewerRetrieveStudyData);\n\nexport default ConnectedViewerRetrieveStudyData;\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport ConnectedViewerRetrieveStudyData from \"../connectedComponents/ConnectedViewerRetrieveStudyData\";\n\nfunction ViewerRouting({ match }) {\n    const { studyInstanceUids, seriesInstanceUids } = match.params;\n\n    let studyUIDs;\n    let seriesUIDs;\n\n    if (studyInstanceUids && !seriesInstanceUids) {\n        studyUIDs = studyInstanceUids.split(';');\n    } else if (studyInstanceUids && seriesInstanceUids) {\n        studyUIDs = [match.params.studyInstanceUid];\n        seriesUIDs = match.params.seriesInstanceUids.split(';');\n    }\n\n    return (\n        <ConnectedViewerRetrieveStudyData studyInstanceUids={studyUIDs} seriesInstanceUids={seriesUIDs}/>\n    );\n}\n\nViewerRouting.propTypes = {\n    match: PropTypes.shape({\n        params: PropTypes.shape({\n            studyInstanceUids: PropTypes.string.isRequired,\n            seriesInstanceUids: PropTypes.string\n        })\n    })\n};\n\nexport default ViewerRouting;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport OHIF from 'ohif-core';\nimport { withRouter } from 'react-router-dom';\nimport { StudyList } from 'react-viewerbase';\nimport ConnectedHeader from '../connectedComponents/ConnectedHeader.js';\nimport moment from 'moment';\n\nclass StudyListWithData extends Component {\n  state = {\n    searchData: {},\n    studies: null,\n    error: null\n  };\n\n  static propTypes = {\n    patientId: PropTypes.string,\n    server: PropTypes.object,\n    user: PropTypes.object,\n    history: PropTypes.object\n  };\n\n  static rowsPerPage = 25;\n  static defaultSort = { field: 'patientName', order: 'desc' };\n\n  static studyListDateFilterNumDays = 25000; // TODO: put this in the settings\n  static defaultStudyDateFrom = moment()\n    .subtract(StudyListWithData.studyListDateFilterNumDays, 'days')\n    .toDate();\n  static defaultStudyDateTo = new Date();\n\n  componentDidMount() {\n    // TODO: Avoid using timepoints here\n    //const params = { studyInstanceUids, seriesInstanceUids, timepointId, timepointsFilter={} };\n\n    this.searchForStudies();\n  }\n\n  searchForStudies = (\n    searchData = {\n      currentPage: 0,\n      rowsPerPage: StudyListWithData.rowsPerPage,\n      studyDateFrom: StudyListWithData.defaultStudyDateFrom,\n      studyDateTo: StudyListWithData.defaultStudyDateTo,\n      sortData: StudyListWithData.defaultSort\n    }\n  ) => {\n    const { server } = this.props;\n    const filter = {\n      patientId: searchData.patientId,\n      patientName: searchData.patientName,\n      accessionNumber: searchData.accessionNumber,\n      studyDescription: searchData.studyDescription,\n      modalitiesInStudy: searchData.modalities,\n      studyDateFrom: searchData.studyDateFrom,\n      studyDateTo: searchData.studyDateTo,\n      limit: searchData.rowsPerPage,\n      offset: searchData.currentPage * searchData.rowsPerPage\n    };\n\n    // TODO: add sorting\n    const promise = OHIF.studies.searchStudies(server, filter);\n\n    // Render the viewer when the data is ready\n    promise\n      .then(studies => {\n        if (!studies) {\n          studies = [];\n        }\n\n        const { field, order } = searchData.sortData;\n        const sortedStudies = studies\n          .sort(function(a, b) {\n            if (order === 'desc') {\n              if (a[field] < b[field]) {\n                return -1;\n              }\n              if (a[field] > b[field]) {\n                return 1;\n              }\n              return 0;\n            } else {\n              if (a[field] > b[field]) {\n                return -1;\n              }\n              if (a[field] < b[field]) {\n                return 1;\n              }\n              return 0;\n            }\n          })\n          .map(study => {\n            study.studyDate = moment(study.studyDate, 'YYYYMMDD').format(\n              'MMM DD, YYYY'\n            );\n            return study;\n          });\n\n        this.setState({\n          studies: sortedStudies\n        });\n      })\n      .catch(error => {\n        this.setState({\n          error: true\n        });\n\n        throw new Error(error);\n      });\n  };\n\n  onImport = () => {\n    //console.log('onImport');\n  };\n\n  onSelectItem = studyInstanceUID => {\n    this.props.history.push(`/viewer/${studyInstanceUID}`);\n  };\n\n  onSearch = searchData => {\n    this.searchForStudies(searchData);\n  };\n\n  render() {\n    if (this.state.error) {\n      return <div>Error: {JSON.stringify(this.state.error)}</div>;\n    } else if (this.state.studies === null) {\n      return <div>Loading...</div>;\n    }\n\n    return (\n      <>\n        <ConnectedHeader home={true} user={this.props.user} />\n        <StudyList\n          studies={this.state.studies}\n          studyListFunctionsEnabled={false}\n          onImport={this.onImport}\n          onSelectItem={this.onSelectItem}\n          pageSize={this.rowsPerPage}\n          defaultSort={StudyListWithData.defaultSort}\n          studyListDateFilterNumDays={\n            StudyListWithData.studyListDateFilterNumDays\n          }\n          onSearch={this.onSearch}\n        />\n      </>\n    );\n  }\n}\n\nexport default withRouter(StudyListWithData);\n","import { connect } from 'react-redux';\n\nimport StudyListWithData from './StudyListWithData.js';\n\nconst isActive = (a) => a.active === true;\n\nconst mapStateToProps = state => {\n    const activeServer = state.servers.servers.find(isActive);\n\n    return {\n        server: activeServer,\n        user: state.oidc.user,\n    };\n};\n\nconst ConnectedStudyList = connect(\n    mapStateToProps,\n    null\n)(StudyListWithData);\n\nexport default ConnectedStudyList;\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport ConnectedStudyList from \"./ConnectedStudyList\";\n\n// TODO: Move to react-viewerbase\n\nfunction StudyListRouting({ match }) {\n    // TODO: Figure out which filters we want to pass in via a URL\n    //const { patientId } = match.params;\n\n    return (\n        <ConnectedStudyList/>\n    );\n}\n\nStudyListRouting.propTypes = {\n    match: PropTypes.shape({\n        params: PropTypes.shape({\n            patientIds: PropTypes.string,\n        })\n    })\n};\n\nexport default StudyListRouting;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport qs from 'querystring';\nimport Viewer from '../connectedComponents/Viewer';\nimport OHIF from 'ohif-core';\n\nconst { createDisplaySets } = OHIF.utils;\n\nclass StandaloneRouting extends Component {\n  state = {\n    studies: null,\n    error: null\n  };\n\n  static propTypes = {\n    location: PropTypes.object,\n    store: PropTypes.object\n  };\n\n  static parseQueryAndFetchStudies(query) {\n    return new Promise((resolve, reject) => {\n      const url = query.url;\n\n      if (!url) {\n        reject(new Error('No URL was specified. Use ?url=$yourURL'));\n      }\n\n      // Define a request to the server to retrieve the study data\n      // as JSON, given a URL that was in the Route\n      const oReq = new XMLHttpRequest();\n\n      // Add event listeners for request failure\n      oReq.addEventListener('error', error => {\n        OHIF.log.warn('An error occurred while retrieving the JSON data');\n        reject(error);\n      });\n\n      // When the JSON has been returned, parse it into a JavaScript Object\n      // and render the OHIF Viewer with this data\n      oReq.addEventListener('load', () => {\n        // Parse the response content\n        // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseText\n        if (!oReq.responseText) {\n          OHIF.log.warn('Response was undefined');\n          reject(new Error('Response was undefined'));\n        }\n\n        OHIF.log.info(JSON.stringify(oReq.responseText, null, 2));\n\n        const data = JSON.parse(oReq.responseText);\n        if (data.servers && query.studyInstanceUids) {\n          const server = data.servers.dicomWeb[0];\n          server.type = 'dicomWeb';\n\n          const studyInstanceUids = query.studyInstanceUids.split(';');\n          const seriesInstanceUids = [];\n\n          OHIF.studies\n            .retrieveStudiesMetadata(\n              server,\n              studyInstanceUids,\n              seriesInstanceUids\n            )\n            .then(\n              studies => {\n                resolve(studies);\n              },\n              error => {\n                reject(error);\n              }\n            );\n        } else {\n          resolve(data.studies);\n        }\n      });\n\n      // Open the Request to the server for the JSON data\n      // In this case we have a server-side route called /api/\n      // which responds to GET requests with the study data\n      OHIF.log.info(`Sending Request to: ${url}`);\n      oReq.open('GET', url);\n      oReq.setRequestHeader('Accept', 'application/json');\n\n      // Fire the request to the server\n      oReq.send();\n    });\n  }\n\n  componentDidMount() {\n    const query = qs.parse(this.props.location.search);\n    StandaloneRouting.parseQueryAndFetchStudies(query).then(\n      studies => {\n        const updatedStudies = createDisplaySets(studies);\n\n        this.setState({ studies: updatedStudies });\n      },\n      error => {\n        this.setState({ error });\n      }\n    );\n  }\n\n  render() {\n    if (this.state.error) {\n      return <div>Error: {JSON.stringify(this.state.error)}</div>;\n    } else if (!this.state.studies) {\n      return <div>Loading...</div>;\n    }\n\n    return <Viewer studies={this.state.studies} />;\n  }\n}\n\nexport default StandaloneRouting;\n","import React, { Component } from 'react';\nimport { withRouter } from 'react-router-dom';\nimport PropTypes from 'prop-types';\nimport { CallbackComponent } from 'redux-oidc';\n\nclass CallbackPage extends Component {\n  static propTypes = {\n    userManager: PropTypes.object.isRequired,\n    history: PropTypes.object.isRequired\n  };\n\n  render() {\n    return (\n      <CallbackComponent\n        userManager={this.props.userManager}\n        successCallback={() => {\n          const pathname = sessionStorage.getItem('ohif-redirect-to');\n\n          this.props.history.push(pathname);\n        }}\n        errorCallback={error => {\n          //this.props.history.push(\"/\");\n          throw new Error(error);\n        }}\n      >\n        <div>Redirecting...</div>\n      </CallbackComponent>\n    );\n  }\n}\n\nexport default withRouter(CallbackPage);\n","import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\n// import asyncComponent from './components/AsyncComponent.js'\nimport IHEInvokeImageDisplay from './routes/IHEInvokeImageDisplay.js'\nimport ViewerRouting from './routes/ViewerRouting.js'\nimport StudyListRouting from './studylist/StudyListRouting.js'\nimport StandaloneRouting from './routes/StandaloneRouting.js'\nimport CallbackPage from './CallbackPage.js'\nimport { withRouter } from 'react-router'\nimport { Route, Switch } from 'react-router-dom'\nimport { connect } from 'react-redux'\nimport { ViewerbaseDragDropContext } from 'react-viewerbase'\n\nimport './OHIFStandaloneViewer.css'\nimport './variables.css'\nimport './theme-tide.css'\n\n// Dynamic Import Routes (CodeSplitting)\n// const IHEInvokeImageDisplay = asyncComponent(() =>\n//   import('./routes/IHEInvokeImageDisplay.js')\n// )\n// const ViewerRouting = asyncComponent(() => import('./routes/ViewerRouting.js'))\n// const StudyListRouting = asyncComponent(() =>\n//   import('./studylist/StudyListRouting.js')\n// )\n// const StandaloneRouting = asyncComponent(() =>\n//   import('./routes/StandaloneRouting.js')\n// )\n// const CallbackPage = asyncComponent(() => import('./CallbackPage.js'))\n//\n\nconst reload = () => window.location.reload()\n\nclass OHIFStandaloneViewer extends Component {\n  static propTypes = {\n    history: PropTypes.object.isRequired,\n    user: PropTypes.object,\n  }\n\n  componentDidMount() {\n    this.unlisten = this.props.history.listen((location, action) => {\n      if (this.props.setContext) {\n        this.props.setContext(window.location.pathname)\n      }\n    })\n  }\n\n  componentWillUnmount() {\n    this.unlisten()\n  }\n\n  render() {\n    const { user, userManager } = this.props\n\n    const userNotLoggedIn = userManager && (!user || user.expired)\n    if (userNotLoggedIn) {\n      const pathname = this.props.location.pathname\n\n      if (pathname !== '/callback') {\n        sessionStorage.setItem('ohif-redirect-to', pathname)\n      }\n\n      return (\n        <Switch>\n          <Route exact path=\"/silent-refresh.html\" onEnter={reload} />\n          <Route exact path=\"/logout-redirect.html\" onEnter={reload} />\n          <Route\n            path=\"/callback\"\n            render={() => <CallbackPage userManager={userManager} />}\n          />\n          <Route\n            component={() => {\n              userManager.signinRedirect()\n\n              return null\n            }}\n          />\n        </Switch>\n      )\n    }\n\n    return (\n      <Switch>\n        <Route exact path=\"/silent-refresh.html\" onEnter={reload} />\n        <Route exact path=\"/logout-redirect.html\" onEnter={reload} />\n        <Route exact path=\"/studylist\" component={StudyListRouting} />\n        <Route exact path=\"/\" component={StudyListRouting} />\n        <Route exact path=\"/viewer\" component={StandaloneRouting} />\n        <Route path=\"/viewer/:studyInstanceUids\" component={ViewerRouting} />\n        <Route\n          path=\"/study/:studyInstanceUid/series/:seriesInstanceUids\"\n          component={ViewerRouting}\n        />\n        <Route\n          path=\"/IHEInvokeImageDisplay\"\n          component={IHEInvokeImageDisplay}\n        />\n        <Route render={() => <div> Sorry, this page does not exist. </div>} />\n      </Switch>\n    )\n  }\n}\n\nconst mapStateToProps = state => {\n  return {\n    user: state.oidc.user,\n  }\n}\n\nconst ConnectedOHIFStandaloneViewer = connect(\n  mapStateToProps,\n  null\n)(OHIFStandaloneViewer)\n\nexport default ViewerbaseDragDropContext(\n  withRouter(ConnectedOHIFStandaloneViewer)\n)\n","/**\n *\n * @param {String} [baseDirectory='/']\n */\nexport default function(baseDirectory = '/') {\n  const iconsFileName = 'icons.svg'\n  const sanitizedBaseDirectory =\n    baseDirectory[baseDirectory.length - 1] === '/'\n      ? baseDirectory\n      : `${baseDirectory}/`\n  const relativePathToIcons = `${sanitizedBaseDirectory}${iconsFileName}`.replace(\n    '//',\n    '/'\n  )\n\n  return [\n    {\n      command: 'StackScroll',\n      type: 'tool',\n      text: 'Stack Scroll',\n      svgUrl: `${relativePathToIcons}#icon-tools-stack-scroll`,\n      active: false,\n    },\n    {\n      command: 'Zoom',\n      type: 'tool',\n      text: 'Zoom',\n      svgUrl: `${relativePathToIcons}#icon-tools-zoom`,\n      active: false,\n    },\n    {\n      command: 'Wwwc',\n      type: 'tool',\n      text: 'Levels',\n      svgUrl: `${relativePathToIcons}#icon-tools-levels`,\n      active: true,\n    },\n    {\n      command: 'Pan',\n      type: 'tool',\n      text: 'Pan',\n      svgUrl: `${relativePathToIcons}#icon-tools-pan`,\n      active: false,\n    },\n    {\n      command: 'Length',\n      type: 'tool',\n      text: 'Length',\n      svgUrl: `${relativePathToIcons}#icon-tools-measure-temp`,\n      active: false,\n    },\n    /*{\n        command: 'Annotate',\n        type: 'tool',\n        text: 'Annotate',\n        svgUrl: `${Icons}#icon-tools-measure-non-target`,\n        active: false\n    },*/\n    {\n      command: 'Angle',\n      type: 'tool',\n      text: 'Angle',\n      iconClasses: 'fa fa-angle-left',\n      active: false,\n    },\n    {\n      command: 'Bidirectional',\n      type: 'tool',\n      text: 'Bidirectional',\n      svgUrl: `${relativePathToIcons}#icon-tools-measure-target`,\n      active: false,\n    },\n    {\n      command: 'Brush',\n      type: 'tool',\n      text: 'Brush',\n      iconClasses: 'fa fa-circle',\n      active: false,\n    },\n    {\n      command: 'FreehandMouse',\n      type: 'tool',\n      text: 'Freehand',\n      iconClasses: 'fa fa-star',\n      active: false,\n    },\n    {\n      command: 'EllipticalRoi',\n      type: 'tool',\n      text: 'EllipticalRoi',\n      iconClasses: 'far fa-circle',\n      active: false,\n    },\n    {\n      command: 'CircleRoi',\n      type: 'tool',\n      text: 'CircleRoi',\n      iconClasses: 'far fa-dot-circle',\n      active: false,\n    },\n    {\n      command: 'RectangleRoi',\n      type: 'tool',\n      text: 'RectangleRoi',\n      iconClasses: 'far fa-square',\n      active: false,\n    },\n    {\n      command: 'reset',\n      type: 'command',\n      text: 'Reset',\n      svgUrl: `${relativePathToIcons}#icon-tools-reset`,\n      active: false,\n    },\n  ]\n}\n","// https://github.com/maxmantz/redux-oidc/blob/master/docs/API.md\nimport { loadUser, createUserManager } from 'redux-oidc'\n\n/**\n * Creates a userManager from oidcSettings;\n * loads the user into the provided redux store\n * LINK: https://github.com/IdentityModel/oidc-client-js/wiki#configuration\n *\n * @param {*} store\n * @param {Object} oidcSettings\n * @param {string} oidcSettings.authServerUrl,\n * @param {string} oidcSettings.clientId,\n * @param {string} oidcSettings.authRedirectUri,\n * @param {string} oidcSettings.postLogoutRedirectUri,\n * @param {string} oidcSettings.responseType,\n * @param {string} oidcSettings.extraQueryParams,\n */\nexport default function(store, oidcSettings) {\n  if (!store || !oidcSettings) {\n    return\n  }\n\n  const settings = {\n    ...oidcSettings,\n    silent_redirect_uri: '/silent-refresh.html',\n    automaticSilentRenew: true,\n    revokeAccessTokenOnSignout: true,\n    filterProtocolClaims: true,\n    loadUserInfo: true,\n  }\n\n  const userManager = createUserManager(settings)\n\n  loadUser(store, userManager)\n\n  return userManager\n}\n","import cornerstoneWADOImageLoader from 'cornerstone-wado-image-loader'\n\n/**\n *\n * @param {String} baseDirectory\n * @param {String} webWorkScriptsPath\n */\nexport default function(baseDirectory, webWorkScriptsPath) {\n  const scriptsPath = `${window.location.protocol}//${\n    window.location.host\n  }${baseDirectory}/${webWorkScriptsPath}`\n  const config = {\n    maxWebWorkers: Math.max(navigator.hardwareConcurrency - 1, 1),\n    startWebWorkersOnDemand: true,\n    webWorkerPath: `${scriptsPath}/cornerstoneWADOImageLoaderWebWorker.min.js`,\n    taskConfiguration: {\n      decodeTask: {\n        loadCodecsOnStartup: true,\n        initializeCodecsOnStartup: false,\n        codecsPath: `${scriptsPath}/cornerstoneWADOImageLoaderCodecs.min.js`,\n        usePDFJS: false,\n        strict: false,\n      },\n    },\n  }\n\n  cornerstoneWADOImageLoader.webWorkerManager.initialize(config)\n}\n","import OHIF from 'ohif-core'\nimport updateTableWithNewMeasurementData from './lib/updateTableWithNewMeasurementData'\n\nfunction getToolLabellingFlowCallback(store) {\n  const setLabellingFlowDataAction = labellingFlowData => ({\n    type: 'SET_LABELLING_FLOW_DATA',\n    labellingFlowData,\n  })\n\n  const setLabellingFlowData = labellingFlowData => {\n    store.dispatch(setLabellingFlowDataAction(labellingFlowData))\n  }\n\n  return function toolLabellingFlowCallback(\n    measurementData,\n    eventData,\n    doneCallback,\n    options = {}\n  ) {\n    const updateLabelling = ({ location, response, description }) => {\n      // Update the measurement data with the labelling parameters\n\n      if (location) {\n        measurementData.location = location\n      }\n      if (description) {\n        measurementData.description = description\n      }\n      if (response) {\n        measurementData.response = response\n      }\n\n      updateTableWithNewMeasurementData(measurementData)\n    }\n\n    const labellingDoneCallback = () => {\n      setLabellingFlowData({ visible: false })\n    }\n\n    const labellingFlowData = {\n      visible: true,\n      eventData,\n      measurementData,\n      skipAddLabelButton: options.skipAddLabelButton,\n      editLocation: options.editLocation,\n      editDescription: options.editDescription,\n      editResponse: options.editResponse,\n      editDescriptionOnDialog: options.editDescriptionOnDialog,\n      labellingDoneCallback,\n      updateLabelling,\n    }\n\n    setLabellingFlowData(labellingFlowData)\n  }\n}\n\nconst resetLabellingAndContextMenuAction = state => ({\n  type: 'RESET_LABELLING_AND_CONTEXT_MENU',\n  state,\n})\n\nconst setToolContextMenuDataAction = (viewportIndex, toolContextMenuData) => ({\n  type: 'SET_TOOL_CONTEXT_MENU_DATA',\n  viewportIndex,\n  toolContextMenuData,\n})\n\nfunction getOnRightClickCallback(store) {\n  const setToolContextMenuData = (viewportIndex, toolContextMenuData) => {\n    store.dispatch(resetLabellingAndContextMenuAction())\n    store.dispatch(\n      setToolContextMenuDataAction(viewportIndex, toolContextMenuData)\n    )\n  }\n\n  const getOnCloseCallback = viewportIndex => {\n    return function onClose() {\n      const toolContextMenuData = {\n        visible: false,\n      }\n\n      store.dispatch(\n        setToolContextMenuDataAction(viewportIndex, toolContextMenuData)\n      )\n    }\n  }\n\n  return function onRightClick(event) {\n    const eventData = event.detail\n    const viewportIndex = parseInt(eventData.element.dataset.viewportIndex, 10)\n\n    const toolContextMenuData = {\n      eventData,\n      isTouchEvent: false,\n      onClose: getOnCloseCallback(viewportIndex),\n    }\n\n    setToolContextMenuData(viewportIndex, toolContextMenuData)\n  }\n}\n\nfunction getOnTouchPressCallback(store) {\n  const setToolContextMenuData = (viewportIndex, toolContextMenuData) => {\n    store.dispatch(resetLabellingAndContextMenuAction())\n    store.dispatch(\n      setToolContextMenuDataAction(viewportIndex, toolContextMenuData)\n    )\n  }\n\n  const getOnCloseCallback = viewportIndex => {\n    return function onClose() {\n      const toolContextMenuData = {\n        visible: false,\n      }\n\n      store.dispatch(\n        setToolContextMenuDataAction(viewportIndex, toolContextMenuData)\n      )\n    }\n  }\n\n  return function onTouchPress(event) {\n    const eventData = event.detail\n    const viewportIndex = parseInt(eventData.element.dataset.viewportIndex, 10)\n\n    const toolContextMenuData = {\n      eventData,\n      isTouchEvent: true,\n      onClose: getOnCloseCallback(viewportIndex),\n    }\n\n    setToolContextMenuData(viewportIndex, toolContextMenuData)\n  }\n}\n\nfunction getResetLabellingAndContextMenu(store) {\n  return function resetLabellingAndContextMenu() {\n    store.dispatch(resetLabellingAndContextMenuAction())\n  }\n}\n\nexport default function setupTools(store) {\n  const toolLabellingFlowCallback = getToolLabellingFlowCallback(store)\n  const availableTools = [\n    { name: 'Pan', mouseButtonMasks: [1, 4] },\n    { name: 'Zoom', mouseButtonMasks: [1, 2] },\n    { name: 'Wwwc', mouseButtonMasks: [1] },\n    {\n      name: 'Bidirectional',\n      configuration: {\n        configuration: {\n          getMeasurementLocationCallback: toolLabellingFlowCallback,\n        },\n      },\n      mouseButtonMasks: [1],\n    },\n    {\n      name: 'Length',\n      configuration: {\n        configuration: {\n          getMeasurementLocationCallback: toolLabellingFlowCallback,\n        },\n      },\n      mouseButtonMasks: [1],\n    },\n    {\n      name: 'Angle',\n      configuration: {\n        configuration: {\n          getMeasurementLocationCallback: toolLabellingFlowCallback,\n        },\n      },\n      mouseButtonMasks: [1],\n    },\n    { name: 'StackScroll', mouseButtonMasks: [1] },\n    { name: 'Brush', mouseButtonMasks: [1] },\n    {\n      name: 'FreehandMouse',\n      configuration: {\n        configuration: {\n          getMeasurementLocationCallback: toolLabellingFlowCallback,\n        },\n      },\n      mouseButtonMasks: [1],\n    },\n    {\n      name: 'EllipticalRoi',\n      configuration: {\n        configuration: {\n          getMeasurementLocationCallback: toolLabellingFlowCallback,\n        },\n      },\n      mouseButtonMasks: [1],\n    },\n    {\n      name: 'CircleRoi',\n      configuration: {\n        configuration: {\n          getMeasurementLocationCallback: toolLabellingFlowCallback,\n        },\n      },\n      mouseButtonMasks: [1],\n    },\n    {\n      name: 'RectangleRoi',\n      configuration: {\n        configuration: {\n          getMeasurementLocationCallback: toolLabellingFlowCallback,\n        },\n      },\n      mouseButtonMasks: [1],\n    },\n    { name: 'PanMultiTouch' },\n    { name: 'ZoomTouchPinch' },\n    { name: 'StackScrollMouseWheel' },\n    { name: 'StackScrollMultiTouch' },\n  ]\n\n  const onRightClick = getOnRightClickCallback(store)\n  const onTouchPress = getOnTouchPressCallback(store)\n  const onNewImage = getResetLabellingAndContextMenu(store)\n  const onMouseClick = getResetLabellingAndContextMenu(store)\n  const onTouchStart = getResetLabellingAndContextMenu(store)\n  const toolAction = OHIF.redux.actions.setExtensionData('cornerstone', {\n    availableTools,\n    onNewImage,\n    onRightClick,\n    onTouchPress,\n    onTouchStart,\n    onMouseClick,\n  })\n\n  store.dispatch(toolAction)\n}\n","import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport cornerstone from 'cornerstone-core'\nimport cornerstoneTools from 'cornerstone-tools'\nimport getMeasurementLocationCallback from '../lib/getMeasurementLocationCallback'\n\nimport './ToolContextMenu.css'\n\nconst toolTypes = [\n  'Angle',\n  'Bidirectional',\n  'Length',\n  'FreehandMouse',\n  'EllipticalRoi',\n  'CircleRoi',\n  'RectangleRoi',\n]\n\nlet defaultDropdownItems = [\n  {\n    actionType: 'Delete',\n    action: ({ nearbyToolData, eventData }) => {\n      const element = eventData.element\n\n      cornerstoneTools.removeToolState(\n        element,\n        nearbyToolData.toolType,\n        nearbyToolData.tool\n      )\n      cornerstone.updateImage(element)\n    },\n  },\n  {\n    actionType: 'setLabel',\n    action: ({ nearbyToolData, eventData }) => {\n      const { tool } = nearbyToolData\n\n      const options = {\n        skipAddLabelButton: true,\n        editLocation: true,\n      }\n\n      getMeasurementLocationCallback(eventData, tool, options)\n    },\n  },\n  {\n    actionType: 'setDescription',\n    action: ({ nearbyToolData, eventData }) => {\n      const { tool } = nearbyToolData\n\n      const options = {\n        editDescriptionOnDialog: true,\n      }\n\n      getMeasurementLocationCallback(eventData, tool, options)\n    },\n  },\n]\n\nfunction getNearbyToolData(element, coords, toolTypes) {\n  const nearbyTool = {}\n  let pointNearTool = false\n\n  toolTypes.forEach(toolType => {\n    const toolData = cornerstoneTools.getToolState(element, toolType)\n    if (!toolData) {\n      return\n    }\n\n    toolData.data.forEach(function(data, index) {\n      // TODO: Fix this, it's ugly\n      let toolInterface = cornerstoneTools.getToolForElement(element, toolType)\n      if (!toolInterface) {\n        toolInterface = cornerstoneTools.getToolForElement(\n          element,\n          `${toolType}Tool`\n        )\n      }\n\n      if (!toolInterface) {\n        throw new Error('Tool not found.')\n      }\n\n      if (toolInterface.pointNearTool(element, data, coords)) {\n        pointNearTool = true\n        nearbyTool.tool = data\n        nearbyTool.index = index\n        nearbyTool.toolType = toolType\n      }\n    })\n\n    if (pointNearTool) {\n      return false\n    }\n  })\n\n  return pointNearTool ? nearbyTool : undefined\n}\n\nfunction getDropdownItems(eventData, isTouchEvent = false, availableTools) {\n  const nearbyToolData = getNearbyToolData(\n    eventData.element,\n    eventData.currentPoints.canvas,\n    toolTypes,\n    availableTools\n  )\n\n  // Annotate tools for touch events already have a press handle to edit it, has a better UX for deleting it\n  if (\n    isTouchEvent &&\n    nearbyToolData &&\n    nearbyToolData.toolType === 'arrowAnnotate'\n  ) {\n    return\n  }\n\n  let dropdownItems = []\n  if (nearbyToolData) {\n    defaultDropdownItems.forEach(function(item) {\n      item.params = {\n        eventData,\n        nearbyToolData,\n      }\n\n      if (item.actionType === 'Delete') {\n        item.text = 'Delete measurement'\n      }\n\n      if (item.actionType === 'setLabel') {\n        item.text = 'Relabel'\n      }\n\n      if (item.actionType === 'setDescription') {\n        item.text = `${\n          nearbyToolData.tool.description ? 'Edit' : 'Add'\n        } Description`\n      }\n\n      dropdownItems.push(item)\n    })\n  }\n\n  return dropdownItems\n}\n\nclass ToolContextMenu extends Component {\n  static propTypes = {\n    isTouchEvent: PropTypes.bool.isRequired,\n    eventData: PropTypes.object,\n    onClose: PropTypes.func,\n    availableTools: PropTypes.array,\n    visible: PropTypes.bool.isRequired,\n  }\n\n  static defaultProps = {\n    visible: true,\n    isTouchEvent: false,\n  }\n\n  constructor(props) {\n    super(props)\n\n    this.mainElement = React.createRef()\n  }\n\n  render() {\n    if (!this.props.eventData) {\n      return null\n    }\n\n    const { isTouchEvent, eventData, availableTools } = this.props\n    const dropdownItems = getDropdownItems(\n      eventData,\n      isTouchEvent,\n      availableTools\n    )\n\n    // Skip if there is no dropdown item\n    if (!dropdownItems.length) {\n      return ''\n    }\n\n    const dropdownComponents = dropdownItems.map(item => {\n      const itemOnClick = event => {\n        item.action(item.params)\n        if (this.props.onClose) {\n          this.props.onClose()\n        }\n      }\n\n      return (\n        <li key={item.actionType}>\n          <button className=\"form-action\" onClick={itemOnClick}>\n            <span key={item.actionType}>{item.text}</span>\n          </button>\n        </li>\n      )\n    })\n\n    const position = {\n      top: `${eventData.currentPoints.canvas.y}px`,\n      left: `${eventData.currentPoints.canvas.x}px`,\n    }\n\n    return (\n      <div className=\"ToolContextMenu\" style={position} ref={this.mainElement}>\n        <ul className=\"bounded\">{dropdownComponents}</ul>\n      </div>\n    )\n  }\n\n  componentDidMount = () => {\n    if (this.mainElement.current) {\n      this.updateElementPosition()\n    }\n  }\n\n  componentDidUpdate = () => {\n    if (this.mainElement.current) {\n      this.updateElementPosition()\n    }\n  }\n\n  updateElementPosition = () => {\n    const {\n      offsetParent,\n      offsetTop,\n      offsetHeight,\n      offsetWidth,\n      offsetLeft,\n    } = this.mainElement.current\n\n    const { eventData } = this.props\n\n    if (offsetTop + offsetHeight > offsetParent.offsetHeight) {\n      const offBoundPixels =\n        offsetTop + offsetHeight - offsetParent.offsetHeight\n      const top = eventData.currentPoints.canvas.y - offBoundPixels\n\n      this.mainElement.current.style.top = `${top > 0 ? top : 0}px`\n    }\n\n    if (offsetLeft + offsetWidth > offsetParent.offsetWidth) {\n      const offBoundPixels = offsetLeft + offsetWidth - offsetParent.offsetWidth\n      const left = eventData.currentPoints.canvas.x - offBoundPixels\n\n      this.mainElement.current.style.left = `${left > 0 ? left : 0}px`\n    }\n  }\n}\n\nexport default ToolContextMenu\n","import { connect } from 'react-redux'\nimport ToolContextMenu from './ToolContextMenu'\n\nconst mapStateToProps = (state, ownProps) => {\n  if (!state.ui || !state.ui.contextMenu) {\n    return {\n      visible: false,\n    }\n  }\n\n  const { viewportIndex } = ownProps\n  const toolContextMenuData = state.ui.contextMenu[viewportIndex]\n  let availableTools\n\n  if (\n    state.extensions &&\n    state.extensions.cornerstone &&\n    state.extensions.cornerstone.availableTools\n  ) {\n    availableTools = state.extensions.cornerstone.availableTools\n  }\n\n  return {\n    ...toolContextMenuData,\n    availableTools,\n  }\n}\n\nconst ConnectedToolContextMenu = connect(\n  mapStateToProps,\n  null\n)(ToolContextMenu)\n\nexport default ConnectedToolContextMenu\n","import React, { Component } from 'react'\nimport { BrowserRouter as Router } from 'react-router-dom'\nimport { Provider } from 'react-redux'\nimport { createStore, combineReducers } from 'redux'\nimport PropTypes from 'prop-types'\nimport OHIF from 'ohif-core'\nimport './config'\nimport ui from './redux/ui.js'\nimport OHIFStandaloneViewer from './OHIFStandaloneViewer'\nimport WhiteLabellingContext from './WhiteLabellingContext'\nimport OHIFCornerstoneExtension from 'ohif-cornerstone-extension'\nimport OHIFVTKExtension from 'ohif-vtk-extension'\nimport OHIFDicomPDFExtension from 'ohif-dicom-pdf-extension'\nimport OHIFDicomHtmlExtension from 'ohif-dicom-html-extension'\nimport OHIFDicomMicroscopyExtension from 'ohif-dicom-microscopy-extension'\nimport { OidcProvider, reducer as oidcReducer } from 'redux-oidc'\nimport {\n  getDefaultToolbarButtons,\n  getUserManagerForOpenIdConnectClient,\n  initWebWorkers,\n} from './utils/index.js'\nimport setupTools from './setupTools'\nimport ConnectedToolContextMenu from './connectedComponents/ConnectedToolContextMenu'\n\nconst { ExtensionManager } = OHIF.extensions\nconst { reducers, localStorage } = OHIF.redux\n\nreducers.ui = ui\nreducers.oidc = oidcReducer\n\nconst combined = combineReducers(reducers)\nconst store = createStore(combined, localStorage.loadState())\n\nstore.subscribe(() => {\n  localStorage.saveState({\n    preferences: store.getState().preferences,\n  })\n})\n\nsetupTools(store)\n\nconst children = {\n  viewport: [<ConnectedToolContextMenu />],\n}\n\n/** TODO: extensions should be passed in as prop as soon as we have the extensions as separate packages and then registered by ExtensionsManager */\nconst extensions = [\n  new OHIFCornerstoneExtension({ children }),\n  new OHIFVTKExtension(),\n  new OHIFDicomPDFExtension(),\n  new OHIFDicomHtmlExtension(),\n  new OHIFDicomMicroscopyExtension(),\n]\nExtensionManager.registerExtensions(store, extensions)\n\n// TODO[react] Use a provider when the whole tree is React\nwindow.store = store\n\nfunction handleServers(servers) {\n  if (servers) {\n    OHIF.utils.addServers(servers, store)\n  }\n}\n\nclass App extends Component {\n  static propTypes = {\n    routerBasename: PropTypes.string.isRequired,\n    relativeWebWorkerScriptsPath: PropTypes.string.isRequired,\n    servers: PropTypes.object.isRequired,\n    oidc: PropTypes.array,\n    whiteLabelling: PropTypes.object,\n  }\n\n  static defaultProps = {\n    whiteLabelling: {},\n    oidc: [],\n  }\n\n  constructor(props) {\n    super(props)\n\n    //\n    const defaultButtons = getDefaultToolbarButtons(this.props.routerBasename)\n    const buttonsAction = OHIF.redux.actions.setAvailableButtons(defaultButtons)\n\n    store.dispatch(buttonsAction)\n\n    if (this.props.oidc.length) {\n      const firstOpenIdClient = this.props.oidc[0]\n\n      this.userManager = getUserManagerForOpenIdConnectClient(\n        store,\n        firstOpenIdClient\n      )\n    }\n    handleServers(this.props.servers)\n    initWebWorkers(\n      this.props.routerBasename,\n      this.props.relativeWebWorkerScriptsPath\n    )\n  }\n\n  render() {\n    const userManager = this.userManager\n\n    if (userManager) {\n      return (\n        <Provider store={store}>\n          <OidcProvider store={store} userManager={userManager}>\n            <Router basename={this.props.routerBasename}>\n              <WhiteLabellingContext.Provider value={this.props.whiteLabelling}>\n                <OHIFStandaloneViewer userManager={userManager} />\n              </WhiteLabellingContext.Provider>\n            </Router>\n          </OidcProvider>\n        </Provider>\n      )\n    }\n\n    return (\n      <Provider store={store}>\n        <Router basename={this.props.routerBasename}>\n          <WhiteLabellingContext.Provider value={this.props.whiteLabelling}>\n            <OHIFStandaloneViewer />\n          </WhiteLabellingContext.Provider>\n        </Router>\n      </Provider>\n    )\n  }\n}\n\nexport default App\n","/**\n * Entry point for development and production PWA builds.\n * Packaged (NPM) builds go through `index_publish.js`\n */\nimport App from './App.js'\nimport React from 'react'\nimport ReactDOM from 'react-dom'\n\nexport { App }\n\nwindow.config = window.config || {}\nconst applicationDefaults = {\n  routerBasename: '/',\n  relativeWebWorkerScriptsPath: '',\n}\nconst applicationProps = Object.assign({}, applicationDefaults, window.config)\nconst app = React.createElement(App, applicationProps, null)\n\nReactDOM.render(app, document.getElementById('root'))\n\n/*\nExample config with OIDC\n*/\n// Uncomment the next two blocks, comment out the config without OIDC\n// Try going to:\n// http://localhost:5000/viewer/1.2.276.0.7230010.3.1.2.0.94237.1537373823.634387 //PDF\n// http://localhost:5000/viewer/1.3.6.1.4.1.25403.345050719074.3824.20170126082328.1\n// http://ohif-viewer-react.s3-website-us-east-1.amazonaws.com/viewer/1.3.6.1.4.1.25403.345050719074.3824.20170126082328.1\n/*props.servers = {\n  dicomWeb: [\n    {\n      name: 'DCM4CHEE',\n      wadoUriRoot:\n        'https://cancer.crowds-cure.org/dcm4chee-arc/aets/DCM4CHEE/wado',\n      qidoRoot: 'https://cancer.crowds-cure.org/dcm4chee-arc/aets/DCM4CHEE/rs',\n      wadoRoot: 'https://cancer.crowds-cure.org/dcm4chee-arc/aets/DCM4CHEE/rs',\n      qidoSupportsIncludeField: true,\n      imageRendering: 'wadors',\n      thumbnailRendering: 'wadors',\n      requestOptions: {\n        requestFromBrowser: true\n      }\n    }\n  ]\n};\n\nprops.oidc = [\n  {\n    authServerUrl: 'https://cancer.crowds-cure.org/auth/realms/dcm4che',\n    authRedirectUri: rootUrl + '/callback',\n    postLogoutRedirectUri: rootUrl + '/logout-redirect.html',\n    clientId: 'crowds-cure-cancer',\n    responseType: 'id_token token',\n    scope: 'email profile openid',\n    revokeAccessTokenOnSignout: true,\n    extraQueryParams: {\n      kc_idp_hint: 'crowds-cure-cancer-auth0-oidc',\n      client_id: 'crowds-cure-cancer'\n    }\n  }\n];*/\n\n/* props.servers = {\n  dicomWeb: [\n    {\n      name: 'DCM4CHEE',\n      wadoUriRoot:\n        'https://k8s-testing.ohif.org/dcm4chee-arc/aets/DCM4CHEE/wado',\n      qidoRoot: 'https://k8s-testing.ohif.org/dcm4chee-arc/aets/DCM4CHEE/rs',\n      wadoRoot: 'https://k8s-testing.ohif.org/dcm4chee-arc/aets/DCM4CHEE/rs',\n      qidoSupportsIncludeField: true,\n      imageRendering: 'wadors',\n      thumbnailRendering: 'wadors',\n      requestOptions: {\n        requestFromBrowser: true\n      }\n    }\n  ]\n};\n\nprops.oidc = [\n  {\n    authServerUrl: 'https://k8s-testing.ohif.org/auth/realms/dcm4che',\n    authRedirectUri: rootUrl + '/callback',\n    postLogoutRedirectUri: rootUrl + '/logout-redirect.html',\n    clientId: 'ohif-viewer',\n    responseType: 'id_token token',\n    scope: 'email profile openid',\n    revokeAccessTokenOnSignout: true\n  }\n]; */\n\n/*props.servers = {\n  \"dicomWeb\": [\n    {\n      \"name\": \"DCM4CHEE\",\n      \"wadoUriRoot\": \"http://localhost:8080/dcm4chee-arc/aets/DCM4CHEE/wado\",\n      \"qidoRoot\": \"http://localhost:8080/dcm4chee-arc/aets/DCM4CHEE/rs\",\n      \"wadoRoot\": \"http://localhost:8080/dcm4chee-arc/aets/DCM4CHEE/rs\",\n      \"qidoSupportsIncludeField\": true,\n      \"imageRendering\": \"wadors\",\n      \"thumbnailRendering\": \"wadors\",\n      \"requestOptions\": {\n        \"requestFromBrowser\": true,\n        \"auth\": \"admin:admin\"\n      }\n    }\n  ]\n};*/\n\n/*\nUI settings\nPlugins\n    - Custom tools / buttons\n    - Custom Sidebar module thing\n    - Custom Viewports\n    - Custom Sop Class Interpreters\n*/\n\n/*\"PUBLIC_SETTINGS\": {\n    \"ui\": {\n      \"studyListFunctionsEnabled\": true,\n      \"leftSidebarOpen\": false,\n      \"displaySetNavigationLoopOverSeries\": false,\n      \"displaySetNavigationMultipleViewports\": true,\n      \"autoPositionMeasurementsTextCallOuts\": \"TRLB\"\n    },\n    \"prefetch\": {\n      \"order\": \"topdown\",\n      \"displaySetCount\": 1\n    }\n */\n"],"sourceRoot":""}