(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{100:function(e,t,n){"use strict";n.r(t);var a=n(5),o=n(6),i=n(9),r=n(7),s=n(8),c=n(0),l=n.n(c),u=n(106),p=n(10),d=n(27),m=n(3),f=n(21),v=n.n(f),h=n(2),b=n.n(h),g=n(16),y=n.n(g);window.info={version:"0.0.20",homepage:"".concat("/demo")},window.cornerstone=b.a,window.cornerstoneWADOImageLoader=y.a,y.a.external.cornerstone=b.a,y.a.external.dicomParser=v.a,m.b.user.getAccessToken=function(){var e=window.store.getState();if(e.oidc&&e.oidc.user)return e.oidc.user.access_token},y.a.configure({beforeSend:function(e){var t=m.b.DICOMWeb.getAuthorizationHeader();t.Authorization&&e.setRequestHeader("Authorization",t.Authorization)}});var E={leftSidebarOpen:!0,rightSidebarOpen:!1,userPreferencesModalOpen:!1,labelling:{},contextMenu:{}},O=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_LEFT_SIDEBAR_OPEN":return Object.assign({},e,{leftSidebarOpen:t.state});case"SET_RIGHT_SIDEBAR_OPEN":return Object.assign({},e,{rightSidebarOpen:t.state});case"SET_USER_PREFERENCES_MODAL_OPEN":return Object.assign({},e,{userPreferencesModalOpen:t.state});case"SET_LABELLING_FLOW_DATA":var n=Object.assign({},t.labellingFlowData);return Object.assign({},e,{labelling:n});case"SET_TOOL_CONTEXT_MENU_DATA":var a=Object.assign({},e.contextMenu);return a[t.viewportIndex]=Object.assign({},t.toolContextMenuData),Object.assign({},e,{contextMenu:a});case"RESET_LABELLING_AND_CONTEXT_MENU":return Object.assign({},e,{labelling:E.labelling,contextMenu:E.contextMenu});default:return e}},S=n(26),D=n.n(S),w=(n(72),"".concat(window.config.routerBasename,"/icons.svg"));var T=function(){return l.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",className:"header-brand",href:"http://ohif.org"},l.a.createElement("svg",{className:"header-logo-image"},l.a.createElement("use",{xlinkHref:"".concat(w,"#icon-ohif-logo")})),l.a.createElement("div",{className:"header-logo-text"},"Open Health Imaging Foundation"))},C={logoComponent:T()},k=l.a.createContext(C),I=n(103),j=n(104),L=n(12),x=(n(76),function(e){return{type:"SET_LEFT_SIDEBAR_OPEN",state:e}}),M=function(e){return{type:"SET_RIGHT_SIDEBAR_OPEN",state:e}},N=function(e){return{type:"SET_USER_PREFERENCES_MODAL_OPEN",state:e}},U=n(22),P=n.n(U),A=m.b.redux.actions.setUserPreferences,R=Object(p.b)(function(e){var t=window.store.getState().commandContext.context;return{isOpen:e.ui.userPreferencesModalOpen,windowLevelData:e.preferences[t]?e.preferences[t].windowLevelData:{},hotKeysData:e.preferences[t]?e.preferences[t].hotKeysData:{}}},function(e){return{onCancel:function(){e(N(!1))},onSave:function(t){var n=window.store.getState().commandContext.context,a=P()(window.store.getState().preferences);a[n]=t,e(A(a)),e(N(!1)),m.b.hotkeysUtil.setHotkeys(t.hotKeysData)},onResetToDefaults:function(){e(A()),e(N(!1)),m.b.hotkeysUtil.setHotkeys()}}})(L.m),B=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(i.a)(this,Object(r.a)(t).call(this,e))).state={userPreferencesOpen:!1},n.options=[{title:"Preferences ",icon:"fa fa-user",onClick:n.props.openUserPreferencesModal},{title:"About",icon:"fa fa-info",link:"http://ohif.org"}],n}return Object(s.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return l.a.createElement("div",{className:"entry-header ".concat(this.props.home?"header-big":"")},l.a.createElement("div",{className:"header-left-box"},this.props.location&&this.props.location.studyLink&&l.a.createElement(I.a,{to:this.props.location.studyLink,className:"header-btn header-viewerLink"},"Back to Viewer"),this.props.children,!this.props.home&&l.a.createElement(I.a,{className:"header-btn header-studyListLinkSection",to:{pathname:"/",state:{studyLink:this.props.location.pathname}}},"Study list")),l.a.createElement("div",{className:"header-menu"},l.a.createElement("span",{className:"research-use"},"INVESTIGATIONAL USE ONLY"),l.a.createElement(L.b,{title:"Options",list:this.options,align:"right"}),l.a.createElement(R,null)))}}]),t}(c.Component);B.defaultProps={home:!0,children:T()};var F=Object(j.a)(B),_=Object(p.b)(function(e){return{isOpen:e.ui.userPreferencesModalOpen}},function(e){return{openUserPreferencesModal:function(){e(N(!0))}}})(F),W=Object(p.b)(function(e,t){var n=e.loading.progress,a=P()(t.studies);return a.forEach(function(e){e.thumbnails.forEach(function(e){var t=e.displaySetInstanceUid,a="StackProgress:".concat(t),o=n[a],i=0;o&&(i=o.percentComplete),e.stackPercentComplete=i})}),{studies:a}},null)(L.i),V=Object(p.b)(function(e){var t,n=e.plugins.availablePlugins.filter(function(e){return e.type===m.b.plugins.PLUGIN_TYPES.VIEWPORT}).map(function(e){return e.id}),a={};return n.forEach(function(e){var t=m.b.plugins.availablePlugins.find(function(t){return t.id===e});t&&(a[e]=t.component)}),n&&n.length&&(t=n[0]),{layout:e.viewports.layout,activeViewportIndex:e.viewports.activeViewportIndex,availablePlugins:a,defaultPlugin:t}},null)(L.e),H=(n(78),function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(i.a)(this,Object(r.a)(t).call(this,e))).getViewportData=function(){for(var e=[],t=n.props,a=t.layout,o=t.viewportSpecificData,i=0;i<a.viewports.length;i++){var r=o[i];if(!r||!r.displaySetInstanceUid)r=n.state.displaySets.find(function(t){return!e.some(function(e){return e.displaySetInstanceUid===t.displaySetInstanceUid})});e.push(r)}return e},n.setViewportData=function(e){var t=e.viewportIndex,a=e.item,o=n.findDisplaySet(n.props.studies,a.studyInstanceUid,a.displaySetInstanceUid);n.props.setViewportSpecificData(t,o)},m.a.hotkeysUtil.setup("viewer"),n.state={displaySets:[]},n}return Object(s.a)(t,e),Object(o.a)(t,[{key:"getDisplaySets",value:function(e){var t=[];return e.forEach(function(e){e.displaySets.forEach(function(e){e.plugin||(e.plugin="cornerstone"),t.push(e)})}),t}},{key:"findDisplaySet",value:function(e,t,n){var a=e.find(function(e){return e.studyInstanceUid===t});if(a)return a.displaySets.find(function(e){return e.displaySetInstanceUid===n})}},{key:"componentDidMount",value:function(){var e=this.getDisplaySets(this.props.studies);this.setState({displaySets:e})}},{key:"render",value:function(){return l.a.createElement("div",{className:"ViewerMain"},l.a.createElement(V,{studies:this.props.studies,viewportData:this.getViewportData(),setViewportData:this.setViewportData}))}},{key:"componentWillUnmount",value:function(){var e=this,t=this.props.viewportSpecificData;Object.keys(t).forEach(function(t){e.props.clearViewportSpecificData(t)})}}]),t}(c.Component)),Y=m.b.redux.actions,G=Y.setViewportSpecificData,q=Y.clearViewportSpecificData,J=Object(p.b)(function(e){var t=e.viewports;return{activeViewportIndex:t.activeViewportIndex,layout:t.layout,viewportSpecificData:t.viewportSpecificData}},function(e){return{setViewportSpecificData:function(t,n){e(G(t,n))},clearViewportSpecificData:function(){e(q())}}})(H),X=n(23);var z=n(4),K=n.n(z);function Z(e){var t=e.toolType,n=e.measurementNumber,a=e.location,o=e.description,i=m.b.measurements.MeasurementApi.Instance;i.tools[t].filter(function(e){return e.measurementNumber===n}).forEach(function(e){e.location=a,e.description=o,i.updateMeasurement(e.toolType,e)}),i.syncMeasurementsAndToolData(),b.a.getEnabledElements().forEach(function(e){b.a.updateImage(e.element)})}function Q(e,t,n){var a=t.toolType,o=e.element,i=Z;K.a.getToolForElement(o,a).configuration.getMeasurementLocationCallback(t,e,i,n)}var $=m.b.redux.actions.setViewportSpecificData,ee=m.b.measurements.MeasurementApi;function te(e){var t=e.location,n=e.description,a="...";return t&&(a=t,n&&(a+="(".concat(n,")"))),a}function ne(e,t,n){var a=[];return e.forEach(function(e){t.forEach(function(t){var o={displayText:"..."};e.timepointId===t.timepointId&&(o.displayText=n(e)),a.push(o)})}),a}function ae(e,t){var n=m.b.measurements.MeasurementApi.getConfiguration().measurementTools,a=function(){var e=m.b.measurements.MeasurementApi.getConfiguration(),t=[];return e.measurementTools.forEach(function(e){return t=t.concat(e.childTools)}),t}(),o=n.map(function(e){return{groupName:e.name,groupId:e.id,measurements:[]}});return Object.keys(e).forEach(function(n){var i,r=e[n],s=a.find(function(e){return e.id===n}),c=s.options.measurementTable.displayFunction,l=(i="measurementNumber",r.reduce(function(e,t){return(e[t[i]]=e[t[i]]||[]).push(t),e},{}));Object.keys(l).forEach(function(e){var n=l[e],a=n[0],i=a.measurementNumber,r=a.lesionNamingNumber,u=a.toolType,p=a._id,d={itemNumber:r,label:te(a),measurementId:p,measurementNumber:i,lesionNamingNumber:r,toolType:u,hasWarnings:!1,warningTitle:"",isSplitLesion:!1,warningList:[],data:ne(n,t,c)};o.find(function(e){return e.groupId===s.toolGroup}).measurements.push(d)})}),o.forEach(function(e){e.measurements.sort(function(e,t){return e.lesionNamingNumber>t.lesionNamingNumber?1:-1})}),o}function oe(e){return e&&e.length?[{label:"Study date:",date:D()(e[0].latestDate).format("DD-MMM-YY")}]:[]}var ie=Object(p.b)(function(e){var t=e.timepointManager,n=t.timepoints,a=t.measurements;return{timepoints:oe(n),measurementCollection:ae(a,n),timepointManager:e.timepointManager,viewports:e.viewports}},function(e){return{dispatchRelabel:function(e,t,n){var a=n&&n.activeViewportIndex||0,o=b.a.getEnabledElements();if(!o||o.length<=a)m.b.log.error("Failed to find the enabled element");else{var i=o[a].element,r={event:{clientX:e.clientX,clientY:e.clientY},element:i},s=t.toolType,c=t.measurementId,l=ee.Instance.tools[s].find(function(e){return e._id===c});Q(r,Object.assign({},l,{location:null}),{skipAddLabelButton:!0,editLocation:!0})}},dispatchEditDescription:function(e,t,n){var a=n&&n.activeViewportIndex||0,o=b.a.getEnabledElements();if(!o||o.length<=a)m.b.log.error("Failed to find the enabled element");else{var i=o[a].element,r={event:{clientX:e.clientX,clientY:e.clientY},element:i},s=t.toolType,c=t.measurementId;Q(r,ee.Instance.tools[s].find(function(e){return e._id===c}),{editDescriptionOnDialog:!0})}},dispatchJumpToRowItem:function(t,n,a,o){(function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{invertViewportTimepointsOrder:!1,childToolKey:null},o=t.layout.viewports.length,i=n.timepoints.length,r=n.measurements,s=n.timepoints,c=Math.min(i,o),l=e.toolType,u=e.measurementNumber;a.invertViewportTimepointsOrder&&s.reverse();for(var p=r[l],d=[],f=function(e){var t=s[e].timepointId,n=p.find(function(e){return e.timepointId===t&&e.measurementNumber===u});if(!n)return d.push(null),"continue";var o=n,i=m.a.measurements.MeasurementApi.getToolConfiguration(l).tool;if(a.childToolKey)o=n[a.childToolKey];else if(Array.isArray(i.childTools)){var r=i.childTools.find(function(e){return!!n[e]});o=n[r]}d.push(o)},v=0;v<c;v++)f(v);var h=[];return d.forEach(function(e,t){if(e){var n=m.a.utils.studyMetadataManager.get(e.studyInstanceUid);if(!n)throw new Error("Study not found.");var a=n.findDisplaySet(function(t){return function(e,t){return e.images.find(function(e){return e.getSOPInstanceUID()===t})}(t,e.sopInstanceUid)});if(!a)throw new Error("Display set not found.");a.sopInstanceUid=e.sopInstanceUid,e.frameIndex&&(a.frameIndex=e.frameIndex),h.push({viewportIndex:t,displaySet:a})}}),{viewportSpecificData:h,layout:[]}})(t,n,a,e,o).viewportSpecificData.forEach(function(t){var n=t.viewportIndex,a=t.displaySet;e($(n,a))});var i=t.toolType,r=t.measurementNumber,s=ee.Instance;Object.keys(s.tools).forEach(function(e){s.tools[e].forEach(function(e){e.active=!1})}),s.tools[i].filter(function(e){return e.measurementNumber===r}).forEach(function(e){e.active=!0}),s.syncMeasurementsAndToolData(),b.a.getEnabledElements().forEach(function(e){b.a.updateImage(e.element)})}}},function(e,t,n){return Object(X.a)({timepoints:e.timepoints,measurementCollection:e.measurementCollection,selectedMeasurementNumber:n.selectedMeasurementNumber},t,{onItemClick:function(n,a){var o=e.viewports,i=e.timepointManager;t.dispatchJumpToRowItem(a,o,i,{invertViewportTimepointsOrder:!1,childToolKey:null})},onRelabelClick:function(n,a){var o=e.viewports;t.dispatchRelabel(n,a,o)},onEditDescriptionClick:function(n,a){var o=e.viewports;t.dispatchEditDescription(n,a,o)},onDeleteClick:function(e,t){m.b.measurements.MeasurementHandlers.onRemoved({detail:{toolType:t.toolType,measurementData:{_id:t.measurementId,lesionNamingNumber:t.lesionNamingNumber,measurementNumber:t.measurementNumber}}})}})})(L.f),re=(n(79),function(e){function t(){var e,n;Object(a.a)(this,t);for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];return(n=Object(i.a)(this,(e=Object(r.a)(t)).call.apply(e,[this].concat(s)))).state={studiesForBrowser:[]},n.getStudiesForBrowser=function(){return n.props.studies.map(function(e){return{studyInstanceUid:e.studyInstanceUid,thumbnails:e.displaySets.map(function(e){var t,n=e.displaySetInstanceUid,a=e.seriesDescription,o=e.seriesNumber,i=e.instanceNumber,r=e.numImageFrames;return e.images&&e.images.length&&(t=e.images[0].getImageId()),{imageId:t,displaySetInstanceUid:n,seriesDescription:a,seriesNumber:o,instanceNumber:i,numImageFrames:r}})}})},n}return Object(s.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this.getStudiesForBrowser();this.setState({studiesForBrowser:e})}},{key:"render",value:function(){var e="main-content";return this.props.leftSidebarOpen&&(e+=" sidebar-left-open"),this.props.rightSidebarOpen&&(e+=" sidebar-right-open"),l.a.createElement("div",{className:"FlexboxLayout"},l.a.createElement("div",{className:this.props.leftSidebarOpen?"sidebar-menu sidebar-left sidebar-open":"sidebar-menu sidebar-left"},l.a.createElement(W,{studies:this.state.studiesForBrowser})),l.a.createElement("div",{className:e},l.a.createElement(J,{studies:this.props.studies})),l.a.createElement("div",{className:this.props.rightSidebarOpen?"sidebar-menu sidebar-right sidebar-open":"sidebar-menu sidebar-right"},l.a.createElement(ie,null)))}}]),t}(c.Component)),se=Object(p.b)(function(e){return{leftSidebarOpen:e.ui.leftSidebarOpen,rightSidebarOpen:e.ui.rightSidebarOpen}},null)(re),ce=m.b.redux.actions.setLayout,le=Object(p.b)(function(e){return{currentLayout:e.viewports.layout}},function(e){return{onChange:function(t){for(var n=[],a=t.row+1,o=t.col+1,i=a*o,r=0;r<i;r++)n.push({height:"".concat(100/a,"%"),width:"".concat(100/o,"%")});e(ce({viewports:n}))}}})(L.d),ue=(n(80),function(e){function t(){return Object(a.a)(this,t),Object(i.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return l.a.createElement("div",{className:"PluginSwitch"},l.a.createElement(L.c,{buttons:this.props.buttons}))}}]),t}(c.Component));ue.defaultProps={};var pe=ue,de=m.b.redux.actions.setLayout;function me(e,t,n){var a=e.slice(),o=Object.assign({},a[t],n);return a[t]=o,a}var fe=Object(p.b)(function(e){var t=e.viewports;return{activeViewportIndex:t.activeViewportIndex,layout:t.layout}},function(e){return{setLayout:function(t){e(de(t))}}},function(e,t,n){var a=e.activeViewportIndex,o=e.layout,i=t.setLayout,r="".concat(window.config.routerBasename,"/icons.svg");return{buttons:[{text:"Acquired",type:"command",iconClasses:"fa fa-bars",active:!1,onClick:function(e){console.warn("Original Acquisition");var t=me(o.viewports,a,{plugin:"cornerstone"});i({viewports:t})}},{text:"Axial",svgUrl:"".concat(r,"#cube"),svgClasses:"icon-rotate-120",active:!1,onClick:function(e){console.warn("Axial");var t=me(o.viewports,a,{plugin:"vtk",vtk:{mode:"mpr",sliceNormal:[0,0,1]}});i({viewports:t})}},{text:"Sagittal",svgUrl:"".concat(r,"#cube"),active:!1,onClick:function(e){console.warn("Sagittal");var t=me(o.viewports,a,{plugin:"vtk",vtk:{mode:"mpr",sliceNormal:[1,0,0]}});i({viewports:t})}},{text:"Coronal",svgUrl:"".concat(r,"#cube"),svgClasses:"fa-rotate-90 fa-flip-horizontal",active:!1,onClick:function(e){console.warn("Coronal");var t=me(o.viewports,a,{plugin:"vtk",vtk:{mode:"mpr",sliceNormal:[0,1,0]}});i({viewports:t})}}]}})(pe),ve=(n(81),"".concat(window.config.routerBasename,"/icons.svg")),he=function(e){function t(){var e,n;Object(a.a)(this,t);for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];return(n=Object(i.a)(this,(e=Object(r.a)(t)).call.apply(e,[this].concat(s)))).onLeftSidebarValueChanged=function(e){n.props.setLeftSidebarOpen(!!e)},n.onRightSidebarValueChanged=function(e){n.props.setRightSidebarOpen(!!e)},n}return Object(s.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e,t=[{value:"studies",svgLink:"".concat(ve,"#icon-studies"),svgWidth:15,svgHeight:13,bottomLabel:"Series"}],n=[{value:"measurements",svgLink:"".concat(ve,"#icon-measurements-lesions"),svgWidth:15,svgHeight:13,bottomLabel:"Measurements"}],a=this.props.leftSidebarOpen?t[0].value:null,o=this.props.rightSidebarOpen?n[0].value:null,i=this.props.pluginId,r=m.b.plugins,s=r.PLUGIN_TYPES,c=r.availablePlugins.find(function(e){return e.type===s.TOOLBAR&&e.id===i});if(c){var u=c.component;e=l.a.createElement(u,null)}return l.a.createElement("div",{className:"ToolbarRow"},l.a.createElement("div",{className:"pull-left m-t-1 p-y-1",style:{padding:"10px"}},l.a.createElement(L.g,{options:t,value:a,onValueChanged:this.onLeftSidebarValueChanged})),e,l.a.createElement(le,null),l.a.createElement(fe,null),l.a.createElement("div",{className:"pull-right m-t-1 rm-x-1",style:{marginLeft:"auto"}},l.a.createElement(L.g,{options:n,value:o,onValueChanged:this.onRightSidebarValueChanged})))}}]),t}(c.Component);he.defaultProps={leftSidebarOpen:!1,rightSidebarOpen:!1};var be=he,ge=Object(p.b)(function(e){var t=e.viewports,n=t.layout,a=t.viewportSpecificData,o=t.activeViewportIndex,i=n.viewports[o]&&n.viewports[o].plugin,r=a[o]&&a[o].plugin;return{pluginId:i||r||"cornerstone",leftSidebarOpen:e.ui.leftSidebarOpen,rightSidebarOpen:e.ui.rightSidebarOpen}},function(e){return{setLeftSidebarOpen:function(t){e(x(t))},setRightSidebarOpen:function(t){e(M(t))}}})(be),ye=(n(82),function(e){function t(){return Object(a.a)(this,t),Object(i.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return l.a.createElement("div",{className:"simpleDialog ".concat(this.props.rootClass),ref:this.props.componentRef,style:this.props.componentStyle},l.a.createElement("form",null,l.a.createElement("div",{className:"header"},l.a.createElement("span",{className:"closeBtn",onClick:this.props.onClose},l.a.createElement("span",{className:"closeIcon"},"x")),l.a.createElement("h4",{className:"title"},this.props.headerTitle)),l.a.createElement("div",{className:"content"},this.props.children),l.a.createElement("div",{className:"footer"},l.a.createElement("button",{type:"button",className:"btn btn-cancel",onClick:this.props.onClose},"Cancel"),l.a.createElement("button",{type:"button",className:"btn btn-confirm",onClick:this.props.onConfirm},"Confirm"))))}}]),t}(c.Component));ye.defaultProps={componentStyle:{},rootClass:""};var Ee=ye;function Oe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.current){var n=e.current,a=n.offsetParent,o=n.offsetTop,i=n.offsetHeight,r=n.offsetLeft,s=n.offsetWidth,c=t.top||o,l=t.left||r;if(a){var u="".concat(a.offsetHeight,"px");i+c>a.offsetHeight&&(c-=i+c-a.offsetHeight)<0&&(c=0),l+s>a.offsetWidth&&(l=a.offsetWidth-s)<0&&(l=0),u&&n.style.maxHeight!==u&&(n.style.maxHeight=u),n.style.top!=="".concat(c,"px")&&(n.style.top="".concat(c,"px")),n.style.left!=="".concat(l,"px")&&(n.style.left="".concat(l,"px"))}}}var Se={width:96,height:28};n(83);var De=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(i.a)(this,Object(r.a)(t).call(this,e))).componentDidMount=function(){Oe(n.mainElement)},n.onClose=function(){n.props.onCancel()},n.onConfirm=function(){n.props.onUpdate(n.state.description)},n.handleChange=function(e){n.setState({description:e.target.value})},n.state={description:e.measurementData.description||""},n.mainElement=l.a.createRef(),n}return Object(s.a)(t,e),Object(o.a)(t,[{key:"componentDidUpdate",value:function(e){this.props.description!==e.description&&this.setState({description:this.props.description})}},{key:"render",value:function(){var e=function(e){var t=Object.assign({},e),n=320,a=230,o=window.innerWidth-n,i=window.innerHeight-a;return t.left-=n/2,t.top-=a/2,t.left>o&&(t.left=o),t.top>i&&(t.top=i),t}(this.props.componentStyle);return l.a.createElement(Ee,{headerTitle:"Edit Description",onClose:this.onClose,onConfirm:this.onConfirm,rootClass:"editDescriptionDialog",componentRef:this.mainElement,componentStyle:e},l.a.createElement("input",{value:this.state.description,className:"simpleDialogInput",id:"description",autoComplete:"off",autoFocus:!0,onChange:this.handleChange}))}}]),t}(c.Component);De.defaultProps={componentRef:l.a.createRef(),componentStyle:{}};var we=n(50),Te=(n(84),function(e){function t(){return Object(a.a)(this,t),Object(i.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return l.a.createElement(we.CSSTransition,{in:this.props.displayComponent,appear:!0,timeout:500,classNames:"labelling",onExited:this.props.onTransitionExit},this.props.children)}}]),t}(c.Component)),Ce=["Abdomen/Chest Wall","Adrenal","Bladder","Bone","Brain","Breast","Colon","Esophagus","Extremities","Gallbladder","Kidney","Liver","Lung","Lymph Node","Mediastinum/Hilum","Muscle","Neck","Other Soft Tissue","Ovary","Pancreas","Pelvis","Peritoneum/Omentum","Prostate","Retroperitoneum","Small Bowel","Spleen","Stomach","Subcutaneous"].map(function(e){return{label:e,value:e}}),ke=function(e){function t(e){var n;Object(a.a)(this,t),(n=Object(i.a)(this,Object(r.a)(t).call(this,e))).componentDidUpdate=function(){n.repositionComponent()},n.labellingStateFragment=function(){var e=n.state,t=e.skipAddLabelButton,a=e.editLocation,o=e.description,i=e.locationLabel;return t?a?l.a.createElement(L.h,{items:n.currentItems,columns:1,onSelected:n.selectTreeSelectCalback,selectTreeFirstTitle:"Assign Label",onComponentChange:n.repositionComponent}):l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"checkIconWrapper",onClick:n.fadeOutAndLeaveFast},l.a.createElement("svg",{className:"checkIcon"},l.a.createElement("use",{xlinkHref:"/icons.svg#check-solid"}))),l.a.createElement("div",{className:"locationDescriptionWrapper"},l.a.createElement("div",{className:"location"},i),l.a.createElement("div",{className:"description"},l.a.createElement("input",{id:"descriptionInput",ref:n.descriptionInput,defaultValue:o||"",autoComplete:"off"}))),l.a.createElement("div",{className:"commonButtons"},l.a.createElement("button",{type:"button",className:"commonButton left",onClick:n.relabel},"Relabel"),l.a.createElement("button",{type:"button",className:"commonButton right",onClick:n.setDescriptionUpdateMode},o?"Edit ":"Add ","Description")),l.a.createElement("div",{className:"editDescriptionButtons"},l.a.createElement("button",{type:"button",className:"commonButton left",onClick:n.descriptionCancel},"Cancel"),l.a.createElement("button",{type:"button",className:"commonButton right",onClick:n.descriptionSave},"Save"))):l.a.createElement(l.a.Fragment,null,l.a.createElement("button",{type:"button",className:"addLabelButton",onClick:n.showLabelling},n.state.location?"Edit":"Add"," Label"))},n.relabel=function(){n.setState({editLocation:!0})},n.setDescriptionUpdateMode=function(){n.descriptionInput.current.focus(),n.setState({editDescription:!0})},n.descriptionCancel=function(){var e=P()(n.state).description,t=void 0===e?"":e;n.descriptionInput.current.value=t,n.setState({editDescription:!1})},n.descriptionSave=function(){var e=n.descriptionInput.current.value;n.props.updateLabelling({description:e}),n.setState({description:e,editDescription:!1})},n.selectTreeSelectCalback=function(e,t){var a=t.value;n.props.updateLabelling({location:a});var o=n.mainElement.current.offsetParent.offsetTop,i={top:e.nativeEvent.y-o-25,left:n.state.componentStyle.left};n.setState({editLocation:!1,confirmationState:!0,location:t.value,locationLabel:t.label,componentStyle:i}),n.isTouchScreen&&(n.setTimeout=setTimeout(function(){n.setState({displayComponent:!1})},2e3))},n.showLabelling=function(){n.setState({skipAddLabelButton:!0,editLocation:!1})},n.fadeOutAndLeave=function(){n.fadeOutTimer=setTimeout(function(){n.setState({displayComponent:!1})},1e3)},n.fadeOutAndLeaveFast=function(){n.setState({displayComponent:!1})},n.clearFadeOutTimer=function(){n.fadeOutTimer&&clearTimeout(n.fadeOutTimer)},n.repositionComponent=function(){setTimeout(function(){Oe(n.mainElement)},200)};var o=e.measurementData,s=o.location,c=o.locationLabel,u=o.description,p=e.componentStyle;return e.skipAddLabelButton||(p=function(e,t){var n=e.handles,a=n.start,o=n.end,i=t.currentPoints.client,r=b.a.pixelToCanvas(t.element,a),s=b.a.pixelToCanvas(t.element,o),c=i.x-r.x,l=i.y-r.y,u={left:s.x+c,top:s.y+l};return a.y>o.y&&(u.top-=Se.height),a.x>o.x&&(u.left-=Se.width),u}(e.measurementData,e.eventData)),n.state={location:s,locationLabel:c,description:u,skipAddLabelButton:e.skipAddLabelButton,editDescription:e.editDescription,editLocation:e.editLocation,componentStyle:p,confirmationState:!1,displayComponent:!0},n.mainElement=l.a.createRef(),n.descriptionInput=l.a.createRef(),n.initialItems=Ce,n.currentItems=P()(n.initialItems),n}return Object(s.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e="labellingComponent";this.state.editDescription&&(e+=" editDescription");var t=Object.assign({},this.state.componentStyle);return this.state.skipAddLabelButton&&(t.left-=160),l.a.createElement(Te,{displayComponent:this.state.displayComponent,onTransitionExit:this.props.labellingDoneCallback},l.a.createElement("div",{className:e,style:t,ref:this.mainElement,onMouseLeave:this.fadeOutAndLeave,onMouseEnter:this.clearFadeOutTimer},this.labellingStateFragment()))}}]),t}(c.Component),Ie=(n(92),function(e){function t(e){var n;Object(a.a)(this,t),(n=Object(i.a)(this,Object(r.a)(t).call(this,e))).componentDidMount=function(){document.addEventListener("touchstart",n.onTouchStart)},n.componentWillUnmount=function(){document.removeEventListener("touchstart",n.onTouchStart)},n.getRenderComponent=function(){var e=n.state,t=e.editLocation,a=e.editDescription,o=e.editDescriptionOnDialog,i=e.measurementData;return o?l.a.createElement(De,{onCancel:n.props.labellingDoneCallback,onUpdate:n.descriptionDialogUpdate,componentRef:n.editDescriptionDialog,componentStyle:n.state.componentStyle,measurementData:i}):t||a?l.a.createElement(ke,Object.assign({},n.props,{componentStyle:n.state.componentStyle})):void 0},n.treatMeasurementData=function(e){var t=n.props,a=t.editDescription,o=t.editLocation;a&&(e.description=void 0),o&&(e.location=void 0)},n.responseDialogUpdate=function(e){n.props.updateLabelling({response:e}),n.props.labellingDoneCallback()},n.descriptionDialogUpdate=function(e){n.props.updateLabelling({description:e}),n.props.labellingDoneCallback()};var o=P()(e.measurementData);n.treatMeasurementData(o);var s=e.editLocation;return e.editDescription||e.editLocation||(s=!0),n.state={componentStyle:je(e.eventData),skipAddLabelButton:e.skipAddLabelButton,editLocation:s,editDescription:e.editDescription,editDescriptionOnDialog:e.editDescriptionOnDialog,measurementData:o},n}return Object(s.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return this.getRenderComponent()}}]),t}(c.Component));function je(e){var t=e.event;return{left:t.clientX,top:t.clientY}}Ie.defaultProps={skipAddLabelButton:!1,editLocation:!1,editDescription:!1,editDescriptionOnDialog:!1};var Le=function(e){function t(){return Object(a.a)(this,t),Object(i.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return this.props.visible?l.a.createElement(Ie,this.props):null}}]),t}(c.Component);Le.defaultProps={visible:!1};var xe=Le,Me=Object(p.b)(function(e){if(!e.ui||!e.ui.labelling)return{visible:!1};var t=e.ui.labelling;return Object(X.a)({visible:!1},t)},null)(xe),Ne=(n(93),function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(i.a)(this,Object(r.a)(t).call(this,e))).retrieveMeasurements=function(e,t){return m.b.log.info("retrieveMeasurements"),Promise.resolve()},n.storeMeasurements=function(e,t){return m.b.log.info("storeMeasurements"),Promise.resolve()},n.retrieveTimepoints=function(e){m.b.log.info("retrieveTimepoints");var t=(new Date).toISOString(),a=(new Date).toISOString();return n.props.studies&&(a=new Date("1000-01-01").toISOString(),n.props.studies.forEach(function(e){var n=D()(e.studyDate,"YYYYMMDD").toISOString();n<t&&(t=n),n>a&&(a=n)})),Promise.resolve([{timepointType:"baseline",timepointId:"TimepointId",studyInstanceUids:n.props.studyInstanceUids,patientId:e.patientId,earliestDate:t,latestDate:a,isLocked:!1}])},n.storeTimepoints=function(e){return m.b.log.info("storeTimepoints"),Promise.resolve()},n.updateTimepoint=function(e,t){return m.b.log.info("updateTimepoint"),Promise.resolve()},n.removeTimepoint=function(e){return m.b.log.info("removeTimepoint"),Promise.resolve()},n.disassociateStudy=function(e,t){return m.b.log.info("disassociateStudy"),Promise.resolve()},n.onTimepointsUpdated=function(e){n.props.onTimepointsUpdated&&n.props.onTimepointsUpdated(e)},n.onMeasurementsUpdated=function(e){n.props.onMeasurementsUpdated&&n.props.onMeasurementsUpdated(e)},m.b.measurements.MeasurementApi.setConfiguration({dataExchange:{retrieve:n.retrieveMeasurements,store:n.storeMeasurements}}),m.b.measurements.TimepointApi.setConfiguration({dataExchange:{retrieve:n.retrieveTimepoints,store:n.storeTimepoints,remove:n.removeTimepoint,update:n.updateTimepoint,disassociate:n.disassociateStudy}}),n}return Object(s.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.studies,t=m.b.measurements,n=t.TimepointApi,a=t.MeasurementApi,o=new n("TimepointId",{onTimepointsUpdated:this.onTimepointsUpdated}),i=new a(o,{onMeasurementsUpdated:this.onMeasurementsUpdated}),r=e[0]&&e[0].patientId;o.retrieveTimepoints({patientId:r}),i.retrieveMeasurements(r,["TimepointId"])}},{key:"render",value:function(){return l.a.createElement(l.a.Fragment,null,l.a.createElement(k.Consumer,null,function(e){return l.a.createElement(_,{home:!1},e.logoComponent)}),l.a.createElement("div",{id:"viewer",className:"Viewer"},l.a.createElement(ge,null),l.a.createElement(se,{studies:this.props.studies}),l.a.createElement(Me,null)))}}]),t}(c.Component)),Ue=m.b.redux.actions,Pe=Ue.setTimepoints,Ae=Ue.setMeasurements,Re=Object(p.b)(null,function(e){return{onTimepointsUpdated:function(t){e(Pe(t))},onMeasurementsUpdated:function(t){e(Ae(t))}}})(Ne),Be=m.b.utils.createDisplaySets,Fe=function(e){function t(){var e,n;Object(a.a)(this,t);for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];return(n=Object(i.a)(this,(e=Object(r.a)(t)).call.apply(e,[this].concat(s)))).state={studies:null,error:null},n}return Object(s.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.studyInstanceUids,a=t.seriesInstanceUids,o=t.server;m.b.studies.retrieveStudiesMetadata(o,n,a).then(function(t){var n=Be(t);e.setState({studies:n})}).catch(function(t){throw e.setState({error:!0}),new Error(t)})}},{key:"render",value:function(){return this.state.error?l.a.createElement("div",null,"Error: ",JSON.stringify(this.state.error)):this.state.studies?l.a.createElement(Re,{studies:this.state.studies,studyInstanceUids:this.props.studyInstanceUids}):l.a.createElement("div",null,"Loading...")}}]),t}(c.Component);var _e=function(e){var t,n=e.match,a=n.params.query.requestType,o=!1;if("STUDY"===a)t=n.params.query.studyUID.split(";");else if("STUDYBASE64"===a){var i=this.params.query.studyUID;t=window.atob(i).split(";")}else o=!0;return o?"":l.a.createElement(Fe,{studyInstanceUids:t})},We=function(e){return!0===e.active},Ve=Object(p.b)(function(e){return{server:e.servers.servers.find(We)}},null)(Fe);var He=function(e){var t,n,a=e.match,o=a.params,i=o.studyInstanceUids,r=o.seriesInstanceUids;return i&&!r?t=i.split(";"):i&&r&&(t=[a.params.studyInstanceUid],n=a.params.seriesInstanceUids.split(";")),l.a.createElement(Ve,{studyInstanceUids:t,seriesInstanceUids:n})},Ye=function(e){function t(){var e,n;Object(a.a)(this,t);for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];return(n=Object(i.a)(this,(e=Object(r.a)(t)).call.apply(e,[this].concat(s)))).state={searchData:{},studies:null,error:null},n.searchForStudies=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{currentPage:0,rowsPerPage:t.rowsPerPage,studyDateFrom:t.defaultStudyDateFrom,studyDateTo:t.defaultStudyDateTo,sortData:t.defaultSort},a=n.props.server,o={patientId:e.patientId,patientName:e.patientName,accessionNumber:e.accessionNumber,studyDescription:e.studyDescription,modalitiesInStudy:e.modalities,studyDateFrom:e.studyDateFrom,studyDateTo:e.studyDateTo,limit:e.rowsPerPage,offset:e.currentPage*e.rowsPerPage};m.b.studies.searchStudies(a,o).then(function(t){t||(t=[]);var a=e.sortData,o=a.field,i=a.order,r=t.sort(function(e,t){return"desc"===i?e[o]<t[o]?-1:e[o]>t[o]?1:0:e[o]>t[o]?-1:e[o]<t[o]?1:0}).map(function(e){return e.studyDate=D()(e.studyDate,"YYYYMMDD").format("MMM DD, YYYY"),e});n.setState({studies:r})}).catch(function(e){throw n.setState({error:!0}),new Error(e)})},n.onImport=function(){},n.onSelectItem=function(e){n.props.history.push("/viewer/".concat(e))},n.onSearch=function(e){n.searchForStudies(e)},n}return Object(s.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){this.searchForStudies()}},{key:"render",value:function(){return this.state.error?l.a.createElement("div",null,"Error: ",JSON.stringify(this.state.error)):null===this.state.studies?l.a.createElement("div",null,"Loading..."):l.a.createElement(l.a.Fragment,null,l.a.createElement(_,{home:!0,user:this.props.user}),l.a.createElement(L.j,{studies:this.state.studies,studyListFunctionsEnabled:!1,onImport:this.onImport,onSelectItem:this.onSelectItem,pageSize:this.rowsPerPage,defaultSort:t.defaultSort,studyListDateFilterNumDays:t.studyListDateFilterNumDays,onSearch:this.onSearch}))}}]),t}(c.Component);Ye.rowsPerPage=25,Ye.defaultSort={field:"patientName",order:"desc"},Ye.studyListDateFilterNumDays=25e3,Ye.defaultStudyDateFrom=D()().subtract(Ye.studyListDateFilterNumDays,"days").toDate(),Ye.defaultStudyDateTo=new Date;var Ge=Object(j.a)(Ye),qe=function(e){return!0===e.active},Je=Object(p.b)(function(e){return{server:e.servers.servers.find(qe),user:e.oidc.user}},null)(Ge);var Xe=function(e){return e.match,l.a.createElement(Je,null)},ze=n(51),Ke=n.n(ze),Ze=m.b.utils.createDisplaySets,Qe=function(e){function t(){var e,n;Object(a.a)(this,t);for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];return(n=Object(i.a)(this,(e=Object(r.a)(t)).call.apply(e,[this].concat(s)))).state={studies:null,error:null},n}return Object(s.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this,n=Ke.a.parse(this.props.location.search);t.parseQueryAndFetchStudies(n).then(function(t){var n=Ze(t);e.setState({studies:n})},function(t){e.setState({error:t})})}},{key:"render",value:function(){return this.state.error?l.a.createElement("div",null,"Error: ",JSON.stringify(this.state.error)):this.state.studies?l.a.createElement(Ne,{studies:this.state.studies}):l.a.createElement("div",null,"Loading...")}}],[{key:"parseQueryAndFetchStudies",value:function(e){return new Promise(function(t,n){var a=e.url;a||n(new Error("No URL was specified. Use ?url=$yourURL"));var o=new XMLHttpRequest;o.addEventListener("error",function(e){m.b.log.warn("An error occurred while retrieving the JSON data"),n(e)}),o.addEventListener("load",function(){o.responseText||(m.b.log.warn("Response was undefined"),n(new Error("Response was undefined"))),m.b.log.info(JSON.stringify(o.responseText,null,2));var a=JSON.parse(o.responseText);if(a.servers&&e.studyInstanceUids){var i=a.servers.dicomWeb[0];i.type="dicomWeb";var r=e.studyInstanceUids.split(";");m.b.studies.retrieveStudiesMetadata(i,r,[]).then(function(e){t(e)},function(e){n(e)})}else t(a.studies)}),m.b.log.info("Sending Request to: ".concat(a)),o.open("GET",a),o.setRequestHeader("Accept","application/json"),o.send()})}}]),t}(c.Component),$e=n(24),et=function(e){function t(){return Object(a.a)(this,t),Object(i.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;return l.a.createElement($e.CallbackComponent,{userManager:this.props.userManager,successCallback:function(){var t=sessionStorage.getItem("ohif-redirect-to");e.props.history.push(t)},errorCallback:function(e){throw new Error(e)}},l.a.createElement("div",null,"Redirecting..."))}}]),t}(c.Component),tt=Object(j.a)(et),nt=n(47),at=n(107),ot=n(105),it=(n(96),n(97),n(98),function(){return window.location.reload()}),rt=function(e){function t(){return Object(a.a)(this,t),Object(i.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.unlisten=this.props.history.listen(function(t,n){e.props.setContext&&e.props.setContext(window.location.pathname)})}},{key:"componentWillUnmount",value:function(){this.unlisten()}},{key:"render",value:function(){var e=this.props,t=e.user,n=e.userManager;if(n&&(!t||t.expired)){var a=this.props.location.pathname;return"/callback"!==a&&sessionStorage.setItem("ohif-redirect-to",a),l.a.createElement(at.a,null,l.a.createElement(ot.a,{exact:!0,path:"/silent-refresh.html",onEnter:it}),l.a.createElement(ot.a,{exact:!0,path:"/logout-redirect.html",onEnter:it}),l.a.createElement(ot.a,{path:"/callback",render:function(){return l.a.createElement(tt,{userManager:n})}}),l.a.createElement(ot.a,{component:function(){return n.signinRedirect(),null}}))}return l.a.createElement(at.a,null,l.a.createElement(ot.a,{exact:!0,path:"/silent-refresh.html",onEnter:it}),l.a.createElement(ot.a,{exact:!0,path:"/logout-redirect.html",onEnter:it}),l.a.createElement(ot.a,{exact:!0,path:"/studylist",component:Xe}),l.a.createElement(ot.a,{exact:!0,path:"/",component:Xe}),l.a.createElement(ot.a,{exact:!0,path:"/viewer",component:Qe}),l.a.createElement(ot.a,{path:"/viewer/:studyInstanceUids",component:He}),l.a.createElement(ot.a,{path:"/study/:studyInstanceUid/series/:seriesInstanceUids",component:He}),l.a.createElement(ot.a,{path:"/IHEInvokeImageDisplay",component:_e}),l.a.createElement(ot.a,{render:function(){return l.a.createElement("div",null," Sorry, this page does not exist. ")}}))}}]),t}(c.Component),st=Object(p.b)(function(e){return{user:e.oidc.user}},null)(rt),ct=Object(L.n)(Object(nt.a)(st)),lt=n(52),ut=n(57),pt=n(58),dt=n(59),mt=n(60),ft=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",t="/"===e[e.length-1]?e:"".concat(e,"/"),n="".concat(t).concat("icons.svg");return[{command:"StackScroll",type:"tool",text:"Stack Scroll",svgUrl:"".concat(n,"#icon-tools-stack-scroll"),active:!1},{command:"Zoom",type:"tool",text:"Zoom",svgUrl:"".concat(n,"#icon-tools-zoom"),active:!1},{command:"Wwwc",type:"tool",text:"Levels",svgUrl:"".concat(n,"#icon-tools-levels"),active:!0},{command:"Pan",type:"tool",text:"Pan",svgUrl:"".concat(n,"#icon-tools-pan"),active:!1},{command:"Length",type:"tool",text:"Length",svgUrl:"".concat(n,"#icon-tools-measure-temp"),active:!1},{command:"Angle",type:"tool",text:"Angle",iconClasses:"fa fa-angle-left",active:!1},{command:"Bidirectional",type:"tool",text:"Bidirectional",svgUrl:"".concat(n,"#icon-tools-measure-target"),active:!1},{command:"Brush",type:"tool",text:"Brush",iconClasses:"fa fa-circle",active:!1},{command:"FreehandMouse",type:"tool",text:"Freehand",iconClasses:"fa fa-star",active:!1},{command:"EllipticalRoi",type:"tool",text:"EllipticalRoi",iconClasses:"far fa-circle",active:!1},{command:"CircleRoi",type:"tool",text:"CircleRoi",iconClasses:"far fa-dot-circle",active:!1},{command:"RectangleRoi",type:"tool",text:"RectangleRoi",iconClasses:"far fa-square",active:!1},{command:"reset",type:"command",text:"Reset",svgUrl:"".concat(n,"#icon-tools-reset"),active:!1}]},vt=function(e,t){if(e&&t){var n=Object(X.a)({},t,{silent_redirect_uri:"/silent-refresh.html",automaticSilentRenew:!0,revokeAccessTokenOnSignout:!0,filterProtocolClaims:!0,loadUserInfo:!0}),a=Object($e.createUserManager)(n);return Object($e.loadUser)(e,a),a}},ht=function(e,t){var n="".concat(window.location.protocol,"//").concat(window.location.host).concat(e,"/").concat(t),a={maxWebWorkers:Math.max(navigator.hardwareConcurrency-1,1),startWebWorkersOnDemand:!0,webWorkerPath:"".concat(n,"/cornerstoneWADOImageLoaderWebWorker.min.js"),taskConfiguration:{decodeTask:{loadCodecsOnStartup:!0,initializeCodecsOnStartup:!1,codecsPath:"".concat(n,"/cornerstoneWADOImageLoaderCodecs.min.js"),usePDFJS:!1,strict:!1}}};y.a.webWorkerManager.initialize(a)};var bt=function(e){return{type:"RESET_LABELLING_AND_CONTEXT_MENU",state:e}},gt=function(e,t){return{type:"SET_TOOL_CONTEXT_MENU_DATA",viewportIndex:e,toolContextMenuData:t}};function yt(e){var t=function(t){return function(){e.dispatch(gt(t,{visible:!1}))}};return function(n){var a=n.detail,o=parseInt(a.element.dataset.viewportIndex,10);!function(t,n){e.dispatch(bt()),e.dispatch(gt(t,n))}(o,{eventData:a,isTouchEvent:!1,onClose:t(o)})}}function Et(e){var t=function(t){return function(){e.dispatch(gt(t,{visible:!1}))}};return function(n){var a=n.detail,o=parseInt(a.element.dataset.viewportIndex,10);!function(t,n){e.dispatch(bt()),e.dispatch(gt(t,n))}(o,{eventData:a,isTouchEvent:!0,onClose:t(o)})}}function Ot(e){return function(){e.dispatch(bt())}}n(99);var St=["Angle","Bidirectional","Length","FreehandMouse","EllipticalRoi","CircleRoi","RectangleRoi"],Dt=[{actionType:"Delete",action:function(e){var t=e.nearbyToolData,n=e.eventData.element;K.a.removeToolState(n,t.toolType,t.tool),b.a.updateImage(n)}},{actionType:"setLabel",action:function(e){var t=e.nearbyToolData;Q(e.eventData,t.tool,{skipAddLabelButton:!0,editLocation:!0})}},{actionType:"setDescription",action:function(e){var t=e.nearbyToolData;Q(e.eventData,t.tool,{editDescriptionOnDialog:!0})}}];function wt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(arguments.length>2&&arguments[2],function(e,t,n){var a={},o=!1;return n.forEach(function(n){var i=K.a.getToolState(e,n);if(i)return i.data.forEach(function(i,r){var s=K.a.getToolForElement(e,n);if(s||(s=K.a.getToolForElement(e,"".concat(n,"Tool"))),!s)throw new Error("Tool not found.");s.pointNearTool(e,i,t)&&(o=!0,a.tool=i,a.index=r,a.toolType=n)}),!o&&void 0}),o?a:void 0}(e.element,e.currentPoints.canvas,St));if(!t||!n||"arrowAnnotate"!==n.toolType){var a=[];return n&&Dt.forEach(function(t){t.params={eventData:e,nearbyToolData:n},"Delete"===t.actionType&&(t.text="Delete measurement"),"setLabel"===t.actionType&&(t.text="Relabel"),"setDescription"===t.actionType&&(t.text="".concat(n.tool.description?"Edit":"Add"," Description")),a.push(t)}),a}}var Tt=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(i.a)(this,Object(r.a)(t).call(this,e))).componentDidMount=function(){n.mainElement.current&&n.updateElementPosition()},n.componentDidUpdate=function(){n.mainElement.current&&n.updateElementPosition()},n.updateElementPosition=function(){var e=n.mainElement.current,t=e.offsetParent,a=e.offsetTop,o=e.offsetHeight,i=e.offsetWidth,r=e.offsetLeft,s=n.props.eventData;if(a+o>t.offsetHeight){var c=a+o-t.offsetHeight,l=s.currentPoints.canvas.y-c;n.mainElement.current.style.top="".concat(l>0?l:0,"px")}if(r+i>t.offsetWidth){var u=r+i-t.offsetWidth,p=s.currentPoints.canvas.x-u;n.mainElement.current.style.left="".concat(p>0?p:0,"px")}},n.mainElement=l.a.createRef(),n}return Object(s.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this;if(!this.props.eventData)return null;var t=this.props,n=t.isTouchEvent,a=t.eventData,o=wt(a,n,t.availableTools);if(!o.length)return"";var i=o.map(function(t){return l.a.createElement("li",{key:t.actionType},l.a.createElement("button",{className:"form-action",onClick:function(n){t.action(t.params),e.props.onClose&&e.props.onClose()}},l.a.createElement("span",{key:t.actionType},t.text)))}),r={top:"".concat(a.currentPoints.canvas.y,"px"),left:"".concat(a.currentPoints.canvas.x,"px")};return l.a.createElement("div",{className:"ToolContextMenu",style:r,ref:this.mainElement},l.a.createElement("ul",{className:"bounded"},i))}}]),t}(c.Component);Tt.defaultProps={visible:!0,isTouchEvent:!1};var Ct=Tt,kt=Object(p.b)(function(e,t){if(!e.ui||!e.ui.contextMenu)return{visible:!1};var n,a=t.viewportIndex,o=e.ui.contextMenu[a];return e.extensions&&e.extensions.cornerstone&&e.extensions.cornerstone.availableTools&&(n=e.extensions.cornerstone.availableTools),Object(X.a)({},o,{availableTools:n})},null)(Ct),It=m.b.extensions.ExtensionManager,jt=m.b.redux,Lt=jt.reducers,xt=jt.localStorage;Lt.ui=O,Lt.oidc=$e.reducer;var Mt=Object(d.b)(Lt),Nt=Object(d.c)(Mt,xt.loadState());Nt.subscribe(function(){xt.saveState({preferences:Nt.getState().preferences})}),function(e){var t=function(e){var t=function(t){e.dispatch(function(e){return{type:"SET_LABELLING_FLOW_DATA",labellingFlowData:e}}(t))};return function(e,n,a){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i={visible:!0,eventData:n,measurementData:e,skipAddLabelButton:o.skipAddLabelButton,editLocation:o.editLocation,editDescription:o.editDescription,editResponse:o.editResponse,editDescriptionOnDialog:o.editDescriptionOnDialog,labellingDoneCallback:function(){t({visible:!1})},updateLabelling:function(t){var n=t.location,a=t.response,o=t.description;n&&(e.location=n),o&&(e.description=o),a&&(e.response=a),Z(e)}};t(i)}}(e),n=[{name:"Pan",mouseButtonMasks:[1,4]},{name:"Zoom",mouseButtonMasks:[1,2]},{name:"Wwwc",mouseButtonMasks:[1]},{name:"Bidirectional",configuration:{configuration:{getMeasurementLocationCallback:t}},mouseButtonMasks:[1]},{name:"Length",configuration:{configuration:{getMeasurementLocationCallback:t}},mouseButtonMasks:[1]},{name:"Angle",configuration:{configuration:{getMeasurementLocationCallback:t}},mouseButtonMasks:[1]},{name:"StackScroll",mouseButtonMasks:[1]},{name:"Brush",mouseButtonMasks:[1]},{name:"FreehandMouse",configuration:{configuration:{getMeasurementLocationCallback:t}},mouseButtonMasks:[1]},{name:"EllipticalRoi",configuration:{configuration:{getMeasurementLocationCallback:t}},mouseButtonMasks:[1]},{name:"CircleRoi",configuration:{configuration:{getMeasurementLocationCallback:t}},mouseButtonMasks:[1]},{name:"RectangleRoi",configuration:{configuration:{getMeasurementLocationCallback:t}},mouseButtonMasks:[1]},{name:"PanMultiTouch"},{name:"ZoomTouchPinch"},{name:"StackScrollMouseWheel"},{name:"StackScrollMultiTouch"}],a=yt(e),o=Et(e),i=Ot(e),r=Ot(e),s=Ot(e),c=m.b.redux.actions.setExtensionData("cornerstone",{availableTools:n,onNewImage:i,onRightClick:a,onTouchPress:o,onTouchStart:s,onMouseClick:r});e.dispatch(c)}(Nt);var Ut={viewport:[l.a.createElement(kt,null)]},Pt=[new lt.a({children:Ut}),new ut.a,new pt.a,new dt.a,new mt.a];It.registerExtensions(Nt,Pt),window.store=Nt;var At=function(e){function t(e){var n;Object(a.a)(this,t),n=Object(i.a)(this,Object(r.a)(t).call(this,e));var o,s=ft(n.props.routerBasename),c=m.b.redux.actions.setAvailableButtons(s);if(Nt.dispatch(c),n.props.oidc.length){var l=n.props.oidc[0];n.userManager=vt(Nt,l)}return(o=n.props.servers)&&m.b.utils.addServers(o,Nt),ht(n.props.routerBasename,n.props.relativeWebWorkerScriptsPath),n}return Object(s.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this.userManager;return e?l.a.createElement(p.a,{store:Nt},l.a.createElement($e.OidcProvider,{store:Nt,userManager:e},l.a.createElement(u.a,{basename:this.props.routerBasename},l.a.createElement(k.Provider,{value:this.props.whiteLabelling},l.a.createElement(ct,{userManager:e}))))):l.a.createElement(p.a,{store:Nt},l.a.createElement(u.a,{basename:this.props.routerBasename},l.a.createElement(k.Provider,{value:this.props.whiteLabelling},l.a.createElement(ct,null))))}}]),t}(c.Component);At.defaultProps={whiteLabelling:{},oidc:[]};var Rt=At,Bt=n(11),Ft=n.n(Bt);n.d(t,"App",function(){return Rt}),window.config=window.config||{};var _t=Object.assign({},{routerBasename:"/",relativeWebWorkerScriptsPath:""},window.config),Wt=l.a.createElement(Rt,_t,null);Ft.a.render(Wt,document.getElementById("root"))},63:function(e,t,n){e.exports=n(100)},72:function(e,t,n){},76:function(e,t,n){},78:function(e,t,n){},79:function(e,t,n){},80:function(e,t,n){},81:function(e,t,n){},82:function(e,t,n){},83:function(e,t,n){},84:function(e,t,n){},92:function(e,t,n){},93:function(e,t,n){},96:function(e,t,n){},97:function(e,t,n){},98:function(e,t,n){},99:function(e,t,n){}},[[63,1,2]]]);
//# sourceMappingURL=main.e21947da.chunk.js.map